<div id="CompositionalRefinement">
<div class="head">
<h1>Theory CompositionalRefinement</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: Value-Dependent SIFUM Refinement
Authors: Toby Murray, Robert Sison
*)</span>
<span class="keyword1"><span class="command">theory</span></span> CompositionalRefinement
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../Dependent_SIFUM_Type_Systems/Compositionality.html">Dependent_SIFUM_Type_Systems.Compositionality</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">lemma</span></span> inj_card_le<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="free">f</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⟹</span> finite <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'b</span> set<span class="main">)</span> <span class="main">⟹</span> card <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'b</span> set<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> card_inj_on_le<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We define a generic locale for capturing refinement between an abstract and a concrete
  program. We then define and prove sufficient, conditions that preserve local security
  from the abstract to the concrete program.

  Below we define a second locale that is more restrictive than this one. Specifically, this
  one allows the concrete program to have extra variables not present in the abstract one.
  These variables might be used, for instance, to implement a runtime stack that was implicit
  in the semantics of the abstract program; or as temporary storage for expression evaluation
  that may (appear to be) atomic in the abstract semantics.

  The simpler locale below forbids extra variables in the concrete program, making the
  necessary conditions for preservation of local security simpler.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> sifum_refinement <span class="main">=</span> 
  abs<span class="main">:</span> sifum_security <span class="quoted"><span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="quoted"><span class="free">𝒞_vars<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="quoted"><span class="free">𝒞<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="quoted"><span class="free">eval<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="quoted"><span class="free">some_val</span></span> <span class="main">+</span>
  conc<span class="main">:</span> sifum_security <span class="quoted"><span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="quoted"><span class="free">𝒞_vars<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="quoted"><span class="free">𝒞<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="quoted"><span class="free">eval<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="quoted"><span class="free">some_val</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="tfree">'Val</span><span class="main">)</span> Mem <span class="main">⇒</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⇒</span> Sec"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="tfree">'Val</span><span class="main">)</span> Mem <span class="main">⇒</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⇒</span> Sec"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">𝒞_vars<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⇒</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">𝒞_vars<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⇒</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">𝒞<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">𝒞<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eval<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">)</span> LocalConf rel"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eval<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">)</span> LocalConf rel"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">some_val</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Val</span>"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⇒</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> var<span class="hidden">⇩</span><sub>C</sub>_of_inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> dma_consistent<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">.</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 𝒞_vars_consistent<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">`</span> <span class="free">𝒞_vars<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">𝒞_vars<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span>
  <span class="comment1">(* we make the (reasonable IMHO) assumption that the only control variables
     are user-declared and so that the compiler won't introduce new ones. *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> control_vars_are_A_vars<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">𝒞<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">`</span> <span class="free">𝒞<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"General Compositional Refinement"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The type of state relations between the abstract and compiled components.
  The job of a certifying compiler will be to exhibit one of these for each
  component it compiles. Below we'll define the conditions that such a
  relation needs to satisfy to give compositional refinement.
›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">,</span> <span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> state_relation <span class="main">=</span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">)</span> LocalConf <span class="main">×</span> <span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">)</span> LocalConf<span class="main">)</span> set"</span></span>

<span class="keyword1"><span class="command">context</span></span> sifum_refinement <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> 
  <span class="entity">conf_abv<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⇒</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span> Mds <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">)</span> Mem <span class="main">⇒</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">)</span> LocalConf"</span></span>
  <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_<span class="keyword1">,</span> _<span class="keyword1">,</span> _<span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 0<span class="main">]</span> 1000<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="keyword1"><span class="free">⟩<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> 
  <span class="entity">conf_abv<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⇒</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> Mds <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">)</span> Mem <span class="main">⇒</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">)</span> LocalConf"</span></span>
  <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_<span class="keyword1">,</span> _<span class="keyword1">,</span> _<span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 0<span class="main">]</span> 1000<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="keyword1"><span class="free">⟩<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> 
  <span class="entity">eval_abv<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">)</span> LocalConf <span class="main">⇒</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> LocalConf <span class="main">⇒</span> bool"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">↝<span class="hidden">⇩</span><sub>A</sub></span>"</span> 70<span class="main">)</span>
 <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">↝<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">eval<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> 
  <span class="entity">eval_abv<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">)</span> LocalConf <span class="main">⇒</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> LocalConf <span class="main">⇒</span> bool"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span>"</span> 70<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">↝<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">eval<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">preserves_modes_mem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">,</span> <span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> state_relation <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">preserves_modes_mem</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">≡</span> 
  <span class="main">(</span><span class="main">∀</span> <span class="bound">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">.</span> <span class="main">(</span><span class="bound">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">`</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">=</span> <span class="main">(</span>range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span> <span class="main">∩</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">mem<span class="hidden">⇩</span><sub>A</sub>_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">)</span> Mem <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">)</span> Mem"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>A</sub>_of</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">≡</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">mds<span class="hidden">⇩</span><sub>A</sub>_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> Mds <span class="main">⇒</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span> Mds"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>A</sub>_of</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span>inv <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> low_mds_eq_from_conc_to_abs<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conc.low_mds_eq <span class="free">mds</span> <span class="free">mem</span> <span class="free">mem'</span> <span class="main">⟹</span> abs.low_mds_eq <span class="main">(</span>mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds</span><span class="main">)</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem</span><span class="main">)</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs.low_mds_eq_def conc.low_mds_eq_def mem<span class="hidden">⇩</span><sub>A</sub>_of_def mds<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> var<span class="hidden">⇩</span><sub>C</sub>_of_inj 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntI control_vars_are_A_vars dma_consistent image_eqI inv_f_f rangeI<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">var<span class="hidden">⇩</span><sub>A</sub>_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⇒</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">var<span class="hidden">⇩</span><sub>A</sub>_of</span> <span class="main">≡</span> inv <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preserves_modes_mem_mem<span class="hidden">⇩</span><sub>A</sub>_simp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">.</span> <span class="main">(</span><span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> preserves_modes_mem_mds<span class="hidden">⇩</span><sub>A</sub>_simp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">`</span> <span class="free">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">=</span> range <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span> <span class="main">∩</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">m</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="free">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mds<span class="hidden">⇩</span><sub>A</sub>_of_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> equalityI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x<span class="hidden">⇩</span><sub>A</sub><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> equalityD1<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="improper">x<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">unfolding</span></span> image_def
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="improper">x<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv_f_f<span class="main"><span class="main">[</span></span><span class="operator">OF</span> var<span class="hidden">⇩</span><sub>C</sub>_of_inj<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> inj_onD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> var<span class="hidden">⇩</span><sub>C</sub>_of_inj<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x<span class="hidden">⇩</span><sub>A</sub><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_f_f<span class="main"><span class="main">[</span></span><span class="operator">OF</span> var<span class="hidden">⇩</span><sub>C</sub>_of_inj<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> equalityD2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="improper">x<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subsetD<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> inj_onD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> var<span class="hidden">⇩</span><sub>C</sub>_of_inj<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This version might be more useful. Not sure yet.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> preserves_modes_mem_def2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"preserves_modes_mem <span class="free">ℛ</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">∀</span> <span class="bound">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">⟶</span>
      <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
      <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> preserves_modes_mem_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> preserves_modes_mem_mem<span class="hidden">⇩</span><sub>A</sub>_simp preserves_modes_mem_mds<span class="hidden">⇩</span><sub>A</sub>_simp<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> allE impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x<span class="hidden">⇩</span><sub>A</sub><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> allE impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mds<span class="hidden">⇩</span><sub>A</sub>_of_def image_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_f_f<span class="main"><span class="main">[</span></span><span class="operator">OF</span> var<span class="hidden">⇩</span><sub>C</sub>_of_inj<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x<span class="hidden">⇩</span><sub>A</sub><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> allE impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mds<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> image_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="improper">x<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_f_f<span class="main"><span class="main">[</span></span><span class="operator">OF</span> var<span class="hidden">⇩</span><sub>C</sub>_of_inj<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">closed_others</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">,</span> <span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> state_relation <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">closed_others</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">≡</span> 
  <span class="main">(</span><span class="main">∀</span> <span class="bound">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span> <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">⟶</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">stops<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">)</span> LocalConf <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">stops<span class="hidden">⇩</span><sub>C</sub></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">c'</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> neval_induct <span class="main">=</span> abs.neval.induct<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> Zero Suc<span class="main">]</span>

<span class="comment1">(* FIXME: move to Security.thy or similar *)</span>
<span class="keyword1"><span class="command">lemma</span></span> strong_low_bisim_neval'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"abs.neval <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span> <span class="free">c<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> snd <span class="main">(</span>fst <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>fst <span class="free">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span> <span class="main">⟹</span> abs.strong_low_bisim_mm <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span>
  <span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>n</sub>'</span><span class="main">.</span> abs.neval <span class="free">c<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="free">n</span> <span class="bound">c<span class="hidden">⇩</span><sub>n</sub>'</span> <span class="main">∧</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>n</sub></span><span class="main">,</span><span class="bound">c<span class="hidden">⇩</span><sub>n</sub>'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span> snd <span class="main">(</span>fst <span class="free">c<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>fst <span class="main">(</span><span class="bound">c<span class="hidden">⇩</span><sub>n</sub>'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span>  <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">c<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> neval_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Zero <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"abs.neval <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">0</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>n</sub></span><span class="main">,</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span> snd <span class="main">(</span>fst <span class="skolem">c<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>fst <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> abs.neval.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
   <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">lc<span class="hidden">⇩</span><sub>0</sub></span> <span class="skolem">lc<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">n</span> <span class="skolem">lc<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">lc<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="skolem"><span class="skolem">mds<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>0</sub></span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lc<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>0</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">lc<span class="hidden">⇩</span><sub>0</sub></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">mds<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub></span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lc<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">lc<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹snd <span class="main">(</span>fst <span class="skolem">lc<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>fst <span class="skolem">lc<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>0</sub>'</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>0</sub>'</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lc<span class="hidden">⇩</span><sub>0</sub>'</span> <span class="main">=</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>0</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">lc<span class="hidden">⇩</span><sub>0</sub>'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">lc<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="skolem">lc<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span>›</span></span><span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">lc<span class="hidden">⇩</span><sub>0</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">lc<span class="hidden">⇩</span><sub>1</sub></span>›</span></span><span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹abs.strong_low_bisim_mm <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>0</sub>'</span><span class="main">,</span><span class="skolem">mds<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>0</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">,</span><span class="skolem">mds<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
          b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="skolem">mds<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">,</span><span class="skolem">mds<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> abs.strong_low_bisim_mm_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> this Suc.hyps Suc<span class="main">(</span>6<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lc<span class="hidden">⇩</span><sub>S</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"abs.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">,</span><span class="skolem">mds<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">n</span> <span class="skolem">lc<span class="hidden">⇩</span><sub>S</sub>'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">lc<span class="hidden">⇩</span><sub>n</sub></span><span class="main">,</span> <span class="skolem">lc<span class="hidden">⇩</span><sub>S</sub>'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>fst <span class="skolem">lc<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>fst <span class="skolem">lc<span class="hidden">⇩</span><sub>S</sub>'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">with</span></span> Suc this a b <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> abs.neval.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> strong_low_bisim_neval<span class="main">:</span>
  <span class="quoted"><span class="quoted">"abs.neval <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">n</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>n</sub></span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>n</sub></span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>n</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> abs.strong_low_bisim_mm <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span>
  <span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>n</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>n</sub>'</span><span class="main">.</span> abs.neval <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">n</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>n</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>n</sub></span><span class="main">,</span><span class="bound">mem<span class="hidden">⇩</span><sub>n</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span> <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>n</sub></span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>n</sub></span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>n</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>n</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>n</sub></span><span class="main">,</span><span class="bound">mem<span class="hidden">⇩</span><sub>n</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">drule</span> strong_low_bisim_neval'<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> in_ℛ_dma'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> preserves<span class="main">:</span> <span class="quoted"><span class="quoted">"preserves_modes_mem <span class="free">ℛ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_ℛ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span>
    mds<span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  
    mem<span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> preserves_modes_mem_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> dma_consistent<span class="main">)</span>
  
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> in_ℛ_dma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> preserves<span class="main">:</span> <span class="quoted"><span class="quoted">"preserves_modes_mem <span class="free">ℛ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_ℛ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∘</span> <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> o_def
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> in_ℛ_dma'<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">new_vars_private</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">,</span> <span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> state_relation <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">new_vars_private</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">≡</span>
  <span class="main">(</span><span class="main">∀</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> 
   <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∀</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟶</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="main">(</span><span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≠</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">&lt;</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> AsmNoReadOrWrite<span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoReadOrWrite <span class="main">-</span> <span class="main">(</span>range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> AsmNoReadOrWrite <span class="main">-</span> <span class="main">(</span>range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> not_less_eq_is_greater_Sec<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="free">a</span> <span class="main">≤</span> <span class="main">(</span><span class="free">b</span><span class="main">::</span>Sec<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">&gt;</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> less_Sec_def less_eq_Sec_def <span class="keyword1"><span class="command">using</span></span> Sec.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> doesnt_have_mode<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∉</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mds<span class="hidden">⇩</span><sub>A</sub>_of_def image_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_f_f<span class="main"><span class="main">[</span></span><span class="operator">OF</span> var<span class="hidden">⇩</span><sub>C</sub>_of_inj<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_f_f<span class="main"><span class="main">[</span></span><span class="operator">OF</span> var<span class="hidden">⇩</span><sub>C</sub>_of_inj<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> new_vars_private_does_the_thing<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nice<span class="main">:</span> <span class="quoted"><span class="quoted">"new_vars_private <span class="free">ℛ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_ℛ<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_ℛ<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> step<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> step<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> low_mds_eq<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"conc.low_mds_eq <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> low_mds_eq<span class="hidden">⇩</span><sub>A</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"abs.low_mds_eq <span class="main">(</span>mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conc.low_mds_eq <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> conc.low_mds_eq_def
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span>
  <span class="keyword3"><span class="command">assume</span></span> is_Low<span class="hidden">⇩</span><sub>C</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Low"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> is_readable<span class="hidden">⇩</span><sub>C</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free">𝒞<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> AsmNoReadOrWrite"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≥</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoReadOrWrite <span class="main">⟶</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> AsmNoReadOrWrite<span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> easy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≥</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoReadOrWrite <span class="main">⟶</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> AsmNoReadOrWrite<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> is_Low<span class="hidden">⇩</span><sub>C</sub>' <span class="keyword1"><span class="command">have</span></span> is_Low<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Low"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_Sec_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> easy is_readable<span class="hidden">⇩</span><sub>C</sub>' <span class="keyword1"><span class="command">have</span></span> is_readable<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free">𝒞<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoReadOrWrite"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> is_Low<span class="hidden">⇩</span><sub>C</sub> is_readable<span class="hidden">⇩</span><sub>C</sub> low_mds_eq<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> conc.low_mds_eq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> easy <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≤</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
       <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
       <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoReadOrWrite <span class="main">⟶</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> AsmNoReadOrWrite<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> a_disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">&gt;</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span>
       <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≠</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span>
       <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≠</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoReadOrWrite <span class="main">∧</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> AsmNoReadOrWrite<span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> not_less_eq_is_greater_Sec <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> C_only_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> in_ℛ<span class="hidden">⇩</span><sub>1</sub> step<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub> nice
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≠</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">&lt;</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> AsmNoReadOrWrite"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> new_vars_private_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> C_only_var in_ℛ<span class="hidden">⇩</span><sub>2</sub> step<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> nice <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≠</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> AsmNoReadOrWrite"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> new_vars_private_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> C_only_var in_ℛ<span class="hidden">⇩</span><sub>1</sub> step<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub> nice <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoReadOrWrite <span class="main">⟶</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> AsmNoReadOrWrite"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> new_vars_private_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> C_only_var is_readable<span class="hidden">⇩</span><sub>C</sub>' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> AsmNoReadOrWrite"</span></span>
        <span class="keyword1"><span class="command">using</span></span> control_vars_are_A_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> a_disj <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> in_val<span class="hidden">⇩</span><sub>C</sub>_of<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="hidden">⇩</span><sub>C</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> is_Low<span class="hidden">⇩</span><sub>C</sub>' <span class="keyword1"><span class="command">have</span></span> is_Low<span class="hidden">⇩</span><sub>A</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> Low"</span></span>
        <span class="keyword1"><span class="command">using</span></span> dma_consistent <span class="keyword1"><span class="command">unfolding</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def x<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">from</span></span> is_readable<span class="hidden">⇩</span><sub>C</sub>' <span class="keyword1"><span class="command">have</span></span> is_readable<span class="hidden">⇩</span><sub>A</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∈</span> <span class="free">𝒞<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∨</span> <span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∉</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span> AsmNoReadOrWrite"</span></span>
        <span class="keyword1"><span class="command">using</span></span> control_vars_are_A_vars x<span class="hidden">⇩</span><sub>C</sub>_def doesnt_have_mode<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> var<span class="hidden">⇩</span><sub>C</sub>_of_inj inj_image_mem_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">with</span></span> is_Low<span class="hidden">⇩</span><sub>A</sub>' low_mds_eq<span class="hidden">⇩</span><sub>A</sub>' <span class="keyword1"><span class="command">have</span></span> x<span class="hidden">⇩</span><sub>A</sub>_eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> abs.low_mds_eq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def x<span class="hidden">⇩</span><sub>C</sub>_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Perhaps surprisingly, we don't necessarily 
  care whether the refinement preserves
  termination or divergence behaviour from the source to the target program.
  It can do whatever it likes, so long as it transforms two source programs
  that are low bisimilar (i.e. perform the same low actions at the 
  same time), into two target ones that perform the same low actions at the
  same time.

  Having the concrete step correspond to zero abstract ones is like expanding
  abstract code out (think e.g. of side-effect free expression evaluation).
  Having the concrete step correspond to more than one abstract step is
  like optimising out abstract code. But importantly, the optimisation needs
  to look the same for abstract-bisimilar code.

  Additionally, we allow the instantiation of this theory to supply
  an arbitrary predicate that can be used to restrict our consideration to
  pairs of concrete steps that correspond to each other in terms of progress.
  This is particularly important for distinguishing between multiple concrete
  steps derived from the expansion of a single abstract step.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">secure_refinement</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">)</span> LocalConf rel <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">,</span> <span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> state_relation <span class="main">⇒</span> 
                          <span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">)</span> LocalConf rel <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">secure_refinement</span> <span class="free"><span class="bound"><span class="entity">ℛ<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span>
  closed_others <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">∧</span>
  preserves_modes_mem <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">∧</span>
  new_vars_private <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">∧</span>
  conc.closed_glob_consistent <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> 
   <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∀</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟶</span>
     <span class="main">(</span><span class="main">∃</span> <span class="bound">n</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span> abs.neval <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">n</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span>
                   <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span> 
         <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span>
         abs.neval <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">n</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>  <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∃</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
                   <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">∧</span>
                   <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preserves_modes_memD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>preserves_modes_mem <span class="free">ℛ</span><span class="main">;</span> <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span> <span class="free">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> preserves_modes_mem_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> secure_refinement_def2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"secure_refinement <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span> <span class="main">≡</span>
  closed_others <span class="free">ℛ</span> <span class="main">∧</span>
  preserves_modes_mem <span class="free">ℛ</span> <span class="main">∧</span>
  new_vars_private <span class="free">ℛ</span> <span class="main">∧</span>
  conc.closed_glob_consistent <span class="free">P</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> 
   <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∀</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟶</span>
     <span class="main">(</span><span class="main">∃</span> <span class="bound">n</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span> abs.neval <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">n</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span>
                   <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span> 
         <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span>
         abs.neval <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">n</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>  <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∃</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
                   <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">∧</span>
                   <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> eq_reflection<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conj_cong<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conj_cong<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conj_cong<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conj_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI conjI impI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="main">(</span><span class="operator">drule</span> spec<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> impE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="main">(</span><span class="operator">drule</span> spec<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> impE<span class="main">)</span>
   <span class="keyword1"><span class="command">using</span></span> preserves_modes_memD <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI conjI impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> preserves_modes_memD<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="main">(</span><span class="operator">drule</span> spec<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> impE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="main">(</span><span class="operator">drule</span> spec<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> impE<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> preserves_modes_memD <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> extra_vars_are_not_control_vars<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">𝒞<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> contrapos_nn<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">𝒞<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> control_vars_are_A_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">R<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">::</span> 
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">×</span> <span class="main">(</span>Mode <span class="main">⇒</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span> set<span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⇒</span> <span class="tfree">'Val</span><span class="main">)</span><span class="main">)</span> <span class="main">×</span>
    <span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">×</span> <span class="main">(</span>Mode <span class="main">⇒</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span> set<span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⇒</span> <span class="tfree">'Val</span><span class="main">)</span><span class="main">)</span> set <span class="main">⇒</span> 
  <span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">,</span> <span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> state_relation <span class="main">⇒</span>
  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">×</span> <span class="main">(</span>Mode <span class="main">⇒</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> set<span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⇒</span> <span class="tfree">'Val</span><span class="main">)</span><span class="main">)</span> <span class="main">×</span>
    <span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">×</span> <span class="main">(</span>Mode <span class="main">⇒</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> set<span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⇒</span> <span class="tfree">'Val</span><span class="main">)</span><span class="main">)</span> set <span class="main">⇒</span>
  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">×</span> <span class="main">(</span>Mode <span class="main">⇒</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> set<span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⇒</span> <span class="tfree">'Val</span><span class="main">)</span><span class="main">)</span> <span class="main">×</span>
    <span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">×</span> <span class="main">(</span>Mode <span class="main">⇒</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> set<span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⇒</span> <span class="tfree">'Val</span><span class="main">)</span><span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">R<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free"><span class="bound"><span class="entity">ℛ<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">y<span class="hidden">⇩</span><sub>A</sub></span><span class="main">.</span> <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="bound">y<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">y<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">∧</span>
     snd <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>fst <span class="bound">y</span><span class="main">)</span> <span class="comment1">― ‹TODO: annoying to have to say›</span> <span class="main">∧</span>
     conc.low_mds_eq <span class="main">(</span>snd <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> abs_low_mds_eq_dma<span class="hidden">⇩</span><sub>C</sub>_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"abs.low_mds_eq <span class="main">(</span>mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds</span><span class="main">)</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>  <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> conc.dma_𝒞<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ballI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free">𝒞<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∈</span> <span class="free">𝒞<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> control_vars_are_A_vars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∈</span> <span class="free">𝒞<span class="hidden">⇩</span><sub>A</sub></span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> abs.low_mds_eq_def
      <span class="keyword1"><span class="command">using</span></span> abs.𝒞_Low <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> R<span class="hidden">⇩</span><sub>C</sub>_ofD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rr<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_refinement <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> R<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">.</span>  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∧</span>
    conc.low_mds_eq <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ℛ_preserves_modes_mem<span class="main">:</span> <span class="quoted"><span class="quoted">"preserves_modes_mem <span class="free">ℛ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rr <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> in_R <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">mds<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">mds<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span>
  in_ℛ<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  in_ℛ<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  in_ℛ<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  pred_holds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  mds_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  mds_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"conc.low_mds_eq <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> R<span class="hidden">⇩</span><sub>C</sub>_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
  
  <span class="keyword1"><span class="command">from</span></span> this ℛ_preserves_modes_mem<span class="main">[</span><span class="operator">simplified</span> preserves_modes_mem_def2<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> in_ℛ<span class="hidden">⇩</span><sub>1</sub><span class="main">]</span> ℛ_preserves_modes_mem<span class="main">[</span><span class="operator">simplified</span> preserves_modes_mem_def2<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> in_ℛ<span class="hidden">⇩</span><sub>2</sub><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> R<span class="hidden">⇩</span><sub>C</sub>_ofI<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span>
    conc.low_mds_eq <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">⟹</span>
     <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> R<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> R<span class="hidden">⇩</span><sub>C</sub>_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> R<span class="hidden">⇩</span><sub>C</sub>_of_sym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rr<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_refinement <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mm<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">mds</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">mds</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="main">.</span> <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span>
    abs.low_mds_eq <span class="bound">mds</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span>R<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> symI<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span>  <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>
  <span class="keyword3"><span class="command">assume</span></span> in_R<span class="hidden">⇩</span><sub>C</sub>_of<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> R<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> in_R<span class="hidden">⇩</span><sub>C</sub>_of <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span>
  junk<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span>
    <span class="main">(</span><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∧</span> conc.low_mds_eq <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rr R<span class="hidden">⇩</span><sub>C</sub>_ofD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> dma_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abs_low_mds_eq_dma<span class="hidden">⇩</span><sub>C</sub>_eq<span class="main">[</span><span class="operator">OF</span> mm<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> junk <span class="keyword1"><span class="command">have</span></span> junk'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span>
    <span class="main">(</span><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∧</span>
   conc.low_mds_eq <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sym <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span>›</span></span> P_sym <span class="keyword1"><span class="command">unfolding</span></span> sym_def <span class="keyword1"><span class="command">using</span></span> conc.low_mds_eq_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> R<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> R<span class="hidden">⇩</span><sub>C</sub>_ofI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> R<span class="hidden">⇩</span><sub>C</sub>_of_simp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rr<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_refinement <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> R<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span> <span class="main">=</span>
   <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">.</span>  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∧</span>
    conc.low_mds_eq <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> R<span class="hidden">⇩</span><sub>C</sub>_ofD <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> R<span class="hidden">⇩</span><sub>C</sub>_ofI<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">A<span class="hidden">⇩</span><sub>A</sub>_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="tfree">'Val</span><span class="main">)</span> adaptation <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="tfree">'Val</span><span class="main">)</span> adaptation"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">A<span class="hidden">⇩</span><sub>A</sub>_of</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">.</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span>
                  Some <span class="main">(</span><span class="bound">v</span><span class="main">,</span><span class="bound">v'</span><span class="main">)</span> <span class="main">⇒</span> Some <span class="main">(</span><span class="bound">v</span><span class="main">,</span><span class="bound">v'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> var_writable<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> var_asm_not_written <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span> var_asm_not_written <span class="main">(</span>mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> var_asm_not_written_def mds<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inv_f_f<span class="main"><span class="main">[</span></span><span class="operator">OF</span> var<span class="hidden">⇩</span><sub>C</sub>_of_inj<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> A<span class="hidden">⇩</span><sub>A</sub>_asm_mem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="hidden">⇩</span><sub>C</sub>_asm_mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span> <span class="keyword1">of</span> None <span class="main">⇒</span> True
           <span class="main">|</span> Some <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">⇒</span>
               <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">v</span> <span class="main">∨</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">v'</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">case</span> <span class="main">(</span>A<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="free">x</span> <span class="keyword1">of</span> None <span class="main">⇒</span> True
           <span class="main">|</span> Some <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">⇒</span>
               <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="free">x</span> <span class="main">≠</span> <span class="bound">v</span> <span class="main">∨</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="free">x</span> <span class="main">≠</span> <span class="bound">v'</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="main">(</span>mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">split</span> option.splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">v'</span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="hidden">⇩</span><sub>A</sub>_not_None<span class="main">:</span> <span class="quoted"><span class="quoted">"A<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">x</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="hidden">⇩</span><sub>A</sub>_updates_x<span class="main">:</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">⟶</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="free">x</span> <span class="main">≠</span> <span class="skolem">v'</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> A<span class="hidden">⇩</span><sub>A</sub>_not_None <span class="keyword1"><span class="command">have</span></span>
      A<span class="hidden">⇩</span><sub>C</sub>_not_None<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> A<span class="hidden">⇩</span><sub>A</sub>_of_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> A<span class="hidden">⇩</span><sub>A</sub>_updates_x  <span class="keyword1"><span class="command">have</span></span>
      A<span class="hidden">⇩</span><sub>C</sub>_updates_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">v</span> <span class="main">∨</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">v'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">from</span></span> A<span class="hidden">⇩</span><sub>C</sub>_not_None A<span class="hidden">⇩</span><sub>C</sub>_updates_x A<span class="hidden">⇩</span><sub>C</sub>_asm_mem <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">¬</span> var_asm_not_written <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> var_asm_not_written <span class="main">(</span>mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> var_writable<span class="hidden">⇩</span><sub>A</sub><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dma<span class="hidden">⇩</span><sub>A</sub>_adaptation_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> A<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> dma_consistent<span class="main"><span class="main">[</span></span><span class="operator">folded</span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> fun_cong<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apply_adaptation_def A<span class="hidden">⇩</span><sub>A</sub>_of_def mem<span class="hidden">⇩</span><sub>A</sub>_of_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  
<span class="keyword1"><span class="command">lemma</span></span> A<span class="hidden">⇩</span><sub>A</sub>_asm_dma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="hidden">⇩</span><sub>C</sub>_asm_dma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>A<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="main">(</span>mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> impI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="hidden">⇩</span><sub>A</sub>_updates_dma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> A<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
 
  <span class="keyword1"><span class="command">with</span></span> dma_consistent<span class="main">[</span><span class="operator">folded</span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">]</span> dma<span class="hidden">⇩</span><sub>A</sub>_adaptation_eq
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">≠</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span><span class="main">)</span>

  <span class="keyword1"><span class="command">with</span></span> A<span class="hidden">⇩</span><sub>C</sub>_asm_dma <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> var_asm_not_written <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> var_asm_not_written <span class="main">(</span>mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span>  var_writable<span class="hidden">⇩</span><sub>A</sub><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> var<span class="hidden">⇩</span><sub>C</sub>_of_in_𝒞<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∈</span> <span class="free">𝒞<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∈</span> <span class="free">𝒞<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∈</span> <span class="free">𝒞_vars<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">y<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> abs.𝒞_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∈</span> <span class="free">𝒞_vars<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="skolem">y<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 𝒞_vars_consistent <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> conc.𝒞_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> doesnt_have_mode<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> doesnt_have_mode<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> has_mode<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> doesnt_have_mode<span class="hidden">⇩</span><sub>C</sub>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> A<span class="hidden">⇩</span><sub>A</sub>_sec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="hidden">⇩</span><sub>C</sub>_sec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> Low <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∉</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoReadOrWrite <span class="main">∨</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">𝒞<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">⟶</span>
           <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">[∥<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> A<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Low <span class="main">∧</span> <span class="main">(</span><span class="free">x</span> <span class="main">∉</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoReadOrWrite <span class="main">∨</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">𝒞<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> A<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">[∥<span class="hidden">⇩</span><sub>2</sub></span> A<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> x_is_Low<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> A<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Low"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> x_is_readable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoReadOrWrite <span class="main">∨</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">𝒞<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    
  <span class="keyword1"><span class="command">from</span></span> x_is_Low <span class="keyword1"><span class="command">have</span></span> x_is_Low<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> Low"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dma<span class="hidden">⇩</span><sub>A</sub>_adaptation_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> x_is_readable <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoReadOrWrite <span class="main">∨</span> <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">𝒞<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> doesnt_have_mode<span class="hidden">⇩</span><sub>C</sub>  var<span class="hidden">⇩</span><sub>C</sub>_of_in_𝒞<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> A<span class="hidden">⇩</span><sub>C</sub>_sec x_is_Low<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">[∥<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> A<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">[∥<span class="hidden">⇩</span><sub>2</sub></span> A<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def apply_adaptation_def A<span class="hidden">⇩</span><sub>A</sub>_of_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> apply_adaptation<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> A<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="main">(</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">[∥<span class="hidden">⇩</span><sub>2</sub></span> A<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="main">(</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">[∥<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def A<span class="hidden">⇩</span><sub>A</sub>_of_def apply_adaptation_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

 
<span class="keyword1"><span class="command">lemma</span></span> R<span class="hidden">⇩</span><sub>C</sub>_of_closed_glob_consistent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mm<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">mds</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">mds</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="main">.</span> <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span>
    abs.low_mds_eq <span class="bound">mds</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cgc<span class="main">:</span> <span class="quoted"><span class="quoted">"abs.closed_glob_consistent <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rr<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_refinement <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conc.closed_glob_consistent <span class="main">(</span>R<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> conc.closed_glob_consistent_def
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">A<span class="hidden">⇩</span><sub>C</sub></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> R<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this rr <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span>
       in_ℛ<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
       in_ℛ<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
       in_ℛ<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span>
       mds_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"conc.low_mds_eq <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span>
       P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> R<span class="hidden">⇩</span><sub>C</sub>_ofD<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="hidden">⇩</span><sub>C</sub>_asm_mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="skolem">A<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span> <span class="keyword1">of</span> None <span class="main">⇒</span> True
                                   <span class="main">|</span> Some <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">⇒</span>
                                      <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">v</span> <span class="main">∨</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">v'</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="hidden">⇩</span><sub>A</sub>_asm_mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="main">(</span>A<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">of</span> None <span class="main">⇒</span> True
                                           <span class="main">|</span> Some <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">⇒</span>
               <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">v</span> <span class="main">∨</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">v'</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="main">(</span>mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> A<span class="hidden">⇩</span><sub>A</sub>_asm_mem<span class="main">)</span>

  <span class="keyword3"><span class="command">assume</span></span> A<span class="hidden">⇩</span><sub>C</sub>_asm_dma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="hidden">⇩</span><sub>A</sub>_asm_dma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">.</span> <span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>A<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="main">(</span>mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> A<span class="hidden">⇩</span><sub>A</sub>_asm_dma<span class="main">)</span>

  <span class="keyword3"><span class="command">assume</span></span> A<span class="hidden">⇩</span><sub>C</sub>_sec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> Low <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∉</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoReadOrWrite <span class="main">∨</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">𝒞<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">⟶</span>
         <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">[∥<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="hidden">⇩</span><sub>A</sub>_sec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> A<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> Low <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∉</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoReadOrWrite <span class="main">∨</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">𝒞<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">⟶</span>
         <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> A<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">[∥<span class="hidden">⇩</span><sub>2</sub></span> A<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> A<span class="hidden">⇩</span><sub>A</sub>_sec<span class="main">)</span>
    
  <span class="keyword1"><span class="command">from</span></span> rr <span class="keyword1"><span class="command">have</span></span> others<span class="main">:</span> <span class="quoted"><span class="quoted">"closed_others <span class="free">ℛ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> rr <span class="keyword1"><span class="command">have</span></span> P_cgc<span class="main">:</span> <span class="quoted"><span class="quoted">"conc.closed_glob_consistent <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">[∥<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> A<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">[∥<span class="hidden">⇩</span><sub>2</sub></span> A<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> mem'_simps<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apply_adaptation<span class="hidden">⇩</span><sub>A</sub><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">from</span></span> cgc in_ℛ<span class="hidden">⇩</span><sub>A</sub> A<span class="hidden">⇩</span><sub>A</sub>_asm_mem A<span class="hidden">⇩</span><sub>A</sub>_asm_dma A<span class="hidden">⇩</span><sub>A</sub>_sec <span class="keyword1"><span class="command">have</span></span>
    in_ℛ<span class="hidden">⇩</span><sub>A</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> A<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">[∥<span class="hidden">⇩</span><sub>2</sub></span> A<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">A<span class="hidden">⇩</span><sub>C</sub></span><span class="main">]</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> abs.closed_glob_consistent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> A<span class="hidden">⇩</span><sub>C</sub>_asm_mem A<span class="hidden">⇩</span><sub>C</sub>_asm_dma <span class="keyword1"><span class="command">have</span></span> 
    A<span class="hidden">⇩</span><sub>C</sub>_asm_mem<span class="hidden">⇩</span><sub>1</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span> <span class="main">≠</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    A<span class="hidden">⇩</span><sub>C</sub>_asm_dma<span class="hidden">⇩</span><sub>1</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> apply_adaptation_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">from</span></span> A<span class="hidden">⇩</span><sub>C</sub>_asm_mem <span class="keyword1"><span class="command">have</span></span>
    A<span class="hidden">⇩</span><sub>C</sub>_asm_mem<span class="hidden">⇩</span><sub>2</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span> <span class="main">≠</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> apply_adaptation_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> in_ℛ<span class="hidden">⇩</span><sub>1</sub> A<span class="hidden">⇩</span><sub>C</sub>_asm_mem<span class="hidden">⇩</span><sub>1</sub>' A<span class="hidden">⇩</span><sub>C</sub>_asm_dma<span class="hidden">⇩</span><sub>1</sub>' others <span class="keyword1"><span class="command">have</span></span>
    in_ℛ<span class="hidden">⇩</span><sub>1</sub>'<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> closed_others_def mem'_simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> mm<span class="main">[</span><span class="operator">OF</span> in_ℛ<span class="hidden">⇩</span><sub>A</sub><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
    dma<span class="hidden">⇩</span><sub>C</sub>_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> abs_low_mds_eq_dma<span class="hidden">⇩</span><sub>C</sub>_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> dma<span class="hidden">⇩</span><sub>C</sub>_eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> abs_low_mds_eq_dma<span class="hidden">⇩</span><sub>C</sub>_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mm<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem'_simps<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> in_ℛ<span class="hidden">⇩</span><sub>A</sub>'<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> dma<span class="hidden">⇩</span><sub>C</sub>_eq dma<span class="hidden">⇩</span><sub>C</sub>_eq' A<span class="hidden">⇩</span><sub>C</sub>_asm_dma<span class="hidden">⇩</span><sub>1</sub>' <span class="keyword1"><span class="command">have</span></span>
    A<span class="hidden">⇩</span><sub>C</sub>_asm_dma<span class="hidden">⇩</span><sub>2</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> in_ℛ<span class="hidden">⇩</span><sub>2</sub>  A<span class="hidden">⇩</span><sub>C</sub>_asm_mem<span class="hidden">⇩</span><sub>2</sub>' A<span class="hidden">⇩</span><sub>C</sub>_asm_dma<span class="hidden">⇩</span><sub>2</sub>' others <span class="keyword1"><span class="command">have</span></span>
    in_ℛ<span class="hidden">⇩</span><sub>2</sub>'<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> closed_others_def mem'_simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> mds_eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"conc.low_mds_eq <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> A<span class="hidden">⇩</span><sub>C</sub>_sec <span class="keyword1"><span class="command">unfolding</span></span> conc.low_mds_eq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   
 <span class="keyword1"><span class="command">from</span></span> P P_cgc A<span class="hidden">⇩</span><sub>C</sub>_asm_mem A<span class="hidden">⇩</span><sub>C</sub>_asm_dma A<span class="hidden">⇩</span><sub>C</sub>_sec <span class="keyword1"><span class="command">have</span></span> P'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> conc.closed_glob_consistent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> in_ℛ<span class="hidden">⇩</span><sub>A</sub>' in_ℛ<span class="hidden">⇩</span><sub>1</sub>' in_ℛ<span class="hidden">⇩</span><sub>2</sub>' mem'_simps R<span class="hidden">⇩</span><sub>C</sub>_ofI mds_eq' P' <span class="keyword3"><span class="command">show</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> R<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> R<span class="hidden">⇩</span><sub>C</sub>_of_local_preservation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rr<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_refinement <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bisim<span class="main">:</span> <span class="quoted"><span class="quoted">"abs.strong_low_bisim_mm <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_R<span class="hidden">⇩</span><sub>C</sub>_of<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> R<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> step<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
          <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> R<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> rr in_R<span class="hidden">⇩</span><sub>C</sub>_of <span class="keyword1"><span class="command">have</span></span>
    P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> R<span class="hidden">⇩</span><sub>C</sub>_ofD<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> rr in_R<span class="hidden">⇩</span><sub>C</sub>_of <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span>
    in_ℛ<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    in_ℛ<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    in_ℛ<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    low_mds_mds<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"conc.low_mds_eq <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> R<span class="hidden">⇩</span><sub>C</sub>_ofD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">from</span></span> rr in_ℛ<span class="hidden">⇩</span><sub>1</sub> in_ℛ<span class="hidden">⇩</span><sub>A</sub> in_ℛ<span class="hidden">⇩</span><sub>2</sub> step<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs.neval <span class="main">⟨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">n</span> <span class="main">⟨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span> 
         <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span>
         abs.neval <span class="main">⟨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">n</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>  <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∃</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span> <span class="main">⟨</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
                   <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">∧</span>
                   <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_def2
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> neval<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"abs.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">n</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                in_ℛ<span class="hidden">⇩</span><sub>1</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span>  strong_low_bisim_neval<span class="main">[</span><span class="operator">OF</span> neval<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>  in_ℛ<span class="hidden">⇩</span><sub>A</sub> bisim<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"abs.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">n</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      in_ℛ<span class="hidden">⇩</span><sub>A</sub>'_help<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> abs.strong_low_bisim_mm_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> a in_ℛ<span class="hidden">⇩</span><sub>A</sub> in_ℛ<span class="hidden">⇩</span><sub>2</sub> neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> P <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          step<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          in_ℛ<span class="hidden">⇩</span><sub>2</sub>'_help<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          P'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> in_ℛ<span class="hidden">⇩</span><sub>2</sub>'_help rr preserves_modes_memD <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">with</span></span> in_ℛ<span class="hidden">⇩</span><sub>2</sub>'_help in_ℛ<span class="hidden">⇩</span><sub>A</sub>'_help <span class="keyword1"><span class="command">have</span></span> 
      in_ℛ<span class="hidden">⇩</span><sub>2</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      in_ℛ<span class="hidden">⇩</span><sub>A</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conc.low_mds_eq <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> new_vars_private_does_the_thing<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ℛ<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">ℛ</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> _ in_ℛ<span class="hidden">⇩</span><sub>1</sub> in_ℛ<span class="hidden">⇩</span><sub>2</sub> step<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub> step<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> low_mds_mds<span class="hidden">⇩</span><sub>C</sub><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> rr <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> secure_refinement_def<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> in_ℛ<span class="hidden">⇩</span><sub>A</sub>' bisim <span class="keyword1"><span class="command">unfolding</span></span> abs.strong_low_bisim_mm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">with</span></span> step<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> in_ℛ<span class="hidden">⇩</span><sub>1</sub>' in_ℛ<span class="hidden">⇩</span><sub>2</sub>' in_ℛ<span class="hidden">⇩</span><sub>A</sub>' in_ℛ<span class="hidden">⇩</span><sub>2</sub>' P' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> R<span class="hidden">⇩</span><sub>C</sub>_ofI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Security of the concrete system should follow straightforwardly from
  security of the abstract one, via the compositionality theorem, presuming
  that the compiler also preserves the sound use of modes.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> R<span class="hidden">⇩</span><sub>C</sub>_of_strong_low_bisim_mm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abs<span class="main">:</span> <span class="quoted"><span class="quoted">"abs.strong_low_bisim_mm <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rr<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_refinement <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conc.strong_low_bisim_mm <span class="main">(</span>R<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> conc.strong_low_bisim_mm_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> R<span class="hidden">⇩</span><sub>C</sub>_of_sym<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> abs rr P_sym <span class="keyword1"><span class="command">unfolding</span></span> abs.strong_low_bisim_mm_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> R<span class="hidden">⇩</span><sub>C</sub>_of_closed_glob_consistent<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> abs <span class="keyword1"><span class="command">unfolding</span></span> abs.strong_low_bisim_mm_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
   <span class="keyword1"><span class="command">using</span></span> rr <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> R<span class="hidden">⇩</span><sub>C</sub>_of_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> R<span class="hidden">⇩</span><sub>C</sub>_of_local_preservation<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rr<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> abs<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"A Simpler Proof Principle for General Compositional Refinement"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Here we make use of the fact that the source language we are working
  in is assumed deterministic. This allows us to invert the direction
  of refinement and thereby to derive a simpler condition for secure
  compositional refinement.
  
  The simpler condition rests on an ordinary definition of refinement,
  and has the user prove separately that the coupling invariant <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  is self-preserving. This allows proofs about coupling invariant properties
  to be disentangled from the proof of refinement itself.
›</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Given a  bisimulation <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, this definition captures the essence of the extra
  requirements on a refinement relation~<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ℛ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> needed to ensure that the refined program is
  also secure. These requirements are essentially that:
  \begin{enumerate}
    \item The enabledness of the compiled code depends only on Low abstract data;
    \item The length of the abstract program to which a single step of the concrete program
          corresponds depends only on Low abstract data;
    \item The coupling invariant is maintained.
  \end{enumerate}
  
  The second requirement we express via the parameter~<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">abs_steps</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> that, given an
  abstract and corresponding concrete configuration, yields the number of execution steps of
  the abstract configuration to which a single step of the concrete configuration corresponds.
  
  Note that a more specialised version of this definition, fixing the coupling
  invariant <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to be the one that relates all configurations with
  identical programs and mode states, appeared in Murray et al., CSF 2016.
  Here we generalise the theory to support a wider class of coupling invariants.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">simpler_refinement_safe</span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">simpler_refinement_safe</span> <span class="free"><span class="bound"><span class="entity">ℛ<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">abs_steps</span></span></span> <span class="main">≡</span> 
  <span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">∧</span> 
      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>  <span class="main">⟶</span>
           <span class="main">(</span>stops<span class="hidden">⇩</span><sub>C</sub> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> stops<span class="hidden">⇩</span><sub>C</sub> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="free"><span class="bound"><span class="entity">abs_steps</span></span></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">abs_steps</span></span></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mds<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>  <span class="main">∧</span>
                                          <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟶</span>
                                          <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span>
                                          <span class="bound">mds<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="bound">mds<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">secure_refinement_simpler</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">secure_refinement_simpler</span> <span class="free"><span class="bound"><span class="entity">ℛ<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">abs_steps</span></span></span> <span class="main">≡</span>
  closed_others <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">∧</span>
  preserves_modes_mem <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">∧</span>
  new_vars_private <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">∧</span>
  simpler_refinement_safe <span class="free"><span class="bound"><span class="entity">ℛ<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">abs_steps</span></span></span> <span class="main">∧</span>
  conc.closed_glob_consistent <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> 
   <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∀</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟶</span>
     <span class="main">(</span><span class="main">∃</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span> abs.neval <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">abs_steps</span></span></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span>
                   <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> secure_refinement_simpler<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rrs<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_refinement_simpler <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span> <span class="free">abs_steps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"secure_refinement <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_def
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> rrs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"closed_others <span class="free">ℛ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_simpler_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> rrs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"preserves_modes_mem <span class="free">ℛ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_simpler_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> rrs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"new_vars_private <span class="free">ℛ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_simpler_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">abs_steps</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> in_ℛ<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> eval<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> rrs <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span> <span class="skolem"><span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    neval<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"abs.neval <span class="main">⟨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="var">?n</span> <span class="main">⟨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    in_ℛ<span class="hidden">⇩</span><sub>1</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_simpler_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> abs.neval <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="var">?n</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                    <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
                    <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">∧</span> 
                    <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> 
    in_ℛ<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    in_ℛ<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    neval<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"abs.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="var">?n</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    in_P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟶</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span>
      <span class="keyword3"><span class="command">assume</span></span> eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> in_ℛ<span class="hidden">⇩</span><sub>2</sub> eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> in_P rrs <span class="keyword3"><span class="command">obtain</span></span>
      <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>''</span></span> <span class="skolem"><span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>''</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      neval<span class="hidden">⇩</span><sub>2</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"abs.neval <span class="main">⟨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="free">abs_steps</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">⟨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>''</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      in_ℛ<span class="hidden">⇩</span><sub>2</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>''</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_simpler_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">abs_steps</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> rrs <span class="keyword1"><span class="command">have</span></span> pe<span class="main">:</span> <span class="quoted"><span class="quoted">"simpler_refinement_safe <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span> <span class="free">abs_steps</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_simpler_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> in_ℛ<span class="hidden">⇩</span><sub>A</sub> in_ℛ<span class="hidden">⇩</span><sub>1</sub> in_ℛ<span class="hidden">⇩</span><sub>2</sub> in_P
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n'</span> <span class="main">=</span> <span class="var">?n</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> simpler_refinement_safe_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">with</span></span> neval<span class="hidden">⇩</span><sub>2</sub> neval<span class="hidden">⇩</span><sub>2</sub>' abs.neval_det 
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> in_ℛ<span class="hidden">⇩</span><sub>2</sub>' <span class="keyword1"><span class="command">have</span></span> in_ℛ<span class="hidden">⇩</span><sub>2</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> eval<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub> eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> in_P <span class="keyword1"><span class="command">have</span></span> 
      in_P'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> rrs <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_simpler_def
                            simpler_refinement_safe_def
        <span class="keyword1"><span class="command">using</span></span> in_ℛ<span class="hidden">⇩</span><sub>A</sub> in_ℛ<span class="hidden">⇩</span><sub>1</sub> in_ℛ<span class="hidden">⇩</span><sub>2</sub> in_P <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> in_ℛ<span class="hidden">⇩</span><sub>2</sub>'
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> rrs <span class="keyword1"><span class="command">have</span></span> pe<span class="main">:</span> <span class="quoted"><span class="quoted">"simpler_refinement_safe <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span> <span class="free">abs_steps</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_simpler_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> in_ℛ<span class="hidden">⇩</span><sub>A</sub> in_ℛ<span class="hidden">⇩</span><sub>1</sub> in_ℛ<span class="hidden">⇩</span><sub>2</sub> in_P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stops<span class="hidden">⇩</span><sub>C</sub>  <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> stops<span class="hidden">⇩</span><sub>C</sub>  <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> simpler_refinement_safe_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> eval<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> stops<span class="hidden">⇩</span><sub>C</sub>  <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> stops<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> stops<span class="hidden">⇩</span><sub>C</sub>  <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>          
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="skolem"><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">,</span><span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> stops<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> pe eval<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub> in_ℛ<span class="hidden">⇩</span><sub>A</sub> in_ℛ<span class="hidden">⇩</span><sub>1</sub> in_ℛ<span class="hidden">⇩</span><sub>2</sub> in_P <span class="keyword1"><span class="command">have</span></span> in_P'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
                                             <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> simpler_refinement_safe_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">from</span></span> in_P' eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
     <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
           <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
          <span class="main">∈</span> <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> neval<span class="hidden">⇩</span><sub>1</sub> in_ℛ<span class="hidden">⇩</span><sub>1</sub> in_ℛ<span class="hidden">⇩</span><sub>1</sub>' 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
            abs.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">n</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span>
                abs.neval <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">n</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                    <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
                    <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">∧</span>
                    <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                    <span class="main">∈</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"conc.closed_glob_consistent <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rrs <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_simpler_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Simple Bisimulations and Simple Refinement"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We derive the theory of simple refinements from Murray et al. CSF 2016 from the above
  \emph{simpler} theory of secure refinement.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">bisim_simple</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bisim_simple</span> <span class="free"><span class="bound"><span class="entity">ℛ<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mds</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">.</span> <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mds</span><span class="main">,</span><span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mds</span><span class="main">,</span><span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">⟶</span> 
                                              <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">simple_refinement_safe</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">simple_refinement_safe</span> <span class="free"><span class="bound"><span class="entity">ℛ<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="free"><span class="bound"><span class="entity">abs_steps</span></span></span> <span class="main">≡</span> 
  <span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">∧</span> 
      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">⟶</span>
           <span class="main">(</span>stops<span class="hidden">⇩</span><sub>C</sub> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> stops<span class="hidden">⇩</span><sub>C</sub> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="free"><span class="bound"><span class="entity">abs_steps</span></span></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">abs_steps</span></span></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mds<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>  <span class="main">∧</span>
                                          <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟶</span>
                                          <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span> <span class="bound">mds<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="bound">mds<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">secure_refinement_simple</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">secure_refinement_simple</span> <span class="free"><span class="bound"><span class="entity">ℛ<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="free"><span class="bound"><span class="entity">abs_steps</span></span></span> <span class="main">≡</span>
  closed_others <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">∧</span>
  preserves_modes_mem <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">∧</span>
  new_vars_private <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">∧</span>
  simple_refinement_safe <span class="free"><span class="bound"><span class="entity">ℛ<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="free"><span class="bound"><span class="entity">abs_steps</span></span></span> <span class="main">∧</span>
  bisim_simple <span class="free"><span class="bound"><span class="entity">ℛ<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> 
   <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∀</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟶</span>
     <span class="main">(</span><span class="main">∃</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span> abs.neval <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">abs_steps</span></span></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span>
                   <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">ℐsimple</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ℐsimple</span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="main">⟨</span><span class="bound">c</span><span class="main">,</span><span class="bound">mds</span><span class="main">,</span><span class="bound">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="main">⟨</span><span class="bound">c'</span><span class="main">,</span><span class="bound">mds'</span><span class="main">,</span><span class="bound">mem'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">|</span> <span class="bound">c</span> <span class="bound">mds</span> <span class="bound">mem</span> <span class="bound">c'</span> <span class="bound">mds'</span> <span class="bound">mem'</span><span class="main">.</span> <span class="bound">c</span> <span class="main">=</span> <span class="bound">c'</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ℐsimple_closed_glob_consistent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conc.closed_glob_consistent ℐsimple"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> conc.closed_glob_consistent_def ℐsimple_def<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> secure_refinement_simple<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> srs<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_refinement_simple <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">abs_steps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"secure_refinement_simpler <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> ℐsimple <span class="free">abs_steps</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_simpler_def
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">safe</span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> srs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"closed_others <span class="free">ℛ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_simple_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> srs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"preserves_modes_mem <span class="free">ℛ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_simple_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> srs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"new_vars_private <span class="free">ℛ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_simple_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"conc.closed_glob_consistent ℐsimple"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ℐsimple_closed_glob_consistent<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> srs <span class="keyword1"><span class="command">have</span></span> safe<span class="main">:</span> <span class="quoted"><span class="quoted">"simple_refinement_safe <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">abs_steps</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_simple_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> srs <span class="keyword1"><span class="command">have</span></span> simple<span class="main">:</span> <span class="quoted"><span class="quoted">"bisim_simple <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_simple_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  
  <span class="keyword1"><span class="command">from</span></span> safe simple <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"simpler_refinement_safe <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> ℐsimple <span class="free">abs_steps</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> simpler_refinement_safe_def ℐsimple_def simple_refinement_safe_def bisim_simple_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">⟹</span>
       <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟹</span>
       <span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
          abs.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="free">abs_steps</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
           <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> srs <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_simple_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Sound Mode Use Preservation"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Prove that
  \begin{quote}
  acquiring a mode on the concrete version of an abstract
      variable~<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and then mapping the new concrete mode state to the
      corresponding abstract mode state,
  \end{quote}
   is equivalent to
   \begin{quote}
      first mapping the initial concrete mode
      state to its corresponding abstract mode state and then acquiring the mode
      on the abstract variable~<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
   \end{quote}

   This lemma essentially justifies why a concrete program doing
   <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Acq</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">SomeMode</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
   is a the right way to implement the abstract program doing
   <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Acq</span></span> <span class="free"><span class="free">x</span></span> <span class="free"><span class="free">SomeMode</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="comment1">(* FIXME: There might be better names for these *)</span>
<span class="keyword1"><span class="command">lemma</span></span> mode_acquire_refinement_helper<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="main">(</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="free">SomeMode</span> <span class="main">:=</span> insert <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">SomeMode</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
   <span class="main">(</span>mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">(</span><span class="free">SomeMode</span> <span class="main">:=</span> insert <span class="free">x</span> <span class="main">(</span>mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">SomeMode</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mds<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def inv_f_f<span class="main"><span class="main">[</span></span><span class="operator">OF</span> var<span class="hidden">⇩</span><sub>C</sub>_of_inj<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> mode_release_refinement_helper<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="main">(</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="free">SomeMode</span> <span class="main">:=</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">SomeMode</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free">x</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
   <span class="main">(</span>mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">(</span><span class="free">SomeMode</span> <span class="main">:=</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span> <span class="main">∈</span> <span class="main">(</span>mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">SomeMode</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≠</span> <span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mds<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def inv_f_f<span class="main"><span class="main">[</span></span><span class="operator">OF</span> var<span class="hidden">⇩</span><sub>C</sub>_of_inj<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">preserves_locally_sound_mode_use</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">,</span> <span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> state_relation <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">preserves_locally_sound_mode_use</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">≡</span>
   <span class="main">∀</span><span class="bound">lc<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">lc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span>
      <span class="main">(</span>abs.locally_sound_mode_use <span class="bound">lc<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span> <span class="main">(</span><span class="bound">lc<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">lc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">⟶</span>
      conc.locally_sound_mode_use <span class="bound">lc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> secure_refinement_loc_reach<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rr<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_refinement <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_ℛ<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> loc_reach<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> conc.loc_reach <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">∧</span>
      <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∈</span> abs.loc_reach <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> loc_reach<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> conc.loc_reach.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>refl<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> in_ℛ abs.loc_reach.refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> step<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>'</span></span> <span class="skolem"><span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    in_ℛ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    loc_reach<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∈</span> abs.loc_reach <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> "</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> rr in_ℛ' step<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>''</span></span> <span class="skolem"><span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>''</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"abs.neval <span class="main">⟨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">n</span> <span class="main">⟨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    in_ℛ''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> neval<span class="hidden">⇩</span><sub>A</sub> loc_reach<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∈</span> abs.loc_reach <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abs.neval_loc_reach
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> in_ℛ'' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>mem_diff <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> mem_diff<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>'</span></span> <span class="skolem"><span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    in_ℛ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    loc_reach<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∈</span> abs.loc_reach <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> "</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> rr <span class="keyword1"><span class="command">have</span></span> mm<span class="main">:</span> <span class="quoted"><span class="quoted">"preserves_modes_mem <span class="free">ℛ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> co<span class="main">:</span> <span class="quoted"><span class="quoted">"closed_others <span class="free">ℛ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> preserves_modes_memD<span class="main">[</span><span class="operator">OF</span> mm in_ℛ'<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
    mem<span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mds<span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> in_ℛ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> loc_reach<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> abs.loc_reach <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_ℛ' loc_reach<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> mem_diff<span class="main">(</span>3<span class="main">)</span> co
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> closed_others_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∈</span> abs.loc_reach <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> abs.loc_reach.mem_diff<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> loc_reach<span class="hidden">⇩</span><sub>A</sub><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> mem_diff<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> calculation in_ℛ' in_ℛ_dma' mem<span class="hidden">⇩</span><sub>A</sub>_of_def mm var_writable<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">preserves_local_guarantee_compliance</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">,</span> <span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> state_relation <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">preserves_local_guarantee_compliance</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">≡</span>
    <span class="main">∀</span><span class="bound">cm<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">cm<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span>
      abs.respects_own_guarantees <span class="bound">cm<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">(</span><span class="bound">cm<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="bound">cm<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">⟶</span>
        conc.respects_own_guarantees <span class="bound">cm<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preserves_local_guarantee_compliance_def2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"preserves_local_guarantee_compliance <span class="free">ℛ</span> <span class="main">≡</span>
    <span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span>
      abs.respects_own_guarantees <span class="main">(</span><span class="bound">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">⟶</span>
        conc.respects_own_guarantees <span class="main">(</span><span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> preserves_local_guarantee_compliance_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(* This lemma proves it is sufficient to require a refinement relation to preserve
   guarantee compliance to ensure that it also preserves locally sound mode use.
  TODO: Should preserves_guarantee_compliance become part of secure_refinement's requirements? *)</span>
<span class="keyword1"><span class="command">lemma</span></span> locally_sound_mode_use_preservation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rr<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_refinement <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> preserves_guarantee_compliance<span class="main">:</span> <span class="quoted"><span class="quoted">"preserves_local_guarantee_compliance <span class="free">ℛ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"preserves_locally_sound_mode_use <span class="free">ℛ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> preserves_locally_sound_mode_use_def
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span>
  <span class="keyword3"><span class="command">assume</span></span> locally_sound<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"abs.locally_sound_mode_use <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
         in_ℛ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span>
 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"conc.locally_sound_mode_use <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> conc.locally_sound_mode_use_def2
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span>
      <span class="keyword3"><span class="command">assume</span></span> loc_reach<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> conc.loc_reach <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> rr in_ℛ loc_reach<span class="hidden">⇩</span><sub>C</sub>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>'</span></span> <span class="skolem"><span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        in_ℛ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        loc_reach<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∈</span> abs.loc_reach <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> secure_refinement_loc_reach <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">from</span></span> locally_sound<span class="hidden">⇩</span><sub>A</sub> loc_reach<span class="hidden">⇩</span><sub>A</sub>
      <span class="keyword1"><span class="command">have</span></span> respects_guarantees<span class="hidden">⇩</span><sub>A</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"abs.respects_own_guarantees <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> abs.locally_sound_mode_use_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">with</span></span> preserves_guarantee_compliance in_ℛ'
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"conc.respects_own_guarantees <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> preserves_local_guarantee_compliance_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Refinement without changing the Memory Model"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Here we define a locale which restricts the refinement to be between an abstract and
  concrete programs that share identical memory models: i,e. have the same set of variables.
  This allows us to derive simpler versions of the conditions that are likely to be easier
  to work with for initial experimentation.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> sifum_refinement_same_mem <span class="main">=</span> 
  abs<span class="main">:</span> sifum_security <span class="quoted"><span class="free">dma</span></span> <span class="quoted"><span class="free">𝒞_vars</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">eval<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="quoted"><span class="free">some_val</span></span> <span class="main">+</span>
  conc<span class="main">:</span> sifum_security <span class="quoted"><span class="free">dma</span></span> <span class="quoted"><span class="free">𝒞_vars</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">eval<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="quoted"><span class="free">some_val</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">dma</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Var</span><span class="main">,</span><span class="tfree">'Val</span><span class="main">)</span> Mem <span class="main">⇒</span> <span class="tfree">'Var</span> <span class="main">⇒</span> Sec"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">𝒞_vars</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Var</span> <span class="main">⇒</span> <span class="tfree">'Var</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">𝒞</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Var</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eval<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Var</span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">)</span> LocalConf rel"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eval<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var</span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">)</span> LocalConf rel"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">some_val</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Val</span>"</span></span> 

<span class="keyword1"><span class="command">sublocale</span></span> sifum_refinement_same_mem <span class="main">⊆</span> 
          gen_refine<span class="main">:</span> sifum_refinement <span class="quoted"><span class="free">dma</span></span> <span class="quoted"><span class="free">dma</span></span> <span class="quoted"><span class="free">𝒞_vars</span></span> <span class="quoted"><span class="free">𝒞_vars</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">eval<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="quoted"><span class="free">eval<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="quoted"><span class="free">some_val</span></span> <span class="quoted">id</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> sifum_refinement_same_mem <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gen_refine.new_vars_private <span class="free">ℛ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> gen_refine.new_vars_private_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">preserves_modes_mem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Var</span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">,</span> <span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var</span><span class="main">)</span> state_relation <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">preserves_modes_mem</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">≡</span> 
  <span class="main">(</span><span class="main">∀</span> <span class="bound">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">⟶</span>
      <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">closed_others</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Var</span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">,</span> <span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var</span><span class="main">)</span> state_relation <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">closed_others</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">≡</span> 
  <span class="main">(</span><span class="main">∀</span> <span class="bound">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mds</span> <span class="bound">mem</span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem'</span><span class="main">.</span> <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">⟶</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">mem</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">mem'</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="bound">mds</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">dma</span> <span class="bound">mem</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">dma</span> <span class="bound">mem'</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="bound">mds</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gen_refine.mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_refine.mds<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gen_refine.mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_refine.mem<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"preserves_modes_mem <span class="free">ℛ</span> <span class="main">⟹</span>
  gen_refine.closed_others <span class="free">ℛ</span> <span class="main">=</span> closed_others <span class="free">ℛ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> closed_others_def
            gen_refine.closed_others_def
            preserves_modes_mem_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gen_refine.preserves_modes_mem <span class="free">ℛ</span> <span class="main">=</span> preserves_modes_mem <span class="free">ℛ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> gen_refine.preserves_modes_mem_def2 preserves_modes_mem_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">secure_refinement</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Var</span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">)</span> LocalConf rel <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Var</span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">,</span> <span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var</span><span class="main">)</span> state_relation <span class="main">⇒</span> 
                          <span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var</span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">)</span> LocalConf rel <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">secure_refinement</span> <span class="free"><span class="bound"><span class="entity">ℛ<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span>
  closed_others <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">∧</span>
  preserves_modes_mem <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">∧</span>
  conc.closed_glob_consistent <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mds</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> 
   <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∀</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mds'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">.</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟶</span>
     <span class="main">(</span><span class="main">∃</span> <span class="bound">n</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span> abs.neval <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">n</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span>
                   <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">.</span> 
         <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>  <span class="main">∧</span>
         abs.neval <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">n</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>  <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∃</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">.</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
                   <span class="main">(</span><span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="main">∧</span>
                   <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preserves_modes_memD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"preserves_modes_mem <span class="free">ℛ</span> <span class="main">⟹</span>
<span class="main">(</span><span class="main">⟨</span> <span class="free">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span> <span class="free">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">⟹</span>
      <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span> <span class="free">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> preserves_modes_mem_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gen_refine.secure_refinement <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span> <span class="main">=</span> secure_refinement <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> gen_refine.secure_refinement_def secure_refinement_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="main">(</span><span class="operator">drule</span> spec<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> impE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="main">(</span><span class="operator">drule</span> spec<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> impE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span>  n c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>' mds<span class="hidden">⇩</span><sub>A</sub>' mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> preserves_modes_memD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> preserves_modes_memD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="main">(</span><span class="operator">drule</span> spec<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> impE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="main">(</span><span class="operator">drule</span> spec<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> impE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> preserves_modes_memD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> R<span class="hidden">⇩</span><sub>C</sub>_of_strong_low_bisim_mm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abs<span class="main">:</span> <span class="quoted"><span class="quoted">"abs.strong_low_bisim_mm <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rr<span class="main">:</span> <span class="quoted"><span class="quoted">"secure_refinement <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conc.strong_low_bisim_mm <span class="main">(</span>gen_refine.R<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abs rr gen_refine.R<span class="hidden">⇩</span><sub>C</sub>_of_strong_low_bisim_mm<span class="main">[</span><span class="operator">OF</span> _ _ P_sym<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> sifum_refinement <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> use_secure_refinement_helper<span class="main">:</span>
  <span class="quoted"><span class="quoted">"secure_refinement <span class="free">ℛ<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛ</span> <span class="free">P</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">(</span><span class="free">cm<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">cm<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">cm<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">cm<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">∃</span><span class="bound">cm<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">n</span><span class="main">.</span> abs.neval <span class="main">(</span><span class="free">cm<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="bound">n</span> <span class="main">(</span><span class="bound">cm<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">)</span> <span class="main">∧</span>
                 <span class="main">(</span><span class="main">(</span><span class="bound">cm<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">cm<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">cm<span class="hidden">⇩</span><sub>A</sub></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="free">cm<span class="hidden">⇩</span><sub>C</sub></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> secure_refinement_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surjective_pairing<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> closed_othersD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"closed_others <span class="free">ℛ</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span> <span class="main">∨</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span> <span class="main">⟹</span> <span class="main">¬</span> var_asm_not_written <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛ</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> closed_others_def
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">record</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> componentwise_refinement <span class="main">=</span>
  priv_mem <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> set"</span></span> <span class="comment1">(* private variables *)</span>
  ℛ<span class="hidden">⇩</span><sub>A</sub>_rel <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">)</span> LocalConf rel"</span></span> <span class="comment1">(* abstract bisimulation *)</span>
  ℛ_rel <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">,</span> <span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> state_relation"</span></span> <span class="comment1">(* refinement relation *)</span>
  P_rel <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">)</span> LocalConf rel"</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Whole System Refinement"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A locale to capture componentwise refinement of an entire system.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> sifum_refinement_sys <span class="main">=</span> 
  sifum_refinement <span class="quoted"><span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="quoted"><span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="quoted"><span class="free">𝒞_vars<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="quoted"><span class="free">𝒞_vars<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="quoted"><span class="free">𝒞<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="quoted"><span class="free">𝒞<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="quoted"><span class="free">eval<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="quoted"><span class="free">eval<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="quoted"><span class="free">some_val</span></span> <span class="quoted"><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="tfree">'Val</span><span class="main">)</span> Mem <span class="main">⇒</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⇒</span> Sec"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="tfree">'Val</span><span class="main">)</span> Mem <span class="main">⇒</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⇒</span> Sec"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">𝒞_vars<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⇒</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">𝒞_vars<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⇒</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">𝒞<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">𝒞<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eval<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">)</span> LocalConf rel"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eval<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Val</span><span class="main">)</span> LocalConf rel"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">some_val</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Val</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⇒</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">cms</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>wellorder<span class="main">,</span> <span class="tfree">'Val</span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Com<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="tfree">'Var<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="tfree">'Com<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> componentwise_refinement list"</span></span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">priv_mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> set list"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> priv_mem<span class="hidden">⇩</span><sub>C</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">priv_mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≡</span> map priv_mem <span class="free">cms</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> priv_mem_disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≠</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">priv_mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="free">i</span> <span class="main">∩</span> <span class="free">priv_mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="free">j</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> new_vars_priv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span>set <span class="free">priv_mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> new_privs_preserved<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span><span class="free">c'</span><span class="main">,</span> <span class="free">mds'</span><span class="main">,</span> <span class="free">mem'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">⟹</span>
                                 <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> <span class="free">mds</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> <span class="free">mds'</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> secure_refinements<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟹</span> secure_refinement <span class="main">(</span>ℛ<span class="hidden">⇩</span><sub>A</sub>_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>P_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> local_guarantee_preservation<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟹</span> preserves_local_guarantee_compliance <span class="main">(</span>ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bisims<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟹</span> abs.strong_low_bisim_mm <span class="main">(</span>ℛ<span class="hidden">⇩</span><sub>A</sub>_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Ps_sym<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟹</span> sym <span class="main">(</span>P_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Ps_refl_on_low_mds_eq<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟹</span> conc.low_mds_eq <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>P_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="comment1">(* FIXME: move to a parent theory? *)</span>
<span class="keyword1"><span class="command">context</span></span> sifum_security <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> neval_modifies_helper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nevaln<span class="main">:</span> <span class="quoted"><span class="quoted">"neval <span class="free">lcn</span> <span class="free">m</span> <span class="free">lcn'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lcn_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">lcn</span> <span class="main">=</span> <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="free">n</span><span class="main">,</span> <span class="free">mem</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lcn'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">lcn'</span> <span class="main">=</span> <span class="main">(</span><span class="free">cmn'</span><span class="main">,</span> <span class="free">mem'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="free">cms</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> modified<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">mem'</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">dma</span> <span class="free">mem</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">dma</span> <span class="free">mem'</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span> <span class="bound">cmn''</span> <span class="bound">mem''</span> <span class="bound">cmn'''</span> <span class="bound">mem'''</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">∧</span> neval <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="free">n</span><span class="main">,</span><span class="free">mem</span><span class="main">)</span> <span class="bound">k</span> <span class="main">(</span><span class="bound">cmn''</span><span class="main">,</span><span class="bound">mem''</span><span class="main">)</span> <span class="main">∧</span>
                           <span class="main">(</span><span class="bound">cmn''</span><span class="main">,</span><span class="bound">mem''</span><span class="main">)</span> <span class="main">↝</span> <span class="main">(</span><span class="bound">cmn'''</span><span class="main">,</span> <span class="bound">mem'''</span><span class="main">)</span> <span class="main">∧</span>
                           <span class="main">(</span><span class="bound">mem''</span> <span class="free">x</span> <span class="main">≠</span> <span class="bound">mem'''</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">dma</span> <span class="bound">mem''</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">dma</span> <span class="bound">mem'''</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> nevaln lcn_def lcn'_def modified len
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">cms</span></span> <span class="quoted"><span class="free">cmn'</span></span> <span class="quoted"><span class="free">mem</span></span> <span class="quoted"><span class="free">mem'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> neval.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>neval_0 <span class="skolem">lcn</span> <span class="skolem">lcn'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> neval_0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>neval_S_n <span class="skolem">lcn</span> <span class="skolem">lcn''</span> <span class="skolem">m</span> <span class="skolem">lcn'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cmn''</span></span> <span class="skolem"><span class="skolem">mem''</span></span> <span class="keyword2"><span class="keyword">where</span></span> lcn''_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lcn''</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cmn''</span><span class="main">,</span> <span class="skolem">mem''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem</span> <span class="free">x</span> <span class="main">≠</span> <span class="skolem">mem''</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">dma</span> <span class="skolem">mem</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">dma</span> <span class="skolem">mem''</span> <span class="free">x</span>"</span></span><span class="main">)</span>    
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem</span> <span class="free">x</span> <span class="main">≠</span> <span class="skolem">mem''</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">dma</span> <span class="skolem">mem</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">dma</span> <span class="skolem">mem''</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>nat"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmn''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">cms</span> <span class="main">!</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">&lt;</span> Suc <span class="skolem">m</span> <span class="main">∧</span>
    neval <span class="main">(</span><span class="skolem">cms</span> <span class="main">!</span> <span class="free">n</span><span class="main">,</span> <span class="skolem">mem</span><span class="main">)</span> <span class="var">?k</span> <span class="main">(</span><span class="var">?cmn''</span><span class="main">,</span> <span class="var">?mem''</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="var">?cmn''</span><span class="main">,</span> <span class="var">?mem''</span><span class="main">)</span> <span class="main">↝</span> <span class="main">(</span><span class="skolem">cmn''</span><span class="main">,</span> <span class="skolem">mem''</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="var">?mem''</span> <span class="free">x</span> <span class="main">≠</span> <span class="skolem">mem''</span> <span class="free">x</span> <span class="main">∨</span>
    <span class="free">dma</span> <span class="var">?mem''</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">dma</span> <span class="skolem">mem''</span> <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neval.neval_0<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neval_S_n<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">simplified</span> neval_S_n lcn''_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">mem</span> <span class="free">x</span> <span class="main">≠</span> <span class="skolem">mem''</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">dma</span> <span class="skolem">mem</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">dma</span> <span class="skolem">mem''</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> unchanged<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem''</span> <span class="free">x</span> <span class="main">=</span> <span class="skolem">mem</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">dma</span> <span class="skolem">mem''</span> <span class="free">x</span> <span class="main">=</span> <span class="free">dma</span> <span class="skolem">mem</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sym<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cms''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cms''</span> <span class="main">=</span> <span class="skolem">cms</span><span class="main">[</span><span class="free">n</span> <span class="main">:=</span> <span class="skolem">cmn''</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> len''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="skolem">cms''</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cms''_def neval_S_n<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> lcn''_def2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lcn''</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cms''</span> <span class="main">!</span> <span class="free">n</span><span class="main">,</span> <span class="skolem">mem''</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lcn''_def cms''_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span>
    neval_S_n<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> lcn''_def2 neval_S_n<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">simplified</span> unchanged neval_S_n len''<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">cmn'''</span></span> <span class="skolem"><span class="skolem">mem'''</span></span> <span class="skolem"><span class="skolem">cmn''''</span></span> <span class="skolem"><span class="skolem">mem''''</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      hyp<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">m</span> <span class="main">∧</span>
          neval <span class="main">(</span><span class="skolem">cms''</span> <span class="main">!</span> <span class="free">n</span><span class="main">,</span> <span class="skolem">mem''</span><span class="main">)</span> <span class="skolem">k</span> <span class="main">(</span><span class="skolem">cmn'''</span><span class="main">,</span> <span class="skolem">mem'''</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="skolem">cmn'''</span><span class="main">,</span> <span class="skolem">mem'''</span><span class="main">)</span> <span class="main">↝</span> <span class="main">(</span><span class="skolem">cmn''''</span><span class="main">,</span> <span class="skolem">mem''''</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="skolem">mem'''</span> <span class="free">x</span> <span class="main">≠</span> <span class="skolem">mem''''</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">dma</span> <span class="skolem">mem'''</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">dma</span> <span class="skolem">mem''''</span> <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"neval <span class="main">(</span><span class="skolem">cms</span> <span class="main">!</span> <span class="free">n</span><span class="main">,</span> <span class="skolem">mem</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="skolem">cmn'''</span><span class="main">,</span> <span class="skolem">mem'''</span><span class="main">)</span>"</span></span>           
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> neval.neval_S_n<span class="main">)</span>  
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
       <span class="keyword1"><span class="command">using</span></span> hyp <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cms''_def neval_S_n<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> neval_S_n<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">simplified</span> neval_S_n lcn''_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span> <span class="main">&lt;</span> Suc <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hyp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> hyp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> neval_sched_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cms</span><span class="main">,</span> <span class="free">mem</span><span class="main">)</span> →<span class="hidden">⇘</span><sub><span class="main">[]</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">cms</span><span class="main">,</span> <span class="free">mem</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
<span class="keyword1"><span class="command">lemma</span></span> reachable_mode_states_refl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map snd <span class="free">cms</span> <span class="main">∈</span> reachable_mode_states <span class="main">(</span><span class="free">cms</span><span class="main">,</span> <span class="free">mem</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reachable_mode_states_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> neval_sched_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
<span class="keyword1"><span class="command">lemma</span></span> neval_reachable_mode_states<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> neval<span class="main">:</span> <span class="quoted"><span class="quoted">"neval <span class="free">lc</span> <span class="free">n</span> <span class="free">lc'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lc_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">lc</span> <span class="main">=</span> <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="free">k</span><span class="main">,</span> <span class="free">mem</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> length <span class="free">cms</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map snd <span class="main">(</span><span class="free">cms</span><span class="main">[</span><span class="free">k</span> <span class="main">:=</span> <span class="main">(</span>fst <span class="free">lc'</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> reachable_mode_states <span class="main">(</span><span class="free">cms</span><span class="main">,</span> <span class="free">mem</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> neval lc_def len <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">cms</span></span> <span class="quoted"><span class="free">mem</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> neval.induct<span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>neval_0 <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> len reachable_mode_states_refl<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>neval_S_n <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">n</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cms'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cms'</span> <span class="main">=</span> <span class="skolem">cms</span><span class="main">[</span><span class="free">k</span> <span class="main">:=</span> fst <span class="skolem">y</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">mem'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mem'</span> <span class="main">=</span> snd <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> y_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cms'</span> <span class="main">!</span> <span class="free">k</span><span class="main">,</span> <span class="skolem">mem'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cms'_def mem'_def neval_S_n<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> len'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> length <span class="skolem">cms'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cms'_def neval_S_n<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"map snd <span class="main">(</span><span class="skolem">cms'</span><span class="main">[</span><span class="free">k</span> <span class="main">:=</span> fst <span class="skolem">z</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> reachable_mode_states <span class="main">(</span><span class="skolem">cms'</span><span class="main">,</span> <span class="skolem">mem'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> neval_S_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map snd <span class="main">(</span><span class="skolem">cms'</span><span class="main">[</span><span class="free">k</span> <span class="main">:=</span> fst <span class="skolem">z</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> map snd <span class="main">(</span><span class="skolem">cms</span><span class="main">[</span><span class="free">k</span> <span class="main">:=</span> fst <span class="skolem">z</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cms'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cms</span><span class="main">,</span> <span class="skolem">mem</span><span class="main">)</span> ↝<span class="hidden">⇘</span><sub><span class="free">k</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">cms'</span><span class="main">,</span> <span class="skolem">mem'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> meval_intro neval_S_n y_def cms'_def mem'_def len' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> reachable_modes_subset subsetD hyp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> meval_sched_sound_mode_use<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sound_mode_use <span class="free">gc</span> <span class="main">⟹</span> meval_sched <span class="free">sched</span> <span class="free">gc</span> <span class="free">gc'</span> <span class="main">⟹</span> sound_mode_use <span class="free">gc'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> meval_sched.induct<span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">gc</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">n</span> <span class="skolem">ns</span> <span class="skolem">gc</span> <span class="skolem">gc'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">gc''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"meval_abv <span class="skolem">gc</span> <span class="skolem">n</span> <span class="skolem">gc''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"meval_sched <span class="skolem">ns</span> <span class="skolem">gc''</span> <span class="skolem">gc'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>2<span class="main">)</span> sound_modes_invariant <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"sound_mode_use <span class="skolem">gc''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surjective_pairing<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> b a<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> neval_meval<span class="main">:</span>
  <span class="quoted"><span class="quoted">"neval <span class="free">lcn</span> <span class="free">k</span> <span class="free">lcn'</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟹</span> <span class="free">lcn</span> <span class="main">=</span> <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="free">n</span><span class="main">,</span><span class="free">mem</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">lcn'</span> <span class="main">=</span> <span class="main">(</span><span class="free">cmn'</span><span class="main">,</span> <span class="free">mem'</span><span class="main">)</span> <span class="main">⟹</span>
  meval_sched <span class="main">(</span>replicate <span class="free">k</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">cms</span><span class="main">,</span><span class="free">mem</span><span class="main">)</span> <span class="main">(</span><span class="free">cms</span><span class="main">[</span><span class="free">n</span> <span class="main">:=</span> <span class="free">cmn'</span><span class="main">]</span><span class="main">,</span><span class="free">mem'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">cms</span></span> <span class="quoted"><span class="free">mem</span></span> <span class="quoted"><span class="free">cmn'</span></span> <span class="quoted"><span class="free">mem'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> neval.induct<span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>neval_0 <span class="skolem">lcn</span> <span class="skolem">lcn'</span><span class="main">)</span>  
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>neval_S_n <span class="skolem">lcn</span> <span class="skolem">lcn''</span> <span class="skolem">k</span> <span class="skolem">lcn'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cms''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cms''</span> <span class="main">=</span> <span class="skolem">cms</span><span class="main">[</span><span class="free">n</span> <span class="main">:=</span> fst <span class="skolem">lcn''</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">mem''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem''</span> <span class="main">=</span> snd <span class="skolem">lcn''</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> len'' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="skolem">cms''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neval_S_n<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> lcn''_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lcn''</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cms''</span> <span class="main">!</span> <span class="free">n</span><span class="main">,</span> <span class="skolem">mem''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cms''</span><span class="main">,</span> <span class="skolem">mem''</span><span class="main">)</span> →<span class="hidden">⇘</span><sub>replicate <span class="skolem">k</span> <span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">cms''</span><span class="main">[</span><span class="free">n</span> <span class="main">:=</span> <span class="skolem">cmn'</span><span class="main">]</span><span class="main">,</span> <span class="skolem">mem'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> neval_S_n<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> len'' lcn''_def neval_S_n<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> meval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cms</span><span class="main">,</span> <span class="skolem">mem</span><span class="main">)</span> ↝<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">cms''</span><span class="main">,</span> <span class="skolem">mem''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cms''_def neval_S_n.hyps<span class="main">(</span>1<span class="main">)</span> neval_S_n.prems<span class="main">(</span>1<span class="main">)</span> neval_S_n.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> hyp meval <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> meval_sched_app<span class="main">:</span>
  <span class="quoted"><span class="quoted">"meval_sched <span class="free">as</span> <span class="free">gc</span> <span class="free">gc'</span> <span class="main">⟹</span> meval_sched <span class="free">bs</span> <span class="free">gc'</span> <span class="free">gc''</span> <span class="main">⟹</span> meval_sched <span class="main">(</span><span class="free">as</span><span class="main">@</span><span class="free">bs</span><span class="main">)</span> <span class="free">gc</span> <span class="free">gc''</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">gc</span></span> <span class="quoted"><span class="free">gc'</span></span> <span class="quoted"><span class="free">bs</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">as</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> 
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">gc'''</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"meval_abv <span class="skolem">gc</span> <span class="skolem">a</span> <span class="skolem">gc'''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"meval_sched <span class="skolem">as</span> <span class="skolem">gc'''</span> <span class="skolem">gc'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> as Cons<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> a
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gc</span> →<span class="hidden">⇘</span><sub><span class="skolem">a</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">as</span> <span class="main">@</span> <span class="skolem">bs</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="free">gc''</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> meval_sched.simps<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> sifum_refinement_sys <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conc_respects_priv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xnin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> modified<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≠</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≠</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="free">x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eval<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="free">n</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">cm<span class="hidden">⇩</span><sub>C</sub>n'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_ℛn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="free">n</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">,</span> <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="free">n</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛn</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> preserves<span class="main">:</span> <span class="quoted"><span class="quoted">"preserves_local_guarantee_compliance <span class="free">ℛn</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sound_mode_use<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"abs.sound_mode_use <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nlen<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="free">cms</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> len_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> length <span class="free">cms</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> len_eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> length <span class="free">cms</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> GuarNoWrite <span class="main">∧</span> <span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> GuarNoReadOrWrite"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> sound_mode_use<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs.respects_own_guarantees <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nlen len_eq abs.locally_sound_respects_guarantees 
    <span class="keyword1"><span class="command">unfolding</span></span> abs.sound_mode_use_def list_all_length
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> in_ℛn <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"conc.respects_own_guarantees <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> preserves
    <span class="keyword1"><span class="command">unfolding</span></span> preserves_local_guarantee_compliance_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">with</span></span> eval<span class="hidden">⇩</span><sub>C</sub> modified<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> conc.doesnt_modify <span class="main">(</span>fst <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> conc.doesnt_modify_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surjective_pairing<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> conc.doesnt_read_or_modify <span class="main">(</span>fst <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conc.doesnt_read_or_modify_doesnt_modify <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">with</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> conc.respects_own_guarantees_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modified_variables_are_not_assumed_not_written<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">cm<span class="hidden">⇩</span><sub>C</sub>n'</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="free">ℛn</span> <span class="free">cm<span class="hidden">⇩</span><sub>A</sub>n'</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="free">m<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">ℛi</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sound_mode_use<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"abs.sound_mode_use <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pmmn<span class="main">:</span> <span class="quoted"><span class="quoted">"preserves_modes_mem <span class="free">ℛn</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_ℛn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="free">n</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="free">n</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛn</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pmmi<span class="main">:</span> <span class="quoted"><span class="quoted">"preserves_modes_mem <span class="free">ℛi</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_ℛi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="free">i</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="free">i</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛi</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nlen<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="free">cms</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> len<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> length <span class="free">cms</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> len<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> length <span class="free">cms</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> priv_is_asm_priv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟹</span> <span class="free">priv_mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="bound">i</span> <span class="main">⊆</span> snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> AsmNoReadOrWrite"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> priv_is_guar_priv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟹</span> <span class="free">priv_mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="bound">i</span> <span class="main">⊆</span> snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span> GuarNoReadOrWrite"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> new_asms_only_for_priv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟹</span> 
                                           <span class="main">(</span>snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> AsmNoReadOrWrite <span class="main">∪</span> snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> AsmNoWrite<span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">priv_mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eval<span class="hidden">⇩</span><sub>C</sub>n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="free">n</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">cm<span class="hidden">⇩</span><sub>C</sub>n'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> neval<span class="hidden">⇩</span><sub>A</sub>n<span class="main">:</span> <span class="quoted"><span class="quoted">"abs.neval <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="free">n</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="free">m<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="free">cm<span class="hidden">⇩</span><sub>A</sub>n'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_ℛn'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">cm<span class="hidden">⇩</span><sub>A</sub>n'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">cm<span class="hidden">⇩</span><sub>C</sub>n'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">ℛn</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> modified<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≠</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≠</span> <span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="free">x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ilen<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">cms</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> preserves<span class="main">:</span> <span class="quoted"><span class="quoted">"preserves_local_guarantee_compliance <span class="free">ℛn</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> var_asm_not_written <span class="main">(</span>snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="hidden">⇩</span><sub>C</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>n</span></span> <span class="skolem"><span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>n</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>n</span></span> <span class="skolem"><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>n</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>n'</span></span> <span class="skolem"><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cm<span class="hidden">⇩</span><sub>C</sub>n'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>n'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>n'</span></span> <span class="skolem"><span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cm<span class="hidden">⇩</span><sub>A</sub>n'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>n'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">from</span></span> in_ℛn pmmn <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>n</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> preserves_modes_memD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> in_ℛn' pmmn <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>n'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>n'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> preserves_modes_memD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">from</span></span> modified<span class="hidden">⇩</span><sub>C</sub> dma_consistent <span class="keyword1"><span class="command">have</span></span> 
    modified<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∨</span> <span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def x<span class="hidden">⇩</span><sub>C</sub>_def<span class="main">)</span>
    
  <span class="keyword1"><span class="command">from</span></span> len<span class="hidden">⇩</span><sub>A</sub> nlen <span class="keyword1"><span class="command">have</span></span> nlen<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> len<span class="hidden">⇩</span><sub>A</sub> ilen <span class="keyword1"><span class="command">have</span></span> ilen<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> abs.neval_modifies_helper<span class="main">[</span><span class="operator">OF</span> neval<span class="hidden">⇩</span><sub>A</sub>n HOL.refl HOL.refl nlen<span class="hidden">⇩</span><sub>A</sub> modified<span class="hidden">⇩</span><sub>A</sub><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">cm<span class="hidden">⇩</span><sub>A</sub>n''</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>''</span></span> <span class="skolem"><span class="skolem">cm<span class="hidden">⇩</span><sub>A</sub>n'''</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'''</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">&lt;</span> <span class="free">m<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> neval<span class="hidden">⇩</span><sub>A</sub>n''<span class="main">:</span> <span class="quoted"><span class="quoted">"abs.neval <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="free">n</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="skolem">k<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="skolem">cm<span class="hidden">⇩</span><sub>A</sub>n''</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> eval<span class="hidden">⇩</span><sub>A</sub>n''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cm<span class="hidden">⇩</span><sub>A</sub>n''</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">)</span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="skolem">cm<span class="hidden">⇩</span><sub>A</sub>n'''</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'''</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> modified<span class="hidden">⇩</span><sub>A</sub>''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'''</span> <span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∨</span> <span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="free">dma<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'''</span> <span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>A</sub>n''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">cm<span class="hidden">⇩</span><sub>A</sub>n''</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>n''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="skolem">cm<span class="hidden">⇩</span><sub>A</sub>n''</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> eval<span class="hidden">⇩</span><sub>A</sub>n'' modified<span class="hidden">⇩</span><sub>A</sub>'' <span class="keyword1"><span class="command">have</span></span> modifies<span class="hidden">⇩</span><sub>A</sub>''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> abs.doesnt_modify <span class="var">?c<span class="hidden">⇩</span><sub>A</sub>n''</span> <span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> abs.doesnt_modify_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surjective_pairing<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> loc_reach<span class="hidden">⇩</span><sub>A</sub>''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cm<span class="hidden">⇩</span><sub>A</sub>n''</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">)</span> <span class="main">∈</span> abs.loc_reach <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="free">n</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> abs.neval_loc_reach<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> neval<span class="hidden">⇩</span><sub>A</sub>n''<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> abs.loc_reach.refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> locally_sound_mode_use<span class="hidden">⇩</span><sub>A</sub>n<span class="main">:</span> <span class="quoted"><span class="quoted">"abs.locally_sound_mode_use  <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="free">n</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sound_mode_use<span class="hidden">⇩</span><sub>A</sub> nlen<span class="hidden">⇩</span><sub>A</sub>
    <span class="keyword1"><span class="command">unfolding</span></span> abs.sound_mode_use_def
    <span class="keyword1"><span class="command">using</span></span> list_all_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> modifies<span class="hidden">⇩</span><sub>A</sub>'' loc_reach<span class="hidden">⇩</span><sub>A</sub>'' locally_sound_mode_use<span class="hidden">⇩</span><sub>A</sub>n abs.doesnt_read_or_modify_doesnt_modify
  <span class="keyword1"><span class="command">have</span></span> no_guar<span class="hidden">⇩</span><sub>A</sub>n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∉</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>n''</span> GuarNoReadOrWrite <span class="main">∧</span> <span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∉</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>n''</span> GuarNoWrite"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> abs.locally_sound_mode_use_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surjective_pairing<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mdss<span class="hidden">⇩</span><sub>A</sub>''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span><span class="main">[</span><span class="free">n</span> <span class="main">:=</span> fst <span class="main">(</span><span class="skolem">cm<span class="hidden">⇩</span><sub>A</sub>n''</span><span class="main">,</span><span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?mdss<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">∈</span> abs.reachable_mode_states <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> abs.neval_reachable_mode_states<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> neval<span class="hidden">⇩</span><sub>A</sub>n''<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> HOL.refl<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> nlen<span class="hidden">⇩</span><sub>A</sub><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> compat<span class="main">:</span> <span class="quoted"><span class="quoted">"abs.compatible_modes <span class="var">?mdss<span class="hidden">⇩</span><sub>A</sub>''</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sound_mode_use<span class="hidden">⇩</span><sub>A</sub>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs.globally_sound_mode_use_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mdss<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">!</span> <span class="free">n</span> <span class="main">=</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>n''</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nlen<span class="hidden">⇩</span><sub>A</sub><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mdss<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>i</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ilen<span class="hidden">⇩</span><sub>A</sub><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> nth_list_update_neq neq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> nlen<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">have</span></span> nlen<span class="hidden">⇩</span><sub>A</sub>''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="var">?mdss<span class="hidden">⇩</span><sub>A</sub>''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> ilen<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">have</span></span> ilen<span class="hidden">⇩</span><sub>A</sub>''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="var">?mdss<span class="hidden">⇩</span><sub>A</sub>''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> compat n i nlen<span class="hidden">⇩</span><sub>A</sub>'' ilen<span class="hidden">⇩</span><sub>A</sub>'' no_guar<span class="hidden">⇩</span><sub>A</sub>n neq
  <span class="keyword1"><span class="command">have</span></span> no_asm<span class="hidden">⇩</span><sub>A</sub>i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∉</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>i</span> AsmNoWrite <span class="main">∧</span> <span class="skolem">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∉</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>i</span> AsmNoReadOrWrite"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> abs.compatible_modes_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>i</span></span> <span class="skolem"><span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>i</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>i</span></span> <span class="skolem"><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>i</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">from</span></span> in_ℛi pmmi <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>i</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> preserves_modes_memD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>i</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> no_asm<span class="hidden">⇩</span><sub>A</sub>i <span class="keyword1"><span class="command">have</span></span> no_asm<span class="hidden">⇩</span><sub>C</sub>i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>i</span> AsmNoWrite <span class="main">∧</span> <span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>i</span> AsmNoReadOrWrite"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x<span class="hidden">⇩</span><sub>C</sub>_def mds<span class="hidden">⇩</span><sub>A</sub>_of_def
    <span class="keyword1"><span class="command">using</span></span> doesnt_have_mode <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> var_asm_not_written_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>C</sub>n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>C</sub>i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span>

  <span class="keyword3"><span class="command">assume</span></span> new_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> conc_respects_priv<span class="main">[</span><span class="operator">OF</span> new_var modified<span class="hidden">⇩</span><sub>C</sub> eval<span class="hidden">⇩</span><sub>C</sub>n in_ℛn preserves sound_mode_use<span class="hidden">⇩</span><sub>A</sub> nlen len<span class="hidden">⇩</span><sub>A</sub> len<span class="hidden">⇩</span><sub>C</sub><span class="main">]</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="var">?mds<span class="hidden">⇩</span><sub>C</sub>n</span> GuarNoWrite <span class="main">∧</span> <span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="var">?mds<span class="hidden">⇩</span><sub>C</sub>n</span> GuarNoReadOrWrite"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> priv_is_guar_priv nlen ilen neq
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="free">priv_mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> new_var new_asms_only_for_priv ilen
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="var">?mds<span class="hidden">⇩</span><sub>C</sub>i</span> AsmNoReadOrWrite <span class="main">∪</span> <span class="var">?mds<span class="hidden">⇩</span><sub>C</sub>i</span> AsmNoWrite"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> var_asm_not_written_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">priv_is_asm_priv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> Mds list <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">priv_is_asm_priv</span> <span class="free"><span class="bound"><span class="entity">mdss<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">≡</span>  <span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">cms</span><span class="main">.</span> <span class="free">priv_mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="bound">i</span> <span class="main">⊆</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">mdss<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> AsmNoReadOrWrite"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">priv_is_guar_priv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> Mds list <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">priv_is_guar_priv</span> <span class="free"><span class="bound"><span class="entity">mdss<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">≡</span> 
    <span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">cms</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> length <span class="free">cms</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free">priv_mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="bound">i</span> <span class="main">⊆</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">mdss<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span> GuarNoReadOrWrite<span class="main">)</span>"</span></span>
 
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">new_asms_only_for_priv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> Mds list <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">new_asms_only_for_priv</span> <span class="free"><span class="bound"><span class="entity">mdss<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">≡</span> 
    <span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">cms</span><span class="main">.</span> 
      <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">mdss<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> AsmNoReadOrWrite <span class="main">∪</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">mdss<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> AsmNoWrite<span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">priv_mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="bound">i</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">new_asms_NoReadOrWrite_only</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> Mds list <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">new_asms_NoReadOrWrite_only</span> <span class="free"><span class="bound"><span class="entity">mdss<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">≡</span> 
    <span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">cms</span><span class="main">.</span> 
      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">mdss<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> AsmNoWrite <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">modes_respect_priv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> Mds list <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">modes_respect_priv</span> <span class="free"><span class="bound"><span class="entity">mdss<span class="hidden">⇩</span><sub>C</sub></span></span></span>  <span class="main">≡</span> priv_is_asm_priv <span class="free"><span class="bound"><span class="entity">mdss<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">∧</span> priv_is_guar_priv <span class="free"><span class="bound"><span class="entity">mdss<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">∧</span>
                               new_asms_only_for_priv <span class="free"><span class="bound"><span class="entity">mdss<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">∧</span>
                               new_asms_NoReadOrWrite_only <span class="free"><span class="bound"><span class="entity">mdss<span class="hidden">⇩</span><sub>C</sub></span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">ignores_old_vars</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Var<span class="hidden">⇩</span><sub>C</sub></span> Mds list <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ignores_old_vars</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">mdss</span> <span class="bound">mdss'</span><span class="main">.</span> length <span class="bound">mdss</span> <span class="main">=</span> length <span class="bound">mdss'</span> <span class="main">∧</span> length <span class="bound">mdss'</span> <span class="main">=</span> length <span class="free">cms</span> <span class="main">⟶</span> 
    <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">x</span> <span class="bound">m</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span><span class="main">)</span> <span class="bound">mdss</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">x</span> <span class="bound">m</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span><span class="main">)</span> <span class="bound">mdss'</span><span class="main">)</span> <span class="main">⟶</span> 
  <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">mdss</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">mdss'</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ignores_old_vars_conj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Rdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> iP<span class="main">:</span> <span class="quoted"><span class="quoted">"ignores_old_vars <span class="free">P</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> iQ<span class="main">:</span> <span class="quoted"><span class="quoted">"ignores_old_vars <span class="free">Q</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ignores_old_vars <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ignores_old_vars_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rdef<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> impI allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conj_cong<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> iP<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ignores_old_vars_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> iQ<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> ignores_old_vars_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  
<span class="keyword1"><span class="command">lemma</span></span> nth_map_eq'<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span> <span class="main">⟹</span> map <span class="free">f</span> <span class="free">xs</span> <span class="main">=</span> map <span class="free">g</span> <span class="free">ys</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="free">ys</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_map nth_map<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nth_map_eq<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="free">xs</span> <span class="main">=</span> map <span class="free">g</span> <span class="free">ys</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="free">ys</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nth_map_eq'<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> map_eq_imp_length_eq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> nth_in_Union_over_set<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="main">(</span>set <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Union_upper<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> priv_are_new_vars<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">priv_mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="free">i</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> new_vars_priv nth_in_Union_over_set subsetD
  <span class="keyword1"><span class="command">using</span></span> priv_mem<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  
<span class="keyword1"><span class="command">lemma</span></span> priv_is_asm_priv_ignores_old_vars<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ignores_old_vars priv_is_asm_priv"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ignores_old_vars_def priv_is_asm_priv_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> all_cong<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> nth_map_eq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> priv_are_new_vars fun_cong<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> priv_is_guar_priv_ignores_old_vars<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ignores_old_vars priv_is_guar_priv"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ignores_old_vars_def priv_is_guar_priv_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> all_cong<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> all_cong<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> imp_cong<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> HOL.refl<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> nth_map_eq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">j</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> nth_map_eq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> priv_are_new_vars fun_cong<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> new_asms_only_for_priv_ignores_old_vars<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ignores_old_vars new_asms_only_for_priv"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ignores_old_vars_def new_asms_only_for_priv_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> all_cong<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> nth_map_eq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> priv_are_new_vars fun_cong<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> new_asms_NoReadOrWrite_only_ignores_old_vars<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ignores_old_vars new_asms_NoReadOrWrite_only"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ignores_old_vars_def new_asms_NoReadOrWrite_only_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> all_cong<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> nth_map_eq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> priv_are_new_vars fun_cong<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> modes_respect_priv_ignores_old_vars<span class="main">:</span>
   <span class="quoted"><span class="quoted">"ignores_old_vars modes_respect_priv"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ignores_old_vars_conj<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> modes_respect_priv_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> HOL.refl<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> priv_is_asm_priv_ignores_old_vars<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ignores_old_vars_conj<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> HOL.refl<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> priv_is_guar_priv_ignores_old_vars<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ignores_old_vars_conj<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> HOL.refl<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> new_asms_only_for_priv_ignores_old_vars<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> new_asms_NoReadOrWrite_only_ignores_old_vars<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> ignores_old_varsD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ignores_old_vars <span class="free">P</span> <span class="main">⟹</span> length <span class="free">mdss</span> <span class="main">=</span> length <span class="free">mdss'</span> <span class="main">⟹</span> length <span class="free">mdss'</span> <span class="main">=</span> length <span class="free">cms</span> <span class="main">⟹</span>
  <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">x</span> <span class="bound">m</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span><span class="main">)</span> <span class="free">mdss</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">x</span> <span class="bound">m</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span><span class="main">)</span> <span class="free">mdss'</span><span class="main">)</span> <span class="main">⟹</span> 
  <span class="free">P</span> <span class="free">mdss</span> <span class="main">=</span> <span class="free">P</span> <span class="free">mdss'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ignores_old_vars_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  
<span class="keyword1"><span class="command">lemma</span></span> new_privs_preserved'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟨</span><span class="free">c'</span><span class="main">,</span> <span class="free">mds'</span><span class="main">,</span> <span class="free">mem'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="free">mds</span> <span class="free">m</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">mds'</span> <span class="free">m</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> new_privs_preserved <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> map_nth_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="free">ys</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
  map <span class="free">f</span> <span class="free">xs</span> <span class="main">=</span> map <span class="free">g</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> ignores_old_vars_conc_meval<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ignores<span class="main">:</span> <span class="quoted"><span class="quoted">"ignores_old_vars <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> meval<span class="main">:</span>  <span class="quoted"><span class="quoted">"conc.meval_abv <span class="free">gc<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">n</span> <span class="free">gc<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> len_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>fst <span class="free">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> length <span class="free">cms</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>map snd <span class="main">(</span>fst <span class="free">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span>map snd <span class="main">(</span>fst <span class="free">gc<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gc<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gc<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> meval <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cmn'</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    eval<span class="hidden">⇩</span><sub>C</sub>n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="free">n</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="skolem">cmn'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cms<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">[</span><span class="free">n</span> <span class="main">:=</span> <span class="skolem">cmn'</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conc.meval.cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>map snd <span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span>map snd <span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ignores_old_varsD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ignores<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cms<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> len_eq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cms<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> map_nth_eq<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cms<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">=</span> <span class="free">n</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cms<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> eval<span class="hidden">⇩</span><sub>C</sub>n new_privs_preserved' <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> surjective_pairing<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cms<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ignores_old_vars_conc_meval_sched<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ignores<span class="main">:</span> <span class="quoted"><span class="quoted">"ignores_old_vars <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> meval_sched<span class="main">:</span>  <span class="quoted"><span class="quoted">"conc.meval_sched <span class="free">sched</span> <span class="free">gc<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">gc<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> len_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>fst <span class="free">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> length <span class="free">cms</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>map snd <span class="main">(</span>fst <span class="free">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span>map snd <span class="main">(</span>fst <span class="free">gc<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> meval_sched len_eq <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> conc.meval_sched.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">gc</span> <span class="skolem">gc'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">n</span> <span class="skolem">ns</span> <span class="skolem">gc</span> <span class="skolem">gc'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">gc''</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"conc.meval_abv <span class="skolem">gc</span> <span class="skolem">n</span> <span class="skolem">gc''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"conc.meval_sched <span class="skolem">ns</span> <span class="skolem">gc''</span> <span class="skolem">gc'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>fst <span class="skolem">gc''</span><span class="main">)</span> <span class="main">=</span> length <span class="free">cms</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conc.meval.cases 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_list_update surjective_pairing<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 2 a b <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> ignores_old_vars_conc_meval ignores <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> meval_sched_modes_respect_priv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conc.meval_sched <span class="free">sched</span> <span class="free">gc<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">gc<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">⟹</span>   length <span class="main">(</span>fst <span class="free">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> length <span class="free">cms</span> <span class="main">⟹</span>
  modes_respect_priv <span class="main">(</span>map snd <span class="main">(</span>fst <span class="free">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
  modes_respect_priv <span class="main">(</span>map snd <span class="main">(</span>fst <span class="free">gc<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ignores_old_vars_conc_meval_sched<span class="main"><span class="main">[</span></span><span class="operator">OF</span> modes_respect_priv_ignores_old_vars<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> meval_modes_respect_priv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conc.meval_abv <span class="free">gc<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">n</span> <span class="free">gc<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">⟹</span>   length <span class="main">(</span>fst <span class="free">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> length <span class="free">cms</span> <span class="main">⟹</span>
  modes_respect_priv <span class="main">(</span>map snd <span class="main">(</span>fst <span class="free">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
  modes_respect_priv <span class="main">(</span>map snd <span class="main">(</span>fst <span class="free">gc<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ignores_old_vars_conc_meval<span class="main"><span class="main">[</span></span><span class="operator">OF</span> modes_respect_priv_ignores_old_vars<span class="main"><span class="main">]</span></span><span class="main">)</span>
  
<span class="comment1">(* I think this lemma would guarantee globally sound mode use for all of the
  var<span class="hidden">⇩</span><sub>C</sub>_of variables. It should also hold for all of the non var<span class="hidden">⇩</span><sub>C</sub>_of variables by
  the locale assumptions above *)</span>
<span class="keyword1"><span class="command">lemma</span></span> traces_refinement<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">gc<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">gc<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">sched<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">gc<span class="hidden">⇩</span><sub>A</sub></span><span class="main">.</span> conc.meval_sched <span class="bound">sched<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">gc<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">gc<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">⟹</span>
    length <span class="main">(</span>fst <span class="bound">gc<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">=</span> length <span class="free">cms</span> <span class="main">⟹</span> length <span class="main">(</span>fst <span class="bound">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> length <span class="free">cms</span>  <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>fst <span class="bound">gc<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> snd <span class="bound">gc<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>fst <span class="bound">gc<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> snd <span class="bound">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    abs.sound_mode_use <span class="bound">gc<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> modes_respect_priv <span class="main">(</span>map snd <span class="main">(</span>fst <span class="bound">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">∃</span><span class="bound">sched<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">gc<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span> abs.meval_sched <span class="bound">sched<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">gc<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">gc<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>fst <span class="bound">gc<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> snd <span class="bound">gc<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>fst <span class="bound">gc<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> snd <span class="bound">gc<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          abs.sound_mode_use <span class="bound">gc<span class="hidden">⇩</span><sub>A</sub>'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">sched<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span>
  <span class="keyword3"><span class="command">assume</span></span> meval<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"conc.meval_sched <span class="skolem">sched<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> len_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>fst <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">=</span> length <span class="free">cms</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> len_eq'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>fst <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> length <span class="free">cms</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> in_ℛ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>fst <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> snd <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>fst <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> snd <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> sound_mode_use<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"abs.sound_mode_use <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> modes_respect_priv<span class="main">:</span> <span class="quoted"><span class="quoted">"modes_respect_priv <span class="main">(</span>map snd <span class="main">(</span>fst <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">sched<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">gc<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span> abs.meval_sched <span class="bound">sched<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">gc<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>fst <span class="bound">gc<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> snd <span class="bound">gc<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>fst <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> snd <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          abs.sound_mode_use <span class="bound">gc<span class="hidden">⇩</span><sub>A</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span>  <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> conc.meval_sched.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> cms<span class="hidden">⇩</span><sub>C</sub>'_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs.meval_sched <span class="main">[]</span> <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">cms</span><span class="main">.</span>
        <span class="main">(</span><span class="main">(</span>fst <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> snd <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">,</span> fst <span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> snd <span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span> <span class="main">∈</span> ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
        abs.sound_mode_use <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">n</span> <span class="skolem">ns</span> <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">gc<span class="hidden">⇩</span><sub>c</sub>'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> gc<span class="hidden">⇩</span><sub>C</sub>_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> gc<span class="hidden">⇩</span><sub>A</sub>_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>2<span class="main">)</span> gc<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      meval<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">,</span><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> conc.meval"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      meval_sched<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"conc.meval_sched <span class="skolem">ns</span> <span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">,</span><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">)</span> <span class="skolem">gc<span class="hidden">⇩</span><sub>c</sub>'</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cm<span class="hidden">⇩</span><sub>C</sub>n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cm<span class="hidden">⇩</span><sub>A</sub>n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ℛn</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> meval<span class="hidden">⇩</span><sub>C</sub> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cm<span class="hidden">⇩</span><sub>C</sub>n''</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      eval<span class="hidden">⇩</span><sub>C</sub>n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?cm<span class="hidden">⇩</span><sub>C</sub>n</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="keyword1">↝<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="skolem">cm<span class="hidden">⇩</span><sub>C</sub>n''</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      len<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      cms<span class="hidden">⇩</span><sub>C</sub>''_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> <span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">[</span><span class="skolem">n</span> <span class="main">:=</span> <span class="skolem">cm<span class="hidden">⇩</span><sub>C</sub>n''</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> conc.meval.cases<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> len <span class="keyword1"><span class="command">have</span></span> len <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="free">cms</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 2<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> cms<span class="hidden">⇩</span><sub>C</sub>''_def 2 <span class="keyword1"><span class="command">have</span></span> 
      len_cms<span class="hidden">⇩</span><sub>C</sub>'' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> length <span class="free">cms</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 2 len <span class="keyword1"><span class="command">have</span></span> 
      in_ℛn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="var">?cm<span class="hidden">⇩</span><sub>A</sub>n</span><span class="main">,</span><span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="var">?cm<span class="hidden">⇩</span><sub>C</sub>n</span><span class="main">,</span><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?ℛn</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
    <span class="keyword1"><span class="command">with</span></span> eval<span class="hidden">⇩</span><sub>C</sub>n use_secure_refinement_helper<span class="main">[</span><span class="operator">OF</span> secure_refinements<span class="main"><span class="main">[</span></span><span class="operator">OF</span> len<span class="main"><span class="main">]</span></span><span class="main">]</span>  
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cm<span class="hidden">⇩</span><sub>A</sub>n''</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>''</span></span> <span class="skolem"><span class="skolem">m<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span>
      neval<span class="hidden">⇩</span><sub>A</sub>n<span class="main">:</span> <span class="quoted"><span class="quoted">"abs.neval <span class="main">(</span><span class="var">?cm<span class="hidden">⇩</span><sub>A</sub>n</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="skolem">m<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="skolem">cm<span class="hidden">⇩</span><sub>A</sub>n''</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      in_ℛn''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">cm<span class="hidden">⇩</span><sub>A</sub>n''</span><span class="main">,</span><span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">cm<span class="hidden">⇩</span><sub>C</sub>n''</span><span class="main">,</span><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?ℛn</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> <span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">[</span><span class="skolem">n</span> <span class="main">:=</span> <span class="skolem">cm<span class="hidden">⇩</span><sub>A</sub>n''</span><span class="main">]</span>"</span></span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> len_cms<span class="hidden">⇩</span><sub>A</sub>'' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> length <span class="free">cms</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cms<span class="hidden">⇩</span><sub>A</sub>''_def 2<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  
    <span class="keyword1"><span class="command">have</span></span> in_ℛ''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">)</span><span class="main">,</span> <span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">)</span> <span class="main">∈</span> ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">cms</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">cm<span class="hidden">⇩</span><sub>A</sub>n''</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> cms<span class="hidden">⇩</span><sub>A</sub>''_def len_cms<span class="hidden">⇩</span><sub>A</sub>'' len <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">cm<span class="hidden">⇩</span><sub>C</sub>n''</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> cms<span class="hidden">⇩</span><sub>C</sub>''_def len_cms<span class="hidden">⇩</span><sub>C</sub>'' len <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span>  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> in_ℛn'' <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">n</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>i</span></span> <span class="skolem"><span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>i</span></span> <span class="keyword2"><span class="keyword">where</span></span> cms<span class="hidden">⇩</span><sub>A</sub>i_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub>i</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>i</span></span> <span class="skolem"><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>i</span></span> <span class="keyword2"><span class="keyword">where</span></span> cms<span class="hidden">⇩</span><sub>C</sub>i_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>i</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
        <span class="keyword1"><span class="command">hence</span></span> mds<span class="hidden">⇩</span><sub>C</sub>i_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>i</span> <span class="main">=</span> snd <span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        
        <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>5<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">cms</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
          in_ℛi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="skolem">i</span><span class="main">,</span><span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="skolem">i</span><span class="main">,</span><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          
        <span class="keyword1"><span class="command">from</span></span> in_ℛn'' secure_refinements len preserves_modes_memD
        <span class="keyword1"><span class="command">have</span></span> mem<span class="hidden">⇩</span><sub>A</sub>''_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surjective_pairing<span class="main">)</span>
          
        <span class="keyword1"><span class="command">from</span></span> in_ℛi secure_refinements  <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">cms</span>›</span></span> preserves_modes_memD
             cms<span class="hidden">⇩</span><sub>A</sub>i_def cms<span class="hidden">⇩</span><sub>C</sub>i_def
        <span class="keyword1"><span class="command">have</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
             mds<span class="hidden">⇩</span><sub>A</sub>i_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub>i</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>i</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>
          
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> cms<span class="hidden">⇩</span><sub>A</sub>''_def len_cms<span class="hidden">⇩</span><sub>A</sub>'' len <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> cms<span class="hidden">⇩</span><sub>C</sub>''_def len_cms<span class="hidden">⇩</span><sub>C</sub>'' len <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span>  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        
          <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">cms</span>›</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> closed_othersD<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> secure_refinements<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">cms</span>›</span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> secure_refinement_def<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mds<span class="hidden">⇩</span><sub>C</sub>i_def<span class="main">)</span>  
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ℛn<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ℛi<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> modified_variables_are_not_assumed_not_written<span class="main">)</span>
                           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> gc<span class="hidden">⇩</span><sub>A</sub>_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
                          <span class="keyword1"><span class="command">using</span></span> secure_refinements len secure_refinement_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
                         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> in_ℛn<span class="main">)</span>
                        <span class="keyword1"><span class="command">using</span></span> secure_refinements secure_refinement_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
                       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> in_ℛi<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> len<span class="main">)</span>
                      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                   <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> modes_respect_priv_def priv_is_asm_priv_def gc<span class="hidden">⇩</span><sub>C</sub>_def 
                   <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2.prems"</span><span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
                  <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> modes_respect_priv_def priv_is_guar_priv_def gc<span class="hidden">⇩</span><sub>C</sub>_def 
                  <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2.prems"</span><span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
                 <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> modes_respect_priv_def new_asms_only_for_priv_def gc<span class="hidden">⇩</span><sub>C</sub>_def 
                 <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2.prems"</span><span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> eval<span class="hidden">⇩</span><sub>C</sub>n<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> neval<span class="hidden">⇩</span><sub>A</sub>n<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> in_ℛn''<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> local_guarantee_preservation<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  
    <span class="keyword1"><span class="command">have</span></span> meval_sched<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"abs.meval_sched <span class="main">(</span>replicate <span class="skolem">m<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cms<span class="hidden">⇩</span><sub>A</sub>''_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> abs.neval_meval<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ HOL.refl HOL.refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> neval<span class="hidden">⇩</span><sub>A</sub>n<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2.prems"</span><span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
    <span class="keyword1"><span class="command">have</span></span> sound_mode_use<span class="hidden">⇩</span><sub>A</sub>''<span class="main">:</span> <span class="quoted"><span class="quoted">"abs.sound_mode_use <span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> abs.meval_sched_sound_mode_use<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> meval_sched<span class="hidden">⇩</span><sub>A</sub><span class="main">)</span>
   
    <span class="keyword1"><span class="command">have</span></span> respects''<span class="main">:</span> <span class="quoted"><span class="quoted">"modes_respect_priv <span class="main">(</span>map snd <span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> meval_modes_respect_priv<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> gc<span class="hidden">⇩</span><sub>C</sub>'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>''</span></span><span class="main"><span class="main">,</span></span><span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> meval<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2.prems"</span><span class="main">(</span>3<span class="main">)</span> gc<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">from</span></span> respects'' 2<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> meval_sched<span class="hidden">⇩</span><sub>C</sub><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> gc<span class="hidden">⇩</span><sub>A</sub>7 <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub>''</span></span><span class="main">]</span> in_ℛ'' sound_mode_use<span class="hidden">⇩</span><sub>A</sub>''
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sched<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub>'</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span>  meval_sched<span class="hidden">⇩</span><sub>A</sub>''<span class="main">:</span> <span class="quoted"><span class="quoted">"abs.meval_sched <span class="skolem">sched<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub>'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_ℛ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">cms</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>fst <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> snd <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">)</span><span class="main">,</span> fst <span class="skolem">gc<span class="hidden">⇩</span><sub>c</sub>'</span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> snd <span class="skolem">gc<span class="hidden">⇩</span><sub>c</sub>'</span><span class="main">)</span> <span class="main">∈</span> ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           sound_mode_use<span class="hidden">⇩</span><sub>A</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"abs.sound_mode_use  <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub>'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">final_sched<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">final_sched<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">(</span>replicate <span class="skolem">m<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">n</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">sched<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> meval_final_sched<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"abs.meval_sched <span class="skolem">final_sched<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub>'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> meval_sched<span class="hidden">⇩</span><sub>A</sub>'' meval_sched<span class="hidden">⇩</span><sub>A</sub> abs.meval_sched_app final_sched<span class="hidden">⇩</span><sub>A</sub>_def gc<span class="hidden">⇩</span><sub>A</sub>''_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
    <span class="keyword1"><span class="command">from</span></span> meval_final_sched<span class="hidden">⇩</span><sub>A</sub> in_ℛ' sound_mode_use<span class="hidden">⇩</span><sub>A</sub>'
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> sifum_security <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">restrict_modes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'Var</span> Mds list <span class="main">⇒</span> <span class="tfree">'Var</span> set <span class="main">⇒</span> <span class="tfree">'Var</span> Mds list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">restrict_modes</span> <span class="free"><span class="bound"><span class="entity">mdss</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">mds</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">mds</span> <span class="bound">m</span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">mdss</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> restrict_modes_length <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="main">(</span>restrict_modes <span class="free">mdss</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> length <span class="free">mdss</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> restrict_modes_def<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> compatible_modes_by_case_distinction<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> compat_X<span class="main">:</span> <span class="quoted"><span class="quoted">"compatible_modes <span class="main">(</span>restrict_modes <span class="free">mdss</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> compat_compX<span class="main">:</span> <span class="quoted"><span class="quoted">"compatible_modes <span class="main">(</span>restrict_modes <span class="free">mdss</span> <span class="main">(</span><span class="main">-</span><span class="free">X</span> <span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"compatible_modes <span class="free">mdss</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> compatible_modes_def
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">x</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> ilen<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">mdss</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> jlen<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">mdss</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="skolem">i</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">mdss</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> AsmNoReadOrWrite"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">mdss</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> GuarNoReadOrWrite"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> xin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mdss<span class="hidden">⇩</span><sub>X</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"restrict_modes <span class="free">mdss</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> asm xin <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="var">?mdss<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> AsmNoReadOrWrite"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> restrict_modes_def
      <span class="keyword1"><span class="command">using</span></span> ilen <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">with</span></span> compat_X jlen ilen neq 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="var">?mdss<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> GuarNoReadOrWrite"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> compatible_modes_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> xin jlen <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> restrict_modes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> xnin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mdss<span class="hidden">⇩</span><sub>X</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"restrict_modes <span class="free">mdss</span> <span class="main">(</span><span class="main">-</span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> asm xnin <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="var">?mdss<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> AsmNoReadOrWrite"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> restrict_modes_def
      <span class="keyword1"><span class="command">using</span></span> ilen <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">with</span></span> compat_compX jlen ilen neq 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="var">?mdss<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> GuarNoReadOrWrite"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> compatible_modes_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> xnin jlen <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> restrict_modes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">x</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> ilen<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">mdss</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> jlen<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">mdss</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="skolem">i</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">mdss</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> AsmNoWrite"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">mdss</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> GuarNoWrite"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> xin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mdss<span class="hidden">⇩</span><sub>X</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"restrict_modes <span class="free">mdss</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> asm xin <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="var">?mdss<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> AsmNoWrite"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> restrict_modes_def
      <span class="keyword1"><span class="command">using</span></span> ilen <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">with</span></span> compat_X jlen ilen neq 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="var">?mdss<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> GuarNoWrite"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> compatible_modes_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> xin jlen <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> restrict_modes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> xnin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mdss<span class="hidden">⇩</span><sub>X</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"restrict_modes <span class="free">mdss</span> <span class="main">(</span><span class="main">-</span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> asm xnin <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="var">?mdss<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> AsmNoWrite"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> restrict_modes_def
      <span class="keyword1"><span class="command">using</span></span> ilen <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">with</span></span> compat_compX jlen ilen neq 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="var">?mdss<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> GuarNoWrite"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> compatible_modes_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> xnin jlen <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> restrict_modes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> in_restrict_modesD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">mdss</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span>restrict_modes <span class="free">mdss</span> <span class="free">X</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">mdss</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> restrict_modes_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> in_restrict_modesI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">mdss</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">mdss</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span>restrict_modes <span class="free">mdss</span> <span class="free">X</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">m</span> "</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> restrict_modes_def<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> meval_sched_length<span class="main">:</span>
  <span class="quoted"><span class="quoted">"meval_sched <span class="free">sched</span> <span class="free">gc</span> <span class="free">gc'</span> <span class="main">⟹</span> length <span class="main">(</span>fst <span class="free">gc'</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>fst <span class="free">gc</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">sched</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">gc</span></span> <span class="quoted"><span class="free">gc'</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> sifum_refinement_sys <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> compatible_modes_old_vars<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> compatible_modes<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"abs.compatible_modes <span class="main">(</span>map snd <span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> len<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> length <span class="free">cms</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> len<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> length <span class="free">cms</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_ℛ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">cms</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">,</span> <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conc.compatible_modes <span class="main">(</span>conc.restrict_modes <span class="main">(</span>map snd <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">(</span>range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> conc.compatible_modes_def
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> i_len<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cms</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">cms</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> in_ℛ i_len len<span class="hidden">⇩</span><sub>C</sub>
  <span class="keyword1"><span class="command">have</span></span> in_ℛ_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="skolem">i</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">,</span> <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="skolem">i</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> ℛ_rel <span class="var">?cms</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> i_len <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>map snd <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> m_x_range<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>conc.restrict_modes <span class="main">(</span>map snd <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">(</span>range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="bound">m</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∈</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>map snd <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="bound">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conc.in_restrict_modesD i_len <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> m_x<span class="hidden">⇩</span><sub>C</sub>_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>conc.restrict_modes <span class="main">(</span>map snd <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">(</span>range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="bound">m</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="var">?mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_len<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> secure_refinements i_len len<span class="hidden">⇩</span><sub>C</sub>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"secure_refinement <span class="main">(</span>ℛ<span class="hidden">⇩</span><sub>A</sub>_rel <span class="var">?cms</span><span class="main">)</span> <span class="main">(</span>ℛ_rel <span class="var">?cms</span><span class="main">)</span> <span class="main">(</span>P_rel <span class="var">?cms</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> preserves_modes_mem_ℛ_i<span class="main">:</span> <span class="quoted"><span class="quoted">"preserves_modes_mem <span class="main">(</span>ℛ_rel <span class="var">?cms</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> in_ℛ_i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> ℛ_rel <span class="var">?cms</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">with</span></span> preserves_modes_mem_ℛ_i
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">.</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">`</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">=</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">∩</span> <span class="var">?mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> preserves_modes_mem_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> m_x<span class="hidden">⇩</span><sub>C</sub>_i <span class="keyword1"><span class="command">have</span></span> m_x<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>conc.restrict_modes <span class="main">(</span>map snd <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">(</span>range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="bound">m</span> <span class="main">⟹</span> var<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">x</span> <span class="main">∈</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> var<span class="hidden">⇩</span><sub>A</sub>_of_def <span class="keyword1"><span class="command">using</span></span> m_x_range inj_image_mem_iff var<span class="hidden">⇩</span><sub>C</sub>_of_inj <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>conc.restrict_modes <span class="main">(</span>map snd <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">(</span>range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> AsmNoReadOrWrite <span class="main">⟶</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">j</span> <span class="main">≠</span> <span class="skolem">i</span> <span class="main">⟶</span>
            <span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>conc.restrict_modes <span class="main">(</span>map snd <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">(</span>range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span> GuarNoReadOrWrite<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>conc.restrict_modes <span class="main">(</span>map snd <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">(</span>range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> AsmNoWrite <span class="main">⟶</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">j</span> <span class="main">≠</span> <span class="skolem">i</span> <span class="main">⟶</span>
            <span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>conc.restrict_modes <span class="main">(</span>map snd <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">(</span>range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span> GuarNoWrite<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
      <span class="keyword3"><span class="command">assume</span></span> AsmNoRW_x<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>conc.restrict_modes <span class="main">(</span>map snd <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">(</span>range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> AsmNoReadOrWrite"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        j_len<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        j_not_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cms'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">cms</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>C</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>C</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> AsmNoRW_x<span class="hidden">⇩</span><sub>C</sub> m_x_range
      <span class="keyword1"><span class="command">have</span></span> x_range<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">from</span></span> AsmNoRW_x<span class="hidden">⇩</span><sub>C</sub> m_x<span class="hidden">⇩</span><sub>A</sub>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"var<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">x</span> <span class="main">∈</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub></span> AsmNoReadOrWrite"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> compatible_modes<span class="hidden">⇩</span><sub>A</sub>
      <span class="keyword1"><span class="command">have</span></span> GuarNoRW_x<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"var<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">x</span> <span class="main">∈</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span> GuarNoReadOrWrite"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> abs.compatible_modes_def <span class="keyword1"><span class="command">using</span></span> i_len len<span class="hidden">⇩</span><sub>A</sub> len<span class="hidden">⇩</span><sub>C</sub> j_len j_not_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>

      <span class="keyword1"><span class="command">from</span></span> in_ℛ j_len len<span class="hidden">⇩</span><sub>C</sub>
      <span class="keyword1"><span class="command">have</span></span> in_ℛ_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="skolem">j</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">,</span> <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="skolem">j</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> ℛ_rel <span class="var">?cms'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">from</span></span> j_len <span class="keyword1"><span class="command">have</span></span> j_len'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span>map snd <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">from</span></span> secure_refinements j_len len<span class="hidden">⇩</span><sub>C</sub>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"secure_refinement <span class="main">(</span>ℛ<span class="hidden">⇩</span><sub>A</sub>_rel <span class="var">?cms'</span><span class="main">)</span> <span class="main">(</span>ℛ_rel <span class="var">?cms'</span><span class="main">)</span> <span class="main">(</span>P_rel <span class="var">?cms'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> preserves_modes_mem_ℛ_j<span class="main">:</span> <span class="quoted"><span class="quoted">"preserves_modes_mem <span class="main">(</span>ℛ_rel <span class="var">?cms'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">from</span></span> in_ℛ_j <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> ℛ_rel <span class="var">?cms'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command">with</span></span> preserves_modes_mem_ℛ_j
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">.</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">`</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">m</span> <span class="main">=</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">∩</span> <span class="var">?mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> preserves_modes_mem_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">with</span></span> GuarNoRW_x<span class="hidden">⇩</span><sub>A</sub> j_len j_len' mds<span class="hidden">⇩</span><sub>A</sub>_of_def x_range conc.in_restrict_modesI var<span class="hidden">⇩</span><sub>C</sub>_of_inj
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>conc.restrict_modes <span class="main">(</span>map snd <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">(</span>range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> GuarNoReadOrWrite"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> var<span class="hidden">⇩</span><sub>A</sub>_of_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> doesnt_have_mode f_inv_into_f image_inv_f_f nth_map<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="comment1">(* This argument is identical to that for AsmNoReadOrWrite *)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
      <span class="keyword3"><span class="command">assume</span></span> AsmNoWrite_x<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>conc.restrict_modes <span class="main">(</span>map snd <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">(</span>range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> AsmNoWrite"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        j_len<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        j_not_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cms'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">cms</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>C</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>C</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> AsmNoWrite_x<span class="hidden">⇩</span><sub>C</sub> m_x_range
      <span class="keyword1"><span class="command">have</span></span> x_range<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">from</span></span> AsmNoWrite_x<span class="hidden">⇩</span><sub>C</sub> m_x<span class="hidden">⇩</span><sub>A</sub>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"var<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">x</span> <span class="main">∈</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub></span> AsmNoWrite"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> compatible_modes<span class="hidden">⇩</span><sub>A</sub>
      <span class="keyword1"><span class="command">have</span></span> GuarNoWrite_x<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"var<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">x</span> <span class="main">∈</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span> GuarNoWrite"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> abs.compatible_modes_def <span class="keyword1"><span class="command">using</span></span> i_len len<span class="hidden">⇩</span><sub>A</sub> len<span class="hidden">⇩</span><sub>C</sub> j_len j_not_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>

      <span class="keyword1"><span class="command">from</span></span> in_ℛ j_len len<span class="hidden">⇩</span><sub>C</sub>
      <span class="keyword1"><span class="command">have</span></span> in_ℛ_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="skolem">j</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">,</span> <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="skolem">j</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> ℛ_rel <span class="var">?cms'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">from</span></span> j_len <span class="keyword1"><span class="command">have</span></span> j_len'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span>map snd <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">from</span></span> secure_refinements j_len len<span class="hidden">⇩</span><sub>C</sub>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"secure_refinement <span class="main">(</span>ℛ<span class="hidden">⇩</span><sub>A</sub>_rel <span class="var">?cms'</span><span class="main">)</span> <span class="main">(</span>ℛ_rel <span class="var">?cms'</span><span class="main">)</span> <span class="main">(</span>P_rel <span class="var">?cms'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> preserves_modes_mem_ℛ_j<span class="main">:</span> <span class="quoted"><span class="quoted">"preserves_modes_mem <span class="main">(</span>ℛ_rel <span class="var">?cms'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">from</span></span> in_ℛ_j <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> ℛ_rel <span class="var">?cms'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command">with</span></span> preserves_modes_mem_ℛ_j
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">.</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="bound">x<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">`</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">m</span> <span class="main">=</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">∩</span> <span class="var">?mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> preserves_modes_mem_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">with</span></span> GuarNoWrite_x<span class="hidden">⇩</span><sub>A</sub> j_len j_len' mds<span class="hidden">⇩</span><sub>A</sub>_of_def x_range conc.in_restrict_modesI var<span class="hidden">⇩</span><sub>C</sub>_of_inj
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>conc.restrict_modes <span class="main">(</span>map snd <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">(</span>range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> GuarNoWrite"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> var<span class="hidden">⇩</span><sub>A</sub>_of_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> doesnt_have_mode f_inv_into_f image_inv_f_f nth_map<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> compatible_modes_new_vars<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">mdss</span> <span class="main">=</span> length <span class="free">cms</span> <span class="main">⟹</span> modes_respect_priv <span class="free">mdss</span> <span class="main">⟹</span> conc.compatible_modes <span class="main">(</span>conc.restrict_modes <span class="free">mdss</span> <span class="main">(</span><span class="main">-</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> conc.compatible_modes_def
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mdss<span class="hidden">⇩</span><sub>X</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"conc.restrict_modes <span class="free">mdss</span> <span class="var">?X</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> respect<span class="main">:</span> <span class="quoted"><span class="quoted">"modes_respect_priv <span class="free">mdss</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> len_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">mdss</span> <span class="main">=</span> length <span class="free">cms</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> ilen<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="var">?mdss<span class="hidden">⇩</span><sub>X</sub></span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> jlen<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="var">?mdss<span class="hidden">⇩</span><sub>X</sub></span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="skolem">i</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="hidden">⇩</span><sub>X</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="main">(</span><span class="var">?mdss<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> AsmNoWrite"</span></span>
  <span class="keyword1"><span class="command">from</span></span> conc.in_restrict_modesD ilen asm<span class="hidden">⇩</span><sub>X</sub> conc.restrict_modes_length <span class="keyword1"><span class="command">have</span></span> 
    xin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="var">?X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="main">(</span><span class="free">mdss</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> AsmNoWrite"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> asm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
    <span class="keyword1"><span class="command">using</span></span> respect xin ilen conc.restrict_modes_length len_eq
    <span class="keyword1"><span class="command">unfolding</span></span> modes_respect_priv_def new_asms_NoReadOrWrite_only_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="main">(</span><span class="var">?mdss<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> GuarNoWrite"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mdss<span class="hidden">⇩</span><sub>X</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"conc.restrict_modes <span class="free">mdss</span> <span class="var">?X</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> respect<span class="main">:</span> <span class="quoted"><span class="quoted">"modes_respect_priv <span class="free">mdss</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> len_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">mdss</span> <span class="main">=</span> length <span class="free">cms</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> ilen<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="var">?mdss<span class="hidden">⇩</span><sub>X</sub></span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> jlen<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="var">?mdss<span class="hidden">⇩</span><sub>X</sub></span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="skolem">i</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="hidden">⇩</span><sub>X</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="main">(</span><span class="var">?mdss<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> AsmNoReadOrWrite"</span></span>
  <span class="keyword1"><span class="command">from</span></span> conc.in_restrict_modesD ilen asm<span class="hidden">⇩</span><sub>X</sub> conc.restrict_modes_length <span class="keyword1"><span class="command">have</span></span> 
    xin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="var">?X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="main">(</span><span class="free">mdss</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> AsmNoReadOrWrite"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> respect asm xin ilen conc.restrict_modes_length len_eq <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free">priv_mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> modes_respect_priv_def new_asms_only_for_priv_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">with</span></span> respect ilen jlen neq conc.restrict_modes_length len_eq <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="main">(</span><span class="free">mdss</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> GuarNoReadOrWrite"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> modes_respect_priv_def priv_is_guar_priv_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">with</span></span> jlen xin conc.in_restrict_modesI <span class="keyword3"><span class="command">show</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="main">(</span><span class="var">?mdss<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> GuarNoReadOrWrite"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

    
<span class="keyword1"><span class="command">lemma</span></span> sound_mode_use_preservation<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">gc<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">gc<span class="hidden">⇩</span><sub>A</sub></span><span class="main">.</span> 
    length <span class="main">(</span>fst <span class="bound">gc<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">=</span> length <span class="free">cms</span> <span class="main">⟹</span> length <span class="main">(</span>fst <span class="bound">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> length <span class="free">cms</span>  <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>fst <span class="bound">gc<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> snd <span class="bound">gc<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>fst <span class="bound">gc<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> snd <span class="bound">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    abs.sound_mode_use <span class="bound">gc<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> modes_respect_priv <span class="main">(</span>map snd <span class="main">(</span>fst <span class="bound">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    conc.sound_mode_use <span class="bound">gc<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span>
  <span class="keyword3"><span class="command">assume</span></span> len_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>fst <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">=</span> length <span class="free">cms</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> len_eq'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>fst <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> length <span class="free">cms</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> in_ℛ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>fst <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> snd <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>fst <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> snd <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> sound_mode_use<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"abs.sound_mode_use <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> modes_respect_priv<span class="main">:</span> <span class="quoted"><span class="quoted">"modes_respect_priv <span class="main">(</span>map snd <span class="main">(</span>fst <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conc.globally_sound_mode_use <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> conc.globally_sound_mode_use_def
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">mdss<span class="hidden">⇩</span><sub>C</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> in_reachable_modes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mdss<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∈</span> conc.reachable_mode_states <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="skolem"><span class="skolem">sched<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span>
      meval_sched<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"conc.meval_sched <span class="skolem">sched<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      mdss<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mdss<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> map snd <span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> conc.reachable_mode_states_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> traces_refinement<span class="main">[</span><span class="operator">OF</span> meval_sched<span class="hidden">⇩</span><sub>C</sub><span class="main">,</span> <span class="operator">OF</span> len_eq len_eq' in_ℛ sound_mode_use<span class="hidden">⇩</span><sub>A</sub> modes_respect_priv<span class="main">]</span> 
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sched<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub>'</span></span> <span class="skolem"><span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub>'</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span> gc<span class="hidden">⇩</span><sub>A</sub>'_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
      meval_sched<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"abs.meval_sched <span class="skolem">sched<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub>'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      in_ℛ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">cms</span><span class="main">.</span>
              <span class="main">(</span><span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">)</span><span class="main">,</span> <span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span> <span class="main">∈</span> ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sound_mode_use<span class="hidden">⇩</span><sub>A</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"abs.sound_mode_use <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub>'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mdss<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map snd <span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub>'</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?mdss<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">∈</span> abs.reachable_mode_states <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> abs.reachable_mode_states_def
      <span class="keyword1"><span class="command">using</span></span> meval_sched<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> compatible_modes<span class="hidden">⇩</span><sub>A</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"abs.compatible_modes <span class="var">?mdss<span class="hidden">⇩</span><sub>A</sub>'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sound_mode_use<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">unfolding</span></span> abs.sound_mode_use_def abs.globally_sound_mode_use_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"range <span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"conc.compatible_modes <span class="skolem">mdss<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> conc.compatible_modes_by_case_distinction<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> X<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?X</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"conc.compatible_modes <span class="main">(</span>conc.restrict_modes <span class="skolem">mdss<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="var">?X</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mdss<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> compatible_modes_old_vars<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ in_ℛ<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> compatible_modes<span class="hidden">⇩</span><sub>A</sub>'<span class="main">)</span>
         <span class="keyword1"><span class="command">using</span></span> len_eq abs.meval_sched_length<span class="main">[</span><span class="operator">OF</span> meval_sched<span class="hidden">⇩</span><sub>A</sub><span class="main">]</span> gc<span class="hidden">⇩</span><sub>A</sub>'_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">using</span></span> len_eq' conc.meval_sched_length<span class="main">[</span><span class="operator">OF</span> meval_sched<span class="hidden">⇩</span><sub>C</sub><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"conc.compatible_modes <span class="main">(</span>conc.restrict_modes <span class="skolem">mdss<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span><span class="main">-</span> <span class="var">?X</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> compatible_modes_new_vars<span class="main">)</span>
         <span class="keyword1"><span class="command">using</span></span> len_eq' conc.meval_sched_length<span class="main">[</span><span class="operator">OF</span> meval_sched<span class="hidden">⇩</span><sub>C</sub><span class="main">]</span> mdss<span class="hidden">⇩</span><sub>C</sub>'_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mdss<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> meval_sched_modes_respect_priv<span class="main"><span class="main">[</span></span><span class="operator">OF</span> meval_sched<span class="hidden">⇩</span><sub>C</sub><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> modes_respect_priv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_all <span class="main">(</span><span class="main">λ</span> <span class="bound">cm</span><span class="main">.</span> conc.locally_sound_mode_use <span class="main">(</span><span class="bound">cm</span><span class="main">,</span> <span class="main">(</span>snd <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> list_all_length
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>fst <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">cms</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> preserves<span class="main">:</span> <span class="quoted"><span class="quoted">"preserves_locally_sound_mode_use <span class="main">(</span>ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> locally_sound_mode_use_preservation<span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> secure_refinements len <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">using</span></span> local_guarantee_preservation len <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs.locally_sound_mode_use <span class="main">(</span>fst <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="skolem">i</span><span class="main">,</span> snd <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sound_mode_use<span class="hidden">⇩</span><sub>A</sub> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">cms</span>›</span></span> len_eq
      <span class="keyword1"><span class="command">unfolding</span></span> abs.sound_mode_use_def list_all_length
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span>
    
    <span class="keyword1"><span class="command">from</span></span> this in_ℛ<span class="main">[</span><span class="operator">OF</span> len<span class="main">]</span> preserves<span class="main">[</span><span class="operator">unfolded</span> preserves_locally_sound_mode_use_def<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"conc.locally_sound_mode_use <span class="main">(</span>fst <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="skolem">i</span><span class="main">,</span> snd <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
      
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="skolem">gc<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">gc<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> conc.sound_mode_use_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>     
      
<span class="keyword1"><span class="command">lemma</span></span> refined_prog_secure<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> len<span class="hidden">⇩</span><sub>A</sub> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> length <span class="free">cms</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> len<span class="hidden">⇩</span><sub>C</sub> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> length <span class="free">cms</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_ℛ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟹</span>  <span class="main">(</span><span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_ℛ<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">cms</span><span class="main">;</span> conc.low_mds_eq <span class="main">(</span>snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">⟧</span>
       <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ℛ<span class="hidden">⇩</span><sub>A</sub>_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sound_mode_use<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">.</span>  abs.sound_mode_use <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> modes_respect_priv<span class="main">:</span> <span class="quoted"><span class="quoted">"modes_respect_priv <span class="main">(</span>map snd <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conc.prog_sifum_secure_cont <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conc.sifum_compositionality_cont<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_all_length<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> conc.com_sifum_secure_def conc.low_indistinguishable_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conc.mm_equiv.intros<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> R<span class="hidden">⇩</span><sub>C</sub>_of_strong_low_bisim_mm<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> bisims<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> secure_refinements<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ps_sym<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> R<span class="hidden">⇩</span><sub>C</sub>_of_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> i c<span class="hidden">⇩</span><sub>C</sub> mds<span class="hidden">⇩</span><sub>C</sub> mem<span class="hidden">⇩</span><sub>C</sub> mem<span class="hidden">⇩</span><sub>C</sub>'<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="improper">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="improper">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="improper">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> in_ℛ <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="improper">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="improper">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="improper">mem<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> in_ℛ <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_ℛ<span class="hidden">⇩</span><sub>A</sub> Ps_refl_on_low_mds_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> mem<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> gc<span class="hidden">⇩</span><sub>A</sub><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="improper">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sound_mode_use_preservation<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">using</span></span> in_ℛ <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sound_mode_use<span class="hidden">⇩</span><sub>A</sub><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> modes_respect_priv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> refined_prog_secure'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> len<span class="hidden">⇩</span><sub>A</sub> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> length <span class="free">cms</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> len<span class="hidden">⇩</span><sub>C</sub> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> length <span class="free">cms</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_ℛ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_ℛ<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">cms</span><span class="main">;</span>  abs.low_mds_eq <span class="main">(</span>snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">⟧</span>
       <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ℛ<span class="hidden">⇩</span><sub>A</sub>_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sound_mode_use<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">.</span>  abs.sound_mode_use <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> modes_respect_priv<span class="main">:</span> <span class="quoted"><span class="quoted">"modes_respect_priv <span class="main">(</span>map snd <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conc.prog_sifum_secure_cont <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> refined_prog_secure<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> len<span class="hidden">⇩</span><sub>A</sub><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> len<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> in_ℛ<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> in_ℛ<span class="hidden">⇩</span><sub>A</sub><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="improper">i</span><span class="main">)</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="main">(</span>snd <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="improper">i</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> low_mds_eq_from_conc_to_abs <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ℛ1<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="improper">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="hidden">⇩</span><sub>A</sub>1<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="improper">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="hidden">⇩</span><sub>C</sub>1<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="improper">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> preserves_modes_memD<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct2<span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> secure_refinements <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command">using</span></span> in_ℛ <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sound_mode_use<span class="hidden">⇩</span><sub>A</sub><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> modes_respect_priv<span class="main">)</span>
    
<span class="keyword2"><span class="keyword">end</span></span>
  
<span class="keyword1"><span class="command">context</span></span> sifum_security <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">reachable_mems</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'Com</span> <span class="main">×</span> <span class="main">(</span>Mode <span class="main">⇒</span> <span class="tfree">'Var</span> set<span class="main">)</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'Var</span><span class="main">,</span><span class="tfree">'Val</span><span class="main">)</span> Mem <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'Var</span><span class="main">,</span><span class="tfree">'Val</span><span class="main">)</span> Mem set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">reachable_mems</span> <span class="free"><span class="bound"><span class="entity">cms</span></span></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">mem'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">sched</span> <span class="bound">cms'</span><span class="main">.</span> meval_sched <span class="bound">sched</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cms</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">cms'</span><span class="main">,</span><span class="bound">mem'</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reachable_mems_refl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">mem</span> <span class="main">∈</span> reachable_mems <span class="free">cms</span> <span class="free">mem</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reachable_mems_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> sifum_refinement_sys <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reachable_mems_refinement<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sys_nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">cms</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> len<span class="hidden">⇩</span><sub>A</sub> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> length <span class="free">cms</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> len<span class="hidden">⇩</span><sub>C</sub> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> length <span class="free">cms</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_ℛ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">cms</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sound_mode_use<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">.</span> abs.sound_mode_use <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> modes_respect_priv<span class="main">:</span> <span class="quoted"><span class="quoted">"modes_respect_priv <span class="main">(</span>map snd <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> reachable<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∈</span> conc.reachable_mems <span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∈</span> abs.reachable_mems <span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> reachable<span class="hidden">⇩</span><sub>C</sub> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sched<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="skolem"><span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    meval_sched<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"conc.meval_sched <span class="skolem">sched<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> conc.reachable_mems_def<span class="main">)</span>
  
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> sound_mode_use<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"abs.sound_mode_use <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> sound_mode_use<span class="hidden">⇩</span><sub>A</sub><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> traces_refinement<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> gc<span class="hidden">⇩</span><sub>A</sub><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> meval_sched<span class="hidden">⇩</span><sub>C</sub><span class="main">,</span> <span class="operator">OF</span> _ _ _ sound_mode_use<span class="hidden">⇩</span><sub>A</sub><span class="main">]</span>
       in_ℛ<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span></span><span class="main">]</span>
       modes_respect_priv
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sched<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="skolem"><span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub>'</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    meval_sched<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"abs.meval_sched <span class="skolem">sched<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span><span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    in_ℛ'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">cms</span><span class="main">.</span>
               <span class="main">(</span><span class="main">(</span><span class="skolem">cms<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">)</span><span class="main">,</span> <span class="skolem">cms<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span> <span class="main">∈</span> ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> reachable<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">∈</span> abs.reachable_mems <span class="free">cms<span class="hidden">⇩</span><sub>A</sub></span> <span class="var">?mem<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs.reachable_mems_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sys_nonempty <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> ilen<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">cms</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ℛi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ℛ_rel <span class="main">(</span><span class="free">cms</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> ilen secure_refinements <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"preserves_modes_mem <span class="var">?ℛi</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> ilen in_ℛ' preserves_modes_memD<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    mem<span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> surjective_pairing<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> reachable<span class="hidden">⇩</span><sub>A</sub> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Eg1">
<div class="head">
<h1>Theory Eg1</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Eg1
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../Dependent_SIFUM_Type_Systems/Compositionality.html">Dependent_SIFUM_Type_Systems.Compositionality</a>
        <a href="../Dependent_SIFUM_Type_Systems/Language.html">Dependent_SIFUM_Type_Systems.Language</a>
        <a href="../Dependent_SIFUM_Type_Systems/TypeSystemTactics.html">Dependent_SIFUM_Type_Systems.TypeSystemTactics</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">datatype</span></span> var <span class="main">=</span> control_var <span class="main">|</span> buffer <span class="main">|</span> high_var <span class="main">|</span> low_var <span class="main">|</span> temp

<span class="keyword1"><span class="command">type_synonym</span></span> addr <span class="main">=</span> <span class="quoted">var</span>
<span class="keyword1"><span class="command">type_synonym</span></span> val <span class="main">=</span> <span class="quoted">nat</span>
<span class="keyword1"><span class="command">type_synonym</span></span> mem <span class="main">=</span> <span class="quoted"><span class="quoted">"addr <span class="main">⇒</span> val"</span></span>

<span class="comment1">(* Address expression evaluation *)</span>
<span class="keyword1"><span class="command">datatype</span></span> aexp <span class="main">=</span> Const <span class="quoted"><span class="quoted">"val"</span></span> <span class="main">|</span>
                Load <span class="quoted"><span class="quoted">"addr"</span></span>

<span class="keyword1"><span class="command">fun</span></span> 
  <span class="entity">ev<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"mem <span class="main">⇒</span> aexp <span class="main">⇒</span> val"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ev<span class="hidden">⇩</span><sub>A</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">ev<span class="hidden">⇩</span><sub>A</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="comment1">(* Boolean expression evaluation *)</span>
<span class="keyword1"><span class="command">datatype</span></span> bexp <span class="main">=</span> Same <span class="quoted"><span class="quoted">"addr"</span></span> <span class="quoted"><span class="quoted">"addr"</span></span> <span class="main">|</span>
                NotSame <span class="quoted"><span class="quoted">"addr"</span></span> <span class="quoted"><span class="quoted">"addr"</span></span> <span class="main">|</span>
                Eq <span class="quoted"><span class="quoted">"addr"</span></span> <span class="quoted"><span class="quoted">"val"</span></span> <span class="main">|</span>
                Neq <span class="quoted"><span class="quoted">"addr"</span></span> <span class="quoted"><span class="quoted">"val"</span></span> <span class="main">|</span> TT <span class="main">|</span> FF

<span class="keyword1"><span class="command">fun</span></span>
  <span class="entity">ev<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"mem <span class="main">⇒</span> bexp <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ev<span class="hidden">⇩</span><sub>B</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="main">(</span>Same <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span> 
  <span class="quoted"><span class="quoted">"<span class="free">ev<span class="hidden">⇩</span><sub>B</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="main">(</span>NotSame <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">ev<span class="hidden">⇩</span><sub>B</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span> 
  <span class="quoted"><span class="quoted">"<span class="free">ev<span class="hidden">⇩</span><sub>B</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="main">(</span>Neq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">ev<span class="hidden">⇩</span><sub>B</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> TT <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">ev<span class="hidden">⇩</span><sub>B</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> FF <span class="main">=</span> False"</span></span>


<span class="comment1">(* NB: dma ~ "domain assignment"
 * Domain assignment function based on the value of a control variable,
 * Low if 0, High otherwise. *)</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">dma_control_var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"val <span class="main">⇒</span> Sec"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dma_control_var</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> Low <span class="keyword1">else</span> High"</span></span>

<span class="comment1">(* buffer's security level is controlled by control_var.
 * high_var's is High.
 * All other memory's security level is Low. *)</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">dma</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"mem <span class="main">⇒</span> addr <span class="main">⇒</span> Sec"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dma</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> buffer <span class="keyword1">then</span> dma_control_var <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> control_var<span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> high_var <span class="keyword1">then</span> High <span class="keyword1">else</span> Low"</span></span>

<span class="comment1">(* Function that gives the control variables of a given variable.
 * Only buffer is controlled by a control variable, control_var *)</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">𝒞_vars</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"addr <span class="main">⇒</span> addr set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">𝒞_vars</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> buffer <span class="keyword1">then</span> <span class="main">{</span>control_var<span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span>"</span></span>

<span class="comment1">(* NB: mds ~ "mode state"
 * mds<span class="hidden">⇩</span><sub>s</sub> is the initial mode state - start with it empty. *)</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">mds<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Mode <span class="main">⇒</span> var set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">aexp_vars</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"aexp <span class="main">⇒</span> var set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">aexp_vars</span> <span class="main">(</span>Const <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">aexp_vars</span> <span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span>"</span></span>
  
<span class="keyword1"><span class="command">fun</span></span>
  <span class="entity">bexp_vars</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bexp <span class="main">⇒</span> addr set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_vars</span> <span class="main">(</span>Neq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_vars</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_vars</span> <span class="main">(</span>Same <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">}</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_vars</span> <span class="main">(</span>NotSame <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">}</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_vars</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

  
<span class="keyword1"><span class="command">fun</span></span>
  <span class="entity">bexp_neg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bexp <span class="main">⇒</span> bexp"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_neg</span> <span class="main">(</span>Neq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_neg</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Neq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_neg</span> <span class="main">(</span>Same <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>NotSame <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_neg</span> <span class="main">(</span>NotSame <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Same <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_neg</span> TT <span class="main">=</span> FF"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_neg</span> FF <span class="main">=</span> TT"</span></span>


<span class="keyword1"><span class="command">fun</span></span>
  <span class="entity">bexp_assign</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"addr <span class="main">⇒</span> aexp <span class="main">⇒</span> bexp"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_assign</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_assign</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>  <span class="main">=</span> <span class="main">(</span>Same <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> sifum_example <span class="main">=</span>
  sifum_lang_no_dma <span class="quoted">ev<span class="hidden">⇩</span><sub>A</sub></span> <span class="quoted">ev<span class="hidden">⇩</span><sub>B</sub></span> <span class="quoted">aexp_vars</span> <span class="quoted">bexp_vars</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eval_det<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">lc</span><span class="main">,</span> <span class="free">lc'</span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">⟹</span> <span class="main">(</span><span class="free">lc</span><span class="main">,</span> <span class="free">lc''</span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">⟹</span> <span class="free">lc'</span> <span class="main">=</span> <span class="free">lc''</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">𝒞</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"addr set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">≡</span> <span class="main">⋃</span><span class="bound">x</span><span class="main">.</span> 𝒞_vars <span class="bound">x</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span>
  <span class="entity">dma_type</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"addr <span class="main">⇒</span> bexp set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dma_type</span> high_var <span class="main">=</span> <span class="main">{</span>FF<span class="main">}</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">dma_type</span> buffer <span class="main">=</span> <span class="main">{</span>Eq control_var <span class="main">0</span><span class="main">}</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">dma_type</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>


<span class="keyword1"><span class="command">sublocale</span></span> sifum_example <span class="main">⊆</span>  sifum_types_assign <span class="quoted">ev<span class="hidden">⇩</span><sub>A</sub></span> <span class="quoted">ev<span class="hidden">⇩</span><sub>B</sub></span> <span class="quoted">aexp_vars</span> <span class="quoted">bexp_vars</span> <span class="quoted">dma</span> <span class="quoted">𝒞_vars</span> <span class="quoted">𝒞</span>  <span class="quoted">bexp_neg</span> <span class="quoted">dma_type</span> <span class="quoted">FF</span> <span class="quoted">bexp_assign</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eval_det<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Var_finite<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝒞_vars_def dma_def 𝒞_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>3<span class="main"><span class="keyword3">]</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> mem e<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">e</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dma_def dma_control_var_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝒞_vars_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">e</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">e</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝒞_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">sublocale</span></span> sifum_example <span class="main">⊆</span>  sifum_security <span class="quoted">dma</span> <span class="quoted">𝒞_vars</span> <span class="quoted">𝒞</span> <span class="quoted">eval<span class="hidden">⇩</span><sub>w</sub></span> <span class="quoted">undefined</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>


<span class="keyword1"><span class="command">context</span></span> sifum_example <span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">read_buffer</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>addr<span class="main">,</span> aexp<span class="main">,</span> bexp<span class="main">)</span> Stmt"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">read_buffer</span> <span class="main">≡</span> 
     ModeDecl Skip <span class="main">(</span>Acq control_var AsmNoWrite<span class="main">)</span> <span class="main">;;</span> 
     ModeDecl Skip <span class="main">(</span>Acq temp AsmNoReadOrWrite<span class="main">)</span> <span class="main">;;</span>
     Assign temp <span class="main">(</span>Load buffer<span class="main">)</span> <span class="main">;;</span>
     If <span class="main">(</span>Eq control_var <span class="main">0</span><span class="main">)</span> <span class="main">(</span>Assign low_var <span class="main">(</span>Load temp<span class="main">)</span><span class="main">)</span> <span class="main">(</span>Assign high_var <span class="main">(</span>Load temp<span class="main">)</span><span class="main">)</span> <span class="main">;;</span>
     Assign temp <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     ModeDecl Skip <span class="main">(</span>Rel temp AsmNoReadOrWrite<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">thm</span></span> read_buffer_def

<span class="comment1">(* PROOF VIA TYPESYSTEM BELOW - adapted from Example_TypeSystem *)</span>

<span class="keyword1"><span class="command">lemma</span></span> 𝒞_simp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"𝒞 <span class="main">=</span> <span class="main">{</span>control_var<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝒞_def 𝒞_vars_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> type_aexpr_Load<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> dom <span class="free">Γ</span> <span class="main">⟹</span> type_aexpr <span class="free">Γ</span> <span class="main">(</span>Load <span class="free">v</span><span class="main">)</span> <span class="main">(</span>dma_type <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> type_aexpr<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="quoted">"Load <span class="free">v</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_total_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> type_aexpr_Load'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> dom <span class="free">Γ</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>the <span class="main">(</span><span class="free">Γ</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> type_aexpr <span class="free">Γ</span> <span class="main">(</span>Load <span class="free">v</span><span class="main">)</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> type_aexpr<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="quoted">"Load <span class="free">v</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_total_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> type_aexpr_Const<span class="main">:</span>
  <span class="quoted"><span class="quoted">"type_aexpr <span class="free">Γ</span> <span class="main">(</span>Const <span class="free">c</span><span class="main">)</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> type_aexpr<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="quoted">"Const <span class="free">c</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">declare</span></span> restrict_preds_to_vars_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> add_pred_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> stable_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> to_total_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> 𝒞_vars_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> anno_type_stable_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> anno_type_sec_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pred_entailment <span class="free">P</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pred_entailment_def pred_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">⟹</span> pred_entailment <span class="free">P</span> <span class="main">{</span><span class="free">e</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subset_entailment<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"FF <span class="main">∈</span> <span class="free">P</span> <span class="main">⟹</span> pred_entailment <span class="free">P</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pred_entailment_def pred_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> read_buffer_typed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> None<span class="main">)</span> <span class="main">⟹</span> <span class="free">𝒮</span> <span class="main">=</span> <span class="main">(</span><span class="main">{}</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> 
  <span class="main">∃</span><span class="bound">Γ'</span> <span class="bound">𝒮'</span> <span class="bound">P'</span><span class="main">.</span> has_type <span class="free">Γ</span> <span class="free">𝒮</span> <span class="free">P</span> read_buffer <span class="bound">Γ'</span> <span class="bound">𝒮'</span> <span class="bound">P'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> read_buffer_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> seq_type<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> anno_type<span class="main"><span class="main">[</span></span><span class="operator">OF</span> HOL.refl HOL.refl HOL.refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> skip_type<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> seq_type<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> anno_type<span class="main"><span class="main">[</span></span><span class="operator">OF</span> HOL.refl HOL.refl HOL.refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> skip_type<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> seq_type<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> assign<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ HOL.refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> type_aexpr_Load<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> seq_type<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_type'<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> type_bexprI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> assign<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> type_aexpr_Load'<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subtype_def pred_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> assign<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> type_aexpr_Load'<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subtype_def pred_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> seq_type<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> assign<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ HOL.refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> type_aexpr_Const<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> anno_type<span class="main"><span class="main">[</span></span><span class="operator">OF</span> HOL.refl HOL.refl HOL.refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> skip_type<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_anno_def subtype_def pred_def bot_Sec_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> pred_entailment_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">lemma</span></span> read_buffer_typed_auto<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Γ</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> None<span class="main">)</span> <span class="main">⟹</span> <span class="free">𝒮</span> <span class="main">=</span> <span class="main">(</span><span class="main">{}</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> 
  <span class="main">∃</span><span class="bound">Γ'</span> <span class="bound">𝒮'</span> <span class="bound">P'</span><span class="main">.</span> has_type <span class="free">Γ</span> <span class="free">𝒮</span> <span class="free">P</span> read_buffer <span class="bound">Γ'</span> <span class="bound">𝒮'</span> <span class="bound">P'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">has_type_tac</span> 
            <span class="quasi_keyword">prog</span><span class="main"><span class="main">:</span></span> read_buffer_def 
            <span class="quasi_keyword">aexpr</span><span class="main"><span class="main">:</span></span> type_aexpr_Load type_aexpr_Load' type_aexpr_Const
            <span class="quasi_keyword">bexpr</span><span class="main"><span class="main">:</span></span> type_bexprI<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> read_buffer_com_sifum_secure<span class="main">:</span>
  <span class="quoted"><span class="quoted">"com_sifum_secure <span class="main">(</span>read_buffer<span class="main">,</span><span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> read_buffer_typed<span class="main"><span class="main">[</span></span><span class="operator">OF</span> HOL.refl HOL.refl HOL.refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> typed_secure<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Γ_of_mds_def 𝒮_of_mds_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mds_yields_stable_types_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(* Toby: removed manual bisimulation proof since we now use the type system
   and the manual proofs take quite a while to process. See git log to recover them. *)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Eg1RefinementTrivial">
<div class="head">
<h1>Theory Eg1RefinementTrivial</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Eg1RefinementTrivial
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Eg1.html">Eg1</a>
        <span class="quoted">"<a href="CompositionalRefinement.html">../CompositionalRefinement</a>"</span>
        <a href="../Dependent_SIFUM_Type_Systems/TypeSystem.html">Dependent_SIFUM_Type_Systems.TypeSystem</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> sifum_example <span class="main">⊆</span>
    sifum_refinement_same_mem <span class="quoted">dma</span> <span class="quoted">𝒞_vars</span> <span class="quoted">𝒞</span> <span class="quoted">eval<span class="hidden">⇩</span><sub>w</sub></span> <span class="quoted">eval<span class="hidden">⇩</span><sub>w</sub></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> sifum_example <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This predicate can be used to express arbitrary relational invariants for
  compiler-specific features, but for this trivial case the vacuous one is fine.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">P_true</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">P_true</span>  <span class="main">≡</span> UNIV"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Id_secure_refinement<span class="main">:</span>
  <span class="quoted"><span class="quoted">"secure_refinement <span class="free">R</span> Id P_true"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> secure_refinement_def
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"closed_others Id"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> closed_others_def Id_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"preserves_modes_mem Id"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> preserves_modes_mem_def Id_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">mds'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
    <span class="keyword3"><span class="command">show</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
          neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">n</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> Id <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">.</span>
              <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> Id <span class="main">∧</span>
              <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> P_true <span class="main">∧</span>
              neval <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">n</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟶</span>
              <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> Id <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> P_true<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span>
      <span class="keyword1"><span class="command">from</span></span> step <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="var">?n</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> Id"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">.</span>
              <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> Id <span class="main">∧</span>
              <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> P_true <span class="main">∧</span>
              neval <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="var">?n</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟶</span>
              <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> Id <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> P_true<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> step
        <span class="keyword1"><span class="command">unfolding</span></span> P_true_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"closed_glob_consistent P_true"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> closed_glob_consistent_def P_true_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This doesn't really mean much, but shows the lemmas in action.
  (I suspect that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">R<span class="hidden">⇩</span><sub>C</sub>_of</span></span> <span class="free"><span class="free">R</span></span> Id"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is equivalent to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">R</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. But who cares?)
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"strong_low_bisim_mm <span class="main">(</span>gen_refine.R<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">(</span>ℛ <span class="free">Γ</span> <span class="free">𝒮</span> <span class="free">P</span><span class="main">)</span> Id P_true<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> R<span class="hidden">⇩</span><sub>C</sub>_of_strong_low_bisim_mm<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ℛ_bisim<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Id_secure_refinement<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> P_true_def sym_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Eg2">
<div class="head">
<h1>Theory Eg2</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Eg2
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../Dependent_SIFUM_Type_Systems/Language.html">Dependent_SIFUM_Type_Systems.Language</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">datatype</span></span> var<span class="hidden">⇩</span><sub>C</sub> <span class="main">=</span> control_var<span class="hidden">⇩</span><sub>C</sub> <span class="main">|</span> buffer<span class="hidden">⇩</span><sub>C</sub> <span class="main">|</span> high_var<span class="hidden">⇩</span><sub>C</sub> <span class="main">|</span> low_var<span class="hidden">⇩</span><sub>C</sub> <span class="main">|</span> temp<span class="hidden">⇩</span><sub>C</sub> <span class="main">|</span> reg<span class="hidden">⇩</span><sub>C</sub>

<span class="keyword1"><span class="command">type_synonym</span></span> addr<span class="hidden">⇩</span><sub>C</sub> <span class="main">=</span> <span class="quoted">var<span class="hidden">⇩</span><sub>C</sub></span>
<span class="keyword1"><span class="command">type_synonym</span></span> val <span class="main">=</span> <span class="quoted">nat</span>
<span class="keyword1"><span class="command">type_synonym</span></span> mem<span class="hidden">⇩</span><sub>C</sub> <span class="main">=</span> <span class="quoted"><span class="quoted">"addr<span class="hidden">⇩</span><sub>C</sub> <span class="main">⇒</span> val"</span></span>

<span class="comment1">(* Address expression evaluation *)</span>
<span class="keyword1"><span class="command">datatype</span></span> aexp<span class="hidden">⇩</span><sub>C</sub> <span class="main">=</span> Const <span class="quoted"><span class="quoted">"val"</span></span> <span class="main">|</span>
                 Load <span class="quoted"><span class="quoted">"addr<span class="hidden">⇩</span><sub>C</sub>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> 
  <span class="entity">ev<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>C</sub> <span class="main">⇒</span> aexp<span class="hidden">⇩</span><sub>C</sub> <span class="main">⇒</span> val"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ev<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">ev<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="comment1">(* Boolean expression evaluation *)</span>
<span class="keyword1"><span class="command">datatype</span></span> bexp<span class="hidden">⇩</span><sub>C</sub> <span class="main">=</span> Eq <span class="quoted"><span class="quoted">"addr<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="quoted"><span class="quoted">"val"</span></span>

<span class="keyword1"><span class="command">fun</span></span>
  <span class="entity">ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>C</sub> <span class="main">⇒</span> bexp<span class="hidden">⇩</span><sub>C</sub> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(* NB: dma ~ "domain assignment"
 * Domain assignment function based on the value of a control variable,
 * Low if 0, High otherwise. *)</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">dma_control_var<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"val <span class="main">⇒</span> Sec"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dma_control_var<span class="hidden">⇩</span><sub>C</sub></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> Low <span class="keyword1">else</span> High"</span></span>

<span class="comment1">(* buffer's security level is controlled by control_var.
 * high_var's is High.
 * All other memory's security level is Low. *)</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>C</sub> <span class="main">⇒</span> addr<span class="hidden">⇩</span><sub>C</sub> <span class="main">⇒</span> Sec"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> buffer<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1">then</span> dma_control_var<span class="hidden">⇩</span><sub>C</sub> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> control_var<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> high_var<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1">then</span> High <span class="keyword1">else</span> Low"</span></span>

<span class="comment1">(* Function that gives the control variables of a given variable.
 * Only buffer is controlled by a control variable, control_var *)</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">𝒞_vars<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"addr<span class="hidden">⇩</span><sub>C</sub> <span class="main">⇒</span> addr<span class="hidden">⇩</span><sub>C</sub> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">𝒞_vars<span class="hidden">⇩</span><sub>C</sub></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> buffer<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1">then</span> <span class="main">{</span>control_var<span class="hidden">⇩</span><sub>C</sub><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">aexp_vars<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"aexp<span class="hidden">⇩</span><sub>C</sub> <span class="main">⇒</span> var<span class="hidden">⇩</span><sub>C</sub> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">aexp_vars<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Const <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">aexp_vars<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span>"</span></span>
  
<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">bexp_vars<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bexp<span class="hidden">⇩</span><sub>C</sub> <span class="main">⇒</span> var<span class="hidden">⇩</span><sub>C</sub> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_vars<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> sifum_example2 <span class="main">=</span>
  sifum_lang_no_dma <span class="quoted">ev<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="quoted">ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="quoted">aexp_vars<span class="hidden">⇩</span><sub>C</sub></span> <span class="quoted">bexp_vars<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eval_det<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">lc</span><span class="main">,</span> <span class="free">lc'</span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>C</sub> ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="main">⟹</span> <span class="main">(</span><span class="free">lc</span><span class="main">,</span> <span class="free">lc''</span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>C</sub> ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="main">⟹</span> <span class="free">lc'</span> <span class="main">=</span> <span class="free">lc''</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">𝒞<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"addr<span class="hidden">⇩</span><sub>C</sub> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">𝒞<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≡</span> <span class="main">⋃</span><span class="bound">x</span><span class="main">.</span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub> <span class="bound">x</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> sifum_example2 <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">read_buffer<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub><span class="main">,</span> aexp<span class="hidden">⇩</span><sub>C</sub><span class="main">,</span> bexp<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span> Stmt"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">read_buffer<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≡</span> 
     ModeDecl Skip <span class="main">(</span>Acq control_var<span class="hidden">⇩</span><sub>C</sub> AsmNoWrite<span class="main">)</span> <span class="main">;;</span> 
     ModeDecl Skip <span class="main">(</span>Acq temp<span class="hidden">⇩</span><sub>C</sub> AsmNoReadOrWrite<span class="main">)</span> <span class="main">;;</span>
     Assign temp<span class="hidden">⇩</span><sub>C</sub> <span class="main">(</span>Load buffer<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span> <span class="main">;;</span>
     Assign reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">(</span>Load control_var<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">;;</span>
     If <span class="main">(</span>Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>Assign low_var<span class="hidden">⇩</span><sub>C</sub> <span class="main">(</span>Load temp<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Assign high_var<span class="hidden">⇩</span><sub>C</sub> <span class="main">(</span>Load temp<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span> <span class="main">;;</span>
     Assign temp<span class="hidden">⇩</span><sub>C</sub> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     ModeDecl Skip <span class="main">(</span>Rel temp<span class="hidden">⇩</span><sub>C</sub> AsmNoReadOrWrite<span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Eg1Eg2">
<div class="head">
<h1>Theory Eg1Eg2</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Eg1Eg2
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Eg1.html">Eg1</a>
        <a href="Eg2.html">Eg2</a>
        <span class="quoted">"<a href="CompositionalRefinement.html">../CompositionalRefinement</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">locale</span></span> sifum_refinement_eg1_eg2 <span class="main">=</span>
  A<span class="main">:</span> sifum_example <span class="main">+</span>
  C<span class="main">:</span> sifum_example2

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Eg1.var <span class="main">⇒</span> Eg2.var<span class="hidden">⇩</span><sub>C</sub>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1</span> control_var <span class="main">=</span> control_var<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1</span> buffer <span class="main">=</span> buffer<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1</span> high_var <span class="main">=</span> high_var<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1</span> low_var <span class="main">=</span> low_var<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1</span> temp <span class="main">=</span> temp<span class="hidden">⇩</span><sub>C</sub>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> sifum_refinement_eg1_eg2 <span class="main">⊆</span> sifum_refinement <span class="quoted">dma</span> <span class="quoted">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="quoted">𝒞_vars</span> <span class="quoted">𝒞_vars<span class="hidden">⇩</span><sub>C</sub></span> <span class="quoted">𝒞</span> <span class="quoted">𝒞<span class="hidden">⇩</span><sub>C</sub></span> <span class="quoted">A.eval<span class="hidden">⇩</span><sub>w</sub></span> <span class="quoted">C.eval<span class="hidden">⇩</span><sub>w</sub></span> <span class="quoted">undefined</span> <span class="quoted">Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">supply</span></span></span></span> image_cong_simp <span class="main">[</span><span class="operator">cong</span> <span class="quasi_keyword">del</span><span class="main">]</span> INF_cong_simp <span class="main">[</span><span class="operator">cong</span><span class="main">]</span> SUP_cong_simp <span class="main">[</span><span class="operator">cong</span><span class="main">]</span> subst_all <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword">del</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> C.eval_det<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> C.Var_finite<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>𝒞_vars<span class="hidden">⇩</span><sub>C</sub>_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>𝒞_vars<span class="hidden">⇩</span><sub>C</sub>_def dma<span class="hidden">⇩</span><sub>C</sub>_def<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>𝒞_vars<span class="hidden">⇩</span><sub>C</sub>_def dma<span class="hidden">⇩</span><sub>C</sub>_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x<span class="hidden">⇩</span><sub>A</sub></span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>dma<span class="hidden">⇩</span><sub>C</sub>_def dma_def dma_control_var_def dma_control_var<span class="hidden">⇩</span><sub>C</sub>_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x<span class="hidden">⇩</span><sub>A</sub></span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>𝒞_vars<span class="hidden">⇩</span><sub>C</sub>_def 𝒞_vars_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">control_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_image_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">xa</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">xb</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">xa</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">xb</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">xa</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">xb</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">xa</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">xb</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">xa</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>𝒞<span class="hidden">⇩</span><sub>C</sub>_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">context</span></span> sifum_refinement_eg1_eg2
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">lemma</span></span> bisim_simple_ℛ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bisim_simple <span class="main">(</span>A.ℛ <span class="free">Γ</span> <span class="free">𝒮</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bisim_simple_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> lc<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="improper">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="improper">mds</span><span class="main">,</span> <span class="improper">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> lc'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="improper">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="improper">mds</span><span class="main">,</span> <span class="improper">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> A.bisim_simple_ℛ<span class="hidden">⇩</span><sub>u</sub><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(* Don't know to what extent these helpers can be made generic enough to go into any parent theories.
   Again, mightn't be able to (or bother to) make some generic considering the aexp evaluator
   is going to be specific to each language. *)</span>

<span class="keyword1"><span class="command">lemma</span></span> conc_only_vars_not_visible_abs<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> range Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="main">⟶</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">⟹</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conc_only_var_assign_not_visible_abs<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">e</span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="main">⟶</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="main">(</span><span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">:=</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conc_only_vars_not_visible_abs
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_is_not_the_var<span class="hidden">⇩</span><sub>C</sub>_of_anything<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">=</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="free">x</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_not_visible_abs<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">∉</span> range Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1"</span></span>
  <span class="keyword1"><span class="command">using</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_is_not_the_var<span class="hidden">⇩</span><sub>C</sub>_of_anything
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(* This one's pretty specific to this refinement... *)</span>
<span class="keyword1"><span class="command">lemma</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_the_only_concrete_only_var<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="main">⟹</span> <span class="free">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> reg<span class="hidden">⇩</span><sub>C</sub>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>C</sub></span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rev_notE<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">control_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> range_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rev_notE<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">buffer</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> range_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rev_notE<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">high_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> range_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rev_notE<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">low_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> range_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rev_notE<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">temp</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> range_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> NoRW<span class="hidden">⇩</span><sub>A</sub>_implies_NoRW<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoReadOrWrite <span class="main">⟹</span>
   Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="free">x</span> <span class="main">∈</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoReadOrWrite"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mds<span class="hidden">⇩</span><sub>A</sub>_of_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_inv_into_f<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> NoWrite<span class="hidden">⇩</span><sub>A</sub>_implies_NoWrite<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoWrite <span class="main">⟹</span>
   Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="free">x</span> <span class="main">∈</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoWrite"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mds<span class="hidden">⇩</span><sub>A</sub>_of_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_inv_into_f<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">x</span> <span class="main">←</span> Eg1.Load <span class="free">y</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span> <span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="free">mem</span> <span class="free">y</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A.assign_eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub>.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">x</span> <span class="main">←</span> Load <span class="free">y</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span> <span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="free">mem</span> <span class="free">y</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> C.unannotated<span class="main">[</span><span class="operator">OF</span> C.assign<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> E<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Load <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">mds</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">mem</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> assign_eval<span class="hidden">⇩</span><sub>w</sub>_const<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">x</span> <span class="main">←</span> Eg1.Const <span class="free">c</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span> <span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="free">c</span><span class="main">)</span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A.assign_eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub>.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> assign_eval<span class="hidden">⇩</span><sub>w</sub>_const<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">x</span> <span class="main">←</span> Const <span class="free">c</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span> <span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="free">c</span><span class="main">)</span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> C.unannotated<span class="main">[</span><span class="operator">OF</span> C.assign<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> E<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Const <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">mds</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">mem</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> if_seq_eval<span class="hidden">⇩</span><sub>w</sub>_helper<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>If <span class="free">B</span> <span class="free">T</span> <span class="free">E</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="main">⟩</span><span class="main">,</span>
    <span class="main">⟨</span><span class="keyword1">if</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="free">mem</span> <span class="free">B</span> <span class="keyword1">then</span> <span class="free">T</span> <span class="keyword1">else</span> <span class="free">E</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>
    <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⟨</span>If <span class="free">B</span> <span class="free">T</span> <span class="free">E</span> <span class="main">;;</span> <span class="free">TAIL</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="main">⟩</span><span class="main">,</span>
    <span class="main">⟨</span><span class="keyword1">if</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="free">mem</span> <span class="free">B</span> <span class="keyword1">then</span> <span class="free">T</span> <span class="main">;;</span> <span class="free">TAIL</span> <span class="keyword1">else</span> <span class="free">E</span> <span class="main">;;</span> <span class="free">TAIL</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> A.eval<span class="hidden">⇩</span><sub>w</sub>.seq
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> if_seq_eval<span class="hidden">⇩</span><sub>w</sub>_helper<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>If <span class="free">B</span> <span class="free">T</span> <span class="free">E</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="main">⟩</span><span class="main">,</span>
    <span class="main">⟨</span><span class="keyword1">if</span> ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="free">mem</span> <span class="free">B</span> <span class="keyword1">then</span> <span class="free">T</span> <span class="keyword1">else</span> <span class="free">E</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
    <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⟨</span>If <span class="free">B</span> <span class="free">T</span> <span class="free">E</span> <span class="main">;;</span> <span class="free">TAIL</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="main">⟩</span><span class="main">,</span>
    <span class="main">⟨</span><span class="keyword1">if</span> ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="free">mem</span> <span class="free">B</span> <span class="keyword1">then</span> <span class="free">T</span> <span class="main">;;</span> <span class="free">TAIL</span> <span class="keyword1">else</span> <span class="free">E</span> <span class="main">;;</span> <span class="free">TAIL</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> mem_assign_refinement_helper_var<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="main">(</span><span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="free">x</span> <span class="main">:=</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">=</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">x<span class="hidden">⇩</span><sub>A</sub></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> mem_assign_refinement_helper_const<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="main">(</span><span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="free">x</span> <span class="main">:=</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>
       <span class="main">=</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">x<span class="hidden">⇩</span><sub>A</sub></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> if_true_eval<span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>C</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span>
     <span class="main">(</span><span class="main">⟨</span><span class="main">(</span>If <span class="main">(</span>Eq <span class="free">x</span> <span class="main">0</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>C</sub>_then</span> <span class="free">c<span class="hidden">⇩</span><sub>C</sub>_else</span><span class="main">)</span> <span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>C</sub>_tail</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
      <span class="main">⟨</span><span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>C</sub>_then</span> <span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>C</sub>_tail</span><span class="main">)</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> C.if_eval<span class="hidden">⇩</span><sub>w</sub> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub>.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">lemma</span></span> if_false_eval<span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>C</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span>
     <span class="main">(</span><span class="main">⟨</span><span class="main">(</span>If <span class="main">(</span>Eq <span class="free">x</span> <span class="main">0</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>C</sub>_then</span> <span class="free">c<span class="hidden">⇩</span><sub>C</sub>_else</span><span class="main">)</span> <span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>C</sub>_tail</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
      <span class="main">⟨</span><span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>C</sub>_else</span> <span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>C</sub>_tail</span><span class="main">)</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> C.if_eval<span class="hidden">⇩</span><sub>w</sub> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub>.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>


<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Eg1Eg2RefinementSimple">
<div class="head">
<h1>Theory Eg1Eg2RefinementSimple</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Eg1Eg2RefinementSimple
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Eg1Eg2.html">Eg1Eg2</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> sifum_refinement_eg1_eg2
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">RelS_Eg1Eg2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>
    <span class="main">(</span><span class="main">(</span><span class="main">(</span>var<span class="main">,</span> aexp<span class="main">,</span> bexp<span class="main">)</span> Stmt <span class="main">×</span> <span class="main">(</span>Mode <span class="main">⇒</span> var set<span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span>var <span class="main">⇒</span> val<span class="main">)</span><span class="main">)</span> <span class="main">×</span>
     <span class="main">(</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub><span class="main">,</span> aexp<span class="hidden">⇩</span><sub>C</sub><span class="main">,</span> bexp<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span> Stmt <span class="main">×</span> <span class="main">(</span>Mode <span class="main">⇒</span> var<span class="hidden">⇩</span><sub>C</sub> set<span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub> <span class="main">⇒</span> val<span class="main">)</span>
    <span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  acq_mode_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> ModeDecl Skip <span class="main">(</span>Acq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">SomeMode</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> ModeDecl Skip <span class="main">(</span>Acq <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">SomeMode</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RelS_Eg1Eg2</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RelS_Eg1Eg2</span>"</span></span> <span class="main">|</span>

  rel_mode_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> ModeDecl Skip <span class="main">(</span>Rel <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">SomeMode</span></span></span><span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> ModeDecl Skip <span class="main">(</span>Rel <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">SomeMode</span></span></span><span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span>Stop<span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RelS_Eg1Eg2</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RelS_Eg1Eg2</span>"</span></span> <span class="main">|</span>

  assign_load_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">←</span> aexp.Load <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">←</span> aexp<span class="hidden">⇩</span><sub>C</sub>.Load <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    <span class="comment1">― ‹With this requirement it is possible to establish <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>x ∉ mds<span class="hidden">⇩</span><sub>A</sub> GuarNoReadOrWrite›</span></span>.›</span>
    <span class="comment1">⌦‹x ≠ y;›</span>
    <span class="comment1">― ‹However since we've deemed it reasonable to require <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>x ∉ mds<span class="hidden">⇩</span><sub>A</sub> GuarNoWrite›</span></span>,›</span>
    <span class="comment1">― ‹it makes little sense not to just require <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>x ∉ mds<span class="hidden">⇩</span><sub>A</sub> GuarNoReadOrWrite›</span></span> as well.›</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> GuarNoReadOrWrite<span class="main">;</span>
    <span class="comment1">― ‹Without this requirement, we would have to prove preservation of <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>doesnt_modify c x›</span></span>›</span>
    <span class="comment1">― ‹because <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>x ∈ mds<span class="hidden">⇩</span><sub>A</sub> GuarNoWrite›</span></span> holds in the case where <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>mem<span class="hidden">⇩</span><sub>A</sub> x = mem<span class="hidden">⇩</span><sub>A</sub> y›</span></span>.›</span>
    <span class="comment1">― ‹It makes more sense just to assume a blanket ban on this guarantee for this instruction,›</span>
    <span class="comment1">― ‹seeing as it is clearly a write operation to <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>x›</span></span>.›</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> GuarNoWrite<span class="main">;</span>
    <span class="comment1">― ‹This command loads from <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>y›</span></span>, so it makes little sense to guarantee we're not reading it›</span>
    <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> GuarNoReadOrWrite<span class="main">;</span>
    <span class="comment1">― ‹Requirements for sound mode use preservation for variables other than <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>x›</span></span> and <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>y›</span></span>›</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> 𝒞<span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∉</span> 𝒞<span class="main">;</span>
    <span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RelS_Eg1Eg2</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RelS_Eg1Eg2</span>"</span></span> <span class="main">|</span>

  assign_const_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">←</span> aexp.Const <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">←</span> aexp<span class="hidden">⇩</span><sub>C</sub>.Const <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> GuarNoReadOrWrite<span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> GuarNoWrite<span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> 𝒞<span class="main">;</span>
    <span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RelS_Eg1Eg2</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RelS_Eg1Eg2</span>"</span></span> <span class="main">|</span>

  if_reg_load_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>If <span class="main">(</span>Eg1.Eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_then</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_else</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">←</span> <span class="main">(</span>Load <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span><span class="main">(</span>If <span class="main">(</span>Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_then</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_else</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> GuarNoReadOrWrite<span class="main">;</span>
    reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> GuarNoWrite<span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> GuarNoReadOrWrite<span class="main">;</span>
    <span class="comment1">― ‹Nope: need to make this one versatile enough to allow <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>c = control_var›</span></span> for our example›</span>
    <span class="comment1">⌦‹x ∉ 𝒞;›</span>
    <span class="main">∀</span><span class="bound">x'</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> 𝒞_vars <span class="bound">x'</span> <span class="main">⟶</span> <span class="bound">x'</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> GuarNoReadOrWrite<span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="comment1">― ‹The change in <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>mem<span class="hidden">⇩</span><sub>C</sub>›</span></span> does not affect <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>mem<span class="hidden">⇩</span><sub>A</sub>›</span></span>›</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">∧</span>
         <span class="comment1">― ‹The concrete and abstract versions of the bool condition must become consistent›</span>
         ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">(</span>Eg1.Eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
          <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="main">(</span>If <span class="main">(</span>Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_then</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_else</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
          <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="main">(</span>If <span class="main">(</span>Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_then</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_else</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RelS_Eg1Eg2</span><span class="main">)</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RelS_Eg1Eg2</span>"</span></span> <span class="main">|</span>

  if_reg_stop_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>If <span class="main">(</span>Eg1.Eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_then</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_else</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="main">(</span><span class="main">(</span>If <span class="main">(</span>Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_then</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_else</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoWrite <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoReadOrWrite<span class="main">;</span>
    <span class="comment1">― ‹Likely we will need to carry this through to the <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>if_reg_rel›</span></span> case.›</span>
    ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">(</span>Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">(</span>Eg1.Eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span><span class="main">)</span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="comment1">― ‹The change in <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>mem<span class="hidden">⇩</span><sub>C</sub>›</span></span> does not affect <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>mem<span class="hidden">⇩</span><sub>A</sub>›</span></span>›</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">∧</span>
         <span class="comment1">― ‹The concrete and abstract versions of the bool condition must remain consistent›</span>
         ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">(</span>Eg1.Eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
         ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">(</span>Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">(</span>Eg1.Eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
          <span class="main">⟨</span><span class="main">(</span>If <span class="main">(</span>Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_then</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_else</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
          <span class="main">⟨</span><span class="main">(</span>If <span class="main">(</span>Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_then</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_else</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RelS_Eg1Eg2</span><span class="main">)</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RelS_Eg1Eg2</span>"</span></span> <span class="main">|</span>

  if_reg_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>
<span class="comment1">― ‹Is a more generic version possible for an arbitrary <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>b<span class="hidden">⇩</span><sub>A</sub>›</span></span>?›</span>
    <span class="comment1">⌦‹c<span class="hidden">⇩</span><sub>A</sub> = (If b<span class="hidden">⇩</span><sub>A</sub> c<span class="hidden">⇩</span><sub>A</sub>_then c<span class="hidden">⇩</span><sub>A</sub>_else) ;; c<span class="hidden">⇩</span><sub>A</sub>_tail;›</span>
    <span class="comment1">⌦‹b<span class="hidden">⇩</span><sub>A</sub> = Eg1.Eq x 0;›</span>  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>ev<span class="hidden">⇩</span><sub>B</sub> mem<span class="hidden">⇩</span><sub>A</sub> b<span class="hidden">⇩</span><sub>A</sub>›</span></span>›</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>If <span class="main">(</span>Eg1.Eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_then</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_else</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>If <span class="main">(</span>Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_then</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_else</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoWrite <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoReadOrWrite<span class="main">;</span>
    <span class="comment1">― ‹The concrete and abstract versions of the bool condition must have remained consistent›</span>
    ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">(</span>Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">(</span>Eg1.Eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span><span class="main">)</span><span class="main">;</span>
    <span class="comment1">― ‹As for <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>if_reg_load_rel›</span></span>›</span>
    reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> GuarNoReadOrWrite<span class="main">;</span>
    reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> GuarNoWrite<span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> GuarNoReadOrWrite<span class="main">;</span>
    <span class="main">∀</span><span class="bound">x'</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> 𝒞_vars <span class="bound">x'</span> <span class="main">⟶</span> <span class="bound">x'</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> GuarNoReadOrWrite<span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
       <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
       <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
       ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">(</span>Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">(</span>Eg1.Eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
       ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">(</span>Eg1.Eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
        <span class="main">⟨</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>ev<span class="hidden">⇩</span><sub>B</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">(</span>Eg1.Eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_then</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_else</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">∧</span>
       <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
        <span class="main">⟨</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">(</span>Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_then</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_else</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
       <span class="main">⟶</span>
       <span class="main">(</span><span class="main">⟨</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>ev<span class="hidden">⇩</span><sub>B</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">(</span>Eg1.Eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_then</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_else</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
        <span class="main">⟨</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">(</span>Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_then</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_else</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RelS_Eg1Eg2</span><span class="main">)</span><span class="main">;</span>
    <span class="comment1">― ‹Disallow branching on variables that can potentially be in the high domain›</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> buffer <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> high_var
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RelS_Eg1Eg2</span>"</span></span> <span class="main">|</span>

  stop_seq_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RelS_Eg1Eg2</span><span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RelS_Eg1Eg2</span>"</span></span> <span class="main">|</span>

  stop_rel<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>Stop<span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RelS_Eg1Eg2</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">abs_steps'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">)</span> Stmt <span class="main">⇒</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">)</span> Stmt <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">abs_steps'</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">≡</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">m</span> <span class="bound">c<span class="hidden">⇩</span><sub>A</sub>_tail</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>Skip<span class="main">@[</span><span class="bound">x</span> <span class="keyword1">+=<span class="hidden">⇩</span><sub>m</sub></span> <span class="bound">m</span><span class="main">]</span><span class="main">)</span> <span class="main">;;</span> <span class="bound">c<span class="hidden">⇩</span><sub>A</sub>_tail</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">m</span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub>_tail</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>Skip<span class="main">@[</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="bound">x</span> <span class="keyword1">+=<span class="hidden">⇩</span><sub>m</sub></span> <span class="bound">m</span><span class="main">]</span><span class="main">)</span> <span class="main">;;</span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub>_tail</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">c<span class="hidden">⇩</span><sub>A</sub>_tail</span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub>_tail</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>Stop <span class="main">;;</span> <span class="bound">c<span class="hidden">⇩</span><sub>A</sub>_tail</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>Stop <span class="main">;;</span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub>_tail</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span> <span class="bound">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span>
        <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>Stmt.If <span class="main">(</span>bexp.Eq <span class="bound">x</span> <span class="main">0</span><span class="main">)</span> <span class="bound">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">;;</span> <span class="bound">tail<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">←</span> aexp<span class="hidden">⇩</span><sub>C</sub>.Load <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> Stmt.If <span class="main">(</span>bexp<span class="hidden">⇩</span><sub>C</sub>.Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="bound">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">;;</span> <span class="bound">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
         <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>Stop <span class="main">;;</span> Stmt.If <span class="main">(</span>bexp<span class="hidden">⇩</span><sub>C</sub>.Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="bound">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">;;</span> <span class="bound">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span>
        <span class="keyword1">then</span> <span class="main">0</span>
     <span class="keyword1">else</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">abs_steps</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">abs_steps</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> abs_steps' <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> closed_others_RelS_Eg1Eg2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"closed_others RelS_Eg1Eg2"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> closed_others_def
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span>
<span class="keyword3"><span class="command">assume</span></span>
  in_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
    <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  vars<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>  dmas<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> dma<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span> <span class="main">≠</span> dma<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">from</span></span> in_rel vars dmas
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> RelS_Eg1Eg2.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>acq_mode_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">SomeMode</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
    <span class="keyword1"><span class="command">using</span></span> acq_mode_rel
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>RelS_Eg1Eg2.acq_mode_rel<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>rel_mode_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">SomeMode</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_mode_rel
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>RelS_Eg1Eg2.rel_mode_rel<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>assign_load_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assign_load_rel
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>RelS_Eg1Eg2.assign_load_rel<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>assign_const_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">z</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assign_const_rel
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>RelS_Eg1Eg2.assign_const_rel<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_load_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
    <span class="keyword1"><span class="command">using</span></span> if_reg_load_rel
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>RelS_Eg1Eg2.if_reg_load_rel<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_stop_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
    <span class="keyword1"><span class="command">using</span></span> if_reg_stop_rel
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> if_reg_stop_rel.hyps<span class="main">(</span>3<span class="main">,</span>5<span class="main">,</span>6<span class="main">)</span> if_reg_stop_rel.prems<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        x<span class="hidden">⇩</span><sub>C</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        x<span class="hidden">⇩</span><sub>A</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_is_not_the_var<span class="hidden">⇩</span><sub>C</sub>_of_anything mem<span class="hidden">⇩</span><sub>A</sub>_of_def NoWrite<span class="hidden">⇩</span><sub>A</sub>_implies_NoWrite<span class="hidden">⇩</span><sub>C</sub>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>var_asm_not_written_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">with</span></span> if_reg_stop_rel.hyps
      <span class="keyword1"><span class="command">have</span></span> conds_still_match<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> if_reg_stop_rel RelS_Eg1Eg2.if_reg_stop_rel
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>Stmt.If <span class="main">(</span>bexp.Eq <span class="skolem">x</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
             <span class="main">⟨</span>Stop <span class="main">;;</span> Stmt.If <span class="main">(</span>bexp<span class="hidden">⇩</span><sub>C</sub>.Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
             <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
    <span class="keyword1"><span class="command">using</span></span> if_reg_rel
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> if_reg_rel.hyps<span class="main">(</span>3<span class="main">,</span>5<span class="main">,</span>6<span class="main">)</span> if_reg_rel.prems<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        x<span class="hidden">⇩</span><sub>C</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        x<span class="hidden">⇩</span><sub>A</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_is_not_the_var<span class="hidden">⇩</span><sub>C</sub>_of_anything mem<span class="hidden">⇩</span><sub>A</sub>_of_def NoWrite<span class="hidden">⇩</span><sub>A</sub>_implies_NoWrite<span class="hidden">⇩</span><sub>C</sub>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>var_asm_not_written_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">with</span></span> if_reg_rel.hyps
      <span class="keyword1"><span class="command">have</span></span> conds_still_match<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>Stmt.If <span class="main">(</span>bexp.Eq <span class="skolem">x</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
             <span class="main">⟨</span>Stmt.If <span class="main">(</span>bexp<span class="hidden">⇩</span><sub>C</sub>.Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
             <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> RelS_Eg1Eg2.if_reg_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> if_reg_rel <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
           <span class="keyword1"><span class="command">using</span></span> if_reg_rel <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">using</span></span> conds_still_match <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
         <span class="keyword1"><span class="command">using</span></span> if_reg_rel <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>stop_seq_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stop_seq_rel
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>RelS_Eg1Eg2.stop_seq_rel<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>stop_rel <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>RelS_Eg1Eg2.stop_rel<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preserves_modes_mem_RelS_Eg1Eg2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"preserves_modes_mem RelS_Eg1Eg2"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> preserves_modes_mem_def2
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span>
  <span class="keyword3"><span class="command">assume</span></span> in_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>RelS_Eg1Eg2.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Just some exploration to see what's likely to be needed *)</span>

<span class="keyword1"><span class="command">lemma</span></span> mem_twist_other<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">mem</span> <span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="free">mem</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span> <span class="main">:=</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">mem</span> <span class="main">(</span><span class="free">z</span> <span class="main">:=</span> <span class="free">v</span><span class="main">,</span> <span class="free">x</span> <span class="main">:=</span> <span class="main">(</span><span class="free">mem</span> <span class="main">(</span><span class="free">z</span> <span class="main">:=</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_other fun_upd_twist<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_load_helper<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≠</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="free">x</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⟨</span>reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">←</span> aexp<span class="hidden">⇩</span><sub>C</sub>.Load <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="free">x</span><span class="main">)</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">:=</span> <span class="free">v</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span>
            <span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">:=</span> <span class="free">v</span><span class="main">,</span> reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">:=</span> <span class="free">mem</span> <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span>
   <span class="main">(</span><span class="main">⟨</span>reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">←</span> aexp<span class="hidden">⇩</span><sub>C</sub>.Load <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="free">x</span><span class="main">)</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">:=</span> <span class="free">v</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span>
            <span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">:=</span> <span class="free">v</span><span class="main">,</span> reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">:=</span> <span class="main">(</span><span class="free">mem</span><span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">:=</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fun_upd_other <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> preserves_local_guarantee_compliance_RelS_Eg1Eg2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"preserves_local_guarantee_compliance RelS_Eg1Eg2"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>preserves_local_guarantee_compliance_def2<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span>
  <span class="keyword3"><span class="command">assume</span></span> in_RelS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    respects<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.respects_own_guarantees <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"conc.respects_own_guarantees <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> conc.respects_own_guarantees_def conc.doesnt_read_or_modify_def conc.doesnt_read_or_modify_vars_def conc.doesnt_modify_def
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>RelS_Eg1Eg2.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>acq_mode_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">m</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> acq_mode_rel.hyps<span class="main">(</span>2-3<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> C.decl_eval<span class="hidden">⇩</span><sub>w</sub>' C.eval<span class="hidden">⇩</span><sub>w</sub>.seq C.seq_decl_elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>rel_mode_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">m</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> rel_mode_rel.hyps<span class="main">(</span>2-3<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> C.decl_eval<span class="hidden">⇩</span><sub>w</sub>' C.eval<span class="hidden">⇩</span><sub>w</sub>.seq C.seq_decl_elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>assign_load_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> in_RelS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>RelS_Eg1Eg2.intros<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> assign_load_rel.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> respects<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.respects_own_guarantees <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?case_x<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> snd <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> GuarNoReadOrWrite <span class="main">⟶</span>
               <span class="main">(</span><span class="main">∀</span><span class="bound">mds</span> <span class="bound">mem</span> <span class="bound">c'</span> <span class="bound">mds'</span> <span class="bound">mem'</span><span class="main">.</span>
                   <span class="main">(</span><span class="main">⟨</span>fst <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">mds'</span><span class="main">,</span> <span class="bound">mem'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                   <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>C</sub> ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="main">⟶</span>
                   <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span><span class="main">}</span> <span class="main">∪</span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span>
                       <span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="main">⟨</span>fst <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem</span><span class="main">(</span><span class="bound">x</span> <span class="main">:=</span> <span class="bound">v</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">mds'</span><span class="main">,</span> <span class="bound">mem'</span><span class="main">(</span><span class="bound">x</span> <span class="main">:=</span> <span class="bound">v</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                           <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>C</sub> ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> snd <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> GuarNoWrite <span class="main">⟶</span>
               <span class="main">(</span><span class="main">∀</span><span class="bound">mds</span> <span class="bound">mem</span> <span class="bound">c'</span> <span class="bound">mds'</span> <span class="bound">mem'</span><span class="main">.</span>
                   <span class="main">(</span><span class="main">⟨</span>fst <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">mds'</span><span class="main">,</span> <span class="bound">mem'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                   <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>C</sub> ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="main">⟶</span>
                   <span class="bound">mem</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="bound">mem'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span> dma<span class="hidden">⇩</span><sub>C</sub> <span class="bound">mem</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> dma<span class="hidden">⇩</span><sub>C</sub> <span class="bound">mem'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>

        <span class="comment1">(* For x<span class="hidden">⇩</span><sub>C</sub> = x, we have to argue that the abstract version of x<span class="hidden">⇩</span><sub>C</sub> must have the same
           guarantees as for x<span class="hidden">⇩</span><sub>C</sub>, which yields contradictions in both cases. *)</span>
        <span class="keyword1"><span class="command">from</span></span> assign_load_rel<span class="main">(</span>3<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> preserves_modes_mem_RelS_Eg1Eg2 has_mode<span class="hidden">⇩</span><sub>A</sub>
        <span class="keyword1"><span class="command">have</span></span> notGuarNoRW_x<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> GuarNoReadOrWrite"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
             notGuarNoWrite_x<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> GuarNoWrite"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span>

        <span class="comment1">(* For x<span class="hidden">⇩</span><sub>C</sub> = y, waive doesnt_read_or_modify using ¬ GuarNoRW y from refinement relation,
           and the proof for doesnt_modify is straightforward *)</span>
        <span class="keyword1"><span class="command">from</span></span> assign_load_rel<span class="main">(</span>3<span class="main">,</span>8<span class="main">)</span> preserves_modes_mem_RelS_Eg1Eg2 has_mode<span class="hidden">⇩</span><sub>A</sub>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> GuarNoReadOrWrite"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command">with</span></span> assign_load_rel<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">y</span><span class="main">;</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span> <span class="main">∉</span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="var">?case_x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub>_def dma<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="comment1">(* For all other x<span class="hidden">⇩</span><sub>C</sub>, the proof should be straightforward because c<span class="hidden">⇩</span><sub>C</sub> does not touch x<span class="hidden">⇩</span><sub>C</sub>,
           and we've required that x and y cannot potentially be the control var of x<span class="hidden">⇩</span><sub>C</sub> *)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≠</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">;</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≠</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">y</span><span class="main">;</span>
               Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span> <span class="main">∉</span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span><span class="main">;</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">y</span> <span class="main">∉</span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span><span class="main">⟧</span>
              <span class="main">⟹</span> <span class="var">?case_x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assign_load_rel<span class="main">(</span>2<span class="main">,</span>6<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> C.seq_assign_elim<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem_twist_other C.eval<span class="hidden">⇩</span><sub>w</sub>.seq assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> C.seq_assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">xa</span> <span class="main">≠</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span> <span class="main">∧</span> <span class="improper">xa</span> <span class="main">≠</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">y</span>"</span></span><span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem_twist_other C.eval<span class="hidden">⇩</span><sub>w</sub>.seq assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> C.seq_assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> C.seq_assign_elim<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub>_def dma<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span> <span class="main">∉</span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">y</span> <span class="main">∉</span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assign_load_rel<span class="main">(</span>9-10<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub>_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> A.𝒞_simp empty_iff insert_iff inv_f_eq var<span class="hidden">⇩</span><sub>C</sub>_of_inj<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> notGuarNoRW_x<span class="hidden">⇩</span><sub>C</sub> notGuarNoWrite_x<span class="hidden">⇩</span><sub>C</sub>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> GuarNoReadOrWrite <span class="main">⟹</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> GuarNoWrite <span class="main">⟹</span> <span class="var">?case_x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case_x<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>assign_const_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">z</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> assign_const_rel.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> respects<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.respects_own_guarantees <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?case_x<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> snd <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> GuarNoReadOrWrite <span class="main">⟶</span>
               <span class="main">(</span><span class="main">∀</span><span class="bound">mds</span> <span class="bound">mem</span> <span class="bound">c'</span> <span class="bound">mds'</span> <span class="bound">mem'</span><span class="main">.</span>
                   <span class="main">(</span><span class="main">⟨</span>fst <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">mds'</span><span class="main">,</span> <span class="bound">mem'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                   <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>C</sub> ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="main">⟶</span>
                   <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span><span class="main">}</span> <span class="main">∪</span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span>
                       <span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="main">⟨</span>fst <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem</span><span class="main">(</span><span class="bound">x</span> <span class="main">:=</span> <span class="bound">v</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">mds'</span><span class="main">,</span> <span class="bound">mem'</span><span class="main">(</span><span class="bound">x</span> <span class="main">:=</span> <span class="bound">v</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                           <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>C</sub> ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> snd <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> GuarNoWrite <span class="main">⟶</span>
               <span class="main">(</span><span class="main">∀</span><span class="bound">mds</span> <span class="bound">mem</span> <span class="bound">c'</span> <span class="bound">mds'</span> <span class="bound">mem'</span><span class="main">.</span>
                   <span class="main">(</span><span class="main">⟨</span>fst <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">mds'</span><span class="main">,</span> <span class="bound">mem'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                   <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>C</sub> ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="main">⟶</span>
                   <span class="bound">mem</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="bound">mem'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span> dma<span class="hidden">⇩</span><sub>C</sub> <span class="bound">mem</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> dma<span class="hidden">⇩</span><sub>C</sub> <span class="bound">mem'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> assign_const_rel<span class="main">(</span>3<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> preserves_modes_mem_RelS_Eg1Eg2 has_mode<span class="hidden">⇩</span><sub>A</sub>
        <span class="keyword1"><span class="command">have</span></span> notGuarNoRW_x<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> GuarNoReadOrWrite"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
             notGuarNoWrite_x<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> GuarNoWrite"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span>

        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≠</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">;</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span> <span class="main">∉</span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="var">?case_x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assign_const_rel<span class="main">(</span>2<span class="main">,</span>8<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> C.seq_assign_elim<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_twist C.eval<span class="hidden">⇩</span><sub>w</sub>.seq assign_eval<span class="hidden">⇩</span><sub>w</sub>_const<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> C.seq_assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">xa</span> <span class="main">≠</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span>"</span></span><span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_twist C.eval<span class="hidden">⇩</span><sub>w</sub>.seq assign_eval<span class="hidden">⇩</span><sub>w</sub>_const<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> C.seq_assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> C.seq_assign_elim<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub>_def dma<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span> <span class="main">∉</span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assign_const_rel<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub>_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> A.𝒞_simp empty_iff insert_iff inv_f_eq var<span class="hidden">⇩</span><sub>C</sub>_of_inj<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> notGuarNoRW_x<span class="hidden">⇩</span><sub>C</sub> notGuarNoWrite_x<span class="hidden">⇩</span><sub>C</sub>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> GuarNoReadOrWrite <span class="main">⟹</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> GuarNoWrite <span class="main">⟹</span> <span class="var">?case_x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case_x<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_load_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> if_reg_load_rel.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> respects<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.respects_own_guarantees <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?case_x<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> snd <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> GuarNoReadOrWrite <span class="main">⟶</span>
               <span class="main">(</span><span class="main">∀</span><span class="bound">mds</span> <span class="bound">mem</span> <span class="bound">c'</span> <span class="bound">mds'</span> <span class="bound">mem'</span><span class="main">.</span>
                   <span class="main">(</span><span class="main">⟨</span>fst <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">mds'</span><span class="main">,</span> <span class="bound">mem'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                   <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>C</sub> ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="main">⟶</span>
                   <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span><span class="main">}</span> <span class="main">∪</span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span>
                       <span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="main">⟨</span>fst <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem</span><span class="main">(</span><span class="bound">x</span> <span class="main">:=</span> <span class="bound">v</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">mds'</span><span class="main">,</span> <span class="bound">mem'</span><span class="main">(</span><span class="bound">x</span> <span class="main">:=</span> <span class="bound">v</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                           <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>C</sub> ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> snd <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> GuarNoWrite <span class="main">⟶</span>
               <span class="main">(</span><span class="main">∀</span><span class="bound">mds</span> <span class="bound">mem</span> <span class="bound">c'</span> <span class="bound">mds'</span> <span class="bound">mem'</span><span class="main">.</span>
                   <span class="main">(</span><span class="main">⟨</span>fst <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">mds'</span><span class="main">,</span> <span class="bound">mem'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                   <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>C</sub> ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="main">⟶</span>
                   <span class="bound">mem</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="bound">mem'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span> dma<span class="hidden">⇩</span><sub>C</sub> <span class="bound">mem</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> dma<span class="hidden">⇩</span><sub>C</sub> <span class="bound">mem'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="comment1">(* For x<span class="hidden">⇩</span><sub>C</sub> = x, waive doesnt_read_or_modify using ¬ GuarNoRW x from refinement relation
           (makes sense because it's being read), then doesnt_modify is straightforward *)</span>
        <span class="keyword1"><span class="command">from</span></span> if_reg_load_rel<span class="main">(</span>3<span class="main">,</span>8<span class="main">)</span> preserves_modes_mem_RelS_Eg1Eg2 has_mode<span class="hidden">⇩</span><sub>A</sub>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> GuarNoReadOrWrite"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command">with</span></span> if_reg_load_rel<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span> <span class="main">⟹</span> <span class="var">?case_x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub>_def dma<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> if_reg_load_rel<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≠</span> reg<span class="hidden">⇩</span><sub>C</sub><span class="main">;</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≠</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">;</span> reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">∉</span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span><span class="main">;</span>
               Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span> <span class="main">∈</span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟹</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> GuarNoReadOrWrite<span class="main">⟧</span> <span class="main">⟹</span> <span class="var">?case_x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> C.seq_assign_elim<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fun_upd_twist <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>reg<span class="hidden">⇩</span><sub>C</sub>_load_helper <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> C.seq_assign_elim<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fun_upd_twist <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">xa</span> <span class="main">≠</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span> <span class="main">∧</span> <span class="improper">xa</span> <span class="main">≠</span> reg<span class="hidden">⇩</span><sub>C</sub>"</span></span><span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fun_upd_twist reg<span class="hidden">⇩</span><sub>C</sub>_load_helper assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> C.seq_assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> C.seq_assign_elim<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub>_def dma<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> if_reg_load_rel<span class="main">(</span>3<span class="main">,</span>9<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span> <span class="main">∈</span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟹</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> GuarNoReadOrWrite"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1.simps<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub>_def 𝒞_vars_def empty_iff has_mode<span class="hidden">⇩</span><sub>A</sub> insert_iff inv_f_f var<span class="hidden">⇩</span><sub>C</sub>_of_inj<span class="main">)</span>

        <span class="comment1">(* We waive cases where x<span class="hidden">⇩</span><sub>C</sub> = reg<span class="hidden">⇩</span><sub>C</sub> by requiring ¬ GuarNoRW reg<span class="hidden">⇩</span><sub>C</sub> and ¬ GuarNoWrite reg<span class="hidden">⇩</span><sub>C</sub>
           which makes sense if we consider concrete-only variables like reg<span class="hidden">⇩</span><sub>C</sub> to be private.
           Furthermore we establish that reg<span class="hidden">⇩</span><sub>C</sub> cannot be a control var.  *)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">⟹</span> <span class="var">?case_x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> if_reg_load_rel<span class="main">(</span>6-7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">∉</span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_is_not_the_var<span class="hidden">⇩</span><sub>C</sub>_of_anything 𝒞_vars<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case_x<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_stop_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> if_reg_stop_rel<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C.seq_stop_elim C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub> fst_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> if_reg_rel.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> respects<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.respects_own_guarantees <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?case_x<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> snd <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> GuarNoReadOrWrite <span class="main">⟶</span>
               <span class="main">(</span><span class="main">∀</span><span class="bound">mds</span> <span class="bound">mem</span> <span class="bound">c'</span> <span class="bound">mds'</span> <span class="bound">mem'</span><span class="main">.</span>
                   <span class="main">(</span><span class="main">⟨</span>fst <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">mds'</span><span class="main">,</span> <span class="bound">mem'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                   <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>C</sub> ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="main">⟶</span>
                   <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span><span class="main">}</span> <span class="main">∪</span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span>
                       <span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="main">⟨</span>fst <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem</span><span class="main">(</span><span class="bound">x</span> <span class="main">:=</span> <span class="bound">v</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">mds'</span><span class="main">,</span> <span class="bound">mem'</span><span class="main">(</span><span class="bound">x</span> <span class="main">:=</span> <span class="bound">v</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                           <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>C</sub> ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> snd <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> GuarNoWrite <span class="main">⟶</span>
               <span class="main">(</span><span class="main">∀</span><span class="bound">mds</span> <span class="bound">mem</span> <span class="bound">c'</span> <span class="bound">mds'</span> <span class="bound">mem'</span><span class="main">.</span>
                   <span class="main">(</span><span class="main">⟨</span>fst <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">mds'</span><span class="main">,</span> <span class="bound">mem'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                   <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>C</sub> ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="main">⟶</span>
                   <span class="bound">mem</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="bound">mem'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span> dma<span class="hidden">⇩</span><sub>C</sub> <span class="bound">mem</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> dma<span class="hidden">⇩</span><sub>C</sub> <span class="bound">mem'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> if_reg_rel<span class="main">(</span>3<span class="main">,</span>10<span class="main">)</span> preserves_modes_mem_RelS_Eg1Eg2 has_mode<span class="hidden">⇩</span><sub>A</sub>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> GuarNoReadOrWrite"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command">with</span></span> if_reg_rel<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span> <span class="main">⟹</span> <span class="var">?case_x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub>_def dma<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> if_reg_rel<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≠</span> reg<span class="hidden">⇩</span><sub>C</sub><span class="main">;</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≠</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">;</span> reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">∉</span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span><span class="main">;</span>
            Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span> <span class="main">∈</span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟹</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> GuarNoReadOrWrite<span class="main">⟧</span> <span class="main">⟹</span> <span class="var">?case_x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">mem</span><span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">:=</span> <span class="improper">v</span><span class="main">)</span><span class="main">)</span> reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">=</span> <span class="improper">mem</span> reg<span class="hidden">⇩</span><sub>C</sub>"</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> C.if_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> if_true_eval<span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>C</sub> if_false_eval<span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">xa</span> <span class="main">≠</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span> <span class="main">∧</span> <span class="improper">xa</span> <span class="main">≠</span> reg<span class="hidden">⇩</span><sub>C</sub>"</span></span><span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> C.if_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> if_true_eval<span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>C</sub> if_false_eval<span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> C.if_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> C.if_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> if_reg_rel<span class="main">(</span>3<span class="main">,</span>11<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span> <span class="main">∈</span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟹</span> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> GuarNoReadOrWrite"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1.simps<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub>_def 𝒞_vars_def empty_iff has_mode<span class="hidden">⇩</span><sub>A</sub> insert_iff inv_f_f var<span class="hidden">⇩</span><sub>C</sub>_of_inj<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">⟹</span> <span class="var">?case_x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> if_reg_rel<span class="main">(</span>8-9<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">∉</span> 𝒞_vars<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">x<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_is_not_the_var<span class="hidden">⇩</span><sub>C</sub>_of_anything 𝒞_vars<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case_x<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>stop_seq_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> stop_seq_rel<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C.seq_stop_elim C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub> fst_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> stop_rel
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C.stop_no_eval<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mdss<span class="hidden">⇩</span><sub>A</sub>_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub> Mds<span class="main">)</span> list<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span>var Mds<span class="main">)</span> list<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mdss<span class="hidden">⇩</span><sub>A</sub>_of</span> <span class="free"><span class="bound"><span class="entity">mdss<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> map mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mdss<span class="hidden">⇩</span><sub>C</sub></span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> new_vars_private_RelS_Eg1Eg2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sifum_refinement.new_vars_private dma<span class="hidden">⇩</span><sub>C</sub> C.eval<span class="hidden">⇩</span><sub>w</sub> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 RelS_Eg1Eg2"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> new_vars_private_def
<span class="comment1">(* Slightly more intuitive goals without simp converting ∨ to ⟶ *)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span>
  <span class="keyword3"><span class="command">assume</span></span> in_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      does_eval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="quoted"><span class="quoted">"<span class="var">?diff_mem</span> <span class="free">v<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="free">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≠</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="quoted"><span class="quoted">"<span class="var">?diff_dma</span> <span class="free">v<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"dma<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="free">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">&lt;</span> dma<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="quoted"><span class="quoted">"<span class="var">?conc_only</span> <span class="free">v<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="main">(</span><span class="var">?diff_mem</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span> <span class="var">?diff_dma</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∧</span> <span class="var">?conc_only</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span> AsmNoReadOrWrite<span class="main">)</span> <span class="main">∧</span>
         <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoReadOrWrite <span class="main">-</span> range Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1
         <span class="main">⊆</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span> AsmNoReadOrWrite <span class="main">-</span> range Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1"</span></span> <span class="comment1">(* not sure what to call this one *)</span>
  <span class="keyword1"><span class="command">using</span></span> in_rel does_eval
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>RelS_Eg1Eg2.cases<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>acq_mode_rel <span class="skolem">x</span> <span class="skolem">SomeMode</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> does_eval
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="skolem">SomeMode</span> <span class="main">:=</span> insert <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">SomeMode</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> C.seq_decl_elim C.update_modes.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>rel_mode_rel <span class="skolem">x</span> <span class="skolem">SomeMode</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> does_eval
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="skolem">SomeMode</span> <span class="main">:=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">SomeMode</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> C.upd_elim C.skip_elim C.update_modes.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>assign_load_rel <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C.assign_elim C.seq_elim Stmt.distinct<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> set_eq_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>assign_const_rel <span class="skolem">x</span> <span class="skolem">z</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C.assign_elim C.seq_elim Stmt.distinct<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> set_eq_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_load_rel <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C.assign_elim C.seq_elim Stmt.distinct<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> set_eq_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_stop_rel <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C.seq_stop_elim subset_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_rel <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword1"><span class="command">have</span></span> mds<span class="hidden">⇩</span><sub>C</sub>_unchanged<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C.if_elim C.seq_elim Stmt.distinct<span class="main"><span class="main">(</span></span>50<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> if_reg_rel<span class="main">(</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="main">(</span><span class="var">?diff_mem</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span> <span class="var">?diff_dma</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∧</span> <span class="var">?conc_only</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span> AsmNoReadOrWrite"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> mds<span class="hidden">⇩</span><sub>C</sub>_unchanged
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoReadOrWrite <span class="main">-</span> range Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="main">⊆</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span> AsmNoReadOrWrite <span class="main">-</span> range Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarify</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>stop_seq_rel <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval C.seq_stop_elim
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>stop_rel<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval C.stop_no_eval <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> simple_refinement_safe_RelS_Eg1Eg2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> R_low_mds_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span> <span class="bound">mds</span> <span class="bound">mem</span> <span class="bound">mem'</span><span class="main">.</span> <span class="main">(</span><span class="main">⟨</span><span class="bound">c</span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c</span><span class="main">,</span> <span class="bound">mds</span><span class="main">,</span> <span class="bound">mem'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">Some_R</span> <span class="main">⟹</span> A.low_mds_eq <span class="bound">mds</span> <span class="bound">mem</span> <span class="bound">mem'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"sifum_refinement.simple_refinement_safe C.eval<span class="hidden">⇩</span><sub>w</sub> <span class="free">Some_R</span> RelS_Eg1Eg2 abs_steps"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> simple_refinement_safe_def
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>
  <span class="keyword3"><span class="command">assume</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">Some_R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
       in_RelS_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
       in_RelS_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"stops<span class="hidden">⇩</span><sub>C</sub> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> stops<span class="hidden">⇩</span><sub>C</sub> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mds<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
           <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>  <span class="main">⟶</span>
           <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span> <span class="bound">mds<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="bound">mds<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> in_RelS_1 in_RelS_2
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>RelS_Eg1Eg2.cases<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>acq_mode_rel <span class="skolem">x</span> <span class="skolem">m</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>C</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="skolem">m</span> <span class="main">:=</span> insert <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> acq_mode_rel <span class="keyword1"><span class="command">have</span></span>
    eval_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    eval_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C.decl_eval<span class="hidden">⇩</span><sub>w</sub>' C.eval<span class="hidden">⇩</span><sub>w</sub>.seq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> stops<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">using</span></span> C.eval_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>rel_mode_rel <span class="skolem">x</span> <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>C</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="skolem">m</span> <span class="main">:=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">m</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> rel_mode_rel <span class="keyword1"><span class="command">have</span></span>
    eval_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    eval_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C.decl_eval<span class="hidden">⇩</span><sub>w</sub>'<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> stops<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">using</span></span> C.eval_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>assign_load_rel <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assign_load_rel <span class="keyword1"><span class="command">have</span></span>
    eval_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
               <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    eval_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
               <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> stops<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">using</span></span> C.eval_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>assign_const_rel <span class="skolem">x</span> <span class="skolem">z</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assign_const_rel <span class="keyword1"><span class="command">have</span></span>
    eval_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
               <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">z</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    eval_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
               <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">z</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assign_eval<span class="hidden">⇩</span><sub>w</sub>_const<span class="hidden">⇩</span><sub>C</sub> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> stops<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">using</span></span> C.eval_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_load_rel <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> if_reg_load_rel <span class="keyword1"><span class="command">have</span></span>
    eval_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> Stmt.If <span class="main">(</span>bexp<span class="hidden">⇩</span><sub>C</sub>.Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
               <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    eval_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> Stmt.If <span class="main">(</span>bexp<span class="hidden">⇩</span><sub>C</sub>.Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
               <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> stops<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">using</span></span> C.eval_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_stop_rel <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> if_reg_stop_rel <span class="keyword1"><span class="command">have</span></span>
    eval_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
              <span class="main">⟨</span>Stmt.If <span class="main">(</span>bexp<span class="hidden">⇩</span><sub>C</sub>.Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    eval_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
              <span class="main">⟨</span>Stmt.If <span class="main">(</span>bexp<span class="hidden">⇩</span><sub>C</sub>.Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> stops<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">using</span></span> C.eval_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_rel <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> if_reg_rel <span class="keyword1"><span class="command">have</span></span>
    eval_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
              <span class="main">⟨</span><span class="main">(</span><span class="keyword1">if</span> ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>bexp<span class="hidden">⇩</span><sub>C</sub>.Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">else</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    eval_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
              <span class="main">⟨</span><span class="main">(</span><span class="keyword1">if</span> ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>bexp<span class="hidden">⇩</span><sub>C</sub>.Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="keyword1">else</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> if_true_eval<span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>C</sub> if_false_eval<span class="hidden">⇩</span><sub>w</sub><span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">hence</span></span> stops_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"stops<span class="hidden">⇩</span><sub>C</sub> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> stops<span class="hidden">⇩</span><sub>C</sub> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> stops<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="comment1">(* Side-conditions ensure both programs take the same branch *)</span>
    <span class="keyword1"><span class="command">from</span></span> in_R R_low_mds_eq
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"A.low_mds_eq <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command">with</span></span> if_reg_rel<span class="main">(</span>6<span class="main">,</span>13<span class="main">)</span> dma_def
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ev<span class="hidden">⇩</span><sub>B</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span>bexp.Eq <span class="skolem">x</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span>bexp.Eq <span class="skolem">x</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>A.low_mds_eq_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> if_reg_rel<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>7<span class="main">)</span> in_RelS_2
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>bexp<span class="hidden">⇩</span><sub>C</sub>.Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>bexp<span class="hidden">⇩</span><sub>C</sub>.Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>RelS_Eg1Eg2.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> if_reg_rel<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> eval_1 eval_2 C.eval_det <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mds<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
           <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>C</sub> ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>C</sub> ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="main">⟶</span>
           <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span> <span class="bound">mds<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="bound">mds<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> stops_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>stop_seq_rel <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> stop_seq_rel <span class="keyword1"><span class="command">have</span></span>
    eval_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    eval_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> stops<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">using</span></span> C.eval_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> stop_rel
    <span class="keyword1"><span class="command">with</span></span> C.stop_no_eval <span class="keyword1"><span class="command">have</span></span>
      stops_1<span class="main">:</span> <span class="quoted"><span class="quoted">"stops<span class="hidden">⇩</span><sub>C</sub> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      stops_2<span class="main">:</span> <span class="quoted"><span class="quoted">"stops<span class="hidden">⇩</span><sub>C</sub> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> stops<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> stops<span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> induction_RelS_Eg1Eg2<span class="main">:</span>
<span class="keyword2"><span class="keyword">notes</span></span> A.update_modes.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">shows</span></span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2 <span class="main">⟹</span>
       <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">⟹</span>
       <span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
          A.neval <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>
           <span class="main">(</span>abs_steps <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
           <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> RelS_Eg1Eg2.induct<span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>acq_mode_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">m</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> acq_mode_rel<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_acq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> acq_mode_rel.prems acq_mode_rel<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="main">(</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="skolem">m</span> <span class="main">:=</span> insert <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> C.seq_decl_elim C.update_modes.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> mds<span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> A.update_modes <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">+=<span class="hidden">⇩</span><sub>m</sub></span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> A.update_modes.simps
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mode_acquire_refinement_helper<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def acq_mode_rel A.eval<span class="hidden">⇩</span><sub>w</sub>.seq A.decl_eval<span class="hidden">⇩</span><sub>w</sub>
  <span class="keyword1"><span class="command">have</span></span> neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> acq_mode_rel<span class="main">(</span>5<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_concrete_vars_unwritable<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> AsmNoReadOrWrite<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> acq_mode_rel<span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> acq_mode_rel.hyps<span class="main">(</span>4<span class="main">)</span> neval<span class="hidden">⇩</span><sub>A</sub> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> in_Rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A.neval_Suc_simp One_nat_def acq_mode_rel.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> One_nat_def abs_steps.simps n_not_Suc_n<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>rel_mode_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">m</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Stop"</span></span>
  <span class="keyword1"><span class="command">from</span></span> rel_mode_rel<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_acq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> rel_mode_rel.prems rel_mode_rel<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> Stop"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="skolem">m</span> <span class="main">:=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">m</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> C.upd_elim C.skip_elim C.update_modes.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> mds<span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> A.update_modes <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">-=<span class="hidden">⇩</span><sub>m</sub></span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> A.update_modes.simps
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mode_release_refinement_helper<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def rel_mode_rel A.eval<span class="hidden">⇩</span><sub>w</sub>.seq A.decl_eval<span class="hidden">⇩</span><sub>w</sub>
  <span class="keyword1"><span class="command">have</span></span> neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> rel_mode_rel<span class="main">(</span>5<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_concrete_vars_unwritable<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> AsmNoReadOrWrite<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> rel_mode_rel<span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> rel_mode_rel.hyps<span class="main">(</span>4<span class="main">)</span> neval<span class="hidden">⇩</span><sub>A</sub> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> in_Rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A.neval_Suc_simp One_nat_def rel_mode_rel.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> One_nat_def abs_steps.simps n_not_Suc_n<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>assign_load_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assign_load_rel<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_load<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assign_load_rel.prems assign_load_rel<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="main">(</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.seq_elim C.assign_elim C.skip_elim assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Stmt.distinct<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> assign_load_rel<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> eval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A.eval<span class="hidden">⇩</span><sub>w</sub>.seq assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>A</sub> mem_assign_refinement_helper_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> assign_load_rel<span class="main">(</span>11<span class="main">)</span><span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> assign_load_rel.prems c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assign_load_rel.hyps<span class="main">(</span>4-5<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel' abs_steps_load neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>assign_const_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">z</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assign_const_rel<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assign_const_rel.prems assign_const_rel<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="main">(</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.seq_elim C.assign_elim C.skip_elim assign_eval<span class="hidden">⇩</span><sub>w</sub>_const<span class="hidden">⇩</span><sub>C</sub>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Stmt.distinct<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> assign_const_rel<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> eval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A.eval<span class="hidden">⇩</span><sub>w</sub>.seq assign_eval<span class="hidden">⇩</span><sub>w</sub>_const<span class="hidden">⇩</span><sub>A</sub> mem_assign_refinement_helper_const <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> assign_const_rel<span class="main">(</span>9<span class="main">)</span><span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> assign_const_rel.prems c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assign_const_rel.hyps<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel' abs_steps_const neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_load_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_reg_load_rel.hyps<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_if_reg_load<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> if_reg_load_rel.prems if_reg_load_rel<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="main">(</span>Stop <span class="main">;;</span> If <span class="main">(</span>Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1 <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.seq_elim C.assign_elim C.skip_elim assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Stmt.distinct<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_reg_load_rel<span class="main">(</span>1-4<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>A</sub>_unchanged<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_not_visible_abs conc_only_var_assign_not_visible_abs A.neval.intros<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> if_reg_load_rel c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> impE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> if_reg_load_rel.prems mem<span class="hidden">⇩</span><sub>A</sub>_of_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel' abs_steps_if_reg_load neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_stop_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_reg_stop_rel.hyps<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_if_reg_stop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> if_reg_stop_rel.prems if_reg_stop_rel<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="main">(</span>If <span class="main">(</span>Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.seq_stop_elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_reg_stop_rel<span class="main">(</span>1-4<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>A</sub>_unchanged<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_not_visible_abs conc_only_var_assign_not_visible_abs A.neval.intros<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> if_reg_stop_rel c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel' abs_steps_if_reg_stop neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="main">(</span>ev<span class="hidden">⇩</span><sub>B</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span>bexp.Eq <span class="skolem">x</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_reg_rel<span class="main">(</span>1<span class="main">)</span> if_reg_rel<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_if_reg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> if_reg_rel.prems if_reg_rel<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>bexp<span class="hidden">⇩</span><sub>C</sub>.Eq reg<span class="hidden">⇩</span><sub>C</sub> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> C.seq_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> exE<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> C.if_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_reg_rel<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> eval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> if_seq_eval<span class="hidden">⇩</span><sub>w</sub>_helper<span class="hidden">⇩</span><sub>A</sub> A.if_eval<span class="hidden">⇩</span><sub>w</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">hence</span></span> neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abs_steps_if_reg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>A.neval_Suc_simp<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> if_reg_rel<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>7<span class="main">,</span>12<span class="main">)</span> if_reg_rel.prems c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def eval<span class="hidden">⇩</span><sub>A</sub>
  <span class="keyword1"><span class="command">have</span></span> rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">presburger</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel' abs_steps_if_reg neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>stop_seq_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> stop_seq_rel<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_stop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> stop_seq_rel
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.seq_stop_elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span>
    neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stop_seq_rel A.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> abs_steps_stop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> stop_rel
  <span class="keyword1"><span class="command">with</span></span> C.stop_no_eval <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">mds<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Mode <span class="main">⇒</span> var<span class="hidden">⇩</span><sub>C</sub> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">m</span> <span class="keyword1">of</span> AsmNoReadOrWrite <span class="main">⇒</span> <span class="main">{</span>reg<span class="hidden">⇩</span><sub>C</sub><span class="main">}</span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> read_buffer_assign_temp_onwards_RelS<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="main">(</span>temp <span class="main">←</span> aexp.Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span>Skip<span class="main">@[</span>temp <span class="keyword1">-=<span class="hidden">⇩</span><sub>m</sub></span> AsmNoReadOrWrite<span class="main">]</span><span class="main">)</span><span class="main">,</span>
         mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="main">(</span><span class="main">(</span>case_Mode <span class="main">{</span>reg<span class="hidden">⇩</span><sub>C</sub><span class="main">}</span> <span class="main">{}</span> <span class="main">{}</span> <span class="main">{}</span><span class="main">)</span> <span class="main">(</span>AsmNoWrite <span class="main">:=</span> <span class="main">{</span>control_var<span class="hidden">⇩</span><sub>C</sub><span class="main">}</span><span class="main">,</span>
                  AsmNoReadOrWrite <span class="main">:=</span> <span class="main">{</span>temp<span class="hidden">⇩</span><sub>C</sub><span class="main">,</span> reg<span class="hidden">⇩</span><sub>C</sub><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
         mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
        <span class="main">⟨</span><span class="main">(</span>temp<span class="hidden">⇩</span><sub>C</sub> <span class="main">←</span> aexp<span class="hidden">⇩</span><sub>C</sub>.Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span>Skip<span class="main">@[</span>temp<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1">-=<span class="hidden">⇩</span><sub>m</sub></span> AsmNoReadOrWrite<span class="main">]</span><span class="main">)</span><span class="main">,</span>
                  <span class="main">(</span>case_Mode <span class="main">{</span>reg<span class="hidden">⇩</span><sub>C</sub><span class="main">}</span> <span class="main">{}</span> <span class="main">{}</span> <span class="main">{}</span><span class="main">)</span> <span class="main">(</span>AsmNoWrite <span class="main">:=</span> <span class="main">{</span>control_var<span class="hidden">⇩</span><sub>C</sub><span class="main">}</span><span class="main">,</span>
                  AsmNoReadOrWrite <span class="main">:=</span> <span class="main">{</span>temp<span class="hidden">⇩</span><sub>C</sub><span class="main">,</span> reg<span class="hidden">⇩</span><sub>C</sub><span class="main">}</span><span class="main">)</span><span class="main">,</span>
                  <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
  <span class="comment1">(* Assign temp (Const 0) ;; *)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> assign_const_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_the_only_concrete_only_var doesnt_have_mode<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> stop_seq_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="comment1">(* ModeDecl Skip (Rel temp AsmNoReadOrWrite)" *)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_mode_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_the_only_concrete_only_var<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> stop_rel<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> read_buffer_RelS<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>A.read_buffer<span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of mds<span class="hidden">⇩</span><sub>0</sub><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>C.read_buffer<span class="hidden">⇩</span><sub>C</sub><span class="main">,</span> mds<span class="hidden">⇩</span><sub>0</sub><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RelS_Eg1Eg2"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> A.read_buffer_def C.read_buffer<span class="hidden">⇩</span><sub>C</sub>_def mds<span class="hidden">⇩</span><sub>0</sub>_def
  <span class="comment1">(* ModeDecl Skip (Acq buffer AsmNoWrite) ;; *)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> acq_mode_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_the_only_concrete_only_var<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_decl_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> stop_seq_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="comment1">(* ModeDecl Skip (Acq temp AsmNoReadOrWrite) ;; *)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> acq_mode_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_the_only_concrete_only_var<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_decl_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> stop_seq_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="comment1">(* Assign temp (Load buffer) ;; *)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> assign_load_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_the_only_concrete_only_var doesnt_have_mode<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> stop_seq_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="comment1">(* If (Eq control_var 0) (Assign low_var (Load temp)) (Assign high_var (Load temp)) ;; *)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_reg_load_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_the_only_concrete_only_var doesnt_have_mode<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_reg_stop_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_the_only_concrete_only_var<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> has_mode<span class="hidden">⇩</span><sub>A</sub> NoRW<span class="hidden">⇩</span><sub>A</sub>_implies_NoRW<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> has_mode<span class="hidden">⇩</span><sub>A</sub><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_reg_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_the_only_concrete_only_var has_mode<span class="hidden">⇩</span><sub>A</sub> doesnt_have_mode<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="comment1">(* (Assign low_var (Load temp)) ;; *)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> assign_load_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_the_only_concrete_only_var doesnt_have_mode<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> stop_seq_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> read_buffer_assign_temp_onwards_RelS<span class="main">)</span>
   <span class="comment1">(* (Assign high_var (Load temp)) ;; *)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> assign_load_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_the_only_concrete_only_var doesnt_have_mode<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> stop_seq_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> read_buffer_assign_temp_onwards_RelS<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> control_var_visible<span class="main">:</span>
  <span class="quoted"><span class="quoted">"control_var<span class="hidden">⇩</span><sub>C</sub> <span class="main">∈</span> range Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> Eg2_var<span class="hidden">⇩</span><sub>C</sub>_of_Eg1_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">control_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> range_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> mds<span class="hidden">⇩</span><sub>s</sub>_A_of_mds<span class="hidden">⇩</span><sub>0</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>s</sub> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of mds<span class="hidden">⇩</span><sub>0</sub>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> preserves_modes_mem_mds<span class="hidden">⇩</span><sub>A</sub>_simp<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">m</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">unfolding</span></span> mds<span class="hidden">⇩</span><sub>s</sub>_def mds<span class="hidden">⇩</span><sub>0</sub>_def mds<span class="hidden">⇩</span><sub>A</sub>_of_def
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_not_visible_abs control_var_visible<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> A_of_mds<span class="hidden">⇩</span><sub>0</sub>_is_mds<span class="hidden">⇩</span><sub>s</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of mds<span class="hidden">⇩</span><sub>0</sub> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>s</sub>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mds<span class="hidden">⇩</span><sub>s</sub>_A_of_mds<span class="hidden">⇩</span><sub>0</sub><span class="main">)</span>

<span class="comment1">(* using the bisimulation established by the type system *)</span>

<span class="keyword1"><span class="command">lemma</span></span> RelS_Eg1Eg2_secure_refinement_simple_ℛ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"secure_refinement_simple <span class="main">(</span>A.ℛ <span class="free">Γ</span> <span class="free">𝒮</span> <span class="free">P</span><span class="main">)</span> RelS_Eg1Eg2 abs_steps"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> secure_refinement_simple_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> closed_others_RelS_Eg1Eg2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> preserves_modes_mem_RelS_Eg1Eg2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> new_vars_private_RelS_Eg1Eg2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> simple_refinement_safe_RelS_Eg1Eg2<span class="main">)</span>
   <span class="keyword1"><span class="command">using</span></span> A.ℛ_to_ℛ<span class="hidden">⇩</span><sub>3</sub> A.ℛ<span class="hidden">⇩</span><sub>3</sub>_mem_eq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> bisim_simple_ℛ<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> induction_RelS_Eg1Eg2<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> RelS_Eg1Eg2_secure_refinement_ℛ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"secure_refinement <span class="main">(</span>A.ℛ <span class="free">Γ</span> <span class="free">𝒮</span> <span class="free">P</span><span class="main">)</span> RelS_Eg1Eg2 ℐsimple"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> secure_refinement_simpler<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> secure_refinement_simple<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> RelS_Eg1Eg2_secure_refinement_simple_ℛ<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> strong_low_bisim_mm_R<span class="hidden">⇩</span><sub>C</sub>_of_RelS_ℛ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conc.strong_low_bisim_mm <span class="main">(</span>R<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">(</span>A.ℛ <span class="free">Γ</span> <span class="free">𝒮</span> <span class="free">P</span><span class="main">)</span> RelS_Eg1Eg2 ℐsimple<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> R<span class="hidden">⇩</span><sub>C</sub>_of_strong_low_bisim_mm<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> A.ℛ_bisim<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> RelS_Eg1Eg2_secure_refinement_ℛ<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def ℐsimple_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> read_buffer<span class="hidden">⇩</span><sub>C</sub>_secure<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conc.low_mds_eq mds<span class="hidden">⇩</span><sub>0</sub> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">Γ'</span> <span class="bound">𝒮'</span> <span class="bound">P'</span><span class="main">.</span>
   <span class="main">(</span><span class="main">⟨</span>C.read_buffer<span class="hidden">⇩</span><sub>C</sub><span class="main">,</span> mds<span class="hidden">⇩</span><sub>0</sub><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>C.read_buffer<span class="hidden">⇩</span><sub>C</sub><span class="main">,</span> mds<span class="hidden">⇩</span><sub>0</sub><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>R<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">(</span>A.ℛ <span class="bound">Γ'</span> <span class="bound">𝒮'</span> <span class="bound">P'</span><span class="main">)</span> RelS_Eg1Eg2 ℐsimple<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> A.read_buffer_typed<span class="main"><span class="main">[</span></span><span class="operator">OF</span> HOL.refl HOL.refl HOL.refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">Γ'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> R<span class="hidden">⇩</span><sub>C</sub>_of_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">A.read_buffer</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of mds<span class="hidden">⇩</span><sub>0</sub>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> read_buffer_RelS<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">A.read_buffer</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of mds<span class="hidden">⇩</span><sub>0</sub>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> read_buffer_RelS<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_of_mds<span class="hidden">⇩</span><sub>0</sub>_is_mds<span class="hidden">⇩</span><sub>s</sub> ℐsimple_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> low_mds_eq_from_conc_to_abs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> A.Typed_in_ℛ<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> A.tyenv_wellformed_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
       <span class="keyword1"><span class="command">unfolding</span></span> A.mds_consistent_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command">unfolding</span></span> A.types_wellformed_def mds<span class="hidden">⇩</span><sub>s</sub>_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">unfolding</span></span> A.types_stable_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="comment1">(* should be easy: low_mds_eq and low var ⟶ equal mem var *)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> A.low_mds_eq_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> v<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">v</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mds<span class="hidden">⇩</span><sub>A</sub>_of_def mds<span class="hidden">⇩</span><sub>0</sub>_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> xb<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">xb</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
       <span class="keyword1"><span class="command">unfolding</span></span> dma_def mds<span class="hidden">⇩</span><sub>0</sub>_def mds<span class="hidden">⇩</span><sub>A</sub>_of_def pred_def
       <span class="keyword1"><span class="command">using</span></span> reg<span class="hidden">⇩</span><sub>C</sub>_not_visible_abs <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>4<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command">using</span></span> A.pred_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">using</span></span> A.pred_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"conc.com_sifum_secure <span class="main">(</span>C.read_buffer<span class="hidden">⇩</span><sub>C</sub><span class="main">,</span> mds<span class="hidden">⇩</span><sub>0</sub><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> conc.com_sifum_secure_def conc.low_indistinguishable_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> read_buffer<span class="hidden">⇩</span><sub>C</sub>_secure<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conc.mm_equiv_intro<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> Γ<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">Γ'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> 𝒮<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">𝒮'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">P'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> strong_low_bisim_mm_R<span class="hidden">⇩</span><sub>C</sub>_of_RelS_ℛ<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="EgHighBranchRevC">
<div class="head">
<h1>Theory EgHighBranchRevC</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> EgHighBranchRevC
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../Dependent_SIFUM_Type_Systems/Compositionality.html">Dependent_SIFUM_Type_Systems.Compositionality</a>
        <a href="../Dependent_SIFUM_Type_Systems/Language.html">Dependent_SIFUM_Type_Systems.Language</a>
        <span class="quoted">"<a href="../../HOL/HOL-Eisbach/Eisbach_Tools.html">HOL-Eisbach.Eisbach_Tools</a>"</span>
        <span class="quoted">"<a href="CompositionalRefinement.html">../CompositionalRefinement</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Theory for exploring refinement of a program that branches on a high variable.

  The purpose of this particular example is to demonstrate that in order to prove any branching
  on a High-classified variable remains safe when refined to a concrete implementation, it is
  necessary to ensure that the two concrete branches of execution take the same number of steps,
  possibly by skip-padding the one with less steps in it, and provide an appropriate coupling
  invariant to link the corresponding concrete steps of the two branches of the if-statement.
›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'var</span> addr <span class="main">=</span> <span class="tfree"><span class="quoted"><span class="tfree">'var</span></span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> val <span class="main">=</span> <span class="quoted">nat</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'var</span> mem <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> addr <span class="main">⇒</span> val"</span></span>

<span class="comment1">(* Arithmetic expression evaluation *)</span>
<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'var</span> aexp <span class="main">=</span> Const <span class="quoted"><span class="quoted">"val"</span></span> <span class="main">|</span>
                     Load <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> addr"</span></span> <span class="main">|</span>
                     Add <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> aexp"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> aexp"</span></span> <span class="main">|</span>
                     Sub <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> aexp"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> aexp"</span></span>

<span class="keyword1"><span class="command">fun</span></span>
  <span class="entity">ev<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> mem <span class="main">⇒</span> <span class="tfree">'var</span> aexp <span class="main">⇒</span> val"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ev<span class="hidden">⇩</span><sub>A</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">ev<span class="hidden">⇩</span><sub>A</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">ev<span class="hidden">⇩</span><sub>A</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="main">(</span>Add <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">ev<span class="hidden">⇩</span><sub>A</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free">ev<span class="hidden">⇩</span><sub>A</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">ev<span class="hidden">⇩</span><sub>A</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="main">(</span>Sub <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">ev<span class="hidden">⇩</span><sub>A</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> <span class="free">ev<span class="hidden">⇩</span><sub>A</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="comment1">(* Boolean expression evaluation *)</span>
<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'var</span> bexp <span class="main">=</span> Eq <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> aexp"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> aexp"</span></span> <span class="main">|</span>
                     Neq <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> aexp"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> aexp"</span></span> <span class="main">|</span>
                     Lte <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> aexp"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> aexp"</span></span> <span class="main">|</span>
                     Gt <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> aexp"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> aexp"</span></span>

<span class="keyword1"><span class="command">fun</span></span>
  <span class="entity">ev<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> mem <span class="main">⇒</span> <span class="tfree">'var</span> bexp <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ev<span class="hidden">⇩</span><sub>B</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">ev<span class="hidden">⇩</span><sub>B</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="main">(</span>Neq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">ev<span class="hidden">⇩</span><sub>B</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="main">(</span>Lte <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">ev<span class="hidden">⇩</span><sub>B</sub></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="main">(</span>Gt <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&gt;</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(* Function that gives the control variables of a given variable.
 * None for this example. *)</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">𝒞_vars</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> addr <span class="main">⇒</span> <span class="tfree">'var</span> addr set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">𝒞_vars</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">{}</span>"</span></span>

<span class="comment1">(* NB: mds ~ "mode state"
 * mds<span class="hidden">⇩</span><sub>s</sub> is the initial mode state *)</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">mds<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Mode <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">m</span> <span class="keyword1">of</span> AsmNoReadOrWrite <span class="main">⇒</span> <span class="main">{}</span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">aexp_vars</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> aexp <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">aexp_vars</span> <span class="main">(</span>Const <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">aexp_vars</span> <span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">aexp_vars</span> <span class="main">(</span>Add <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">aexp_vars</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∪</span> <span class="free">aexp_vars</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">aexp_vars</span> <span class="main">(</span>Sub <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">aexp_vars</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∪</span> <span class="free">aexp_vars</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span>
  <span class="entity">bexp_vars</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> bexp <span class="main">⇒</span> <span class="tfree">'var</span> addr set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_vars</span> <span class="main">(</span>Neq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> aexp_vars <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∪</span> aexp_vars <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_vars</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> aexp_vars <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∪</span> aexp_vars <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_vars</span> <span class="main">(</span>Lte <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> aexp_vars <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∪</span> aexp_vars <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_vars</span> <span class="main">(</span>Gt <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> aexp_vars <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∪</span> aexp_vars <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span>
  <span class="entity">bexp_neg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> bexp <span class="main">⇒</span> <span class="tfree">'var</span> bexp"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_neg</span> <span class="main">(</span>Neq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_neg</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Neq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_neg</span> <span class="main">(</span>Lte <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Gt <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_neg</span> <span class="main">(</span>Gt <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Lte <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span>
  <span class="entity">bexp_assign</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> addr <span class="main">⇒</span> <span class="tfree">'var</span> aexp <span class="main">⇒</span> <span class="tfree">'var</span> bexp"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bexp_assign</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span>Eq <span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> var <span class="main">=</span> h_var <span class="main">|</span> x_var <span class="main">|</span> y_var <span class="main">|</span> z_var

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">dma</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"var mem <span class="main">⇒</span> var addr <span class="main">⇒</span> Sec"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dma</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> h_var <span class="keyword1">then</span> High <span class="keyword1">else</span> Low"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> t_ev<span class="hidden">⇩</span><sub>A</sub> <span class="main">=</span> <span class="quoted"><span class="quoted">"var mem <span class="main">⇒</span> var aexp <span class="main">⇒</span> val"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> t_ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">=</span> <span class="quoted"><span class="quoted">"var mem <span class="main">⇒</span> var bexp <span class="main">⇒</span> bool"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> t_aexp_vars <span class="main">=</span> <span class="quoted"><span class="quoted">"var aexp <span class="main">⇒</span> var set"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> t_bexp_vars <span class="main">=</span> <span class="quoted"><span class="quoted">"var bexp <span class="main">⇒</span> var addr set"</span></span>

<span class="keyword1"><span class="command">locale</span></span> sifum_example <span class="main">=</span>
  sifum_lang_no_dma <span class="quoted"><span class="quoted">"ev<span class="hidden">⇩</span><sub>A</sub><span class="main">::</span>t_ev<span class="hidden">⇩</span><sub>A</sub>"</span></span> <span class="quoted"><span class="quoted">"ev<span class="hidden">⇩</span><sub>B</sub><span class="main">::</span>t_ev<span class="hidden">⇩</span><sub>B</sub>"</span></span> <span class="quoted"><span class="quoted">"aexp_vars<span class="main">::</span>t_aexp_vars"</span></span> <span class="quoted"><span class="quoted">"bexp_vars<span class="main">::</span>t_bexp_vars"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eval_det<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">lc</span><span class="main">,</span> <span class="free">lc'</span><span class="main">)</span> <span class="main">∈</span> eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">⟹</span> <span class="main">(</span><span class="free">lc</span><span class="main">,</span> <span class="free">lc''</span><span class="main">)</span> <span class="main">∈</span> eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">⟹</span> <span class="free">lc'</span> <span class="main">=</span> <span class="free">lc''</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">𝒞</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"var addr set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">𝒞</span> <span class="main">≡</span> <span class="main">⋃</span><span class="bound">x</span><span class="main">.</span> 𝒞_vars <span class="bound">x</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> sifum_example <span class="main">⊆</span>  sifum_security <span class="quoted">dma</span> <span class="quoted">𝒞_vars</span> <span class="quoted">𝒞</span> <span class="quoted">eval<span class="hidden">⇩</span><sub>w</sub></span> <span class="quoted">undefined</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eval_det<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Var_finite<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝒞_vars_def dma_def 𝒞_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>3<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝒞_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">context</span></span> sifum_example <span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*
  y := 0; z := 0;
  x := y;
  if h then x := y
       else x := y + z

  Must have NoWrite z to prevent an agent getting something observable by spiking the value of z.
  Also take NoWrite y &amp; h to simplify reasoning about reg values staying consistent with the mem.
 *)</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">prog_high_branch</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>var addr<span class="main">,</span> var aexp<span class="main">,</span> var bexp<span class="main">)</span> Stmt"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">prog_high_branch</span> <span class="main">≡</span>
     ModeDecl Skip <span class="main">(</span>Acq h_var AsmNoWrite<span class="main">)</span> <span class="main">;;</span>
     ModeDecl Skip <span class="main">(</span>Acq y_var AsmNoWrite<span class="main">)</span> <span class="main">;;</span>
     ModeDecl Skip <span class="main">(</span>Acq z_var AsmNoWrite<span class="main">)</span> <span class="main">;;</span>
     Assign y_var <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign z_var <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">;;</span>
     If <span class="main">(</span>Neq <span class="main">(</span>Load h_var<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span>
     <span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span>
     <span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">datatype</span></span> var<span class="hidden">⇩</span><sub>C</sub> <span class="main">=</span> h_mem <span class="main">|</span> x_mem <span class="main">|</span> y_mem <span class="main">|</span> z_mem <span class="main">|</span> reg0 <span class="main">|</span> reg1 <span class="main">|</span> reg2 <span class="main">|</span> reg3

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"var<span class="hidden">⇩</span><sub>C</sub> mem <span class="main">⇒</span> var<span class="hidden">⇩</span><sub>C</sub> addr <span class="main">⇒</span> Sec"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> h_mem <span class="keyword1">then</span> High <span class="keyword1">else</span> Low"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> t_ev<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>C</sub> <span class="main">=</span> <span class="quoted"><span class="quoted">"var<span class="hidden">⇩</span><sub>C</sub> mem <span class="main">⇒</span> var<span class="hidden">⇩</span><sub>C</sub> aexp <span class="main">⇒</span> val"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> t_ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub> <span class="main">=</span> <span class="quoted"><span class="quoted">"var<span class="hidden">⇩</span><sub>C</sub> mem <span class="main">⇒</span> var<span class="hidden">⇩</span><sub>C</sub> bexp <span class="main">⇒</span> bool"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> t_aexp_vars<span class="hidden">⇩</span><sub>C</sub> <span class="main">=</span> <span class="quoted"><span class="quoted">"var<span class="hidden">⇩</span><sub>C</sub> aexp <span class="main">⇒</span> var<span class="hidden">⇩</span><sub>C</sub> set"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> t_bexp_vars<span class="hidden">⇩</span><sub>C</sub> <span class="main">=</span> <span class="quoted"><span class="quoted">"var<span class="hidden">⇩</span><sub>C</sub> bexp <span class="main">⇒</span> var<span class="hidden">⇩</span><sub>C</sub> addr set"</span></span>

<span class="keyword1"><span class="command">locale</span></span> sifum_example<span class="hidden">⇩</span><sub>C</sub> <span class="main">=</span>
  sifum_lang_no_dma <span class="quoted"><span class="quoted">"ev<span class="hidden">⇩</span><sub>A</sub><span class="main">::</span>t_ev<span class="hidden">⇩</span><sub>A</sub><span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="quoted"><span class="quoted">"ev<span class="hidden">⇩</span><sub>B</sub><span class="main">::</span>t_ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="quoted"><span class="quoted">"aexp_vars<span class="main">::</span>t_aexp_vars<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="quoted"><span class="quoted">"bexp_vars<span class="main">::</span>t_bexp_vars<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eval_det<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">lc</span><span class="main">,</span> <span class="free">lc'</span><span class="main">)</span> <span class="main">∈</span> eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">⟹</span> <span class="main">(</span><span class="free">lc</span><span class="main">,</span> <span class="free">lc''</span><span class="main">)</span> <span class="main">∈</span> eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">⟹</span> <span class="free">lc'</span> <span class="main">=</span> <span class="free">lc''</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">𝒞<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"var<span class="hidden">⇩</span><sub>C</sub> addr set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">𝒞<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≡</span> <span class="main">⋃</span><span class="bound">x</span><span class="main">.</span> 𝒞_vars <span class="bound">x</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> sifum_example<span class="hidden">⇩</span><sub>C</sub> <span class="main">⊆</span>  sifum_security <span class="quoted">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="quoted">𝒞_vars</span> <span class="quoted">𝒞<span class="hidden">⇩</span><sub>C</sub></span> <span class="quoted">eval<span class="hidden">⇩</span><sub>w</sub></span> <span class="quoted">undefined</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eval_det<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Var_finite<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝒞_vars_def dma<span class="hidden">⇩</span><sub>C</sub>_def 𝒞_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>3<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝒞<span class="hidden">⇩</span><sub>C</sub>_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">context</span></span> sifum_example<span class="hidden">⇩</span><sub>C</sub> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*
  y := 0; z := 0;
  x := y;
  if h
    then
      // "then"-branch: x := y
      NOP ;
      NOP ;
      LOAD r0 y ;
      STORE x r0 ;
    else
      // "else"-branch: x := y + z
      LOAD r1 y ;
      LOAD r2 z ;
      ADD r0 r1 r2 ;
      STORE x r0 ;
 *)</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">prog_high_branch<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub> addr<span class="main">,</span> var<span class="hidden">⇩</span><sub>C</sub> aexp<span class="main">,</span> var<span class="hidden">⇩</span><sub>C</sub> bexp<span class="main">)</span> Stmt"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">prog_high_branch<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≡</span>
     ModeDecl Skip <span class="main">(</span>Acq h_mem AsmNoWrite<span class="main">)</span> <span class="main">;;</span>
     ModeDecl Skip <span class="main">(</span>Acq y_mem AsmNoWrite<span class="main">)</span> <span class="main">;;</span>
     ModeDecl Skip <span class="main">(</span>Acq z_mem AsmNoWrite<span class="main">)</span> <span class="main">;;</span>
     <span class="comment1">― ‹Just set up the memory to match our assumptions›</span>
     Assign y_mem <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign z_mem <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span>
     <span class="comment1">― ‹From this point onwards we model the if-statement using registers.›</span>
     <span class="comment1">― ‹Note that we can just as well (re-)use reg0 instead of reg3 - verify with a search-replace.›</span>
     <span class="comment1">― ‹Leaving it this way to make the reg usages easier to distinguish for the reader, though.›</span>
     Assign reg3 <span class="main">(</span>Load h_mem<span class="main">)</span> <span class="main">;;</span>
     If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>
       Skip <span class="main">;;</span>
       Skip <span class="main">;;</span>
       Assign reg0 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span>
       Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span>
     <span class="main">)</span> <span class="main">(</span>
       Assign reg1 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span>
       Assign reg2 <span class="main">(</span>Load z_mem<span class="main">)</span> <span class="main">;;</span>
       Assign reg0 <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span>
       Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span>
     <span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> sifum_example <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> 𝒞_simp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"𝒞 <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝒞_def 𝒞_vars_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> 𝒞_vars_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="comment1">(* Manual proof of bisimulation because we can't use the type system *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">inv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>var addr<span class="main">,</span> var aexp<span class="main">,</span> var bexp<span class="main">)</span> Stmt<span class="main">,</span> var addr<span class="main">,</span> val<span class="main">)</span> LocalConf<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  inv<span class="hidden">⇩</span><sub>1</sub>h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> prog_high_branch<span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoReadOrWrite <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoWrite <span class="main">=</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">inv</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span>"</span></span> <span class="main">|</span>
  inv<span class="hidden">⇩</span><sub>1</sub>h'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     Stop <span class="main">;;</span>
     ModeDecl Skip <span class="main">(</span>Acq y_var AsmNoWrite<span class="main">)</span> <span class="main">;;</span>
     ModeDecl Skip <span class="main">(</span>Acq z_var AsmNoWrite<span class="main">)</span> <span class="main">;;</span>
     Assign y_var <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign z_var <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">;;</span>
     If <span class="main">(</span>Neq <span class="main">(</span>Load h_var<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span>
     <span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span>
     <span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoWrite <span class="main">=</span> <span class="main">{</span>h_var<span class="main">}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoReadOrWrite <span class="main">=</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span>
   <span class="free">inv</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span>"</span></span> <span class="main">|</span>
  inv<span class="hidden">⇩</span><sub>1</sub>y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     ModeDecl Skip <span class="main">(</span>Acq y_var AsmNoWrite<span class="main">)</span> <span class="main">;;</span>
     ModeDecl Skip <span class="main">(</span>Acq z_var AsmNoWrite<span class="main">)</span> <span class="main">;;</span>
     Assign y_var <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign z_var <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">;;</span>
     If <span class="main">(</span>Neq <span class="main">(</span>Load h_var<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span>
     <span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span>
     <span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoWrite <span class="main">=</span> <span class="main">{</span>h_var<span class="main">}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoReadOrWrite <span class="main">=</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span>
   <span class="free">inv</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span>"</span></span> <span class="main">|</span>
  inv<span class="hidden">⇩</span><sub>1</sub>y'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     Stop <span class="main">;;</span>
     ModeDecl Skip <span class="main">(</span>Acq z_var AsmNoWrite<span class="main">)</span> <span class="main">;;</span>
     Assign y_var <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign z_var <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">;;</span>
     If <span class="main">(</span>Neq <span class="main">(</span>Load h_var<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span>
     <span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span>
     <span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoWrite <span class="main">=</span> <span class="main">{</span>y_var<span class="main">,</span> h_var<span class="main">}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoReadOrWrite <span class="main">=</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span>
   <span class="free">inv</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span>"</span></span> <span class="main">|</span>
  inv<span class="hidden">⇩</span><sub>1</sub>z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     ModeDecl Skip <span class="main">(</span>Acq z_var AsmNoWrite<span class="main">)</span> <span class="main">;;</span>
     Assign y_var <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign z_var <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">;;</span>
     If <span class="main">(</span>Neq <span class="main">(</span>Load h_var<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span>
     <span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span>
     <span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoWrite <span class="main">=</span> <span class="main">{</span>y_var<span class="main">,</span> h_var<span class="main">}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoReadOrWrite <span class="main">=</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span>
   <span class="free">inv</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span>"</span></span> <span class="main">|</span>
  inv<span class="hidden">⇩</span><sub>1</sub>z'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     Stop <span class="main">;;</span>
     Assign y_var <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign z_var <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">;;</span>
     If <span class="main">(</span>Neq <span class="main">(</span>Load h_var<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span>
     <span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span>
     <span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoWrite <span class="main">=</span> <span class="main">{</span>z_var<span class="main">,</span> y_var<span class="main">,</span> h_var<span class="main">}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoReadOrWrite <span class="main">=</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span>
   <span class="free">inv</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span>"</span></span> <span class="main">|</span>
  inv<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     Assign y_var <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign z_var <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">;;</span>
     If <span class="main">(</span>Neq <span class="main">(</span>Load h_var<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span>
     <span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span>
     <span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoWrite <span class="main">=</span> <span class="main">{</span>z_var<span class="main">,</span> y_var<span class="main">,</span> h_var<span class="main">}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoReadOrWrite <span class="main">=</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span>
   <span class="free">inv</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span>"</span></span> <span class="main">|</span>
  inv<span class="hidden">⇩</span><sub>2</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     Stop <span class="main">;;</span>
     Assign z_var <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">;;</span>
     If <span class="main">(</span>Neq <span class="main">(</span>Load h_var<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span>
     <span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span>
     <span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoWrite <span class="main">=</span> <span class="main">{</span>z_var<span class="main">,</span> y_var<span class="main">,</span> h_var<span class="main">}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoReadOrWrite <span class="main">=</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span>
   <span class="free">inv</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span>"</span></span> <span class="main">|</span>
  inv<span class="hidden">⇩</span><sub>3</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     Assign z_var <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">;;</span>
     If <span class="main">(</span>Neq <span class="main">(</span>Load h_var<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span>
     <span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span>
     <span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoWrite <span class="main">=</span> <span class="main">{</span>z_var<span class="main">,</span> y_var<span class="main">,</span> h_var<span class="main">}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoReadOrWrite <span class="main">=</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span>
   <span class="free">inv</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span>"</span></span> <span class="main">|</span>
  inv<span class="hidden">⇩</span><sub>3</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     Stop <span class="main">;;</span>
     Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">;;</span>
     If <span class="main">(</span>Neq <span class="main">(</span>Load h_var<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span>
     <span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span>
     <span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoWrite <span class="main">=</span> <span class="main">{</span>z_var<span class="main">,</span> y_var<span class="main">,</span> h_var<span class="main">}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoReadOrWrite <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> z_var <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span>
   <span class="free">inv</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span>"</span></span> <span class="main">|</span>
  inv<span class="hidden">⇩</span><sub>4</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">;;</span>
     If <span class="main">(</span>Neq <span class="main">(</span>Load h_var<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span>
     <span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span>
     <span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoWrite <span class="main">=</span> <span class="main">{</span>z_var<span class="main">,</span> y_var<span class="main">,</span> h_var<span class="main">}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoReadOrWrite <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> z_var <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span>
   <span class="free">inv</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span>"</span></span> <span class="main">|</span>
  inv<span class="hidden">⇩</span><sub>4</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     Stop <span class="main">;;</span>
     If <span class="main">(</span>Neq <span class="main">(</span>Load h_var<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span>
     <span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span>
     <span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoWrite <span class="main">=</span> <span class="main">{</span>z_var<span class="main">,</span> y_var<span class="main">,</span> h_var<span class="main">}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoReadOrWrite <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> z_var <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span>
   <span class="free">inv</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span>"</span></span> <span class="main">|</span>
  inv<span class="hidden">⇩</span><sub>5</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     If <span class="main">(</span>Neq <span class="main">(</span>Load h_var<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span>
     <span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span>
     <span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoWrite <span class="main">=</span> <span class="main">{</span>z_var<span class="main">,</span> y_var<span class="main">,</span> h_var<span class="main">}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoReadOrWrite <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> z_var <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span>
   <span class="free">inv</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span>"</span></span> <span class="main">|</span>
  inv<span class="hidden">⇩</span><sub>5</sub>_then<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span><span class="main">;</span>
     <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoWrite <span class="main">=</span> <span class="main">{</span>z_var<span class="main">,</span> y_var<span class="main">,</span> h_var<span class="main">}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoReadOrWrite <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> z_var <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span>
   <span class="free">inv</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span>"</span></span> <span class="main">|</span>
  inv<span class="hidden">⇩</span><sub>5</sub>_else<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> Assign x_var <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span><span class="main">;</span>
     <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoWrite <span class="main">=</span> <span class="main">{</span>z_var<span class="main">,</span> y_var<span class="main">,</span> h_var<span class="main">}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoReadOrWrite <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> z_var <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span>
   <span class="free">inv</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span>"</span></span> <span class="main">|</span>
  inv<span class="hidden">⇩</span><sub>6</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> Stop<span class="main">⟧</span> <span class="main">⟹</span>
   <span class="free">inv</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">z_locked_steps</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">z_locked_steps</span> <span class="main">≡</span> <span class="main">{</span>
     Stop <span class="main">;;</span>
     Assign y_var <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign z_var <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">;;</span>
     If <span class="main">(</span>Neq <span class="main">(</span>Load h_var<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span>
     <span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span>
     <span class="main">)</span><span class="main">,</span>
     Assign y_var <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign z_var <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">;;</span>
     If <span class="main">(</span>Neq <span class="main">(</span>Load h_var<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span>
     <span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span>
     <span class="main">)</span><span class="main">,</span>
     Stop <span class="main">;;</span>
     Assign z_var <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">;;</span>
     If <span class="main">(</span>Neq <span class="main">(</span>Load h_var<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span>
     <span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span>
     <span class="main">)</span><span class="main">,</span>
     Assign z_var <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">;;</span>
     If <span class="main">(</span>Neq <span class="main">(</span>Load h_var<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span>
     <span class="main">)</span> <span class="main">(</span>
       Assign x_var <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span>
     <span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">rel_inv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>var addr<span class="main">,</span> var aexp<span class="main">,</span> var bexp<span class="main">)</span> Stmt<span class="main">,</span> var addr<span class="main">,</span> val<span class="main">)</span> LocalConf<span class="main">)</span> rel"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  rel_inv_if<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="main">=</span> Assign x_var <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span><span class="main">;</span>
    z_var <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoWrite<span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoReadOrWrite <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> z_var <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span> z_var<span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> <span class="free">rel_inv</span>"</span></span> <span class="main">|</span>
  rel_inv_if'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="main">=</span> Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> Assign x_var <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span><span class="main">;</span>
    z_var <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoWrite<span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoReadOrWrite <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> z_var <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span> z_var<span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> <span class="free">rel_inv</span>"</span></span> <span class="main">|</span>
  rel_inv_start<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">;</span> z_var <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoWrite<span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoReadOrWrite <span class="main">=</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> <span class="free">rel_inv</span>"</span></span> <span class="main">|</span>
  rel_inv_z_locked<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∈</span> z_locked_steps<span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">;</span> z_var <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoWrite<span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoReadOrWrite <span class="main">=</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> <span class="free">rel_inv</span>"</span></span> <span class="main">|</span>
  rel_inv_z_initted<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∉</span> z_locked_steps<span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> z_var <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span> z_var<span class="main">;</span> z_var <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoWrite<span class="main">;</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span> AsmNoReadOrWrite <span class="main">=</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> <span class="free">rel_inv</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> z_locked_steps_def<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main">]</span>

<span class="comment1">(* the bisimulation is phrased as a conjunction of a global invariant and a
   relational invariant, defined above, plus the background requirement
   of low-equivalence modulo modes *)</span>
<span class="keyword1"><span class="command">inductive_set</span></span>  <span class="entity">R</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>var addr<span class="main">,</span> var aexp<span class="main">,</span> var bexp<span class="main">)</span> Stmt<span class="main">,</span> var addr<span class="main">,</span> val<span class="main">)</span> LocalConf<span class="main">)</span> rel"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* Having a c = c' requirement here is actually too restrictive *)</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">mds</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">mds'</span></span></span><span class="main">;</span> low_mds_eq <span class="free"><span class="bound"><span class="entity">mds</span></span></span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">;</span> inv <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span><span class="main">;</span> inv <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">mds'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">⟩</span><span class="main">;</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="main">⟧</span> <span class="main">⟹</span>
 <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_inv_sym<span class="main">:</span>
  <span class="quoted"><span class="quoted">"low_mds_eq <span class="free">mds</span> <span class="free">mem</span> <span class="free">mem'</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="free">c</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free">c</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem'</span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> rel_inv <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free">c</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem'</span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free">c</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> rel_inv"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rel_inv.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rel_inv.intros<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> R_sym'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free">c'</span><span class="main">,</span> <span class="free">mds'</span><span class="main">,</span> <span class="free">mem'</span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> R <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⟨</span><span class="free">c'</span><span class="main">,</span> <span class="free">mds'</span><span class="main">,</span> <span class="free">mem'</span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free">c</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> R"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> R.intros<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> R.cases <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> low_mds_eq_sym <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rel_inv_sym<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> R.cases<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_inv.cases<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_inv_if'<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_inv_if<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_inv_start<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_inv_z_locked<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_inv_z_initted<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> R_sym<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sym R"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> symI<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> R_sym'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inv_closed_glob_consistent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"inv <span class="main">⟨</span><span class="free">c'</span><span class="main">,</span> <span class="free">mds'</span><span class="main">,</span> <span class="free">mem</span><span class="main">⟩</span> <span class="main">⟹</span>
       <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free">A</span> <span class="bound">x</span> <span class="keyword1">of</span> None <span class="main">⇒</span> True <span class="main">|</span> Some <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">mem</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">v</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="free">mds'</span> <span class="bound">x</span> <span class="main">⟹</span>
       <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> dma <span class="free">mem</span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">A</span><span class="main">]</span> <span class="bound">x</span> <span class="main">≠</span> dma <span class="free">mem</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="free">mds'</span> <span class="bound">x</span>  <span class="main">⟹</span>
       inv <span class="main">⟨</span><span class="free">c'</span><span class="main">,</span> <span class="free">mds'</span><span class="main">,</span> <span class="free">mem</span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">A</span><span class="main">]</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> inv.cases<span class="main">)</span>
             <span class="keyword1"><span class="command">using</span></span> inv.intros <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>3</sub>'<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> z_var"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>apply_adaptation_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>var_asm_not_written_def dma_def apply_adaptation_def<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>4</sub><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> z_var"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>apply_adaptation_def<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>var_asm_not_written_def dma_def apply_adaptation_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>4</sub>'<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> z_var"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>apply_adaptation_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>var_asm_not_written_def dma_def apply_adaptation_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>5</sub><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> z_var"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>apply_adaptation_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>var_asm_not_written_def dma_def apply_adaptation_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>5</sub>_then<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> z_var"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>apply_adaptation_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>var_asm_not_written_def dma_def apply_adaptation_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>5</sub>_else<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> z_var"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>apply_adaptation_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>var_asm_not_written_def dma_def apply_adaptation_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>6</sub><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(* The "right-hand" side of inv_closed_glob_consistent *)</span>
<span class="keyword1"><span class="command">lemma</span></span> inv_closed_glob_consistent_r<span class="main">:</span>
  <span class="quoted"><span class="quoted">"inv <span class="main">⟨</span><span class="free">c'</span><span class="main">,</span> <span class="free">mds'</span><span class="main">,</span> <span class="free">mem</span><span class="main">⟩</span> <span class="main">⟹</span>
       <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free">A</span> <span class="bound">x</span> <span class="keyword1">of</span> None <span class="main">⇒</span> True <span class="main">|</span> Some <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">mem</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">v'</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="free">mds'</span> <span class="bound">x</span> <span class="main">⟹</span>
       <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> dma <span class="free">mem</span> <span class="main">[∥<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">A</span><span class="main">]</span> <span class="bound">x</span> <span class="main">≠</span> dma <span class="free">mem</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="free">mds'</span> <span class="bound">x</span>  <span class="main">⟹</span>
       inv <span class="main">⟨</span><span class="free">c'</span><span class="main">,</span> <span class="free">mds'</span><span class="main">,</span> <span class="free">mem</span> <span class="main">[∥<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">A</span><span class="main">]</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> inv.cases<span class="main">)</span>
               <span class="keyword1"><span class="command">using</span></span> inv.intros <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>3</sub>'<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> z_var"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>apply_adaptation_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>var_asm_not_written_def dma_def apply_adaptation_def<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>4</sub><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> z_var"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>apply_adaptation_def<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>var_asm_not_written_def dma_def apply_adaptation_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>4</sub>'<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> z_var"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>apply_adaptation_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>var_asm_not_written_def dma_def apply_adaptation_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>5</sub><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> z_var"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>apply_adaptation_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>var_asm_not_written_def dma_def apply_adaptation_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>5</sub>_then<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> z_var"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>apply_adaptation_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>var_asm_not_written_def dma_def apply_adaptation_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>5</sub>_else<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">z_var</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> z_var"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>apply_adaptation_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>var_asm_not_written_def dma_def apply_adaptation_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>6</sub><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_inv_closed_glob_consistent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c</span><span class="main">,</span> <span class="free">mds'</span><span class="main">,</span> <span class="free">mem</span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free">c'</span><span class="main">,</span> <span class="free">mds'</span><span class="main">,</span> <span class="free">mem'</span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> rel_inv <span class="main">⟹</span>
       <span class="main">∀</span><span class="bound">x</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span>
          <span class="free">A</span> <span class="bound">x</span> <span class="main">=</span> Some <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟶</span>
          <span class="main">(</span><span class="free">mem</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">⟶</span> <span class="free">mem'</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="free">mds'</span> <span class="bound">x</span> <span class="main">⟹</span>
       <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> dma <span class="free">mem</span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">A</span><span class="main">]</span> <span class="bound">x</span> <span class="main">≠</span> dma <span class="free">mem</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="free">mds'</span> <span class="bound">x</span> <span class="main">⟹</span>
       <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> dma <span class="free">mem</span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">A</span><span class="main">]</span> <span class="bound">x</span> <span class="main">=</span> Low <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">mds'</span> AsmNoReadOrWrite <span class="main">⟶</span> <span class="bound">x</span> <span class="main">∈</span> 𝒞<span class="main">)</span> <span class="main">⟶</span>
           <span class="free">mem</span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">A</span><span class="main">]</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">mem'</span> <span class="main">[∥<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">A</span><span class="main">]</span> <span class="bound">x</span> <span class="main">⟹</span>
       <span class="main">(</span><span class="main">⟨</span><span class="free">c</span><span class="main">,</span> <span class="free">mds'</span><span class="main">,</span> <span class="free">mem</span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">A</span><span class="main">]</span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free">c'</span><span class="main">,</span> <span class="free">mds'</span><span class="main">,</span> <span class="free">mem'</span> <span class="main">[∥<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">A</span><span class="main">]</span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> rel_inv"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rel_inv.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> rel_inv.intros dma_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> R_closed_glob_consistent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"closed_glob_consistent R"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> closed_glob_consistent_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> R.cases<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> R.intros<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> low_mds_eq_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv_closed_glob_consistent<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv_closed_glob_consistent_r<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"dma <span class="improper">mem</span> <span class="main">=</span> dma <span class="improper">mem'</span> <span class="main">∧</span> dma <span class="improper">mem</span> <span class="main">[∥<span class="hidden">⇩</span><sub>1</sub></span> <span class="improper">A</span><span class="main">]</span> <span class="main">=</span> dma <span class="improper">mem'</span> <span class="main">[∥<span class="hidden">⇩</span><sub>2</sub></span> <span class="improper">A</span><span class="main">]</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> low_mds_eq_dma<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> dma_𝒞<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 𝒞_Low<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_inv_closed_glob_consistent<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> R_low_mds_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> R <span class="main">⟹</span>
        low_mds_eq <span class="free">mds</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> R.cases<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> rel_invE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free">c'</span><span class="main">,</span> <span class="free">mds'</span><span class="main">,</span> <span class="free">mem'</span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> rel_inv"</span></span>

<span class="keyword1"><span class="command">method</span></span> seq_decl_inv_method <span class="keyword2"><span class="keyword">uses</span></span> inv_rule rel_inv_rule <span class="main">=</span>
 <span class="main">(</span><span class="operator">erule</span> rel_invE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">drule</span> seq_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">drule</span> upd_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> skip_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span>
    <span class="operator">rule</span> eval<span class="hidden">⇩</span><sub>w</sub>.seq<span class="main"><span class="keyword3">,</span></span>
    <span class="operator">rule</span> decl_eval<span class="hidden">⇩</span><sub>w</sub>'<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">rule</span> R.intros<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> low_mds_eq_def<span class="main"><span class="keyword3">,</span></span>
     <span class="operator">rule</span> <span class="dynamic"><span class="dynamic">inv_rule</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">rule</span> <span class="dynamic"><span class="dynamic">inv_rule</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">rule</span> <span class="dynamic"><span class="dynamic">rel_inv_rule</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">method</span></span> seq_stop_inv_method <span class="keyword2"><span class="keyword">uses</span></span> inv_rule rel_inv_rule <span class="main">=</span>
 <span class="main">(</span><span class="operator">erule</span> rel_invE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">drule</span> seq_stop_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span>
   <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span>
    <span class="operator">rule</span> seq_stop_eval<span class="hidden">⇩</span><sub>w</sub><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">rule</span> R.intros<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> low_mds_eq_def dma_def ev<span class="hidden">⇩</span><sub>A</sub>.simps<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
     <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">inv_rule</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">blast</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">,</span></span>
    <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">inv_rule</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">blast</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">rule</span> <span class="dynamic"><span class="dynamic">rel_inv_rule</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">method</span></span> assign_inv<span class="hidden">⇩</span><sub>6</sub>_method <span class="main">=</span>
 <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">c<span class="hidden">⇩</span><sub>1</sub>'</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span class="main">(</span></span>x_var <span class="main"><span class="main">:=</span></span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="main">(</span></span>Load y_var<span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">erule</span> rel_invE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
  <span class="main">(</span><span class="operator">drule</span> assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span>
    <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ev<span class="hidden">⇩</span><sub>A</sub>.simps<span class="main"><span class="keyword3">,</span></span>
    <span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">z_var</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span>
    <span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">rule</span> assign_eval<span class="hidden">⇩</span><sub>w</sub>'<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ev<span class="hidden">⇩</span><sub>A</sub>.simps<span class="main"><span class="keyword3">,</span></span>
   <span class="operator">rule</span> R.intros<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">unfold</span> low_mds_eq_def dma_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ev<span class="hidden">⇩</span><sub>A</sub>.simps<span class="main"><span class="keyword3">,</span></span>
     <span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>6</sub><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">rule</span> rel_inv_z_initted<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> R_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">notes</span></span> ev<span class="hidden">⇩</span><sub>A</sub>.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> R <span class="main">⟹</span>
       <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">,</span> <span class="free">mds'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">⟹</span>
       <span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">.</span>
          <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">,</span> <span class="free">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">∧</span>
          <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">,</span> <span class="free">mds'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">,</span> <span class="free">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> R"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> R.cases<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> inv.cases<span class="main">)</span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> prog_high_branch_def<span class="main">)</span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">seq_decl_inv_method</span> <span class="quasi_keyword">inv_rule</span><span class="main"><span class="main">:</span></span>inv<span class="hidden">⇩</span><sub>1</sub>h' <span class="quasi_keyword">rel_inv_rule</span><span class="main"><span class="main">:</span></span>rel_inv_start<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">seq_stop_inv_method</span> <span class="quasi_keyword">inv_rule</span><span class="main"><span class="main">:</span></span>inv<span class="hidden">⇩</span><sub>1</sub>y <span class="quasi_keyword">rel_inv_rule</span><span class="main"><span class="main">:</span></span>rel_inv_start<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">seq_decl_inv_method</span> <span class="quasi_keyword">inv_rule</span><span class="main"><span class="main">:</span></span>inv<span class="hidden">⇩</span><sub>1</sub>y' <span class="quasi_keyword">rel_inv_rule</span><span class="main"><span class="main">:</span></span>rel_inv_start<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">seq_stop_inv_method</span> <span class="quasi_keyword">inv_rule</span><span class="main"><span class="main">:</span></span>inv<span class="hidden">⇩</span><sub>1</sub>z <span class="quasi_keyword">rel_inv_rule</span><span class="main"><span class="main">:</span></span>rel_inv_start<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">seq_decl_inv_method</span> <span class="quasi_keyword">inv_rule</span><span class="main"><span class="main">:</span></span>inv<span class="hidden">⇩</span><sub>1</sub>z' <span class="quasi_keyword">rel_inv_rule</span><span class="main"><span class="main">:</span></span>rel_inv_z_locked<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">seq_stop_inv_method</span> <span class="quasi_keyword">inv_rule</span><span class="main"><span class="main">:</span></span>inv<span class="hidden">⇩</span><sub>2</sub> <span class="quasi_keyword">rel_inv_rule</span><span class="main"><span class="main">:</span></span>rel_inv_z_locked<span class="main">)</span>

           <span class="comment1">(* Assign ;; *)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="main">(</span>y_var <span class="main">:=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_invE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> seq_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> eval<span class="hidden">⇩</span><sub>w</sub>.seq<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> assign_eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> R.intros<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> low_mds_eq_def dma_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ev<span class="hidden">⇩</span><sub>A</sub>.simps<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>2</sub>'<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_inv_z_locked<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">seq_stop_inv_method</span> <span class="quasi_keyword">inv_rule</span><span class="main"><span class="main">:</span></span>inv<span class="hidden">⇩</span><sub>3</sub> <span class="quasi_keyword">rel_inv_rule</span><span class="main"><span class="main">:</span></span>rel_inv_z_locked<span class="main">)</span>

         <span class="comment1">(* Assign ;; *)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="main">(</span>z_var <span class="main">:=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_invE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> seq_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> eval<span class="hidden">⇩</span><sub>w</sub>.seq<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> assign_eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> R.intros<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> low_mds_eq_def dma_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ev<span class="hidden">⇩</span><sub>A</sub>.simps<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>3</sub>'<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ev<span class="hidden">⇩</span><sub>A</sub>.simps<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>3</sub>'<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ev<span class="hidden">⇩</span><sub>A</sub>.simps<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_inv_z_initted<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ev<span class="hidden">⇩</span><sub>A</sub>.simps<span class="main">)</span> <span class="comment1">(* do it separately so it doesn't mess everything else up *)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">seq_stop_inv_method</span> <span class="quasi_keyword">inv_rule</span><span class="main"><span class="main">:</span></span>inv<span class="hidden">⇩</span><sub>4</sub> <span class="quasi_keyword">rel_inv_rule</span><span class="main"><span class="main">:</span></span>rel_inv_z_initted<span class="main">)</span>

       <span class="comment1">(* Assign ;; *)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="main">(</span>x_var <span class="main">:=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Load y_var<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_invE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> seq_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> eval<span class="hidden">⇩</span><sub>w</sub>.seq<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> assign_eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> R.intros<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> low_mds_eq_def dma_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ev<span class="hidden">⇩</span><sub>A</sub>.simps<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>4</sub>'<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_inv_z_initted<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">seq_stop_inv_method</span> <span class="quasi_keyword">inv_rule</span><span class="main"><span class="main">:</span></span>inv<span class="hidden">⇩</span><sub>5</sub> <span class="quasi_keyword">rel_inv_rule</span><span class="main"><span class="main">:</span></span>rel_inv_z_initted<span class="main">)</span>

     <span class="comment1">(* (If (cond) Then Else) *)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_invE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Neq <span class="main">(</span>Load h_var<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span>
                        <span class="keyword1">then</span> <span class="main">(</span>x_var <span class="main">←</span> Load y_var<span class="main">)</span>
                        <span class="keyword1">else</span> <span class="main">(</span>x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> if_elim<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> if_elim<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> R.intros<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> low_mds_eq_def dma_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>5</sub>_then<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>5</sub>_then<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>5</sub>_else<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_inv_z_initted<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_inv_if<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> R.intros<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> low_mds_eq_def dma_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>5</sub>_else<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>5</sub>_then<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>5</sub>_else<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_inv_if'<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_inv_z_initted<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
 
    <span class="comment1">(* Assign - then | else *)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assign_inv<span class="hidden">⇩</span><sub>6</sub>_method</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assign_inv<span class="hidden">⇩</span><sub>6</sub>_method</span>
  <span class="keyword1"><span class="command">using</span></span> stop_no_eval <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> strong_low_bisim_mm_R<span class="main">:</span>
  <span class="quoted"><span class="quoted">"strong_low_bisim_mm R"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> strong_low_bisim_mm_def
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym R"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> R_sym<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"closed_glob_consistent R"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> R_closed_glob_consistent<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">mds</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span>  <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> R"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"low_mds_eq <span class="skolem">mds</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> R_low_mds_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">mds</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span>  <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="skolem">mds'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> R"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">.</span>
          <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">mds</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">∧</span>
          <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">,</span> <span class="skolem">mds'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub>'</span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> R"</span></span>
       <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> R_inv<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prog_high_branch_secure'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"low_mds_eq mds<span class="hidden">⇩</span><sub>s</sub> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span>
       <span class="main">(</span><span class="main">⟨</span>prog_high_branch<span class="main">,</span> mds<span class="hidden">⇩</span><sub>s</sub><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span>prog_high_branch<span class="main">,</span> mds<span class="hidden">⇩</span><sub>s</sub><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> R"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> R.intros<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>1</sub>h<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mds<span class="hidden">⇩</span><sub>s</sub>_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inv<span class="hidden">⇩</span><sub>1</sub>h<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mds<span class="hidden">⇩</span><sub>s</sub>_def<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> prog_high_branch_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rel_inv.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"com_sifum_secure <span class="main">(</span>prog_high_branch<span class="main">,</span> mds<span class="hidden">⇩</span><sub>s</sub><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> com_sifum_secure_def low_indistinguishable_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> mm_equiv_intro<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> strong_low_bisim_mm_R<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prog_high_branch_secure'<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> sifum_refinement_high_branch <span class="main">=</span>
  A<span class="main">:</span> sifum_example <span class="main">+</span>
  C<span class="main">:</span> sifum_example<span class="hidden">⇩</span><sub>C</sub>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">var<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"var <span class="main">⇒</span> var<span class="hidden">⇩</span><sub>C</sub>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> h_var <span class="main">=</span> h_mem"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> x_var <span class="main">=</span> x_mem"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> y_var <span class="main">=</span> y_mem"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">var<span class="hidden">⇩</span><sub>C</sub>_of</span> z_var <span class="main">=</span> z_mem"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> sifum_refinement_high_branch <span class="main">⊆</span>
  sifum_refinement <span class="quoted">dma</span> <span class="quoted">dma<span class="hidden">⇩</span><sub>C</sub></span> <span class="quoted">𝒞_vars</span> <span class="quoted">𝒞_vars</span> <span class="quoted">𝒞</span> <span class="quoted">𝒞<span class="hidden">⇩</span><sub>C</sub></span> <span class="quoted">A.eval<span class="hidden">⇩</span><sub>w</sub></span> <span class="quoted">C.eval<span class="hidden">⇩</span><sub>w</sub></span> <span class="quoted">undefined</span> <span class="quoted">var<span class="hidden">⇩</span><sub>C</sub>_of</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x<span class="hidden">⇩</span><sub>A</sub></span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>dma_def dma<span class="hidden">⇩</span><sub>C</sub>_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">context</span></span> sifum_refinement_high_branch <span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* Adapted these helpers from Eg1Eg2 *)</span>
<span class="keyword1"><span class="command">lemma</span></span> conc_only_vars_not_visible_abs<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">⟹</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conc_only_var_assign_not_visible_abs<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">e</span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="main">(</span><span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">:=</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conc_only_vars_not_visible_abs
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> reg_is_not_the_var<span class="hidden">⇩</span><sub>C</sub>_of_anything<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">reg</span> <span class="main">∈</span> <span class="main">{</span>reg0<span class="main">,</span> reg1<span class="main">,</span> reg2<span class="main">,</span> reg3<span class="main">}</span> <span class="main">⟹</span> <span class="free">reg</span> <span class="main">=</span> var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> reg_not_visible_abs<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">reg</span> <span class="main">∈</span> <span class="main">{</span>reg0<span class="main">,</span> reg1<span class="main">,</span> reg2<span class="main">,</span> reg3<span class="main">}</span> <span class="main">⟹</span> <span class="free">reg</span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of"</span></span>
  <span class="keyword1"><span class="command">using</span></span> reg_is_not_the_var<span class="hidden">⇩</span><sub>C</sub>_of_anything
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(* Helpers carried over from Eg1Eg2 *)</span>
<span class="keyword1"><span class="command">lemma</span></span> assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">x</span> <span class="main">←</span> Load <span class="free">y</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span> <span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="free">mem</span> <span class="free">y</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A.assign_eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub>.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">x</span> <span class="main">←</span> Load <span class="free">y</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span> <span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="free">mem</span> <span class="free">y</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> C.unannotated<span class="main">[</span><span class="operator">OF</span> C.assign<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> E<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Load <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">mds</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">mem</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> assign_eval<span class="hidden">⇩</span><sub>w</sub>_const<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">x</span> <span class="main">←</span> Const <span class="free">c</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span> <span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="free">c</span><span class="main">)</span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A.assign_eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub>.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> assign_eval<span class="hidden">⇩</span><sub>w</sub>_const<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">x</span> <span class="main">←</span> Const <span class="free">c</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span> <span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="free">c</span><span class="main">)</span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> C.unannotated<span class="main">[</span><span class="operator">OF</span> C.assign<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> E<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Const <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">mds</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">mem</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> mem_assign_refinement_helper_var<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="main">(</span><span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span> <span class="main">:=</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">=</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">x<span class="hidden">⇩</span><sub>A</sub></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> mem_assign_refinement_helper_const<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="main">(</span><span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span> <span class="main">:=</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>
       <span class="main">=</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">x<span class="hidden">⇩</span><sub>A</sub></span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> NoRW<span class="hidden">⇩</span><sub>A</sub>_implies_NoRW<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoReadOrWrite <span class="main">⟹</span>
   var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span> <span class="main">∈</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoReadOrWrite"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mds<span class="hidden">⇩</span><sub>A</sub>_of_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> var<span class="hidden">⇩</span><sub>C</sub>_of_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_inv_into_f<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> NoWrite<span class="hidden">⇩</span><sub>A</sub>_implies_NoWrite<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoWrite <span class="main">⟹</span>
   var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span> <span class="main">∈</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoWrite"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mds<span class="hidden">⇩</span><sub>A</sub>_of_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> var<span class="hidden">⇩</span><sub>C</sub>_of_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_inv_into_f<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> if_seq_eval<span class="hidden">⇩</span><sub>w</sub>_helper<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>If <span class="free">B</span> <span class="free">T</span> <span class="free">E</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="main">⟩</span><span class="main">,</span>
    <span class="main">⟨</span><span class="keyword1">if</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="free">mem</span> <span class="free">B</span> <span class="keyword1">then</span> <span class="free">T</span> <span class="keyword1">else</span> <span class="free">E</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>
    <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⟨</span>If <span class="free">B</span> <span class="free">T</span> <span class="free">E</span> <span class="main">;;</span> <span class="free">TAIL</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="main">⟩</span><span class="main">,</span>
    <span class="main">⟨</span><span class="keyword1">if</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="free">mem</span> <span class="free">B</span> <span class="keyword1">then</span> <span class="free">T</span> <span class="main">;;</span> <span class="free">TAIL</span> <span class="keyword1">else</span> <span class="free">E</span> <span class="main">;;</span> <span class="free">TAIL</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> A.eval<span class="hidden">⇩</span><sub>w</sub>.seq
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> if_seq_eval<span class="hidden">⇩</span><sub>w</sub>_helper<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>If <span class="free">B</span> <span class="free">T</span> <span class="free">E</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="main">⟩</span><span class="main">,</span>
    <span class="main">⟨</span><span class="keyword1">if</span> <span class="free">ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem</span> <span class="free">B</span> <span class="keyword1">then</span> <span class="free">T</span> <span class="keyword1">else</span> <span class="free">E</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
    <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⟨</span>If <span class="free">B</span> <span class="free">T</span> <span class="free">E</span> <span class="main">;;</span> <span class="free">TAIL</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="main">⟩</span><span class="main">,</span>
    <span class="main">⟨</span><span class="keyword1">if</span> <span class="free">ev<span class="hidden">⇩</span><sub>B</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="free">mem</span> <span class="free">B</span> <span class="keyword1">then</span> <span class="free">T</span> <span class="main">;;</span> <span class="free">TAIL</span> <span class="keyword1">else</span> <span class="free">E</span> <span class="main">;;</span> <span class="free">TAIL</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">aexp<span class="hidden">⇩</span><sub>C</sub>_of</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">aexp<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">aexp<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Load <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">aexp<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">(</span>Add <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Add <span class="main">(</span><span class="free">aexp<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">aexp<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">aexp<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="main">(</span>Sub <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Sub <span class="main">(</span><span class="free">aexp<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">aexp<span class="hidden">⇩</span><sub>C</sub>_of</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mem_assign_refinement_helper_aexp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="main">(</span><span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span> <span class="main">:=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>aexp<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">=</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">:=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x<span class="hidden">⇩</span><sub>A</sub><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x<span class="hidden">⇩</span><sub>A</sub></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>aexp<span class="hidden">⇩</span><sub>C</sub>_of.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x<span class="hidden">⇩</span><sub>A</sub></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>aexp<span class="hidden">⇩</span><sub>C</sub>_of.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>aexp<span class="hidden">⇩</span><sub>C</sub>_of.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x<span class="hidden">⇩</span><sub>A</sub></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>aexp<span class="hidden">⇩</span><sub>C</sub>_of.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>aexp<span class="hidden">⇩</span><sub>C</sub>_of.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x<span class="hidden">⇩</span><sub>A</sub></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>aexp<span class="hidden">⇩</span><sub>C</sub>_of.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>aexp<span class="hidden">⇩</span><sub>C</sub>_of.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">rel_inv<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub> addr<span class="main">,</span> var<span class="hidden">⇩</span><sub>C</sub> aexp<span class="main">,</span> var<span class="hidden">⇩</span><sub>C</sub> bexp<span class="main">)</span> Stmt<span class="main">,</span> var<span class="hidden">⇩</span><sub>C</sub> addr<span class="main">,</span> val<span class="main">)</span> LocalConf<span class="main">)</span> rel"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  rel_inv<span class="hidden">⇩</span><sub>C</sub>_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     Skip <span class="main">;;</span>
     Skip <span class="main">;;</span>
     Assign reg0 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="main">=</span>
     Assign reg1 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span>
     Assign reg2 <span class="main">(</span>Load z_mem<span class="main">)</span> <span class="main">;;</span>
     Assign reg0 <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> <span class="free">rel_inv<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="main">|</span>
  rel_inv<span class="hidden">⇩</span><sub>C</sub>_1'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="main">=</span>
     Skip <span class="main">;;</span>
     Skip <span class="main">;;</span>
     Assign reg0 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     Assign reg1 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span>
     Assign reg2 <span class="main">(</span>Load z_mem<span class="main">)</span> <span class="main">;;</span>
     Assign reg0 <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> <span class="free">rel_inv<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="main">|</span>
  rel_inv<span class="hidden">⇩</span><sub>C</sub>_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     Stop <span class="main">;;</span>
     Skip <span class="main">;;</span>
     Assign reg0 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="main">=</span>
     Stop <span class="main">;;</span>
     Assign reg2 <span class="main">(</span>Load z_mem<span class="main">)</span> <span class="main">;;</span>
     Assign reg0 <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> <span class="free">rel_inv<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="main">|</span>
  rel_inv<span class="hidden">⇩</span><sub>C</sub>_2'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="main">=</span>
     Stop <span class="main">;;</span>
     Skip <span class="main">;;</span>
     Assign reg0 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     Stop <span class="main">;;</span>
     Assign reg2 <span class="main">(</span>Load z_mem<span class="main">)</span> <span class="main">;;</span>
     Assign reg0 <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> <span class="free">rel_inv<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="main">|</span>
  rel_inv<span class="hidden">⇩</span><sub>C</sub>_3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     Skip <span class="main">;;</span>
     Assign reg0 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="main">=</span>
     Assign reg2 <span class="main">(</span>Load z_mem<span class="main">)</span> <span class="main">;;</span>
     Assign reg0 <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> <span class="free">rel_inv<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="main">|</span>
  rel_inv<span class="hidden">⇩</span><sub>C</sub>_3'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="main">=</span>
     Skip <span class="main">;;</span>
     Assign reg0 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     Assign reg2 <span class="main">(</span>Load z_mem<span class="main">)</span> <span class="main">;;</span>
     Assign reg0 <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> <span class="free">rel_inv<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="main">|</span>
  rel_inv<span class="hidden">⇩</span><sub>C</sub>_4<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     Stop <span class="main">;;</span>
     Assign reg0 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="main">=</span>
     Stop <span class="main">;;</span>
     Assign reg0 <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> <span class="free">rel_inv<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="main">|</span>
  rel_inv<span class="hidden">⇩</span><sub>C</sub>_4'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="main">=</span>
     Stop <span class="main">;;</span>
     Assign reg0 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     Stop <span class="main">;;</span>
     Assign reg0 <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> <span class="free">rel_inv<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="main">|</span>
  rel_inv<span class="hidden">⇩</span><sub>C</sub>_5<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     Assign reg0 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="main">=</span>
     Assign reg0 <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> <span class="free">rel_inv<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="main">|</span>
  rel_inv<span class="hidden">⇩</span><sub>C</sub>_5'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="main">=</span>
     Assign reg0 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span>
     Assign reg0 <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> <span class="free">rel_inv<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="main">|</span>
  rel_inv<span class="hidden">⇩</span><sub>C</sub>_default<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem</span></span></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem'</span></span></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> <span class="free">rel_inv<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c'</span><span class="main">,</span> <span class="free">mds'</span><span class="main">,</span> <span class="free">mem'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_inv<span class="hidden">⇩</span><sub>C</sub>_sym<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sym rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sym_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rel_inv<span class="hidden">⇩</span><sub>C</sub>.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rel_inv<span class="hidden">⇩</span><sub>C</sub>.intros<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_inv<span class="hidden">⇩</span><sub>C</sub>_closed_glob_consistent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"C.closed_glob_consistent rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> C.closed_glob_consistent_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rel_inv<span class="hidden">⇩</span><sub>C</sub>.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> rel_inv<span class="hidden">⇩</span><sub>C</sub>.intros <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">RefRel_HighBranch</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>
    <span class="main">(</span><span class="main">(</span><span class="main">(</span>var<span class="main">,</span> var aexp<span class="main">,</span> var bexp<span class="main">)</span> Stmt <span class="main">×</span> <span class="main">(</span>Mode <span class="main">⇒</span> var set<span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span>var <span class="main">⇒</span> val<span class="main">)</span><span class="main">)</span> <span class="main">×</span>
     <span class="main">(</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub><span class="main">,</span> var<span class="hidden">⇩</span><sub>C</sub> aexp<span class="main">,</span> var<span class="hidden">⇩</span><sub>C</sub> bexp<span class="main">)</span> Stmt <span class="main">×</span> <span class="main">(</span>Mode <span class="main">⇒</span> var<span class="hidden">⇩</span><sub>C</sub> set<span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub> <span class="main">⇒</span> val<span class="main">)</span>
    <span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  acq_mode_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> ModeDecl Skip <span class="main">(</span>Acq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">SomeMode</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> ModeDecl Skip <span class="main">(</span>Acq <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">SomeMode</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>"</span></span> <span class="main">|</span>

  assign_load_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">←</span> aexp.Load <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">←</span> aexp.Load <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> GuarNoReadOrWrite<span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> GuarNoWrite<span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> GuarNoReadOrWrite<span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> 𝒞<span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∉</span> 𝒞<span class="main">;</span>
    <span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>"</span></span> <span class="main">|</span>

  assign_const_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">←</span> Const <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">←</span> Const <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> GuarNoReadOrWrite<span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> GuarNoWrite<span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> 𝒞<span class="main">;</span>
    <span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>"</span></span> <span class="main">|</span>

  if_reg_load_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>If <span class="main">(</span>Neq <span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_then</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_else</span></span></span><span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>reg3 <span class="main">←</span> <span class="main">(</span>Load <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span><span class="main">(</span>If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_then</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_else</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoWrite <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoReadOrWrite<span class="main">;</span>
    reg3 <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> GuarNoReadOrWrite <span class="main">∧</span> reg3 <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> GuarNoWrite<span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> GuarNoReadOrWrite<span class="main">;</span>
    <span class="main">∀</span><span class="bound">x'</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> 𝒞_vars <span class="bound">x'</span> <span class="main">⟶</span> <span class="bound">x'</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> GuarNoReadOrWrite<span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="comment1">― ‹The change in <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>mem<span class="hidden">⇩</span><sub>C</sub>›</span></span> does not affect <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>mem<span class="hidden">⇩</span><sub>A</sub>›</span></span>›</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">∧</span>
         <span class="comment1">― ‹The concrete and abstract versions of the bool condition must become consistent›</span>
         ev<span class="hidden">⇩</span><sub>B</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">(</span>Neq <span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
          <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="main">(</span>If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_then</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_else</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
          <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="main">(</span>If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_then</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_else</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span><span class="main">)</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>"</span></span> <span class="main">|</span>

  if_reg_stop_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>If <span class="main">(</span>Neq <span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_then</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_else</span></span></span><span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="main">(</span><span class="main">(</span>If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_then</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_else</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoWrite <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoReadOrWrite<span class="main">;</span>
    <span class="comment1">― ‹We will need to carry this through to the <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>if_reg_rel›</span></span> case.›</span>
    ev<span class="hidden">⇩</span><sub>B</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">(</span>Neq <span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="comment1">― ‹The change in <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>mem<span class="hidden">⇩</span><sub>C</sub>›</span></span> does not affect <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>mem<span class="hidden">⇩</span><sub>A</sub>›</span></span>›</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">∧</span>
         <span class="comment1">― ‹The concrete and abstract versions of the bool condition must remain consistent›</span>
         ev<span class="hidden">⇩</span><sub>B</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">(</span>Neq <span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
         ev<span class="hidden">⇩</span><sub>B</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">(</span>Neq <span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
          <span class="main">⟨</span><span class="main">(</span>If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_then</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_else</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
          <span class="main">⟨</span><span class="main">(</span>If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_then</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_else</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span><span class="main">)</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>"</span></span> <span class="main">|</span>

  if_reg_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>
    <span class="comment1">― ‹Is a more generic version possible for an arbitrary <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>b<span class="hidden">⇩</span><sub>A</sub>›</span></span>?›</span>
    <span class="comment1">⌦‹c<span class="hidden">⇩</span><sub>A</sub> = (If b<span class="hidden">⇩</span><sub>A</sub> c<span class="hidden">⇩</span><sub>A</sub>_then c<span class="hidden">⇩</span><sub>A</sub>_else);›</span>
    <span class="comment1">⌦‹b<span class="hidden">⇩</span><sub>A</sub> = Eq (Load x) (Const 0);›</span>  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>ev<span class="hidden">⇩</span><sub>B</sub> mem<span class="hidden">⇩</span><sub>A</sub> b<span class="hidden">⇩</span><sub>A</sub>›</span></span>›</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>If <span class="main">(</span>Neq <span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_then</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_else</span></span></span><span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_then</span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_else</span></span></span><span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoWrite <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoReadOrWrite<span class="main">;</span>
    <span class="comment1">― ‹The concrete and abstract versions of the bool condition must have remained consistent›</span>
    ev<span class="hidden">⇩</span><sub>B</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">(</span>Neq <span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="comment1">― ‹As for ― ‹if_reg_load_rel››</span>
    reg3 <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> GuarNoReadOrWrite <span class="main">∧</span> reg3 <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> GuarNoWrite<span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> GuarNoReadOrWrite<span class="main">;</span>
    <span class="main">∀</span><span class="bound">x'</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> 𝒞_vars <span class="bound">x'</span> <span class="main">⟶</span> <span class="bound">x'</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> GuarNoReadOrWrite<span class="main">;</span>
    <span class="comment1">― ‹As we would expect, the two branches must be related by the coupling invariant.›</span>
    <span class="main">∀</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span> <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_then</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_else</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
       <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
       <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
       ev<span class="hidden">⇩</span><sub>B</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">(</span>Neq <span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
       ev<span class="hidden">⇩</span><sub>B</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">(</span>Neq <span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
        <span class="main">⟨</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>ev<span class="hidden">⇩</span><sub>B</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">(</span>Neq <span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_then</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_else</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">∧</span>
       <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
        <span class="main">⟨</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>ev<span class="hidden">⇩</span><sub>B</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_then</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_else</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
       <span class="main">⟶</span>
       <span class="main">(</span><span class="main">⟨</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>ev<span class="hidden">⇩</span><sub>B</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">(</span>Neq <span class="main">(</span>Load <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_then</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_else</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
        <span class="main">⟨</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>ev<span class="hidden">⇩</span><sub>B</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_then</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_else</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span><span class="main">)</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>"</span></span> <span class="main">|</span>

<span class="comment1">(*
  Assign x_var (Load y_var)
    - to -
  Skip ;;
  Skip ;;
  Assign reg0 (Load y_mem) ;;
  Assign x_mem (Load reg0);
*)</span>
  if_then_rel_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>x_var <span class="main">←</span> Load y_var<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> Skip <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span> <span class="main">=</span>
     Skip <span class="main">;;</span>
     Assign reg0 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>"</span></span> <span class="main">|</span>

  if_then_rel_1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>x_var <span class="main">←</span> Load y_var<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span> <span class="main">=</span>
     Skip <span class="main">;;</span>
     Assign reg0 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>"</span></span> <span class="main">|</span>

  if_then_rel_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>x_var <span class="main">←</span> Load y_var<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> Skip <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span> <span class="main">=</span>
     Assign reg0 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>"</span></span> <span class="main">|</span>

  if_then_rel_2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>x_var <span class="main">←</span> Load y_var<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span> <span class="main">=</span>
     Assign reg0 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span>
     Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>"</span></span> <span class="main">|</span>

  if_then_rel_3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>x_var <span class="main">←</span> Load y_var<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> Assign reg0 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span> <span class="main">=</span> Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    y_var <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoWrite <span class="main">∧</span> y_var <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoReadOrWrite<span class="main">;</span>
    <span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="comment1">― ‹The value of <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>reg0›</span></span> and <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>y_var›</span></span> must now become consistent›</span>
         ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>Load reg0<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>"</span></span> <span class="main">|</span>

  if_then_rel_3'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>x_var <span class="main">←</span> Load y_var<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span> <span class="main">=</span> Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    y_var <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoWrite <span class="main">∧</span> y_var <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoReadOrWrite<span class="main">;</span>
    <span class="comment1">― ‹The value of <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>reg0›</span></span> and <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>y_var›</span></span> at this point must be consistent›</span>
    ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">(</span>Load reg0<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">(</span>Load y_var<span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="comment1">― ‹and must remain consistent›</span>
         ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>Load reg0<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">∧</span>
         ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">(</span>Load reg0<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>"</span></span> <span class="main">|</span>

  if_then_rel_4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>x_var <span class="main">←</span> Load y_var<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    y_var <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoWrite <span class="main">∧</span> y_var <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoReadOrWrite<span class="main">;</span>
    <span class="comment1">― ‹The value of <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>reg0›</span></span> and <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>y_var›</span></span> at this point must be consistent›</span>
    ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">(</span>Load reg0<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">(</span>Load y_var<span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span>Stop<span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>"</span></span> <span class="main">|</span>

<span class="comment1">(*
  Assign x_var (Add (Load y_var) (Load z_var))
    - to -
  Assign reg1 (Load y_mem) ;;
  Assign reg2 (Load z_mem) ;;
  Assign reg0 (Add (Load reg1) (Load reg2)) ;;
  Assign x_mem (Load reg0)
*)</span>
  if_else_rel_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>reg1 <span class="main">←</span> Load y_mem<span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span> <span class="main">=</span>
      Assign reg2 <span class="main">(</span>Load z_mem<span class="main">)</span> <span class="main">;;</span>
      Assign reg0 <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span>
      Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    y_var <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoWrite <span class="main">∧</span> y_var <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoReadOrWrite<span class="main">;</span>
    <span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="comment1">― ‹Now <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>reg1›</span></span> takes on <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>y_var›</span></span>›</span>
         ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>"</span></span> <span class="main">|</span>

  if_else_rel_1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span> <span class="main">=</span>
      Assign reg2 <span class="main">(</span>Load z_mem<span class="main">)</span> <span class="main">;;</span>
      Assign reg0 <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span>
      Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    y_var <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoWrite <span class="main">∧</span> y_var <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoReadOrWrite<span class="main">;</span>
    <span class="comment1">― ‹At this point <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>reg1›</span></span> contains <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>y_var›</span></span>›</span>
    ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">(</span>Load y_var<span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="comment1">― ‹maintain it›</span>
         ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">∧</span>
         ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>"</span></span> <span class="main">|</span>

  if_else_rel_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> Assign reg2 <span class="main">(</span>Load z_mem<span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span> <span class="main">=</span>
      Assign reg0 <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span>
      Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    y_var <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoWrite <span class="main">∧</span> y_var <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoReadOrWrite<span class="main">;</span>
    <span class="comment1">― ‹At this point <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>reg1›</span></span> contains <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>y_var›</span></span>›</span>
    ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">(</span>Load y_var<span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="comment1">― ‹maintain it›</span>
         ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">∧</span>
         ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">∧</span>
         <span class="comment1">― ‹Now <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>reg2›</span></span> takes on <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>z_var›</span></span>›</span>
         ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>Load reg2<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">(</span>Load z_var<span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>"</span></span> <span class="main">|</span>

  if_else_rel_2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span> <span class="main">=</span>
      Assign reg0 <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span>
      Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    y_var <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoWrite <span class="main">∧</span> y_var <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoReadOrWrite<span class="main">;</span>
    z_var <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoWrite <span class="main">∧</span> z_var <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoReadOrWrite<span class="main">;</span>
    <span class="comment1">― ‹At this point <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>reg1›</span></span> contains <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>y_var›</span></span> and <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>reg2›</span></span> contains z_var›</span>
    ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">(</span>Load y_var<span class="main">)</span><span class="main">;</span>
    ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">(</span>Load reg2<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="comment1">― ‹maintain it›</span>
         ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">∧</span>
         ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">(</span>Load reg2<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">(</span>Load z_var<span class="main">)</span> <span class="main">∧</span>
         ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">∧</span>
         ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>Load reg2<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">(</span>Load z_var<span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>"</span></span> <span class="main">|</span>

  if_else_rel_3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> Assign reg0 <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span> <span class="main">=</span> Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    y_var <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoWrite <span class="main">∧</span> y_var <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoReadOrWrite<span class="main">;</span>
    z_var <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoWrite <span class="main">∧</span> z_var <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoReadOrWrite<span class="main">;</span>
    <span class="comment1">― ‹At this point <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>reg1›</span></span> contains <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>y_var›</span></span> and <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>reg2›</span></span> contains <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>z_var›</span></span>›</span>
    ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">(</span>Load y_var<span class="main">)</span><span class="main">;</span>
    ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">(</span>Load reg2<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">∧</span>
         ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">(</span>Load reg2<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">(</span>Load z_var<span class="main">)</span> <span class="main">∧</span>
         <span class="comment1">― ‹Thus the value of <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>reg0›</span></span> becomes consistent with <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>y_var + z_var›</span></span>›</span>
         ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>Load reg0<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>"</span></span> <span class="main">|</span>

  if_else_rel_3'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span> <span class="main">=</span> Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    y_var <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoWrite <span class="main">∧</span> y_var <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoReadOrWrite<span class="main">;</span>
    z_var <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoWrite <span class="main">∧</span> z_var <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoReadOrWrite<span class="main">;</span>
    <span class="comment1">― ‹The value of <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>reg0›</span></span> and <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>y_var + z_var›</span></span> at this point must be consistent›</span>
    ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">(</span>Load reg0<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="comment1">― ‹and must remain consistent›</span>
         ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>Load reg0<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
         ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">(</span>Load reg0<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>"</span></span> <span class="main">|</span>

  if_else_rel_4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span> AsmNoReadOrWrite<span class="main">)</span><span class="main">;</span>
    y_var <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoWrite <span class="main">∧</span> y_var <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoReadOrWrite<span class="main">;</span>
    z_var <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoWrite <span class="main">∧</span> z_var <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> AsmNoReadOrWrite<span class="main">;</span>
    <span class="comment1">― ‹The value of <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>reg0›</span></span> and <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>y_var + z_var›</span></span> at this point must be consistent›</span>
    ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">(</span>Load reg0<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
        <span class="main">(</span>
         <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
         <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">∧</span>
         <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
        <span class="main">)</span>
         <span class="main">⟶</span>
         <span class="main">(</span><span class="main">⟨</span>Stop<span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="bound">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>
    <span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>"</span></span> <span class="main">|</span>

  stop_seq_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub>_tail</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span><span class="main">⟧</span>
    <span class="main">⟹</span>
    <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>"</span></span> <span class="main">|</span>

  stop_rel<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>Stop<span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mds<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">mem<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> <span class="free">RefRel_HighBranch</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> RefRelE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c'</span><span class="main">,</span> <span class="free">mds'</span><span class="main">,</span> <span class="free">mem'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">abs_steps'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">)</span> Stmt <span class="main">⇒</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">)</span> Stmt <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">abs_steps'</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">≡</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">m</span> <span class="bound">c<span class="hidden">⇩</span><sub>A</sub>_tail</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>Skip<span class="main">@[</span><span class="bound">x</span> <span class="keyword1">+=<span class="hidden">⇩</span><sub>m</sub></span> <span class="bound">m</span><span class="main">]</span><span class="main">)</span> <span class="main">;;</span> <span class="bound">c<span class="hidden">⇩</span><sub>A</sub>_tail</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">m</span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub>_tail</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>Skip<span class="main">@[</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">x</span> <span class="keyword1">+=<span class="hidden">⇩</span><sub>m</sub></span> <span class="bound">m</span><span class="main">]</span><span class="main">)</span> <span class="main">;;</span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub>_tail</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">c<span class="hidden">⇩</span><sub>A</sub>_tail</span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub>_tail</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>Stop <span class="main">;;</span> <span class="bound">c<span class="hidden">⇩</span><sub>A</sub>_tail</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>Stop <span class="main">;;</span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub>_tail</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span> <span class="bound">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">else<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span>
        <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="bound">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">else<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>reg3 <span class="main">←</span> Load <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="bound">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">else<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
         <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>Stop <span class="main">;;</span> Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="bound">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">else<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span>
        <span class="keyword1">then</span> <span class="main">0</span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>x_var <span class="main">←</span> Load y_var<span class="main">)</span> <span class="main">∧</span>
        <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">∈</span> <span class="main">{</span>Skip <span class="main">;;</span> Skip <span class="main">;;</span> Assign reg0 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span> Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">,</span>
              Stop <span class="main">;;</span> Skip <span class="main">;;</span> Assign reg0 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span> Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">,</span>
              Skip <span class="main">;;</span> Assign reg0 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span> Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">,</span>
              Stop <span class="main">;;</span> Assign reg0 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span> Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">,</span>
              Assign reg0 <span class="main">(</span>Load y_mem<span class="main">)</span> <span class="main">;;</span> Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">,</span>
              Stop <span class="main">;;</span> Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">}</span><span class="main">)</span>
        <span class="keyword1">then</span> <span class="main">0</span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
        <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span>reg1 <span class="main">←</span> Load y_mem<span class="main">)</span> <span class="main">;;</span> Assign reg2 <span class="main">(</span>Load z_mem<span class="main">)</span> <span class="main">;;</span>
                Assign reg0 <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span> Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">,</span>
              Stop <span class="main">;;</span> Assign reg2 <span class="main">(</span>Load z_mem<span class="main">)</span> <span class="main">;;</span>
                Assign reg0 <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span> Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">,</span>
              Assign reg2 <span class="main">(</span>Load z_mem<span class="main">)</span> <span class="main">;;</span>
                Assign reg0 <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span> Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">,</span>
              Stop <span class="main">;;</span>
                Assign reg0 <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span> Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">,</span>
              Assign reg0 <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span> Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">,</span>
              Stop <span class="main">;;</span> Assign x_mem <span class="main">(</span>Load reg0<span class="main">)</span><span class="main">}</span><span class="main">)</span>
        <span class="keyword1">then</span> <span class="main">0</span>
     <span class="keyword1">else</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">abs_steps</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">abs_steps</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span><span class="main">,</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span><span class="main">,</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> abs_steps' <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>A</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>C</sub></span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> closed_others_RefRel_HighBranch<span class="main">:</span>
  <span class="quoted"><span class="quoted">"closed_others RefRel_HighBranch"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> closed_others_def
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span>
<span class="keyword3"><span class="command">assume</span></span>
  in_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
    <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  vars<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>  dmas<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> dma<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span> <span class="main">≠</span> dma<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">¬</span> var_asm_not_written <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">from</span></span> in_rel vars dmas
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> RefRel_HighBranch.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>acq_mode_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">SomeMode</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> acq_mode_rel
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>RefRel_HighBranch.acq_mode_rel<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>assign_load_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assign_load_rel
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>RefRel_HighBranch.assign_load_rel<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>assign_const_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">z</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assign_const_rel
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>RefRel_HighBranch.assign_const_rel<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_load_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> if_reg_load_rel
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>RefRel_HighBranch.if_reg_load_rel<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_stop_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> if_reg_stop_rel
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> if_reg_stop_rel.hyps<span class="main">(</span>3<span class="main">,</span>5<span class="main">,</span>6<span class="main">)</span> if_reg_stop_rel.prems<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> reg_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> reg3 <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg3"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        x<span class="hidden">⇩</span><sub>C</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        x<span class="hidden">⇩</span><sub>A</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> reg_is_not_the_var<span class="hidden">⇩</span><sub>C</sub>_of_anything mem<span class="hidden">⇩</span><sub>A</sub>_of_def NoWrite<span class="hidden">⇩</span><sub>A</sub>_implies_NoWrite<span class="hidden">⇩</span><sub>C</sub>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>var_asm_not_written_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">with</span></span> if_reg_stop_rel.hyps
      <span class="keyword1"><span class="command">have</span></span> conds_still_match<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg3 <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">with</span></span> if_reg_stop_rel RefRel_HighBranch.if_reg_stop_rel
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
             <span class="main">⟨</span>Stop <span class="main">;;</span> Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
             <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> if_reg_rel<span class="main">(</span>1-11<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> if_reg_rel.hyps<span class="main">(</span>3<span class="main">,</span>5<span class="main">,</span>6<span class="main">)</span> if_reg_rel.prems<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> reg_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> reg3 <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg3"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        x<span class="hidden">⇩</span><sub>C</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        x<span class="hidden">⇩</span><sub>A</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">x</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> reg_is_not_the_var<span class="hidden">⇩</span><sub>C</sub>_of_anything mem<span class="hidden">⇩</span><sub>A</sub>_of_def NoWrite<span class="hidden">⇩</span><sub>A</sub>_implies_NoWrite<span class="hidden">⇩</span><sub>C</sub>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>var_asm_not_written_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">with</span></span> if_reg_rel.hyps
      <span class="keyword1"><span class="command">have</span></span> conds_still_match<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg3 <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
             <span class="main">⟨</span>Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
             <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> RefRel_HighBranch.if_reg_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> if_reg_rel <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
           <span class="keyword1"><span class="command">using</span></span> if_reg_rel <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">using</span></span> conds_still_match <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
         <span class="keyword1"><span class="command">using</span></span> if_reg_rel <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_then_rel_1 <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> if_then_rel_1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>RefRel_HighBranch.if_then_rel_1<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_then_rel_1' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> if_then_rel_1'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>RefRel_HighBranch.if_then_rel_1'<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_then_rel_2 <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> if_then_rel_2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>RefRel_HighBranch.if_then_rel_2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_then_rel_2' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> if_then_rel_2'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>RefRel_HighBranch.if_then_rel_2'<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_then_rel_3 <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> if_then_rel_3
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>RefRel_HighBranch.if_then_rel_3<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_then_rel_3' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> if_then_rel_3'
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> if_then_rel_3'.hyps<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> if_then_rel_3'.prems<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> reg_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> reg0 <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg0"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        y<span class="hidden">⇩</span><sub>C</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of y_var<span class="main">)</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of y_var<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        y<span class="hidden">⇩</span><sub>A</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> y_var <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> y_var"</span></span>
        <span class="keyword1"><span class="command">using</span></span> reg_is_not_the_var<span class="hidden">⇩</span><sub>C</sub>_of_anything mem<span class="hidden">⇩</span><sub>A</sub>_of_def NoWrite<span class="hidden">⇩</span><sub>A</sub>_implies_NoWrite<span class="hidden">⇩</span><sub>C</sub> var_asm_not_written_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">with</span></span> if_then_rel_3'.hyps
      <span class="keyword1"><span class="command">have</span></span> conds_still_match<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg0 <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> y_var"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>x_var <span class="main">←</span> Load y_var<span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
             <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="main">(</span>x_mem <span class="main">←</span> Load reg0<span class="main">)</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
             <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command">using</span></span> RefRel_HighBranch.if_then_rel_3' if_then_rel_3' conds_still_match <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_then_rel_4 <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> if_then_rel_4
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> if_then_rel_4.hyps<span class="main">(</span>3-7<span class="main">)</span> if_then_rel_4.prems<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> reg_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> reg0 <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg0"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        y<span class="hidden">⇩</span><sub>C</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of y_var<span class="main">)</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of y_var<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        y<span class="hidden">⇩</span><sub>A</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> y_var <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> y_var"</span></span>
        <span class="keyword1"><span class="command">using</span></span> reg_is_not_the_var<span class="hidden">⇩</span><sub>C</sub>_of_anything mem<span class="hidden">⇩</span><sub>A</sub>_of_def NoWrite<span class="hidden">⇩</span><sub>A</sub>_implies_NoWrite<span class="hidden">⇩</span><sub>C</sub> var_asm_not_written_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> if_then_rel_4.hyps
      <span class="keyword1"><span class="command">have</span></span> conds_still_match<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg0 <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> y_var"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>x_var <span class="main">←</span> Load y_var<span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
             <span class="main">⟨</span>x_mem <span class="main">←</span> Load reg0<span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
             <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command">using</span></span> RefRel_HighBranch.if_then_rel_4 if_then_rel_4 conds_still_match <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_else_rel_1 <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> if_else_rel_1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>RefRel_HighBranch.if_else_rel_1<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_else_rel_1' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> if_else_rel_1'
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> if_else_rel_1'.hyps<span class="main">(</span>4-7<span class="main">)</span> if_else_rel_1'.prems<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> reg_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> reg1 <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg1"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        y<span class="hidden">⇩</span><sub>C</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of y_var<span class="main">)</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of y_var<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        y<span class="hidden">⇩</span><sub>A</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> y_var <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> y_var"</span></span>
        <span class="keyword1"><span class="command">using</span></span> reg_is_not_the_var<span class="hidden">⇩</span><sub>C</sub>_of_anything mem<span class="hidden">⇩</span><sub>A</sub>_of_def NoWrite<span class="hidden">⇩</span><sub>A</sub>_implies_NoWrite<span class="hidden">⇩</span><sub>C</sub> var_asm_not_written_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> insertCI reg_not_visible_abs<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> if_else_rel_1'.hyps
      <span class="keyword1"><span class="command">have</span></span> conds_still_match<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg1 <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> y_var"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
             <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="main">(</span>reg2 <span class="main">←</span> Load z_mem<span class="main">)</span> <span class="main">;;</span> <span class="main">(</span>reg0 <span class="main">←</span> Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span>x_mem <span class="main">←</span> Load reg0<span class="main">)</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
             <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command">using</span></span> RefRel_HighBranch.if_else_rel_1' if_else_rel_1' conds_still_match <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_else_rel_2 <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> if_else_rel_2
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> if_else_rel_2.hyps<span class="main">(</span>4-7<span class="main">)</span> if_else_rel_2.prems<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> reg_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> reg1 <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg1"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        y<span class="hidden">⇩</span><sub>C</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of y_var<span class="main">)</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of y_var<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        y<span class="hidden">⇩</span><sub>A</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> y_var <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> y_var"</span></span>
        <span class="keyword1"><span class="command">using</span></span> reg_is_not_the_var<span class="hidden">⇩</span><sub>C</sub>_of_anything mem<span class="hidden">⇩</span><sub>A</sub>_of_def NoWrite<span class="hidden">⇩</span><sub>A</sub>_implies_NoWrite<span class="hidden">⇩</span><sub>C</sub> var_asm_not_written_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> insertCI reg_not_visible_abs<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> if_else_rel_2.hyps
      <span class="keyword1"><span class="command">have</span></span> conds_still_match<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg1 <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> y_var"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
             <span class="main">⟨</span><span class="main">(</span>reg2 <span class="main">←</span> Load z_mem<span class="main">)</span> <span class="main">;;</span> <span class="main">(</span>reg0 <span class="main">←</span> Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span>x_mem <span class="main">←</span> Load reg0<span class="main">)</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
             <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command">using</span></span> RefRel_HighBranch.if_else_rel_2 if_else_rel_2 conds_still_match <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_else_rel_2' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> if_else_rel_2'
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> if_else_rel_2'.hyps<span class="main">(</span>4-8<span class="main">)</span> if_else_rel_2'.prems<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> regs_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> reg1 <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg1 <span class="main">∧</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> reg2 <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg2"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        y<span class="hidden">⇩</span><sub>C</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of y_var<span class="main">)</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of y_var<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        y<span class="hidden">⇩</span><sub>A</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> y_var <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> y_var"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        z<span class="hidden">⇩</span><sub>C</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of z_var<span class="main">)</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of z_var<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        z<span class="hidden">⇩</span><sub>A</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> z_var <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> z_var"</span></span>
        <span class="keyword1"><span class="command">using</span></span> reg_is_not_the_var<span class="hidden">⇩</span><sub>C</sub>_of_anything mem<span class="hidden">⇩</span><sub>A</sub>_of_def NoWrite<span class="hidden">⇩</span><sub>A</sub>_implies_NoWrite<span class="hidden">⇩</span><sub>C</sub> var_asm_not_written_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> insertCI reg_not_visible_abs<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> if_else_rel_2'.hyps<span class="main">(</span>5<span class="main">,</span>9<span class="main">,</span>10<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> conds_still_match<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg1 <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> y_var <span class="main">∧</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg2 <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> z_var"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
             <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="main">(</span>reg0 <span class="main">←</span> Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span>x_mem <span class="main">←</span> Load reg0<span class="main">)</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
             <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command">using</span></span> RefRel_HighBranch.if_else_rel_2' if_else_rel_2' conds_still_match <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_else_rel_3 <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> if_else_rel_3
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> if_else_rel_3.hyps<span class="main">(</span>4-8<span class="main">)</span> if_else_rel_3.prems<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> regs_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> reg1 <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg1 <span class="main">∧</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> reg2 <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg2"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        y<span class="hidden">⇩</span><sub>C</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of y_var<span class="main">)</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of y_var<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        y<span class="hidden">⇩</span><sub>A</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> y_var <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> y_var"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        z<span class="hidden">⇩</span><sub>C</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of z_var<span class="main">)</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of z_var<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        z<span class="hidden">⇩</span><sub>A</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> z_var <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> z_var"</span></span>
        <span class="keyword1"><span class="command">using</span></span> reg_is_not_the_var<span class="hidden">⇩</span><sub>C</sub>_of_anything mem<span class="hidden">⇩</span><sub>A</sub>_of_def NoWrite<span class="hidden">⇩</span><sub>A</sub>_implies_NoWrite<span class="hidden">⇩</span><sub>C</sub> var_asm_not_written_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> insertCI reg_not_visible_abs<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> if_else_rel_3.hyps<span class="main">(</span>5<span class="main">,</span>9<span class="main">,</span>10<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> conds_still_match<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg1 <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> y_var <span class="main">∧</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg2 <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> z_var"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
             <span class="main">⟨</span><span class="main">(</span>reg0 <span class="main">←</span> Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span>x_mem <span class="main">←</span> Load reg0<span class="main">)</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
             <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command">using</span></span> RefRel_HighBranch.if_else_rel_3 if_else_rel_3 conds_still_match <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_else_rel_3' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> if_else_rel_3'
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> if_else_rel_3'.hyps<span class="main">(</span>4-8<span class="main">)</span> if_else_rel_3'.prems<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> reg_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> reg0 <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg0"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        y<span class="hidden">⇩</span><sub>C</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of y_var<span class="main">)</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of y_var<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        y<span class="hidden">⇩</span><sub>A</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> y_var <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> y_var"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        z<span class="hidden">⇩</span><sub>C</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of z_var<span class="main">)</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of z_var<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        z<span class="hidden">⇩</span><sub>A</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> z_var <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> z_var"</span></span>
        <span class="keyword1"><span class="command">using</span></span> reg_is_not_the_var<span class="hidden">⇩</span><sub>C</sub>_of_anything mem<span class="hidden">⇩</span><sub>A</sub>_of_def NoWrite<span class="hidden">⇩</span><sub>A</sub>_implies_NoWrite<span class="hidden">⇩</span><sub>C</sub> var_asm_not_written_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> insertCI reg_not_visible_abs<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> if_else_rel_3'.hyps<span class="main">(</span>5<span class="main">,</span>9<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> conds_still_match<span class="main">:</span>
        <span class="quoted"><span class="quoted">"ev<span class="hidden">⇩</span><sub>A</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>Load reg0<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span> <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
             <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="main">(</span>x_mem <span class="main">←</span> Load reg0<span class="main">)</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
             <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command">using</span></span> RefRel_HighBranch.if_else_rel_3' if_else_rel_3' conds_still_match <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_else_rel_4 <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> if_else_rel_4
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> if_else_rel_4.hyps<span class="main">(</span>3-7<span class="main">)</span> if_else_rel_4.prems<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> reg_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> reg0 <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> reg0"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        y<span class="hidden">⇩</span><sub>C</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of y_var<span class="main">)</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of y_var<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        y<span class="hidden">⇩</span><sub>A</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> y_var <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> y_var"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        z<span class="hidden">⇩</span><sub>C</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of z_var<span class="main">)</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of z_var<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        z<span class="hidden">⇩</span><sub>A</sub>_untouched<span class="main">:</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> z_var <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> z_var"</span></span>
        <span class="keyword1"><span class="command">using</span></span> reg_is_not_the_var<span class="hidden">⇩</span><sub>C</sub>_of_anything mem<span class="hidden">⇩</span><sub>A</sub>_of_def NoWrite<span class="hidden">⇩</span><sub>A</sub>_implies_NoWrite<span class="hidden">⇩</span><sub>C</sub> var_asm_not_written_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> insertCI reg_not_visible_abs<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> if_else_rel_4.hyps<span class="main">(</span>4<span class="main">,</span>8<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> conds_still_match<span class="main">:</span>
        <span class="quoted"><span class="quoted">"ev<span class="hidden">⇩</span><sub>A</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">(</span>Load reg0<span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span> <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
             <span class="main">⟨</span><span class="main">(</span>x_mem <span class="main">←</span> Load reg0<span class="main">)</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
             <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command">using</span></span> RefRel_HighBranch.if_else_rel_4 if_else_rel_4 conds_still_match <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>stop_seq_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stop_seq_rel
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>RefRel_HighBranch.stop_seq_rel<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>stop_rel <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>RefRel_HighBranch.stop_rel<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preserves_modes_mem_RefRel_HighBranch<span class="main">:</span>
  <span class="quoted"><span class="quoted">"preserves_modes_mem RefRel_HighBranch"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> preserves_modes_mem_def2
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span>
  <span class="keyword3"><span class="command">assume</span></span> in_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>RefRel_HighBranch.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> new_vars_private_RefRel_HighBranch<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sifum_refinement.new_vars_private dma<span class="hidden">⇩</span><sub>C</sub> C.eval<span class="hidden">⇩</span><sub>w</sub> var<span class="hidden">⇩</span><sub>C</sub>_of RefRel_HighBranch"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> new_vars_private_def
<span class="comment1">(* Slightly more intuitive goals without simp converting ∨ to ⟶ *)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span>
  <span class="keyword3"><span class="command">assume</span></span> in_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      does_eval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="quoted"><span class="quoted">"<span class="var">?diff_mem</span> <span class="free">v<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="free">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≠</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="quoted"><span class="quoted">"<span class="var">?diff_dma</span> <span class="free">v<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"dma<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="free">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">&lt;</span> dma<span class="hidden">⇩</span><sub>C</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">v<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="quoted"><span class="quoted">"<span class="var">?conc_only</span> <span class="free">v<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="main">(</span><span class="var">?diff_mem</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span> <span class="var">?diff_dma</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∧</span> <span class="var">?conc_only</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span> AsmNoReadOrWrite<span class="main">)</span> <span class="main">∧</span>
         <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoReadOrWrite <span class="main">-</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⊆</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span> AsmNoReadOrWrite <span class="main">-</span> range var<span class="hidden">⇩</span><sub>C</sub>_of"</span></span>
  <span class="keyword1"><span class="command">using</span></span> in_rel does_eval
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>RefRel_HighBranch.cases<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>acq_mode_rel <span class="skolem">x</span> <span class="skolem">SomeMode</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> does_eval
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="skolem">SomeMode</span> <span class="main">:=</span> insert <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">SomeMode</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> C.seq_decl_elim C.update_modes.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>assign_load_rel <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C.assign_elim C.seq_elim Stmt.distinct<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> set_eq_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>assign_const_rel <span class="skolem">x</span> <span class="skolem">z</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C.assign_elim C.seq_elim Stmt.distinct<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> set_eq_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_load_rel <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C.assign_elim C.seq_elim Stmt.distinct<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> set_eq_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_stop_rel <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C.seq_stop_elim subset_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_rel <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword1"><span class="command">have</span></span> mds<span class="hidden">⇩</span><sub>C</sub>_unchanged<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C.if_elim C.seq_elim Stmt.distinct<span class="main"><span class="main">(</span></span>39<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> if_reg_rel<span class="main">(</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="main">(</span><span class="var">?diff_mem</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span> <span class="var">?diff_dma</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∧</span> <span class="var">?conc_only</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span> AsmNoReadOrWrite"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> mds<span class="hidden">⇩</span><sub>C</sub>_unchanged
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> AsmNoReadOrWrite <span class="main">-</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⊆</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub>'</span> AsmNoReadOrWrite <span class="main">-</span> range var<span class="hidden">⇩</span><sub>C</sub>_of"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarify</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_then_rel_1 <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq C.eval_det C.seq_stop_elim C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub> C.skip_eval<span class="hidden">⇩</span><sub>w</sub> subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_then_rel_1' <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> C.seq_stop_elim subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_then_rel_2 <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq C.eval_det C.seq_stop_elim C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub> C.skip_eval<span class="hidden">⇩</span><sub>w</sub> subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_then_rel_2' <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> C.seq_stop_elim subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_then_rel_3 <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> C.seq_assign_elim subset_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_then_rel_3' <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> C.seq_stop_elim subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_then_rel_4<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C.assign_elim order_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_else_rel_1 <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> C.seq_assign_elim subset_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_else_rel_1' <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> C.seq_stop_elim subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_else_rel_2 <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> C.seq_assign_elim subset_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_else_rel_2' <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> C.seq_stop_elim subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_else_rel_3 <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> C.seq_assign_elim subset_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_else_rel_3' <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> C.seq_stop_elim subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_else_rel_4<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C.assign_elim order_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>stop_seq_rel <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval C.seq_stop_elim
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>stop_rel<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> does_eval C.stop_no_eval <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> inR_E<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c'</span><span class="main">,</span> <span class="free">mds'</span><span class="main">,</span> <span class="free">mem'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> refrel_helper_Acq_Rel_ex1I<span class="main">:</span>
<span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">⟨</span><span class="main">(</span>Skip<span class="main">@[</span><span class="free">x</span> <span class="keyword1">+=<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">SomeMode</span><span class="main">]</span><span class="main">)</span> <span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>A</sub>_tail</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
      <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
     <span class="main">∈</span> RefRel_HighBranch
  <span class="main">⟹</span>
  <span class="main">∃!</span><span class="bound">c<span class="hidden">⇩</span><sub>C</sub>_tail</span><span class="main">.</span>
  <span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span>Skip<span class="main">@[</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span> <span class="keyword1">+=<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">SomeMode</span><span class="main">]</span><span class="main">)</span> <span class="main">;;</span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub>_tail</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">(</span><span class="main">⟨</span><span class="main">(</span>Skip<span class="main">@[</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span> <span class="keyword1">+=<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">SomeMode</span><span class="main">]</span><span class="main">)</span> <span class="main">;;</span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub>_tail</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
          <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="bound">c<span class="hidden">⇩</span><sub>C</sub>_tail</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="free">SomeMode</span> <span class="main">:=</span> insert <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">SomeMode</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
          <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>RefRel_HighBranch.cases<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="free">SomeMode</span> <span class="main">:=</span> insert <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">SomeMode</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> HOL.refl<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> A.eval<span class="hidden">⇩</span><sub>w</sub>.seq<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> A.decl_eval<span class="hidden">⇩</span><sub>w</sub>'<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> HOL.refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> mode_acquire_refinement_helper<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> C.decl_eval<span class="hidden">⇩</span><sub>w</sub>'<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> HOL.refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ex1I<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> C.decl_eval<span class="hidden">⇩</span><sub>w</sub>'<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> HOL.refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> refrel_helper_Assign_Load_ex1I<span class="main">:</span>
<span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">⟨</span><span class="main">(</span><span class="free">x</span> <span class="main">←</span> Load <span class="free">y</span><span class="main">)</span> <span class="main">;;</span> <span class="free">tail<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
      <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
     <span class="main">∈</span> RefRel_HighBranch
  <span class="main">⟹</span>
  <span class="main">∃!</span><span class="bound">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span>
  <span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span> <span class="main">←</span> Load <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="bound">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">(</span><span class="main">⟨</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span> <span class="main">←</span> Load <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="bound">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
          <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="bound">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span><span class="main">)</span> <span class="main">:=</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
          <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>RefRel_HighBranch.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span><span class="main">)</span> <span class="main">:=</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> HOL.refl<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> A.eval<span class="hidden">⇩</span><sub>w</sub>.seq<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>A</sub> mem_assign_refinement_helper_var<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ex1I<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>A</sub> mem_assign_refinement_helper_var<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ex1I<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ex1I<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> refrel_helper_Assign_Const_ex1I<span class="main">:</span>
<span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">⟨</span><span class="main">(</span><span class="free">x</span> <span class="main">←</span> Const <span class="free">z</span><span class="main">)</span> <span class="main">;;</span> <span class="free">tail<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
      <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
     <span class="main">∈</span> RefRel_HighBranch
  <span class="main">⟹</span>
  <span class="main">∃!</span><span class="bound">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span>
  <span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span> <span class="main">←</span> Const <span class="free">z</span><span class="main">)</span> <span class="main">;;</span> <span class="bound">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">(</span><span class="main">⟨</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span> <span class="main">←</span> Const <span class="free">z</span><span class="main">)</span> <span class="main">;;</span> <span class="bound">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
          <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="bound">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span><span class="main">)</span> <span class="main">:=</span> <span class="free">z</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
          <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>RefRel_HighBranch.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span><span class="main">)</span> <span class="main">:=</span> <span class="free">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> HOL.refl<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> A.eval<span class="hidden">⇩</span><sub>w</sub>.seq<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assign_eval<span class="hidden">⇩</span><sub>w</sub>_const<span class="hidden">⇩</span><sub>A</sub> mem_assign_refinement_helper_const<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>assign_eval<span class="hidden">⇩</span><sub>w</sub>_const<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ex1I<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>assign_eval<span class="hidden">⇩</span><sub>w</sub>_const<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>A</sub> mem_assign_refinement_helper_var<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>assign_eval<span class="hidden">⇩</span><sub>w</sub>_const<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">c<span class="hidden">⇩</span><sub>C</sub>_tail</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ex1I<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>assign_eval<span class="hidden">⇩</span><sub>w</sub>_const<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ex1I<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(* Could possibly be useful if we have one that just does seq *)</span>
<span class="keyword1"><span class="command">lemma</span></span> refrel_helper_Assign_Const<span class="main">:</span>
<span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">⟨</span><span class="main">(</span><span class="free">x</span> <span class="main">←</span> Const <span class="free">z</span><span class="main">)</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
      <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
     <span class="main">∈</span> RefRel_HighBranch
  <span class="main">⟹</span>
  <span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span> <span class="main">←</span> Const <span class="free">z</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">(</span><span class="main">⟨</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span> <span class="main">←</span> Const <span class="free">z</span><span class="main">)</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
          <span class="main">⟨</span>Stop<span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span><span class="main">)</span> <span class="main">:=</span> <span class="free">z</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
          <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>RefRel_HighBranch.cases<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>assign_eval<span class="hidden">⇩</span><sub>w</sub>_const<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">type_synonym</span></span> t_Neq_C <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub> aexp <span class="main">⇒</span> var<span class="hidden">⇩</span><sub>C</sub> aexp <span class="main">⇒</span> var<span class="hidden">⇩</span><sub>C</sub> bexp<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> refrel_helper_If_Reg_Load_exI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"
  <span class="free">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span>reg3 <span class="main">←</span> Load <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> Stmt.If <span class="main">(</span><span class="main">(</span>Neq<span class="main">::</span>t_Neq_C<span class="main">)</span> <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">else<span class="hidden">⇩</span><sub>C</sub></span>
  <span class="main">⟹</span>
  <span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> If <span class="main">(</span>Neq <span class="main">(</span>Load <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">else<span class="hidden">⇩</span><sub>A</sub></span>
  <span class="main">⟹</span>
  <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
    <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
   <span class="main">∈</span> RefRel_HighBranch
  <span class="main">⟹</span>
  A.neval
     <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span>
     <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>
  <span class="main">⟹</span>
  <span class="comment1">― ‹Distinguish between the different concrete cases›</span>
  <span class="comment1">― ‹for which the abstract program remains the same.›</span>
  <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>
  <span class="main">⟹</span>
  <span class="main">∃</span><span class="bound">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
  <span class="main">(</span><span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span>reg3 <span class="main">←</span> Load <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> Stmt.If <span class="main">(</span><span class="main">(</span>Neq<span class="main">::</span>t_Neq_C<span class="main">)</span> <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="bound">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span>
 <span class="main">∧</span>
   <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
    <span class="main">⟨</span>Stop <span class="main">;;</span> Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="bound">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg3 <span class="main">:=</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
     <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>RefRel_HighBranch.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg3 <span class="main">:=</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conc_only_var_assign_not_visible_abs reg_not_visible_abs<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> refrel_helper_If_Reg_Stop_exI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"
  <span class="free">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Stop <span class="main">;;</span> Stmt.If <span class="main">(</span><span class="main">(</span>Neq<span class="main">::</span>t_Neq_C<span class="main">)</span> <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">else<span class="hidden">⇩</span><sub>C</sub></span>
  <span class="main">⟹</span>
  <span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> If <span class="main">(</span>Neq <span class="main">(</span>Load <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">else<span class="hidden">⇩</span><sub>A</sub></span>
  <span class="main">⟹</span>
  <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
    <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
   <span class="main">∈</span> RefRel_HighBranch
  <span class="main">⟹</span>
  A.neval
     <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span>
     <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>
  <span class="main">⟹</span>
  <span class="comment1">― ‹Distinguish between concrete cases for which abstract program remains the same.›</span>
  <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>
  <span class="main">⟹</span>
  <span class="main">∃</span><span class="bound">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
  <span class="main">(</span><span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Stop <span class="main">;;</span> Stmt.If <span class="main">(</span><span class="main">(</span>Neq<span class="main">::</span>t_Neq_C<span class="main">)</span> <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="bound">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span>
 <span class="main">∧</span>
   <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
    <span class="main">⟨</span>Stmt.If <span class="main">(</span><span class="main">(</span>Neq<span class="main">::</span>t_Neq_C<span class="main">)</span> <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="bound">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
     <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>RefRel_HighBranch.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> refrel_helper_If_Reg_exI<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  conds_match<span class="main">:</span> <span class="quoted"><span class="quoted">"ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">(</span>sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">(</span>Neq <span class="main">(</span>Load <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    ev<span class="hidden">⇩</span><sub>B</sub> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="main">(</span>Neq<span class="main">::</span>t_Neq_C<span class="main">)</span> <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  rest_assms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Stmt.If <span class="main">(</span><span class="main">(</span>Neq<span class="main">::</span>t_Neq_C<span class="main">)</span> <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
  <span class="comment1">― ‹Distinguish between concrete cases for which abstract program remains the same.›</span>
  <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
<span class="quoted"><span class="quoted">"
  <span class="main">∃</span><span class="bound">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
  <span class="main">(</span><span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Stmt.If <span class="main">(</span><span class="main">(</span>Neq<span class="main">::</span>t_Neq_C<span class="main">)</span> <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="bound">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span>
 <span class="main">∧</span>
   <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
    <span class="main">⟨</span><span class="keyword1">if</span> <span class="main">(</span>ev<span class="hidden">⇩</span><sub>B</sub> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span><span class="main">(</span>Neq<span class="main">::</span>t_Neq_C<span class="main">)</span> <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="bound">then<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="bound">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span><span class="main">,</span>
                  <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
     <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>
<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rest_assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>ev<span class="hidden">⇩</span><sub>B</sub>.simps <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>ev<span class="hidden">⇩</span><sub>B</sub>.simps <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> C.if_eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> Skip_tail_RefRel_HighBranchE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>Skip <span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>A</sub>_tail</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span>Skip <span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>C</sub>_tail</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
<span class="keyword1"><span class="command">thm</span></span> Skip_tail_RefRel_HighBranchE

<span class="keyword1"><span class="command">inductive_cases</span></span> Stop_tail_RefRel_HighBranchE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>A</sub>_tail</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="main">⟩</span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>C</sub>_tail</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">⟩</span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
<span class="keyword1"><span class="command">thm</span></span> Stop_tail_RefRel_HighBranchE

<span class="keyword1"><span class="command">inductive_cases</span></span> Acq_Mode_RefRel_HighBranchE<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="main">(</span>Skip<span class="main">@[</span><span class="free">x</span> <span class="keyword1">+=<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">SomeMode</span><span class="main">]</span><span class="main">)</span> <span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>A</sub>_tail</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
  <span class="main">⟨</span><span class="main">(</span>Skip<span class="main">@[</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span> <span class="keyword1">+=<span class="hidden">⇩</span><sub>m</sub></span> <span class="free">SomeMode</span><span class="main">]</span><span class="main">)</span> <span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>C</sub>_tail</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
<span class="keyword1"><span class="command">thm</span></span> Acq_Mode_RefRel_HighBranchE

<span class="keyword1"><span class="command">inductive_cases</span></span> Assign_Load_RefRel_HighBranchE<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="main">(</span><span class="free">x</span> <span class="main">←</span> aexp.Load <span class="free">y</span><span class="main">)</span> <span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>A</sub>_tail</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
  <span class="main">⟨</span><span class="main">(</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span><span class="main">)</span> <span class="main">←</span> Load <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>C</sub>_tail</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
<span class="keyword1"><span class="command">thm</span></span> Assign_Load_RefRel_HighBranchE

<span class="keyword1"><span class="command">inductive_cases</span></span> Assign_Const_RefRel_HighBranchE<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="main">(</span><span class="free">x</span> <span class="main">←</span> Const <span class="free">z</span><span class="main">)</span> <span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>A</sub>_tail</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
  <span class="main">⟨</span><span class="main">(</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">x</span><span class="main">)</span> <span class="main">←</span> Const <span class="free">z</span><span class="main">)</span> <span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>C</sub>_tail</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
<span class="keyword1"><span class="command">thm</span></span> Assign_Const_RefRel_HighBranchE

<span class="keyword1"><span class="command">inductive_cases</span></span> If_Reg_Load_RefRel_HighBranchE<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="main">(</span>If <span class="main">(</span>Neq <span class="main">(</span>Load <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>A</sub>_then</span> <span class="free">c<span class="hidden">⇩</span><sub>A</sub>_else</span><span class="main">)</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
  <span class="main">⟨</span><span class="main">(</span>reg3 <span class="main">←</span> Load <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span><span class="main">(</span>If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>C</sub>_then</span> <span class="free">c<span class="hidden">⇩</span><sub>C</sub>_else</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
<span class="keyword1"><span class="command">thm</span></span> If_Reg_Load_RefRel_HighBranchE

<span class="keyword1"><span class="command">inductive_cases</span></span> If_Reg_Stop_RefRel_HighBranchE<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="main">(</span>If <span class="main">(</span>Neq <span class="main">(</span>Load <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>A</sub>_then</span> <span class="free">c<span class="hidden">⇩</span><sub>A</sub>_else</span><span class="main">)</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
  <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="main">(</span><span class="main">(</span>If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>C</sub>_then</span> <span class="free">c<span class="hidden">⇩</span><sub>C</sub>_else</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
<span class="keyword1"><span class="command">thm</span></span> If_Reg_Stop_RefRel_HighBranchE

<span class="keyword1"><span class="command">inductive_cases</span></span> If_Reg_RefRel_HighBranchE<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="main">(</span>If <span class="main">(</span>Neq <span class="main">(</span>Load <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>A</sub>_then</span> <span class="free">c<span class="hidden">⇩</span><sub>A</sub>_else</span><span class="main">)</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
  <span class="main">⟨</span><span class="main">(</span><span class="main">(</span>If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>C</sub>_then</span> <span class="free">c<span class="hidden">⇩</span><sub>C</sub>_else</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
<span class="keyword1"><span class="command">thm</span></span> If_Reg_RefRel_HighBranchE

<span class="keyword1"><span class="command">inductive_cases</span></span> If_Then_RefRel_HighBranchE<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="main">(</span>x_var <span class="main">←</span> Load y_var<span class="main">)</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="main">∈</span> RefRel_HighBranch"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> If_Else_RefRel_HighBranchE<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="main">(</span>x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="main">∈</span> RefRel_HighBranch"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> inv<span class="hidden">⇩</span><sub>5</sub>E<span class="main">:</span>
<span class="quoted"><span class="quoted">"A.inv <span class="main">⟨</span>Assign x_var <span class="main">(</span>Load y_var<span class="main">)</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="main">⟩</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> inv<span class="hidden">⇩</span><sub>6</sub>E<span class="main">:</span>
<span class="quoted"><span class="quoted">"A.inv <span class="main">⟨</span>Assign x_var <span class="main">(</span>Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">mds</span><span class="main">,</span> <span class="free">mem</span><span class="main">⟩</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> induction_full_RefRel_HighBranch<span class="main">:</span>
  <span class="keyword2"><span class="keyword">notes</span></span> neq0_conv<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> neq0_conv<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
         <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
        <span class="main">∈</span> RefRel_HighBranch<span class="main">;</span>
        <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub><span class="main">⟧</span>
       <span class="main">⟹</span> <span class="main">∃</span><span class="bound">n</span> <span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
              A.neval
               <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">n</span>
               <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of
                         <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
               <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
              <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of
                            <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of
                            <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>
                  <span class="main">∈</span> A.R <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of
                            <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
                  A.neval
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>
                   <span class="bound">n</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
                       <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> RefRel_HighBranch.induct<span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>acq_mode_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">m</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> acq_mode_rel<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_acq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> acq_mode_rel.prems acq_mode_rel<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="main">(</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="skolem">m</span> <span class="main">:=</span> insert <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> C.seq_decl_elim C.update_modes.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> mds<span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> A.update_modes <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">+=<span class="hidden">⇩</span><sub>m</sub></span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> A.update_modes.simps
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mode_acquire_refinement_helper<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def acq_mode_rel A.eval<span class="hidden">⇩</span><sub>w</sub>.seq A.decl_eval<span class="hidden">⇩</span><sub>w</sub>
  <span class="keyword1"><span class="command">have</span></span> eval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">hence</span></span> neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> acq_mode_rel<span class="main">(</span>5<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_concrete_vars_unwritable<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span><span class="main">.</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟶</span> <span class="bound">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> AsmNoReadOrWrite<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> acq_mode_rel<span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> acq_mode_rel.hyps<span class="main">(</span>4<span class="main">)</span> neval<span class="hidden">⇩</span><sub>A</sub> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> in_Rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A.neval_Suc_simp One_nat_def acq_mode_rel.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
           <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
           <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
           A.neval
            <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span>
            <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
               <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
               <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
               <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
               <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>
      <span class="keyword3"><span class="command">assume</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        in_RefRel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
           <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        in_rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
         <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>
        <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> acq_mode_rel<span class="main">(</span>2<span class="main">)</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span>Skip<span class="main">@[</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span> <span class="keyword1">+=<span class="hidden">⇩</span><sub>m</sub></span> <span class="skolem">m</span><span class="main">]</span><span class="main">)</span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>C.eval<span class="hidden">⇩</span><sub>w</sub>.seq C.decl_eval<span class="hidden">⇩</span><sub>w</sub>' mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> in_R acq_mode_rel<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">(</span>Skip<span class="main">@[</span><span class="skolem">x</span> <span class="keyword1">+=<span class="hidden">⇩</span><sub>m</sub></span> <span class="skolem">m</span><span class="main">]</span><span class="main">)</span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>inR_E A.rel_invE<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> acq_mode_rel<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
            <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>A.eval<span class="hidden">⇩</span><sub>w</sub>.seq A.decl_eval<span class="hidden">⇩</span><sub>w</sub>' mds<span class="hidden">⇩</span><sub>C</sub>'_def mode_acquire_refinement_helper<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> acq_mode_rel<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> A.eval_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">from</span></span> acq_mode_rel<span class="main">(</span>3<span class="main">)</span> in_RefRel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def refrel_helper_Acq_Rel_ex1I
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span>Skip<span class="main">@[</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span> <span class="keyword1">+=<span class="hidden">⇩</span><sub>m</sub></span> <span class="skolem">m</span><span class="main">]</span><span class="main">)</span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="main">(</span>Skip<span class="main">@[</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span> <span class="keyword1">+=<span class="hidden">⇩</span><sub>m</sub></span> <span class="skolem">m</span><span class="main">]</span><span class="main">)</span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
                   <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="skolem">m</span> <span class="main">:=</span> insert <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub> C.eval_det <span class="keyword1"><span class="command">have</span></span>
        tails_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> Acq_Mode_RefRel_HighBranchE<span class="main">[</span><span class="operator">OF</span> in_RefRel<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def acq_mode_rel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">⟨</span><span class="main">(</span>Skip<span class="main">@[</span><span class="skolem">x</span> <span class="keyword1">+=<span class="hidden">⇩</span><sub>m</sub></span> <span class="skolem">m</span><span class="main">]</span><span class="main">)</span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of  <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>  mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
                <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>
               <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
              <span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
               <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
              <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>' mds<span class="hidden">⇩</span><sub>C</sub>'_concrete_vars_unwritable
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
                <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
               <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command">using</span></span> A.eval<span class="hidden">⇩</span><sub>w</sub>.seq A.decl_eval<span class="hidden">⇩</span><sub>w</sub>' mds<span class="hidden">⇩</span><sub>C</sub>'_def A.update_modes.simps mode_acquire_refinement_helper
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def tails_eq rel_inv<span class="hidden">⇩</span><sub>C</sub>_default
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
              <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
              <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
              <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
              <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> in_Rel' abs_steps_acq neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>assign_load_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assign_load_rel<span class="main">(</span>1<span class="main">)</span> assign_load_rel<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_load<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assign_load_rel.prems assign_load_rel<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="main">(</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.seq_elim C.assign_elim assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Stmt.distinct<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> assign_load_rel<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> eval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A.eval<span class="hidden">⇩</span><sub>w</sub>.seq assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>A</sub> mem_assign_refinement_helper_var abs_steps_load <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> assign_load_rel<span class="main">(</span>11<span class="main">)</span><span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> assign_load_rel.prems c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> in_Rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assign_load_rel.hyps<span class="main">(</span>4-5<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
                  A.neval
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span>
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_Rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> assign_load_rel<span class="main">(</span>2<span class="main">)</span> reg_is_not_the_var<span class="hidden">⇩</span><sub>C</sub>_of_anything
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span> <span class="main">←</span> Load <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>C.eval<span class="hidden">⇩</span><sub>w</sub>.seq assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub> mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assign_load_rel<span class="main">(</span>1<span class="main">)</span> in_R inR_E
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">←</span> aexp.Load <span class="skolem">y</span><span class="main">)</span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>inR_E A.rel_invE<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> abs_steps_load A.assign_elim A.seq_elim mem_assign_refinement_helper_var
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span> assign_load_rel<span class="main">(</span>3<span class="main">)</span> in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def refrel_helper_Assign_Load_ex1I
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span> <span class="main">←</span> Load <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span> <span class="main">←</span> Load <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
                 <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
                  <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub> C.eval_det <span class="keyword1"><span class="command">have</span></span>
        tails_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                    <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> Assign_Load_RefRel_HighBranchE<span class="main">[</span><span class="operator">OF</span> in_Rel<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def assign_load_rel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">⟨</span><span class="main">(</span><span class="skolem">x</span> <span class="main">←</span> aexp.Load <span class="skolem">y</span><span class="main">)</span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
              <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>
             <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
            <span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
             <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
            <span class="main">∈</span> RefRel_HighBranch"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
              <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
             <span class="main">∈</span> RefRel_HighBranch"</span></span>
      <span class="keyword1"><span class="command">using</span></span> A.eval<span class="hidden">⇩</span><sub>w</sub>.seq assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>A</sub> mds<span class="hidden">⇩</span><sub>C</sub>'_def A.update_modes.simps mem_assign_refinement_helper_var
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def tails_eq rel_inv<span class="hidden">⇩</span><sub>C</sub>_default
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub> eval_tail<span class="hidden">⇩</span><sub>C</sub>'
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> in_Rel' abs_steps_load neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>assign_const_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">z</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assign_const_rel<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assign_const_rel.prems assign_const_rel<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.seq_elim C.assign_elim assign_eval<span class="hidden">⇩</span><sub>w</sub>_const<span class="hidden">⇩</span><sub>C</sub>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Stmt.distinct<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> assign_const_rel<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> eval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A.eval<span class="hidden">⇩</span><sub>w</sub>.seq assign_eval<span class="hidden">⇩</span><sub>w</sub>_const<span class="hidden">⇩</span><sub>A</sub> mem_assign_refinement_helper_const abs_steps_const <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> assign_const_rel c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def stop_rel mds<span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> in_Rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
                  A.neval
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span>
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_Rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> assign_const_rel<span class="main">(</span>2<span class="main">)</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span> <span class="main">←</span> Const <span class="skolem">z</span><span class="main">)</span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>C.eval<span class="hidden">⇩</span><sub>w</sub>.seq assign_eval<span class="hidden">⇩</span><sub>w</sub>_const<span class="hidden">⇩</span><sub>C</sub> mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assign_const_rel<span class="main">(</span>1<span class="main">)</span> in_R inR_E
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">←</span> Const <span class="skolem">z</span><span class="main">)</span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>inR_E A.rel_invE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> abs_steps_const A.assign_elim A.seq_elim mem_assign_refinement_helper_const
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assign_const_rel<span class="main">(</span>3<span class="main">)</span> in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def refrel_helper_Assign_Const_ex1I
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span> <span class="main">←</span> Const <span class="skolem">z</span><span class="main">)</span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span> <span class="main">←</span> Const <span class="skolem">z</span><span class="main">)</span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
                 <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">z</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
                  <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span><span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">z</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub> C.eval_det <span class="keyword1"><span class="command">have</span></span>
        tails_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                    <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> Assign_Const_RefRel_HighBranchE<span class="main">[</span><span class="operator">OF</span> in_Rel<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def assign_const_rel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">⟨</span><span class="main">(</span><span class="skolem">x</span> <span class="main">←</span> Const <span class="skolem">z</span><span class="main">)</span> <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
              <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>
             <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
            <span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
             <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
            <span class="main">∈</span> RefRel_HighBranch"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
              <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
             <span class="main">∈</span> RefRel_HighBranch"</span></span>
      <span class="keyword1"><span class="command">using</span></span> A.eval<span class="hidden">⇩</span><sub>w</sub>.seq assign_eval<span class="hidden">⇩</span><sub>w</sub>_const<span class="hidden">⇩</span><sub>A</sub> mds<span class="hidden">⇩</span><sub>C</sub>'_def A.update_modes.simps mem_assign_refinement_helper_const
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def tails_eq rel_inv<span class="hidden">⇩</span><sub>C</sub>_default
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub> eval_tail<span class="hidden">⇩</span><sub>C</sub>'
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> in_Rel' abs_steps_const neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_load_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_reg_load_rel.hyps<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_if_reg_load<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> if_reg_load_rel.prems if_reg_load_rel<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="main">(</span>Stop <span class="main">;;</span> If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg3 <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.seq_elim C.assign_elim C.skip_elim assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Stmt.distinct<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_reg_load_rel<span class="main">(</span>1-4<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>A</sub>_unchanged<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reg_not_visible_abs conc_only_var_assign_not_visible_abs A.neval.intros<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> if_reg_load_rel c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> impE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> if_reg_load_rel.prems mem<span class="hidden">⇩</span><sub>A</sub>_of_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="comment1">(* This might be usable for an Isar proof of rel', but not sure how best to approach that *)</span>
  <span class="keyword1"><span class="command">from</span></span> reg_not_visible_abs conc_only_var_assign_not_visible_abs mem<span class="hidden">⇩</span><sub>A</sub>_of_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_conds_match<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> reg3 <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
                  A.neval
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span>
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_Rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg3 <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_reg_load_rel<span class="main">(</span>2<span class="main">)</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span>reg3 <span class="main">←</span> Load <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>C.eval<span class="hidden">⇩</span><sub>w</sub>.seq assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub> mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> if_reg_load_rel<span class="main">(</span>1<span class="main">)</span> in_R
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> If <span class="main">(</span>Neq <span class="main">(</span>Load <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> inR_E A.rel_invE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> abs_steps_if_reg_load A.neval_ZeroE
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span> if_reg_load_rel.hyps<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def in_Rel neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> abs_steps_if_reg_load in_rel_inv<span class="hidden">⇩</span><sub>C</sub>
         refrel_helper_If_Reg_Load_exI
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="skolem"><span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span>reg3 <span class="main">←</span> Load <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      eval_tail<span class="hidden">⇩</span><sub>C</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
                 <span class="main">⟨</span>Stop <span class="main">;;</span> Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span>
                      <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg3 <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">with</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub> C.eval_det <span class="keyword1"><span class="command">have</span></span>
      tails_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_reg_load_rel<span class="main">(</span>1-9<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
                    <span class="main">⟨</span>Stop <span class="main">;;</span> Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span>
                       <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg3 <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                   <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> If_Reg_Load_RefRel_HighBranchE<span class="main">[</span><span class="operator">OF</span> in_Rel<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def if_reg_load_rel<span class="main"><span class="main">(</span></span>1-9<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
           sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
           <span class="main">(</span><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> reg3 <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span><span class="main">(</span>reg3 <span class="main">←</span> Load <span class="main">(</span>var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span>
             Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
            <span class="main">⟨</span>Stop <span class="main">;;</span> Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
           <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub><span class="main">)</span> <span class="main">⟶</span>
             <span class="main">(</span><span class="main">⟨</span>Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
              sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
              <span class="main">⟨</span>Stop <span class="main">;;</span> Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
             <span class="main">∈</span> RefRel_HighBranch"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> neq0_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> reg3 <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> conc_only_var_assign_not_visible_abs reg_not_visible_abs mem<span class="hidden">⇩</span><sub>A</sub>_of_def if_reg_load_rel<span class="main">(</span>1-9<span class="main">)</span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
              sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
             <span class="main">⟨</span>Stop <span class="main">;;</span> Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
            <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def eval_tail<span class="hidden">⇩</span><sub>C</sub>' if_reg_load_rel<span class="main">(</span>1-9<span class="main">)</span> conc_only_var_assign_not_visible_abs reg_not_visible_abs
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> if_reg_load_rel<span class="main">(</span>1-9<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def conc_only_var_assign_not_visible_abs mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def reg_not_visible_abs
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def rel_inv<span class="hidden">⇩</span><sub>C</sub>_default tails_eq
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub>' eval_tail<span class="hidden">⇩</span><sub>C</sub> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def if_reg_load_rel.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel' abs_steps_if_reg_load neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_stop_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_reg_stop_rel.hyps<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_if_reg_stop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> if_reg_stop_rel.prems if_reg_stop_rel<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="main">(</span>If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.seq_stop_elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_reg_stop_rel<span class="main">(</span>1-4<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>A</sub>_unchanged<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reg_not_visible_abs conc_only_var_assign_not_visible_abs A.neval.intros<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> if_reg_stop_rel c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> in_Rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
                  A.neval
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span>
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_Rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_reg_stop_rel<span class="main">(</span>2<span class="main">)</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Stop <span class="main">;;</span> Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub> mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> if_reg_stop_rel in_R inR_E
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> If <span class="main">(</span>Neq <span class="main">(</span>Load <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> inR_E A.rel_invE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> abs_steps_if_reg_stop A.neval_ZeroE
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span> if_reg_stop_rel.hyps<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>7<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def in_Rel neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> abs_steps_if_reg_stop in_rel_inv<span class="hidden">⇩</span><sub>C</sub>
         refrel_helper_If_Reg_Stop_exI
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="skolem"><span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Stop <span class="main">;;</span> Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      eval_tail<span class="hidden">⇩</span><sub>C</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
                 <span class="main">⟨</span>Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">with</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub> C.eval_det <span class="keyword1"><span class="command">have</span></span>
      tails_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
                    <span class="main">⟨</span>Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                   <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> If_Reg_Stop_RefRel_HighBranchE<span class="main">[</span><span class="operator">OF</span> in_Rel<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def if_reg_stop_rel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
             <span class="main">⟨</span>Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">⟶</span>
            <span class="main">(</span><span class="main">⟨</span>Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of
                       <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
             <span class="main">⟨</span>Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
            <span class="main">∈</span> RefRel_HighBranch"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub>' mds<span class="hidden">⇩</span><sub>C</sub>'_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span>
             <span class="main">⟨</span>Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
            <span class="main">∈</span> RefRel_HighBranch"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def eval_tail<span class="hidden">⇩</span><sub>C</sub>'
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def conc_only_var_assign_not_visible_abs mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def reg_not_visible_abs
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def rel_inv<span class="hidden">⇩</span><sub>C</sub>_default tails_eq
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub>' eval_tail<span class="hidden">⇩</span><sub>C</sub> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
              <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
              <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
              <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
              <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
              <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def if_reg_stop_rel.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> in_Rel' abs_steps_if_reg_stop neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_reg_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="main">(</span>ev<span class="hidden">⇩</span><sub>B</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">(</span>Neq <span class="main">(</span>Load <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_reg_rel<span class="main">(</span>1<span class="main">)</span> if_reg_rel<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_if_reg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> if_reg_rel.prems if_reg_rel<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>ev<span class="hidden">⇩</span><sub>B</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> C.if_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_reg_rel<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> eval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> if_seq_eval<span class="hidden">⇩</span><sub>w</sub>_helper<span class="hidden">⇩</span><sub>A</sub> A.if_eval<span class="hidden">⇩</span><sub>w</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">hence</span></span> neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abs_steps_if_reg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> if_reg_rel<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>7<span class="main">,</span>12<span class="main">)</span> if_reg_rel.prems c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def eval<span class="hidden">⇩</span><sub>A</sub>
  <span class="keyword1"><span class="command">have</span></span> in_Rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
                  A.neval
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span>
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_Rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_reg_rel<span class="main">(</span>2<span class="main">)</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
        <span class="main">⟨</span><span class="keyword1">if</span> <span class="main">(</span>ev<span class="hidden">⇩</span><sub>B</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
         <span class="keyword1">then</span> <span class="main">(</span><span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>C.if_eval<span class="hidden">⇩</span><sub>w</sub> if_seq_eval<span class="hidden">⇩</span><sub>w</sub>_helper<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> if_reg_rel<span class="main">(</span>1-10<span class="main">)</span> in_R inR_E
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> If <span class="main">(</span>Neq <span class="main">(</span>Load <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> inR_E A.rel_invE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">(</span>Neq <span class="main">(</span>Load <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
         <span class="keyword1">then</span> <span class="main">(</span><span class="skolem">then<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="skolem">else<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> if_seq_eval<span class="hidden">⇩</span><sub>w</sub>_helper<span class="hidden">⇩</span><sub>A</sub> A.if_eval<span class="hidden">⇩</span><sub>w</sub> if_reg_rel<span class="main">(</span>1-4<span class="main">)</span> A.eval_det
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span> in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_reg_rel<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_reg_mem<span class="hidden">⇩</span><sub>A</sub>_x<span class="main">:</span> <span class="quoted"><span class="quoted">"ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">(</span>mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">(</span>Neq <span class="main">(</span>Load <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> RefRelE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> if_reg_rel.hyps<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>7<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def in_Rel eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> abs_steps_if_reg in_rel_inv<span class="hidden">⇩</span><sub>C</sub>
         refrel_helper_If_Reg_exI
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="skolem"><span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      eval_tail<span class="hidden">⇩</span><sub>C</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
                 <span class="main">⟨</span><span class="keyword1">if</span> <span class="main">(</span>ev<span class="hidden">⇩</span><sub>B</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                  <span class="keyword1">then</span> <span class="main">(</span><span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub> C.eval_det <span class="keyword1"><span class="command">have</span></span>
      tails_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Stmt.If <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub></span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="main">(</span>ev<span class="hidden">⇩</span><sub>B</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def if_reg_rel<span class="main">(</span>3<span class="main">,</span>7<span class="main">,</span>9<span class="main">)</span> eval_tail<span class="hidden">⇩</span><sub>C</sub> mds<span class="hidden">⇩</span><sub>C</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
           eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> abs_steps_if_reg
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub> <span class="main">⟶</span>
            <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_Reg_RefRel_HighBranchE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def eval_tail<span class="hidden">⇩</span><sub>C</sub>' mds<span class="hidden">⇩</span><sub>C</sub>'_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def conc_only_var_assign_not_visible_abs mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def reg_not_visible_abs
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="keyword1">if</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">else</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
             <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
             <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∨</span>
            <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
             <span class="main">⟨</span><span class="keyword1">if</span> ev<span class="hidden">⇩</span><sub>B</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Neq <span class="main">(</span>Load reg3<span class="main">)</span> <span class="main">(</span>Const <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">then<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="keyword1">else</span> <span class="skolem">else<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
             <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def if_reg_rel.hyps<span class="main">(</span>11<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def rel_inv<span class="hidden">⇩</span><sub>C</sub>.rel_inv<span class="hidden">⇩</span><sub>C</sub>_default tails_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>_sym symE<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub>' eval_tail<span class="hidden">⇩</span><sub>C</sub> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
              <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
              <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
              <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
              <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> in_Rel' abs_steps_if_reg neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_then_rel_1 <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_then_rel_1.hyps<span class="main">(</span>1-3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_this<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> if_then_rel_1.prems if_then_rel_1<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="main">(</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.seq_elim C.skip_elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_then_rel_1<span class="main">(</span>1-5<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>A</sub>_unchanged<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A.neval.intros<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> if_then_rel_1 c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
                  A.neval
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span>
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_Rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg1 <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> y_mem<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reg2 <span class="main">←</span> Load z_mem<span class="main">)</span> <span class="main">;;</span>
                <span class="main">(</span>reg0 <span class="main">←</span> Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span>x_mem <span class="main">←</span> Load reg0<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_then_rel_1<span class="main">(</span>2-3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span>
          <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span>reg1 <span class="main">←</span> Load y_mem<span class="main">)</span> <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> in_R if_then_rel_1<span class="main">(</span>1<span class="main">)</span> inR_E A.rel_invE <span class="keyword1"><span class="command">have</span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> inR_E A.rel_invE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> abs_steps_this A.neval_ZeroE
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is also in the 'then' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> if_then_rel_1<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def C.eval<span class="hidden">⇩</span><sub>w</sub>.seq C.skip_eval<span class="hidden">⇩</span><sub>w</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_then_rel_1<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_then_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Then_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_then_rel_1<span class="main">(</span>1-8<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq C.skip_eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def rel_inv<span class="hidden">⇩</span><sub>C</sub>_default <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is in the other, 'else' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="main">(</span>reg1 <span class="main">←</span> Load y_mem<span class="main">)</span> <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>C.eval<span class="hidden">⇩</span><sub>w</sub>.seq assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub> mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_then_rel_1<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span>reg1 <span class="main">←</span> Load y_mem<span class="main">)</span> <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Else_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> in_else<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> in_else c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def <span class="keyword1"><span class="command">have</span></span>
        c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_else_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command">with</span></span> in_else in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def if_then_rel_1.hyps<span class="main">(</span>4<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
           mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span><span class="main">(</span>reg1 <span class="main">←</span> Load y_mem<span class="main">)</span> <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
            <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
             <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_Else_RefRel_HighBranchE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="improper">mem<span class="hidden">⇩</span><sub>C</sub>''</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg1 <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> y_mem<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> conc_only_var_assign_not_visible_abs reg_not_visible_abs mem<span class="hidden">⇩</span><sub>A</sub>_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> conc_only_var_assign_not_visible_abs eval_else_tail<span class="hidden">⇩</span><sub>C</sub> reg_not_visible_abs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def if_then_rel_1<span class="main">(</span>3<span class="main">)</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def if_then_rel_1.hyps<span class="main">(</span>1-6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel' abs_steps_this neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_else_rel_1 <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_else_rel_1.hyps<span class="main">(</span>1-3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_this<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> if_else_rel_1.prems if_else_rel_1<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="main">(</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg1 <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> y_mem<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.seq_elim C.assign_elim assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Stmt.distinct<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_else_rel_1<span class="main">(</span>1-5<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>A</sub>_unchanged<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A.neval.neval_0 conc_only_var_assign_not_visible_abs reg_not_visible_abs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> if_else_rel_1 c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> impE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> if_else_rel_1.prems mem<span class="hidden">⇩</span><sub>A</sub>_of_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
                  A.neval
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span>
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_Rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg1 <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> y_mem<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Skip <span class="main">;;</span>
                <span class="main">(</span>reg0 <span class="main">←</span> Load y_mem<span class="main">)</span> <span class="main">;;</span> <span class="main">(</span>x_mem <span class="main">←</span> Load reg0<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_else_rel_1<span class="main">(</span>2-3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span>
          <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Skip <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> in_R if_else_rel_1<span class="main">(</span>1<span class="main">)</span> inR_E A.rel_invE <span class="keyword1"><span class="command">have</span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Load y_var"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> inR_E A.rel_invE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> abs_steps_this A.neval_ZeroE
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is in the other, 'then' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>Skip <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> if_else_rel_1<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def C.eval<span class="hidden">⇩</span><sub>w</sub>.seq C.skip_eval<span class="hidden">⇩</span><sub>w</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_else_rel_1<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_then_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Skip <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Then_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_then_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Load y_var"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> in_then<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> in_then in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_then_def if_else_rel_1.hyps<span class="main">(</span>4<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
           mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span>Skip <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
            <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
             <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_Then_RefRel_HighBranchE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="improper">mem<span class="hidden">⇩</span><sub>C</sub>''</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def if_else_rel_1<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>_2' mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is also in the 'else' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>C.eval<span class="hidden">⇩</span><sub>w</sub>.seq assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub> mds<span class="hidden">⇩</span><sub>C</sub>'_def c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def if_else_rel_1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_else_rel_1<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Else_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> in_else<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> in_else in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def if_else_rel_1.hyps<span class="main">(</span>1-4<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
           mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
            <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
             <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_Else_RefRel_HighBranchE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="improper">mem<span class="hidden">⇩</span><sub>C</sub>''</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> conc_only_var_assign_not_visible_abs reg_not_visible_abs mem<span class="hidden">⇩</span><sub>A</sub>_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> conc_only_var_assign_not_visible_abs eval_else_tail<span class="hidden">⇩</span><sub>C</sub> reg_not_visible_abs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def rel_inv<span class="hidden">⇩</span><sub>C</sub>_default <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def if_else_rel_1.hyps<span class="main">(</span>1-6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel' abs_steps_this neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_then_rel_1' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_then_rel_1'.hyps<span class="main">(</span>1-3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_this<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> if_then_rel_1'.prems if_then_rel_1'<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.seq_stop_elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_then_rel_1'<span class="main">(</span>1-5<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>A</sub>_unchanged<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A.neval.intros<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> if_then_rel_1' c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
                  A.neval
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span>
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_Rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reg2 <span class="main">←</span> Load z_mem<span class="main">)</span> <span class="main">;;</span>
                <span class="main">(</span>reg0 <span class="main">←</span> Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span>x_mem <span class="main">←</span> Load reg0<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_then_rel_1'<span class="main">(</span>2-3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span>
          <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> in_R if_then_rel_1'<span class="main">(</span>1<span class="main">)</span> inR_E A.rel_invE <span class="keyword1"><span class="command">have</span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> inR_E A.rel_invE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> abs_steps_this A.neval_ZeroE
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is also in the 'then' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> if_then_rel_1'<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_then_rel_1'<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_then_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Then_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_then_rel_1'<span class="main">(</span>1-8<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def rel_inv<span class="hidden">⇩</span><sub>C</sub>_default <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is in the other, 'else' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub> mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_then_rel_1'<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Else_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_then_rel_1'<span class="main">(</span>1-8<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> in_else<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> in_else c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def <span class="keyword1"><span class="command">have</span></span>
        c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_else_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command">with</span></span> in_else in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def if_then_rel_1'.hyps<span class="main">(</span>4<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
           mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
            <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
             <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_Else_RefRel_HighBranchE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="improper">mem<span class="hidden">⇩</span><sub>C</sub>''</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def if_then_rel_1'<span class="main">(</span>3<span class="main">)</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def if_then_rel_1'.hyps<span class="main">(</span>1-6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel' abs_steps_this neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_else_rel_1' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_else_rel_1'.hyps<span class="main">(</span>1-3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_this<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> if_else_rel_1'.prems if_else_rel_1'<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.seq_stop_elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_else_rel_1'<span class="main">(</span>1-5<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>A</sub>_unchanged<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A.neval.neval_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> if_else_rel_1' c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
                  A.neval
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span>
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_Rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Skip <span class="main">;;</span> <span class="main">(</span>reg0 <span class="main">←</span> Load y_mem<span class="main">)</span> <span class="main">;;</span> <span class="main">(</span>x_mem <span class="main">←</span> Load reg0<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_else_rel_1'<span class="main">(</span>2-3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span>
          <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> in_R if_else_rel_1'<span class="main">(</span>1<span class="main">)</span> inR_E A.rel_invE <span class="keyword1"><span class="command">have</span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Load y_var"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> inR_E A.rel_invE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> abs_steps_this A.neval_ZeroE
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is in the other, 'then' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> if_else_rel_1'<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_else_rel_1'<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_then_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Then_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_then_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Load y_var"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_else_rel_1'<span class="main">(</span>1-8<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_then_def
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> in_else<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> in_else in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_then_def if_else_rel_1'.hyps<span class="main">(</span>4<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
           mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
            <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
             <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Then_RefRel_HighBranchE<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def if_else_rel_1'<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>_3' mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is also in the 'else' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub> mds<span class="hidden">⇩</span><sub>C</sub>'_def c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def if_else_rel_1'<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_else_rel_1'<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Else_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_else_rel_1'<span class="main">(</span>1-8<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> in_else<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> in_else c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_else_rel_1'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>
        c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_else_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command">with</span></span> in_else in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def if_else_rel_1'.hyps<span class="main">(</span>1-4<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
           mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
            <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
             <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_Else_RefRel_HighBranchE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="improper">mem<span class="hidden">⇩</span><sub>C</sub>''</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def rel_inv<span class="hidden">⇩</span><sub>C</sub>_default <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def if_else_rel_1'.hyps<span class="main">(</span>1-6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel' abs_steps_this neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_then_rel_2 <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_then_rel_2.hyps<span class="main">(</span>1-3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_this<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> if_then_rel_2.prems if_then_rel_2<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="main">(</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.seq_elim C.skip_elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_then_rel_2<span class="main">(</span>1-5<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>A</sub>_unchanged<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A.neval.intros<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> if_then_rel_2 c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
                  A.neval
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span>
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_Rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg2 <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> z_mem<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reg0 <span class="main">←</span> Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span>x_mem <span class="main">←</span> Load reg0<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_then_rel_2<span class="main">(</span>2-3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span>reg2 <span class="main">←</span> Load z_mem<span class="main">)</span> <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> in_R if_then_rel_2<span class="main">(</span>1<span class="main">)</span> inR_E A.rel_invE <span class="keyword1"><span class="command">have</span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> inR_E A.rel_invE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> abs_steps_this A.neval_ZeroE
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is also in the 'then' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> if_then_rel_2<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def C.eval<span class="hidden">⇩</span><sub>w</sub>.seq C.skip_eval<span class="hidden">⇩</span><sub>w</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_then_rel_2<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_then_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Then_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_then_rel_2<span class="main">(</span>1-8<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq C.skip_eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def rel_inv<span class="hidden">⇩</span><sub>C</sub>_default <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is in the other, 'else' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="main">(</span>reg2 <span class="main">←</span> Load z_mem<span class="main">)</span> <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>C.eval<span class="hidden">⇩</span><sub>w</sub>.seq assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub> mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_then_rel_2<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span>reg2 <span class="main">←</span> Load z_mem<span class="main">)</span> <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Else_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> in_else<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> in_else c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def <span class="keyword1"><span class="command">have</span></span>
        c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_else_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command">with</span></span> in_else in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def if_then_rel_2.hyps<span class="main">(</span>4<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
           mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span><span class="main">(</span>reg2 <span class="main">←</span> Load z_mem<span class="main">)</span> <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
            <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
             <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_Else_RefRel_HighBranchE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="improper">mem<span class="hidden">⇩</span><sub>C</sub>''</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> conc_only_var_assign_not_visible_abs reg_not_visible_abs mem<span class="hidden">⇩</span><sub>A</sub>_of_def eval_else_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> conc_only_var_assign_not_visible_abs eval_else_tail<span class="hidden">⇩</span><sub>C</sub> reg_not_visible_abs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def if_then_rel_2<span class="main">(</span>3<span class="main">)</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>_4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def if_then_rel_2.hyps<span class="main">(</span>1-6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel' abs_steps_this neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_else_rel_2 <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_else_rel_2.hyps<span class="main">(</span>1-3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_this<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> if_else_rel_2.prems if_else_rel_2<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="main">(</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg2 <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> z_mem<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.seq_elim C.assign_elim assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Stmt.distinct<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_else_rel_2<span class="main">(</span>1-5<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>A</sub>_unchanged<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A.neval.neval_0 conc_only_var_assign_not_visible_abs reg_not_visible_abs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> if_else_rel_2 c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> impE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> if_else_rel_2.prems mem<span class="hidden">⇩</span><sub>A</sub>_of_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
                  A.neval
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span>
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_Rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg2 <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> z_mem<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reg0 <span class="main">←</span> Load y_mem<span class="main">)</span> <span class="main">;;</span> <span class="main">(</span>x_mem <span class="main">←</span> Load reg0<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_else_rel_2<span class="main">(</span>2-3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span>
          <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Skip <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> in_R if_else_rel_2<span class="main">(</span>1<span class="main">)</span> inR_E A.rel_invE <span class="keyword1"><span class="command">have</span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Load y_var"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> inR_E A.rel_invE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> abs_steps_this A.neval_ZeroE
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is in the other, 'then' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>Skip <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> if_else_rel_2<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def C.eval<span class="hidden">⇩</span><sub>w</sub>.seq C.skip_eval<span class="hidden">⇩</span><sub>w</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_else_rel_2<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_then_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Skip <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Then_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_then_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Load y_var"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> in_else<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> in_else in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_then_def if_else_rel_2.hyps<span class="main">(</span>4<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
           mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span>Skip <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
            <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
             <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_Then_RefRel_HighBranchE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="improper">mem<span class="hidden">⇩</span><sub>C</sub>''</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def if_else_rel_2<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>_4' mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is also in the 'else' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>C.eval<span class="hidden">⇩</span><sub>w</sub>.seq assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub> mds<span class="hidden">⇩</span><sub>C</sub>'_def c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def if_else_rel_2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_else_rel_2<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Else_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> in_else<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> in_else in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def if_else_rel_2.hyps<span class="main">(</span>1-4<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
           mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
            <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
             <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_Else_RefRel_HighBranchE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="improper">mem<span class="hidden">⇩</span><sub>C</sub>''</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> conc_only_var_assign_not_visible_abs reg_not_visible_abs mem<span class="hidden">⇩</span><sub>A</sub>_of_def eval_else_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> conc_only_var_assign_not_visible_abs eval_else_tail<span class="hidden">⇩</span><sub>C</sub> reg_not_visible_abs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def rel_inv<span class="hidden">⇩</span><sub>C</sub>_default <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def if_else_rel_2.hyps<span class="main">(</span>1-6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel' abs_steps_this neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_then_rel_2' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_then_rel_2'.hyps<span class="main">(</span>1-3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_this<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> if_then_rel_2'.prems if_then_rel_2'<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.seq_stop_elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_then_rel_2'<span class="main">(</span>1-5<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>A</sub>_unchanged<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A.neval.intros<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> if_then_rel_2' c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
                  A.neval
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span>
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_Rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reg0 <span class="main">←</span> Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span>x_mem <span class="main">←</span> Load reg0<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_then_rel_2'<span class="main">(</span>2-3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span>
          <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> in_R if_then_rel_2'<span class="main">(</span>1<span class="main">)</span> inR_E A.rel_invE <span class="keyword1"><span class="command">have</span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> inR_E A.rel_invE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> abs_steps_this A.neval_ZeroE
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is also in the 'then' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> if_then_rel_2'<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_then_rel_2'<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_then_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Then_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_then_rel_2'<span class="main">(</span>1-8<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def rel_inv<span class="hidden">⇩</span><sub>C</sub>_default <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is in the other, 'else' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub> mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_then_rel_2'<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Else_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> in_else<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> in_else c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def <span class="keyword1"><span class="command">have</span></span>
        c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_else_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command">with</span></span> in_else in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def if_then_rel_2'.hyps<span class="main">(</span>4<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
           mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
            <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
             <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Else_RefRel_HighBranchE<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def if_then_rel_2'<span class="main">(</span>3<span class="main">)</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>_5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def if_then_rel_2'.hyps<span class="main">(</span>1-6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel' abs_steps_this neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_else_rel_2' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_else_rel_2'.hyps<span class="main">(</span>1-3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_this<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> if_else_rel_2'.prems if_else_rel_2'<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.seq_stop_elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_else_rel_2'<span class="main">(</span>1-5<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>A</sub>_unchanged<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A.neval.neval_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> if_else_rel_2' c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
                  A.neval
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span>
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_Rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reg0 <span class="main">←</span> Load y_mem<span class="main">)</span> <span class="main">;;</span> <span class="main">(</span>x_mem <span class="main">←</span> Load reg0<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_else_rel_2'<span class="main">(</span>2-3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span>
          <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> in_R if_else_rel_2'<span class="main">(</span>1<span class="main">)</span> inR_E A.rel_invE <span class="keyword1"><span class="command">have</span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Load y_var"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> inR_E A.rel_invE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> abs_steps_this A.neval_ZeroE
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is in the other, 'then' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> if_else_rel_2'<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_else_rel_2'<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_then_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Then_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_then_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Load y_var"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> in_else<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> in_else in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_then_def if_else_rel_2'.hyps<span class="main">(</span>4<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
           mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
            <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
             <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Then_RefRel_HighBranchE<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def if_else_rel_2'<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>_5' mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is also in the 'else' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub> mds<span class="hidden">⇩</span><sub>C</sub>'_def c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def if_else_rel_2'<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_else_rel_2'<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Else_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> in_else<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> in_else c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_else_rel_2'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>
        c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_else_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command">with</span></span> in_else in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def if_else_rel_2'.hyps<span class="main">(</span>1-4<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
           mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
            <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
             <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Else_RefRel_HighBranchE<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def rel_inv<span class="hidden">⇩</span><sub>C</sub>_default <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def if_else_rel_2'.hyps<span class="main">(</span>1-6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel' abs_steps_this neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_then_rel_3 <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_then_rel_3.hyps<span class="main">(</span>1-3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_this<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> if_then_rel_3.prems if_then_rel_3<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="main">(</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg0 <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> y_mem<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.seq_elim C.assign_elim assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Stmt.distinct<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_then_rel_3<span class="main">(</span>1-5<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>A</sub>_unchanged<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A.neval.neval_0 conc_only_var_assign_not_visible_abs reg_not_visible_abs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> if_then_rel_3 c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> impE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> if_then_rel_3.prems mem<span class="hidden">⇩</span><sub>A</sub>_of_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
                  A.neval
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span>
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_Rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg0 <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> y_mem<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg0 <span class="main">:=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"x_mem <span class="main">←</span> Load reg0"</span></span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_then_rel_3<span class="main">(</span>2-3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span>reg0 <span class="main">←</span> Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> in_R if_then_rel_3<span class="main">(</span>1<span class="main">)</span> inR_E A.rel_invE <span class="keyword1"><span class="command">have</span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> inR_E A.rel_invE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> abs_steps_this A.neval_ZeroE
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is also in the 'then' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_t</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> if_then_rel_3<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def C.eval<span class="hidden">⇩</span><sub>w</sub>.seq assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_then_rel_3<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_then_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Then_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_t</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> in_then<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> in_then c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_then_rel_3<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>
        c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_then_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Load y_var"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command">with</span></span> in_then in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_then_def if_then_rel_3.hyps<span class="main">(</span>2-4<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
           mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_t</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span><span class="main">(</span>reg0 <span class="main">←</span> Load y_mem<span class="main">)</span> <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
            <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_t</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
             <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_t</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_Then_RefRel_HighBranchE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="improper">mem<span class="hidden">⇩</span><sub>C</sub>''</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg0 <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> y_mem<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> conc_only_var_assign_not_visible_abs reg_not_visible_abs mem<span class="hidden">⇩</span><sub>A</sub>_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def if_then_rel_3<span class="main">(</span>1-3<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> conc_only_var_assign_not_visible_abs eval_then_tail<span class="hidden">⇩</span><sub>C</sub> reg_not_visible_abs <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_t</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def rel_inv<span class="hidden">⇩</span><sub>C</sub>_default <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is in the other, 'else' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="main">(</span>reg0 <span class="main">←</span> Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_e</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq C.assign_eval<span class="hidden">⇩</span><sub>w</sub>' ev<span class="hidden">⇩</span><sub>A</sub>.simps mds<span class="hidden">⇩</span><sub>C</sub>'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_then_rel_3<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span>reg0 <span class="main">←</span> Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Else_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_then_rel_3<span class="main">(</span>1-8<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_e</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> in_else<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> in_else c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def <span class="keyword1"><span class="command">have</span></span>
        c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_else_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command">with</span></span> in_else in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def if_then_rel_3.hyps<span class="main">(</span>4<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
           mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_e</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span><span class="main">(</span>reg0 <span class="main">←</span> Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
            <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_e</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
             <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_e</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_Else_RefRel_HighBranchE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="improper">mem<span class="hidden">⇩</span><sub>C</sub>''</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_e</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> conc_only_var_assign_not_visible_abs reg_not_visible_abs eval_else_tail<span class="hidden">⇩</span><sub>C</sub> mem<span class="hidden">⇩</span><sub>A</sub>_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> conc_only_var_assign_not_visible_abs eval_else_tail<span class="hidden">⇩</span><sub>C</sub> reg_not_visible_abs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_e</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def if_then_rel_3<span class="main">(</span>3<span class="main">)</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>_default <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def if_then_rel_3.hyps<span class="main">(</span>1-6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel' abs_steps_this neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_else_rel_3 <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_else_rel_3.hyps<span class="main">(</span>1-3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_this<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> if_else_rel_3.prems if_else_rel_3<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="main">(</span>Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg0 <span class="main">:=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.seq_elim C.assign_elim assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Stmt.distinct<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_else_rel_3<span class="main">(</span>1-5<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>A</sub>_unchanged<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A.neval.neval_0 conc_only_var_assign_not_visible_abs reg_not_visible_abs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> if_else_rel_3 c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> impE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def<span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> if_else_rel_3.prems mem<span class="hidden">⇩</span><sub>A</sub>_of_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
                  A.neval
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span>
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_Rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg0 <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> y_mem<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>reg0 <span class="main">:=</span> ev<span class="hidden">⇩</span><sub>A</sub> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">(</span>Add <span class="main">(</span>Load reg1<span class="main">)</span> <span class="main">(</span>Load reg2<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"x_mem <span class="main">←</span> Load reg0"</span></span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_else_rel_3<span class="main">(</span>2-3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span>
          <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span>reg0 <span class="main">←</span> Load y_mem<span class="main">)</span> <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> in_R if_else_rel_3<span class="main">(</span>1<span class="main">)</span> inR_E A.rel_invE <span class="keyword1"><span class="command">have</span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Load y_var"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> inR_E A.rel_invE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> abs_steps_this A.neval_ZeroE
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is in the other, 'then' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="main">(</span>reg0 <span class="main">←</span> Load y_mem<span class="main">)</span> <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_t</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> if_else_rel_3<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_else_rel_3<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_then_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="main">(</span>reg0 <span class="main">←</span> Load y_mem<span class="main">)</span> <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Then_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_then_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Load y_var"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_else_rel_3<span class="main">(</span>1-8<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_then_def
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_t</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> in_then<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_then_def in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_then_def if_else_rel_3.hyps<span class="main">(</span>4<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
           mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_t</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span><span class="main">(</span>reg0 <span class="main">←</span> Load y_mem<span class="main">)</span> <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
            <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_t</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
             <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_t</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_Then_RefRel_HighBranchE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="improper">mem<span class="hidden">⇩</span><sub>C</sub>''</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> conc_only_var_assign_not_visible_abs reg_not_visible_abs mem<span class="hidden">⇩</span><sub>A</sub>_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> conc_only_var_assign_not_visible_abs eval_then_tail<span class="hidden">⇩</span><sub>C</sub> reg_not_visible_abs <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_t</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def if_else_rel_3<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>_default mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is also in the 'else' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_e</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> C.eval<span class="hidden">⇩</span><sub>w</sub>.seq C.assign_eval<span class="hidden">⇩</span><sub>w</sub>' ev<span class="hidden">⇩</span><sub>A</sub>.simps mds<span class="hidden">⇩</span><sub>C</sub>'_def c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def if_else_rel_3<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_else_rel_3<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Else_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_else_rel_3<span class="main">(</span>1-8<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_e</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> in_else<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> in_else in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def if_else_rel_3.hyps<span class="main">(</span>1-4<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
           mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_e</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
            <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_e</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
             <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_e</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_Else_RefRel_HighBranchE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="improper">mem<span class="hidden">⇩</span><sub>C</sub>''</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_e</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> conc_only_var_assign_not_visible_abs reg_not_visible_abs mem<span class="hidden">⇩</span><sub>A</sub>_of_def eval_else_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_e</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> conc_only_var_assign_not_visible_abs eval_else_tail<span class="hidden">⇩</span><sub>C</sub> reg_not_visible_abs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'_e</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def rel_inv<span class="hidden">⇩</span><sub>C</sub>_default <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def if_else_rel_3.hyps<span class="main">(</span>1-6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel' abs_steps_this neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_then_rel_3' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_then_rel_3'.hyps<span class="main">(</span>1-3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_this<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> if_then_rel_3'.prems if_then_rel_3'<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.seq_stop_elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_then_rel_3'<span class="main">(</span>1-5<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>A</sub>_unchanged<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A.neval.intros<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> if_then_rel_3' c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
                  A.neval
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span>
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_Rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"x_mem <span class="main">←</span> Load reg0"</span></span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_then_rel_3'<span class="main">(</span>2-3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span>
          <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> in_R if_then_rel_3'<span class="main">(</span>1<span class="main">)</span> inR_E A.rel_invE <span class="keyword1"><span class="command">have</span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> inR_E A.rel_invE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> abs_steps_this A.neval_ZeroE
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is also in the 'then' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> if_then_rel_3'<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_then_rel_3'<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_then_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Then_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_then_rel_3'<span class="main">(</span>1-8<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> in_then<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> in_then c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_then_rel_3'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>
        c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_then_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Load y_var"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command">with</span></span> in_then in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_then_def if_then_rel_3'.hyps<span class="main">(</span>2-4<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
           mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
            <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
             <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Then_RefRel_HighBranchE<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def if_then_rel_3'<span class="main">(</span>1-3<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def rel_inv<span class="hidden">⇩</span><sub>C</sub>_default <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is in the other, 'else' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub> mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_then_rel_3'<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Else_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_then_rel_3'<span class="main">(</span>1-8<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> in_else<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> in_else c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def <span class="keyword1"><span class="command">have</span></span>
        c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_else_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command">with</span></span> in_else in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def if_then_rel_3'.hyps<span class="main">(</span>4<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
           mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
            <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
             <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Else_RefRel_HighBranchE<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def if_then_rel_3'<span class="main">(</span>3<span class="main">)</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>_default <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def if_then_rel_3'.hyps<span class="main">(</span>1-6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel' abs_steps_this neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_else_rel_3' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_else_rel_3'.hyps<span class="main">(</span>1-3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_this<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> if_else_rel_3'.prems if_else_rel_3'<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.seq_stop_elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_else_rel_3'<span class="main">(</span>1-5<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>A</sub>_unchanged<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A.neval.neval_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> if_else_rel_3' c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
                  A.neval
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span>
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_Rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">0</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"x_mem <span class="main">←</span> Load reg0"</span></span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_else_rel_3'<span class="main">(</span>2-3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∨</span>
          <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> in_R if_else_rel_3'<span class="main">(</span>1<span class="main">)</span> inR_E A.rel_invE <span class="keyword1"><span class="command">have</span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Load y_var"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> inR_E A.rel_invE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> neval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> abs_steps_this A.neval_ZeroE
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is in the other, 'then' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> if_else_rel_3'<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_else_rel_3'<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_then_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Then_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_then_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Load y_var"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_else_rel_3'<span class="main">(</span>1-8<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_then_def
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> in_else<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> in_else in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_then_def if_else_rel_3'.hyps<span class="main">(</span>4<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
           mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span>Stop <span class="main">;;</span> <span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
            <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
             <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Then_RefRel_HighBranchE<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="var">?tail<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def if_else_rel_3'<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>_default mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is also in the 'else' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub> mds<span class="hidden">⇩</span><sub>C</sub>'_def c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def if_else_rel_3'<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def in_Rel in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_else_rel_3'<span class="main">(</span>1-6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Else_RefRel_HighBranchE rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> in_else<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> in_else c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_else_rel_3'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>
        c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_else_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command">with</span></span> in_else in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_else_def if_else_rel_3'.hyps<span class="main">(</span>1-4<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="main">.</span>
           mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>C</sub>''</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span>
            <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span> <span class="main">⟶</span>
             <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> If_Else_RefRel_HighBranchE<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub>''</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def rel_inv<span class="hidden">⇩</span><sub>C</sub>_default <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> eval_then_tail<span class="hidden">⇩</span><sub>C</sub> eval_else_tail<span class="hidden">⇩</span><sub>C</sub> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def if_else_rel_3'.hyps<span class="main">(</span>1-6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel' abs_steps_this neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_then_rel_4 <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Stop"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_then_rel_4.hyps<span class="main">(</span>1-3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_this<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> if_then_rel_4.prems if_then_rel_4<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> Stop"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>x_mem <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> reg0<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.assign_elim assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_then_rel_4<span class="main">(</span>1-7<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> eval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A.assign_eval<span class="hidden">⇩</span><sub>w</sub>' ev<span class="hidden">⇩</span><sub>A</sub>.simps<span class="main">(</span>2<span class="main">)</span> mem_assign_refinement_helper_const var<span class="hidden">⇩</span><sub>C</sub>_of.simps<span class="main">(</span>2<span class="main">)</span> abs_steps_this
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> if_then_rel_4 c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
                  A.neval
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span>
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_Rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>x_mem <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> reg0<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_then_rel_4<span class="main">(</span>2-3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_then_rel_4<span class="main">(</span>1-4<span class="main">,</span>6<span class="main">)</span> in_R
    <span class="keyword1"><span class="command">have</span></span> z<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> z_var <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> A.prog_high_branch_def inR_E inv<span class="hidden">⇩</span><sub>5</sub>E
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> if_then_rel_4.hyps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_then_rel_4<span class="main">(</span>1-4<span class="main">)</span> in_R
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> z_var <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> z_var"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inR_E A.low_mds_eq_def dma_def emptyE inv<span class="hidden">⇩</span><sub>5</sub>E var.distinct<span class="main">(</span>5<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> z<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">have</span></span> z<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> z_var <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> in_R if_then_rel_4<span class="main">(</span>1<span class="main">)</span> inR_E A.rel_invE <span class="keyword1"><span class="command">have</span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Add <span class="main">(</span>Load y_var<span class="main">)</span> <span class="main">(</span>Load z_var<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> inR_E A.rel_invE<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def if_then_rel_4<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">)</span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def z<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>
    <span class="keyword1"><span class="command">have</span></span> r0y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> reg0 <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> y_mem"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_Then_RefRel_HighBranchE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_Else_RefRel_HighBranchE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def <span class="keyword1"><span class="command">have</span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> Stop"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> A.assign_elim if_then_rel_4<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_then_rel_4<span class="main">(</span>1-7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>
      mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def mds<span class="hidden">⇩</span><sub>C</sub>'_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> A.assign_elim<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
       <span class="keyword1"><span class="command">using</span></span> r0y <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
       <span class="keyword1"><span class="command">using</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> mem_assign_refinement_helper_const var<span class="hidden">⇩</span><sub>C</sub>_of.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> var<span class="hidden">⇩</span><sub>C</sub>_of.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> A.assign_elim<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command">using</span></span> r0y z<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command">using</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> mem_assign_refinement_helper_const var<span class="hidden">⇩</span><sub>C</sub>_of.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> var<span class="hidden">⇩</span><sub>C</sub>_of.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> if_then_rel_4<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def C.eval<span class="hidden">⇩</span><sub>w</sub>.seq assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_then_rel_4<span class="main">(</span>1-8<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> RefRel_HighBranch.stop_rel<span class="main">)</span>
    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is also in the 'then' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def rel_inv<span class="hidden">⇩</span><sub>C</sub>_default <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is in the other, 'else' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def if_then_rel_4<span class="main">(</span>3<span class="main">)</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>_default <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def if_then_rel_4.hyps<span class="main">(</span>1-6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel' abs_steps_this neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>if_else_rel_4 <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Stop"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_else_rel_4.hyps<span class="main">(</span>1-3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_this<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> if_else_rel_4.prems if_else_rel_4<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> Stop"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>x_mem <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span> reg0<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.assign_elim assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> if_else_rel_4<span class="main">(</span>1-8<span class="main">)</span> mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> eval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A.assign_eval<span class="hidden">⇩</span><sub>w</sub>' ev<span class="hidden">⇩</span><sub>A</sub>.simps<span class="main">(</span>2<span class="main">)</span> mem_assign_refinement_helper_const var<span class="hidden">⇩</span><sub>C</sub>_of.simps<span class="main">(</span>2<span class="main">)</span> abs_steps_this
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> if_else_rel_4 c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def mds<span class="hidden">⇩</span><sub>C</sub>'_def mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
  <span class="keyword1"><span class="command">have</span></span> rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span><span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
                  A.neval
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span>
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_Rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">(</span>x_mem <span class="main">:=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> reg0<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_else_rel_4<span class="main">(</span>2-3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_else_rel_4<span class="main">(</span>1-4<span class="main">,</span>6<span class="main">)</span> in_R
    <span class="keyword1"><span class="command">have</span></span> z<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> z_var <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> A.prog_high_branch_def inR_E inv<span class="hidden">⇩</span><sub>6</sub>E
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> if_else_rel_4.hyps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> if_else_rel_4<span class="main">(</span>1-4<span class="main">)</span> in_R
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> z_var <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> z_var"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inR_E A.low_mds_eq_def dma_def emptyE inv<span class="hidden">⇩</span><sub>6</sub>E var.distinct<span class="main">(</span>5<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> z<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">have</span></span> z<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> z_var <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> in_R if_else_rel_4<span class="main">(</span>1<span class="main">)</span> inR_E A.rel_invE <span class="keyword1"><span class="command">have</span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">∨</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> x_var <span class="main">←</span> Load y_var"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> inR_E A.rel_invE<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def if_else_rel_4<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">)</span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def z<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>
    <span class="keyword1"><span class="command">have</span></span> r0y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> reg0 <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> y_mem"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_Else_RefRel_HighBranchE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_Then_RefRel_HighBranchE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def <span class="keyword1"><span class="command">have</span></span>
      c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> Stop"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> A.assign_elim if_else_rel_4<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_else_rel_4<span class="main">(</span>1-7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>
      mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def mds<span class="hidden">⇩</span><sub>C</sub>'_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">≠</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> A.assign_elim<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
       <span class="keyword1"><span class="command">using</span></span> r0y <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
       <span class="keyword1"><span class="command">using</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> mem_assign_refinement_helper_const var<span class="hidden">⇩</span><sub>C</sub>_of.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> var<span class="hidden">⇩</span><sub>C</sub>_of.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> A.assign_elim<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command">using</span></span> r0y z<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command">using</span></span> mem<span class="hidden">⇩</span><sub>A</sub>_of_def 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> mem_assign_refinement_helper_const var<span class="hidden">⇩</span><sub>C</sub>_of.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> var<span class="hidden">⇩</span><sub>C</sub>_of.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> if_else_rel_4<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def C.eval<span class="hidden">⇩</span><sub>w</sub>.seq assign_eval<span class="hidden">⇩</span><sub>w</sub>_load<span class="hidden">⇩</span><sub>C</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def if_else_rel_4<span class="main">(</span>1-8<span class="main">)</span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> RefRel_HighBranch.stop_rel<span class="main">)</span>
    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is also in the 'then' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def rel_inv<span class="hidden">⇩</span><sub>C</sub>_default <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="comment1">(* c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub> is in the other, 'else' branch *)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>Stop<span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def if_else_rel_4<span class="main">(</span>3<span class="main">)</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>_default <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def if_else_rel_4.hyps<span class="main">(</span>1-6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel' abs_steps_this neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>stop_seq_rel <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> stop_seq_rel<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> abs_steps_stop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs_steps' <span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>abs_steps'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> stop_seq_rel
  <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mds<span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="main">=</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.seq_stop_elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> neval<span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"A.neval <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span> <span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    rel'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mds<span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> <span class="var">?mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stop_seq_rel A.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                  <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                  <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub> <span class="main">∧</span>
                  A.neval
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> sifum_refinement.mem<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span>
                   <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
                      <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
                      <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span>
    <span class="keyword3"><span class="command">assume</span></span> in_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>A</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.R"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_Rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           in_rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">)</span> <span class="main">∈</span> A.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> in_rel_inv<span class="hidden">⇩</span><sub>C</sub> stop_seq_rel<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>rel_inv<span class="hidden">⇩</span><sub>C</sub>E<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> eval_tail<span class="hidden">⇩</span><sub>C</sub>'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> C.eval<span class="hidden">⇩</span><sub>w</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> stop_seq_rel<span class="main">(</span>1<span class="main">)</span> in_R inR_E
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub></span> <span class="main">=</span> Stop <span class="main">;;</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> inR_E A.rel_invE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def
    <span class="keyword1"><span class="command">have</span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> <span class="skolem">tail<span class="hidden">⇩</span><sub>A</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span> <span class="main">=</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eval<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub> abs_steps_stop A.seq_stop_elim
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
      <span class="keyword1"><span class="command">using</span></span> in_Rel c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>_def c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def mds<span class="hidden">⇩</span><sub>C</sub>'_def Stop_tail_RefRel_HighBranchE C.seq_stop_eval<span class="hidden">⇩</span><sub>w</sub>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="skolem">tail<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'_def in_rel_inv<span class="hidden">⇩</span><sub>C</sub> stop_seq_rel<span class="main">(</span>2<span class="main">)</span> c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>rel_inv<span class="hidden">⇩</span><sub>C</sub>E <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>rel_inv<span class="hidden">⇩</span><sub>C</sub>.intros<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">.</span>
              <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mds<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> sifum_lang_no_dma.eval<span class="hidden">⇩</span><sub>w</sub> ev<span class="hidden">⇩</span><sub>A</sub> ev<span class="hidden">⇩</span><sub>B</sub> <span class="main">∧</span>
              <span class="main">(</span><span class="main">⟨</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="main">,</span> sifum_refinement.mds<span class="hidden">⇩</span><sub>A</sub>_of var<span class="hidden">⇩</span><sub>C</sub>_of <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="skolem">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>A</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
              <span class="main">∈</span> RefRel_HighBranch <span class="main">∧</span>
              <span class="main">(</span><span class="main">⟨</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span><span class="bound">c<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="free">mds<span class="hidden">⇩</span><sub>C</sub>'</span><span class="main">,</span> <span class="bound">mem<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>C</sub>'</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mds<span class="hidden">⇩</span><sub>C</sub>'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rel' abs_steps_stop neval<span class="hidden">⇩</span><sub>A</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> stop_rel
  <span class="keyword1"><span class="command">with</span></span> C.stop_no_eval <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> RefRel_HighBranch_secure_refinement<span class="main">:</span>
  <span class="quoted"><span class="quoted">"secure_refinement A.R RefRel_HighBranch rel_inv<span class="hidden">⇩</span><sub>C</sub>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> secure_refinement_def2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> closed_others_RefRel_HighBranch<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> preserves_modes_mem_RefRel_HighBranch<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> new_vars_private_RefRel_HighBranch<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>_closed_glob_consistent<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> induction_full_RefRel_HighBranch<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> strong_low_bisim_mm_R<span class="hidden">⇩</span><sub>C</sub>_of_R<span class="main">:</span>
  <span class="quoted"><span class="quoted">"C.strong_low_bisim_mm <span class="main">(</span>R<span class="hidden">⇩</span><sub>C</sub>_of A.R RefRel_HighBranch rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> R<span class="hidden">⇩</span><sub>C</sub>_of_strong_low_bisim_mm<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> A.strong_low_bisim_mm_R<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> RefRel_HighBranch_secure_refinement<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>_sym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">mds<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Mode <span class="main">⇒</span> var<span class="hidden">⇩</span><sub>C</sub> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mds<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">m</span> <span class="keyword1">of</span> AsmNoReadOrWrite <span class="main">⇒</span> <span class="main">{</span>reg0<span class="main">,</span> reg1<span class="main">,</span> reg2<span class="main">,</span> reg3<span class="main">}</span> <span class="main">|</span>
                        AsmNoWrite <span class="main">⇒</span> <span class="main">{}</span> <span class="main">|</span>
                        <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> regs_the_only_concrete_only_vars<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∉</span> range var<span class="hidden">⇩</span><sub>C</sub>_of <span class="main">⟹</span> <span class="free">v<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">∈</span> <span class="main">{</span>reg0<span class="main">,</span> reg1<span class="main">,</span> reg2<span class="main">,</span> reg3<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">v<span class="hidden">⇩</span><sub>C</sub></span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">metis</span> rangeI var<span class="hidden">⇩</span><sub>C</sub>_of.simps<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prog_high_branch_RefRel<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span>A.prog_high_branch<span class="main">,</span> mds<span class="hidden">⇩</span><sub>A</sub>_of mds<span class="hidden">⇩</span><sub>0</sub><span class="main">,</span> mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>A</sub></span><span class="main">,</span> <span class="main">⟨</span>C.prog_high_branch<span class="hidden">⇩</span><sub>C</sub><span class="main">,</span> mds<span class="hidden">⇩</span><sub>0</sub><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>C</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="main">∈</span> RefRel_HighBranch"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> A.prog_high_branch_def C.prog_high_branch<span class="hidden">⇩</span><sub>C</sub>_def mds<span class="hidden">⇩</span><sub>0</sub>_def
  <span class="keyword1"><span class="command">using</span></span> regs_the_only_concrete_only_vars doesnt_have_mode has_mode<span class="hidden">⇩</span><sub>A</sub> NoRW<span class="hidden">⇩</span><sub>A</sub>_implies_NoRW<span class="hidden">⇩</span><sub>C</sub>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> acq_mode_rel<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_decl_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> stop_seq_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> acq_mode_rel<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_decl_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> stop_seq_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> acq_mode_rel<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_decl_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> stop_seq_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> assign_const_rel<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> stop_seq_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> assign_const_rel<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> stop_seq_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> assign_load_rel<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> stop_seq_rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_reg_load_rel<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_reg_stop_rel<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_stop_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_reg_rel<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>

   <span class="comment1">(* Then *)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_then_rel_1<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.if_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.skip_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_then_rel_1'<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_stop_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_then_rel_2<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.skip_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_then_rel_2'<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_stop_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_then_rel_3<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_then_rel_3'<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_stop_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_then_rel_4<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> stop_rel<span class="main">)</span>

  <span class="comment1">(* Else *)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_else_rel_1<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.if_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_else_rel_1'<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_stop_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_else_rel_2<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_else_rel_2'<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_stop_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_else_rel_3<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_else_rel_3'<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.seq_stop_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> if_else_rel_4<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> C.assign_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> stop_rel<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> mds<span class="hidden">⇩</span><sub>s</sub>_A_of_mds<span class="hidden">⇩</span><sub>0</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>s</sub> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>A</sub>_of mds<span class="hidden">⇩</span><sub>0</sub>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> preserves_modes_mem_mds<span class="hidden">⇩</span><sub>A</sub>_simp<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">m</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">unfolding</span></span> mds<span class="hidden">⇩</span><sub>s</sub>_def mds<span class="hidden">⇩</span><sub>0</sub>_def mds<span class="hidden">⇩</span><sub>A</sub>_of_def
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reg_not_visible_abs<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> A_of_mds<span class="hidden">⇩</span><sub>0</sub>_is_mds<span class="hidden">⇩</span><sub>s</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of mds<span class="hidden">⇩</span><sub>0</sub> <span class="main">=</span> mds<span class="hidden">⇩</span><sub>s</sub>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mds<span class="hidden">⇩</span><sub>s</sub>_A_of_mds<span class="hidden">⇩</span><sub>0</sub><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prog_high_branch<span class="hidden">⇩</span><sub>C</sub>_in_R<span class="hidden">⇩</span><sub>C</sub>_of_R<span class="main">:</span>
  <span class="quoted"><span class="quoted">"C.low_mds_eq mds<span class="hidden">⇩</span><sub>0</sub> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span>
       <span class="main">(</span><span class="main">⟨</span>C.prog_high_branch<span class="hidden">⇩</span><sub>C</sub><span class="main">,</span> mds<span class="hidden">⇩</span><sub>0</sub><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>1</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">,</span> <span class="main">⟨</span>C.prog_high_branch<span class="hidden">⇩</span><sub>C</sub><span class="main">,</span> mds<span class="hidden">⇩</span><sub>0</sub><span class="main">,</span> <span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span>
        <span class="main">∈</span> <span class="main">(</span>R<span class="hidden">⇩</span><sub>C</sub>_of A.R RefRel_HighBranch rel_inv<span class="hidden">⇩</span><sub>C</sub><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> R<span class="hidden">⇩</span><sub>C</sub>_of_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">A.prog_high_branch</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of mds<span class="hidden">⇩</span><sub>0</sub>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> prog_high_branch_RefRel<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">A.prog_high_branch</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mds<span class="hidden">⇩</span><sub>A</sub>_of mds<span class="hidden">⇩</span><sub>0</sub>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"mem<span class="hidden">⇩</span><sub>A</sub>_of <span class="free">mem<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> prog_high_branch_RefRel<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_of_mds<span class="hidden">⇩</span><sub>0</sub>_is_mds<span class="hidden">⇩</span><sub>s</sub><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> A.prog_high_branch_secure'<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A.low_mds_eq_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">unfolding</span></span> C.low_mds_eq_def mem<span class="hidden">⇩</span><sub>A</sub>_of_def dma_def dma<span class="hidden">⇩</span><sub>C</sub>_def 𝒞<span class="hidden">⇩</span><sub>C</sub>_def mds<span class="hidden">⇩</span><sub>0</sub>_def
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_inv<span class="hidden">⇩</span><sub>C</sub>_default<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"C.com_sifum_secure <span class="main">(</span>C.prog_high_branch<span class="hidden">⇩</span><sub>C</sub><span class="main">,</span> mds<span class="hidden">⇩</span><sub>0</sub><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> C.com_sifum_secure_def C.low_indistinguishable_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> C.mm_equiv_intro<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> strong_low_bisim_mm_R<span class="hidden">⇩</span><sub>C</sub>_of_R<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prog_high_branch<span class="hidden">⇩</span><sub>C</sub>_in_R<span class="hidden">⇩</span><sub>C</sub>_of_R<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>