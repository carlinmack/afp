<div id="Decreasing_Diagrams_II_Aux">
<div class="head">
<h1>Theory Decreasing_Diagrams_II_Aux</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Decreasing Diagrams II  
   Author:     Bertram Felgenhauer (2015)
   Maintainer: Bertram Felgenhauer &lt;bertram.felgenhauer@uibk.ac.at&gt;
   License:    LGPL or BSD

License clarification: This file is also licensed under the BSD license to facilitate reuse
and moving snippets from here to more suitable places.
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Decreasing_Diagrams_II_Aux
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../Well_Quasi_Orders/Multiset_Extension.html">Well_Quasi_Orders.Multiset_Extension</a>
  <a href="../Well_Quasi_Orders/Well_Quasi_Orders.html">Well_Quasi_Orders.Well_Quasi_Orders</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Trivialities›</span></span>

<span class="comment1">(* move to Relation.thy? *)</span>
<span class="keyword1"><span class="command">lemma</span></span> asymI2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span> <span class="main">∉</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟹</span> asym <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> asymI irrefl_def<span class="main">)</span>

<span class="comment1">(* move to Relation.thy? *)</span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">strict_order</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≡</span> irrefl <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">∧</span> trans <span class="free"><span class="bound"><span class="entity">R</span></span></span>"</span></span>

<span class="comment1">(* move to Relation.thy? *)</span>
<span class="keyword1"><span class="command">lemma</span></span> order_asym<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="free">R</span> <span class="main">⟹</span> asym <span class="free">R</span> <span class="main">=</span> irrefl <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> asym.simps irrefl_def trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>

<span class="comment1">(* move to Relation.thy? *)</span>
<span class="keyword1"><span class="command">lemma</span></span> strict_order_strict<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_order <span class="free">q</span> <span class="main">⟹</span> strict <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">q</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> trans_def irrefl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="comment1">(* move to Wellfounded.thy? *)</span>
<span class="keyword1"><span class="command">lemma</span></span> mono_lex1<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> lex_prod <span class="bound">r</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono_def<span class="main">)</span>

<span class="comment1">(* move to Wellfounded.thy? *)</span>
<span class="keyword1"><span class="command">lemma</span></span> mono_lex2<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span>lex_prod <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono_def<span class="main">)</span>

<span class="comment1">(* move to Wellfounded.thy? *)</span>
<span class="keyword1"><span class="command">lemma</span></span> irrefl_lex_prod<span class="main">:</span> <span class="quoted"><span class="quoted">"irrefl <span class="free">R</span> <span class="main">⟹</span> irrefl <span class="free">S</span> <span class="main">⟹</span> irrefl <span class="main">(</span><span class="free">R</span> <span class="keyword1">&lt;*lex*&gt;</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lex_prod_def irrefl_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> converse_inward <span class="main">=</span> rtrancl_converse<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> converse_Un converse_UNION converse_relcomp
  converse_converse converse_Id


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Complete lattices and least fixed points›</span></span>

<span class="keyword1"><span class="command">context</span></span> complete_lattice
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹A chain-based induction principle›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">set_chain</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">set_chain</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∨</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">x</span>"</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> lfp_chain_induct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> chain<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">C</span><span class="main">.</span> set_chain <span class="bound">C</span> <span class="main">⟹</span> <span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">C</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>Sup <span class="bound">C</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>lfp <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> lfp_eq_fixp<span class="main">[</span><span class="operator">OF</span> mono<span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> fixp_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monotone <span class="main">(≤)</span> <span class="main">(≤)</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mono <span class="keyword1"><span class="command">unfolding</span></span> order_class.mono_def monotone_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>Sup <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> chain<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ccpo.admissible Sup <span class="main">(≤)</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chain ccpo.admissible_def Complete_Partial_Order.chain_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Preservation of transitivity, asymmetry, irreflexivity by suprema›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> trans_Sup_of_chain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set_chain <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">R</span><span class="main">.</span> <span class="bound">R</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">⟹</span> trans <span class="bound">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span>Sup <span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> transI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> Sup <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> Sup <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> Sup <span class="free">C</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> Sup <span class="free">C</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹set_chain <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">∪</span> <span class="skolem">S</span> <span class="main">=</span> <span class="skolem">R</span> <span class="main">∨</span> <span class="skolem">R</span> <span class="main">∪</span> <span class="skolem">S</span> <span class="main">=</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">∪</span> <span class="skolem">S</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> trans<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">∪</span> <span class="skolem">S</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">∪</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">∪</span> <span class="skolem">S</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⋃</span><span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> asym_Sup_of_chain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set_chain <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> asym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">R</span><span class="main">.</span> <span class="bound">R</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">⟹</span> asym <span class="bound">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"asym <span class="main">(</span>Sup <span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> asymI2 notI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> Sup <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted">"<span class="skolem"><span class="skolem">R</span></span>"</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> Sup <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted">"<span class="skolem"><span class="skolem">S</span></span>"</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹set_chain <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">∪</span> <span class="skolem">S</span> <span class="main">=</span> <span class="skolem">R</span> <span class="main">∨</span> <span class="skolem">R</span> <span class="main">∪</span> <span class="skolem">S</span> <span class="main">=</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">∪</span> <span class="skolem">S</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> asym <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> asym.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> strict_order_lfp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mono <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">R</span><span class="main">.</span> strict_order <span class="bound">R</span> <span class="main">⟹</span> strict_order <span class="main">(</span><span class="free">f</span> <span class="bound">R</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_order <span class="main">(</span>lfp <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> lfp_chain_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span> <span class="quoted"><span class="quoted">strict_order</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"set_chain <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">R</span> <span class="main">∈</span> <span class="skolem">C</span><span class="main">.</span> strict_order <span class="bound">R</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strict_order <span class="main">(</span>Sup <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> asym_Sup_of_chain trans_Sup_of_chain order_asym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> trans_lfp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mono <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">R</span><span class="main">.</span> trans <span class="bound">R</span> <span class="main">⟹</span> trans <span class="main">(</span><span class="free">f</span> <span class="bound">R</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span>lfp <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lfp_chain_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">trans</span></span></span><span class="main"><span class="main">]</span></span> assms trans_Sup_of_chain<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* complete_lattice *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Multiset extension›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mulex_iff_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"mulex <span class="free">r</span> <span class="free">M</span> <span class="free">N</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">M</span><span class="main">,</span><span class="free">N</span><span class="main">)</span> <span class="main">∈</span> mult <span class="main">{</span><span class="main">(</span><span class="bound">M</span><span class="main">,</span><span class="bound">N</span><span class="main">)</span> <span class="main">.</span> <span class="free">r</span> <span class="bound">M</span> <span class="bound">N</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mulex_on_def restrict_to_def mult_def mulex1_def tranclp_unfold<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> multI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">=</span> <span class="free">I</span> <span class="main">+</span> <span class="free">K</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">=</span> <span class="free">I</span> <span class="main">+</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> set_mset <span class="free">K</span><span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">∈</span> set_mset <span class="free">J</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span><span class="main">,</span><span class="free">N</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms one_step_implies_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> multE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span><span class="main">,</span><span class="free">N</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">I</span> <span class="free">J</span> <span class="free">K</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">=</span> <span class="free">I</span> <span class="main">+</span> <span class="free">K</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">=</span> <span class="free">I</span> <span class="main">+</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> set_mset <span class="free">K</span><span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">∈</span> set_mset <span class="free">J</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> mult_implies_one_step<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_on_union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span><span class="main">,</span><span class="free">N</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">r</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">K</span> <span class="main">+</span> <span class="free">M</span><span class="main">,</span> <span class="free">K</span> <span class="main">+</span> <span class="free">N</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> mulex_on_union<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="quoted">UNIV</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mulex_iff_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_on_union'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span><span class="main">,</span><span class="free">N</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">r</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">M</span> <span class="main">+</span> <span class="free">K</span><span class="main">,</span> <span class="free">N</span> <span class="main">+</span> <span class="free">K</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> mulex_on_union'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="quoted">UNIV</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mulex_iff_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_on_add_mset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span><span class="main">,</span><span class="free">N</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">r</span> <span class="main">⟹</span> <span class="main">(</span>add_mset <span class="free">k</span> <span class="free">M</span><span class="main">,</span> add_mset <span class="free">k</span> <span class="free">N</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> add_mset_add_single<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> add_mset_add_single<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">N</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_on_union'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span><span class="main">,</span><span class="main">{#}</span><span class="main">)</span> <span class="main">∉</span> mult <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_def not_less_empty trancl.cases<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_singleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">⟹</span> <span class="main">(</span>add_mset <span class="free">x</span> <span class="free">M</span><span class="main">,</span> add_mset <span class="free">y</span> <span class="free">M</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> add_mset_add_single<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> add_mset_add_single<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_on_union<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> mult1_singleton<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_def mult_on_union<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> empty_mult<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#}</span><span class="main">,</span><span class="free">N</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">R</span> <span class="main">⟷</span> <span class="free">N</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> empty_mulex_on<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span> <span class="quoted">UNIV</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">M</span> <span class="bound">N</span><span class="main">.</span> <span class="main">(</span><span class="bound">M</span><span class="main">,</span><span class="bound">N</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mulex_iff_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> trans_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span>mult <span class="free">R</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> strict_order_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"irrefl <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irrefl <span class="main">(</span>mult <span class="free">R</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span>mult <span class="free">R</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"irrefl <span class="main">(</span>mult <span class="free">R</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> irrefl_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> multE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹trans <span class="free">R</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span> <span class="skolem">I</span> <span class="skolem">J</span> <span class="skolem">K</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="skolem">I</span> <span class="main">+</span> <span class="skolem">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="skolem">I</span> <span class="main">+</span> <span class="skolem">K</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> set_mset <span class="skolem">K</span><span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">∈</span> set_mset <span class="skolem">J</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">=</span> <span class="skolem">I</span> <span class="main">+</span> <span class="skolem">J</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">=</span> <span class="skolem">I</span> <span class="main">+</span> <span class="skolem">K</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="main">=</span> <span class="skolem">K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>set_mset <span class="skolem">J</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="skolem">J</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">=</span> <span class="skolem">K</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
         <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> assms insert_absorb insert_iff insert_not_empty irrefl_def transD<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">≠</span> <span class="main">{#}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_of_image_mset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">R'</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set_mset <span class="free">N</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> set_mset <span class="free">M</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">,</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R'</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">N</span><span class="main">,</span> <span class="free">M</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>image_mset <span class="free">f</span> <span class="free">N</span><span class="main">,</span> image_mset <span class="free">f</span> <span class="free">M</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">R'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> multE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">J</span> <span class="skolem">K</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">=</span> <span class="skolem">I</span> <span class="main">+</span> <span class="skolem">K</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">=</span> <span class="skolem">I</span> <span class="main">+</span> <span class="skolem">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> set_mset <span class="skolem">K</span><span class="main">.</span> <span class="main">∃</span><span class="bound">j</span> <span class="main">∈</span> set_mset <span class="skolem">J</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>image_mset <span class="free">f</span> <span class="free">N</span><span class="main">,</span> image_mset <span class="free">f</span> <span class="free">M</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">R'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> multI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Incrementality of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">mult1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">mult</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_mult1<span class="main">:</span> <span class="quoted"><span class="quoted">"mono mult1"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> mono_def mult1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"mono mult"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> mono_def mult_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">R</span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">⊆</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>mult1 <span class="skolem">R</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>mult1 <span class="skolem">S</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mono_mult1<span class="main">[</span><span class="operator">unfolded</span> mono_def<span class="main">]</span> trancl_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"mult1 <span class="skolem">R</span>"</span></span> <span class="quoted"><span class="quoted">"mult1 <span class="skolem">S</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Well-orders and well-quasi-orders›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> wf_iff_wfp_on<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wf <span class="free">p</span> <span class="main">⟷</span> wfp_on <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">p</span><span class="main">)</span> UNIV"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> wfp_on_iff_inductive_on wf_def inductive_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> well_order_implies_wqo<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"well_order <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wqo_on <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span> UNIV"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> wqo_onI almost_full_onI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"transp_on <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span> UNIV"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> well_order_on_def linear_order_on_def partial_order_on_def preorder_on_def
    trans_def transp_on_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"good <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> well_order_on_def wf_iff_wfp_on wfp_on_def not_ex not_all de_Morgan_conj
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> conjE allE exE<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"linear_order <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">∉</span> UNIV <span class="main">∨</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span><span class="main">,</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∉</span> <span class="free">r</span> <span class="main">-</span> Id"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">,</span> <span class="skolem">f</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹linear_order <span class="free">r</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> linear_order_on_def Relation.total_on_def partial_order_on_def preorder_on_def
      refl_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"good <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> good_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Splitting lists into prefix, element, and suffix›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">list_splits</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> list<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">list_splits</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">list_splits</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">#</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">x'</span><span class="main">,</span> <span class="bound">xs'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="bound">xs</span><span class="main">,</span> <span class="bound">x'</span><span class="main">,</span> <span class="bound">xs'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">list_splits</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_splits_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"list_splits <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> elem_list_splits_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ys</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">zs</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>list_splits <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">@</span> <span class="free">zs</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> elem_list_splits_length<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ys</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">zs</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>list_splits <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">zs</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> elem_list_splits_append<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> elem_list_splits_elem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">ys</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>list_splits <span class="free">zs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> set <span class="free">zs</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> elem_list_splits_append<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> list_splits_append<span class="main">:</span>
  <span class="quoted"><span class="quoted">"list_splits <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">xs'</span><span class="main">,</span> <span class="bound">x'</span><span class="main">,</span> <span class="bound">ys'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">xs'</span><span class="main">,</span> <span class="bound">x'</span><span class="main">,</span> <span class="bound">ys'</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>list_splits <span class="free">xs</span><span class="main">)</span> <span class="main">@</span>
                           map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">xs'</span><span class="main">,</span> <span class="bound">x'</span><span class="main">,</span> <span class="bound">ys'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="bound">xs'</span><span class="main">,</span> <span class="bound">x'</span><span class="main">,</span> <span class="bound">ys'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>list_splits <span class="free">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> list_splits_rev<span class="main">:</span>
  <span class="quoted"><span class="quoted">"list_splits <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">x</span><span class="main">,</span> <span class="bound">ys</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>rev <span class="bound">ys</span><span class="main">,</span> <span class="bound">x</span><span class="main">,</span> rev <span class="bound">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span>list_splits <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_splits_append comp_def prod.case_distrib rev_map<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_splits_map<span class="main">:</span>
  <span class="quoted"><span class="quoted">"list_splits <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">x</span><span class="main">,</span> <span class="bound">ys</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>map <span class="free">f</span> <span class="bound">xs</span><span class="main">,</span> <span class="free">f</span> <span class="bound">x</span><span class="main">,</span> map <span class="free">f</span> <span class="bound">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>list_splits <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* Decreasing_Diagrams_II_Aux *)</span>
</pre>
</div><div id="Decreasing_Diagrams_II">
<div class="head">
<h1>Theory Decreasing_Diagrams_II</h1>
</div>
<pre class="source"><span class="comment1">(*
 * Title:      Decreasing Diagrams II  
 * Author:     Bertram Felgenhauer (2015)
 * Maintainer: Bertram Felgenhauer &lt;bertram.felgenhauer@uibk.ac.at&gt;
 * License:    LGPL
 *)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Decreasing Diagrams›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Decreasing_Diagrams_II
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Decreasing_Diagrams_II_Aux.html">Decreasing_Diagrams_II_Aux</a>
  <span class="quoted">"<a href="../../HOL/HOL-Cardinals/Wellorder_Extension.html">HOL-Cardinals.Wellorder_Extension</a>"</span>
  <span class="quoted">"<a href="../Abstract-Rewriting/Abstract_Rewriting.html">Abstract-Rewriting.Abstract_Rewriting</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Greek accents›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> accent <span class="main">=</span> Acute <span class="main">|</span> Grave <span class="main">|</span> Macron

<span class="keyword1"><span class="command">lemma</span></span> UNIV_accent<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">{</span> Acute<span class="main">,</span> Grave<span class="main">,</span> Macron <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> accent.nchotomy <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_accent<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>UNIV <span class="main">::</span> accent set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UNIV_accent<span class="main">)</span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> letter <span class="main">=</span> <span class="quoted"><span class="quoted">"accent <span class="main">×</span> <span class="tfree">'a</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">letter_less</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> letter <span class="main">×</span> <span class="tfree">'a</span> letter<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">letter_less</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>snd <span class="bound">a</span><span class="main">,</span> snd <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_letter_less<span class="main">:</span> <span class="quoted"><span class="quoted">"mono letter_less"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Comparing Greek strings›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> greek <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> letter list"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">adj_msog</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> greek <span class="main">⇒</span> <span class="tfree">'a</span> greek <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> letter <span class="main">×</span> <span class="tfree">'a</span> greek<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> letter <span class="main">×</span> <span class="tfree">'a</span> greek<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">adj_msog</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">zs</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≡</span>
    <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">ys</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="keyword1">case</span> fst <span class="bound">y</span> <span class="keyword1">of</span> Acute <span class="main">⇒</span> <span class="bound">ys</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">zs</span></span></span> <span class="main">|</span> Grave <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">@</span> <span class="bound">ys</span> <span class="main">|</span> Macron <span class="main">⇒</span> <span class="bound">ys</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ms_of_greek</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> greek <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> letter <span class="main">×</span> <span class="tfree">'a</span> greek<span class="main">)</span> multiset"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ms_of_greek</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">=</span> mset
    <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">xs</span><span class="main">,</span> <span class="bound">y</span><span class="main">,</span> <span class="bound">zs</span><span class="main">)</span> <span class="main">⇒</span> adj_msog <span class="bound">xs</span> <span class="bound">zs</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>list_splits <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> adj_msog_adj_msog<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"adj_msog <span class="free">xs</span> <span class="free">zs</span> <span class="main">(</span>adj_msog <span class="free">xs'</span> <span class="free">zs'</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> adj_msog <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">xs'</span><span class="main">)</span> <span class="main">(</span><span class="free">zs'</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adj_msog_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> accent.splits prod.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> compose_adj_msog<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"adj_msog <span class="free">xs</span> <span class="free">zs</span> <span class="main">∘</span> adj_msog <span class="free">xs'</span> <span class="free">zs'</span> <span class="main">=</span> adj_msog <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">xs'</span><span class="main">)</span> <span class="main">(</span><span class="free">zs'</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> adj_msog_single<span class="main">:</span>
  <span class="quoted"><span class="quoted">"adj_msog <span class="free">xs</span> <span class="free">zs</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="main">(</span><span class="keyword1">case</span> fst <span class="free">x</span> <span class="keyword1">of</span> Grave <span class="main">⇒</span> <span class="free">xs</span> <span class="main">|</span> Acute <span class="main">⇒</span> <span class="free">zs</span> <span class="main">|</span> Macron <span class="main">⇒</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adj_msog_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> accent.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ms_of_greek_elem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> set_mset <span class="main">(</span>ms_of_greek <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> elem_list_splits_elem <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adj_msog_def ms_of_greek_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ms_of_greek_shorter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="main">∈#</span> ms_of_greek <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">s</span> <span class="main">&gt;</span> length <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> ms_of_greek_def in_multiset_in_set<span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> elem_list_splits_length adj_msog_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> accent.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> msog_append<span class="main">:</span> <span class="quoted"><span class="quoted">"ms_of_greek <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> image_mset <span class="main">(</span>adj_msog <span class="main">[]</span> <span class="free">ys</span><span class="main">)</span> <span class="main">(</span>ms_of_greek <span class="free">xs</span><span class="main">)</span> <span class="main">+</span>
  image_mset <span class="main">(</span>adj_msog <span class="free">xs</span> <span class="main">[]</span><span class="main">)</span> <span class="main">(</span>ms_of_greek <span class="free">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ms_of_greek_def list_splits_append multiset.map_comp comp_def prod.case_distrib<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nest</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> greek <span class="main">×</span> <span class="tfree">'a</span> greek<span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> greek <span class="main">×</span> <span class="tfree">'a</span> greek<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nest</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>ms_of_greek <span class="bound">a</span><span class="main">,</span> ms_of_greek <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> mult <span class="main">(</span>letter_less <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="keyword1">&lt;*lex*&gt;</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_nest<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span>nest <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> mono_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">R</span> <span class="skolem">S</span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">⊆</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> nest <span class="free">r</span> <span class="skolem">R</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mult <span class="main">(</span>letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">⊆</span> mult <span class="main">(</span>letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> <span class="skolem">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mono_mult mono_lex2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"letter_less <span class="free">r</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> mono_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> nest <span class="free">r</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nest_mono<span class="main">[</span><span class="operator">mono_set</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊆</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> nest <span class="free">r</span> <span class="free">x</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> nest <span class="free">r</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> mono_nest<span class="main">[</span><span class="operator">unfolded</span> mono_def<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">greek_less</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> greek <span class="main">×</span> <span class="tfree">'a</span> greek<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">greek_less</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> lfp <span class="main">(</span>nest <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> greek_less_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"greek_less <span class="free">r</span> <span class="main">=</span> nest <span class="free">r</span> <span class="main">(</span>greek_less <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> mono_nest<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span> lfp_unfold<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"nest <span class="free">r</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> greek_less_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Preservation of strict partial orders›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> strict_order_letter_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_order <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_order <span class="main">(</span>letter_less <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> irrefl_def trans_def letter_less_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">lemma</span></span> strict_order_nest<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_order <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_order <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_order <span class="main">(</span>nest <span class="free">r</span> <span class="free">R</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_order <span class="main">(</span>mult <span class="main">(</span>letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> strict_order_letter_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span> irrefl_lex_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"letter_less <span class="free">r</span>"</span></span> <span class="quoted"><span class="free">R</span></span><span class="main">]</span>
    trans_lex_prod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"letter_less <span class="free">r</span>"</span></span> <span class="quoted"><span class="free">R</span></span><span class="main">]</span> strict_order_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"letter_less <span class="free"><span class="free">r</span></span> <span class="keyword1"><span class="keyword1">&lt;*lex*&gt;</span></span> <span class="free"><span class="free">R</span></span>"</span></span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strict_order <span class="main">(</span>nest <span class="free">r</span> <span class="free">R</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nest_def trans_def irrefl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> strict_order_greek_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_order <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_order <span class="main">(</span>greek_less <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> greek_less_def strict_order_lfp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mono_nest strict_order_nest<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> trans_letter_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span>letter_less <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> trans_def letter_less_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">lemma</span></span> trans_order_nest<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span>nest <span class="free">r</span> <span class="free">R</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> trans_mult <span class="keyword1"><span class="command">unfolding</span></span> nest_def trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">lemma</span></span> trans_greek_less<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span>greek_less <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> greek_less_unfold<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> trans_order_nest<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_greek_less<span class="main">:</span> <span class="quoted"><span class="quoted">"mono greek_less"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> greek_less_def mono_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI lfp_mono<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">R</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> greek <span class="main">×</span> <span class="tfree">'a</span> greek<span class="main">)</span> set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">⊆</span> <span class="skolem">s</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"letter_less <span class="skolem">r</span> <span class="keyword1">&lt;*lex*&gt;</span> <span class="skolem">R</span> <span class="main">⊆</span> letter_less <span class="skolem">s</span> <span class="keyword1">&lt;*lex*&gt;</span> <span class="skolem">R</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mono_letter_less mono_lex1 <span class="keyword1"><span class="command">unfolding</span></span> mono_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nest <span class="skolem">r</span> <span class="skolem">R</span> <span class="main">⊆</span> nest <span class="skolem">s</span> <span class="skolem">R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mono_mult <span class="keyword1"><span class="command">unfolding</span></span> nest_def mono_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Involution›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inv_letter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> letter <span class="main">⇒</span> <span class="tfree">'a</span> letter"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inv_letter</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≡</span>
    <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">a</span> <span class="keyword1">of</span> Grave <span class="main">⇒</span> Acute <span class="main">|</span> Acute <span class="main">⇒</span> Grave <span class="main">|</span> Macron <span class="main">⇒</span> Macron<span class="main">,</span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inv_letter_pair<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"inv_letter <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">a</span> <span class="keyword1">of</span> Grave <span class="main">⇒</span> Acute <span class="main">|</span> Acute <span class="main">⇒</span> Grave <span class="main">|</span> Macron <span class="main">⇒</span> Macron<span class="main">,</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_letter_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> snd_inv_letter<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"snd <span class="main">(</span>inv_letter <span class="free">x</span><span class="main">)</span> <span class="main">=</span> snd <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_letter_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inv_letter_invol<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"inv_letter <span class="main">(</span>inv_letter <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_letter_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits accent.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inv_letter_mono<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> letter_less <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv_letter <span class="free">x</span><span class="main">,</span> inv_letter <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> letter_less <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inv_greek</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> greek <span class="main">⇒</span> <span class="tfree">'a</span> greek"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inv_greek</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> rev <span class="main">(</span>map inv_letter <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inv_greek_invol<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"inv_greek <span class="main">(</span>inv_greek <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_greek_def rev_map comp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inv_greek_append<span class="main">:</span>
  <span class="quoted"><span class="quoted">"inv_greek <span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> inv_greek <span class="free">t</span> <span class="main">@</span> inv_greek <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_greek_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inv_msog</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> letter <span class="main">×</span> <span class="tfree">'a</span> greek<span class="main">)</span> multiset <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> letter <span class="main">×</span> <span class="tfree">'a</span> greek<span class="main">)</span> multiset"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inv_msog</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> image_mset <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>inv_letter <span class="bound">x</span><span class="main">,</span> inv_greek <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inv_msog_invol<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"inv_msog <span class="main">(</span>inv_msog <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_msog_def multiset.map_comp comp_def prod.case_distrib<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ms_of_greek_inv_greek<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ms_of_greek <span class="main">(</span>inv_greek <span class="free">M</span><span class="main">)</span> <span class="main">=</span> inv_msog <span class="main">(</span>ms_of_greek <span class="free">M</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> inv_msog_def inv_greek_def ms_of_greek_def list_splits_rev list_splits_map mset_map
  multiset.map_comp mset_rev inv_letter_def adj_msog_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"image_mset"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span> refl<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> accent.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inv_greek_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv_greek <span class="free">s</span><span class="main">,</span> inv_greek <span class="free">t</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"length <span class="free">s</span> <span class="main">+</span> length <span class="free">t</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> trans_lex_prod<span class="main">[</span><span class="operator">OF</span> trans_letter_less<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹trans <span class="free">r</span>›</span></span><span class="main"><span class="main">]</span></span> trans_greek_less<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">s</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv_msog <span class="main">(</span>ms_of_greek <span class="skolem">s</span><span class="main">)</span><span class="main">,</span> inv_msog <span class="main">(</span>ms_of_greek <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> mult <span class="main">(</span>letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inv_msog_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> mult_of_image_mset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> * *<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> less<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ms_of_greek_shorter<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> greek_less_unfold<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> greek_less_unfold<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ms_of_greek_inv_greek<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Monotonicity of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"greek_less <span class="free"><span class="free">r</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> greek_less_rempty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span> <span class="main">⟷</span> False"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> greek_less_unfold<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ms_of_greek_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> greek_less_nonempty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> nest <span class="free">r</span> <span class="main">(</span>greek_less <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> greek_less_unfold<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> greek_less_lempty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span> <span class="main">⟷</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> greek_less_rempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> greek_less_nonempty<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ms_of_greek_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> greek_less_singleton<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> letter_less <span class="free">r</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> greek_less_unfold<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> accent.splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adj_msog_def ms_of_greek_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ms_of_greek_cons<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ms_of_greek <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">{#</span> adj_msog <span class="main">[]</span> <span class="free">s</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span> <span class="main">#}</span> <span class="main">+</span> image_mset <span class="main">(</span>adj_msog <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">[]</span><span class="main">)</span> <span class="main">(</span>ms_of_greek <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> msog_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adj_msog_def ms_of_greek_def accent.splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> greek_less_cons_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">s</span><span class="main">,</span> <span class="free">x</span> <span class="main">#</span> <span class="free">t</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"length <span class="free">s</span> <span class="main">+</span> length <span class="free">t</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> trans_lex_prod<span class="main">[</span><span class="operator">OF</span> trans_letter_less<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹trans <span class="free">r</span>›</span></span><span class="main"><span class="main">]</span></span> trans_greek_less<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">s</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">M</span> <span class="main">+</span> image_mset <span class="main">(</span>adj_msog <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">[]</span><span class="main">)</span> <span class="main">(</span>ms_of_greek <span class="skolem">s</span><span class="main">)</span><span class="main">,</span>
      <span class="skolem">M</span> <span class="main">+</span> image_mset <span class="main">(</span>adj_msog <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">[]</span><span class="main">)</span> <span class="main">(</span>ms_of_greek <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> mult <span class="main">(</span>letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mult_on_union<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> mult_of_image_mset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> * *<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> adj_msog_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> less<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits accent.splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ms_of_greek_shorter<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> greek_less_unfold<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{#</span> adj_msog <span class="main">[]</span> <span class="skolem">s</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span> <span class="main">#}</span> <span class="main">+</span> <span class="skolem">N</span><span class="main">,</span><span class="main">{#</span> adj_msog <span class="main">[]</span> <span class="skolem">t</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span> <span class="main">#}</span> <span class="main">+</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">∈</span>
      <span class="main">(</span>mult <span class="main">(</span>letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adj_msog_def less <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> accent.splits<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> transD<span class="main">[</span><span class="operator">OF</span> trans_mult<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> greek_less_unfold<span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ms_of_greek_cons<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> greek_less_app_mono2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">s</span><span class="main">,</span> <span class="free">p</span> <span class="main">@</span> <span class="free">t</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> greek_less_cons_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> greek_less_app_mono1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="free">p</span><span class="main">,</span> <span class="free">t</span> <span class="main">@</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> inv_greek_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="quoted">"inv_greek <span class="free">p</span> <span class="main">@</span> inv_greek <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"inv_greek <span class="free">p</span> <span class="main">@</span> inv_greek <span class="free">t</span>"</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms inv_greek_append inv_greek_mono greek_less_app_mono2<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Well-founded-ness of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"greek_less <span class="free"><span class="free">r</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> greek_embed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list_emb <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">:</span> reflcl <span class="main">(</span>letter_less <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> reflcl <span class="main">(</span>greek_less <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_emb.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>list_emb_Cons <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> trans_greek_less<span class="main">[</span><span class="operator">unfolded</span> trans_def<span class="main">]</span> <span class="quoted"><span class="quoted">‹trans <span class="free">r</span>›</span></span>
    greek_less_app_mono1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">y</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> greek_less_app_mono2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">y</span><span class="main">]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>list_emb_Cons2 <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> trans_greek_less<span class="main">[</span><span class="operator">unfolded</span> trans_def<span class="main">]</span> <span class="quoted"><span class="quoted">‹trans <span class="free">r</span>›</span></span> greek_less_singleton<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span>
    greek_less_app_mono1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">x</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">y</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> greek_less_app_mono2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">y</span><span class="main">]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> wqo_letter_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"wqo_on <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span><span class="main">)</span> UNIV"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wqo_on <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>letter_less <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span><span class="main">)</span> UNIV"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wqo_on_hom<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">id</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"prod_le <span class="main"><span class="main">(=)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">a</span></span> <span class="bound"><span class="bound">b</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">a</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">b</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">∈</span></span> <span class="free"><span class="free">r</span></span><span class="main"><span class="main"><span class="hidden">⇧</span><sup>=</sup></span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> image_id id_apply<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wqo_on <span class="main">(</span>prod_le <span class="main">(</span><span class="main">(=)</span> <span class="main">::</span> accent <span class="main">⇒</span> accent <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span><span class="main">)</span><span class="main">)</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dickson<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_eq_wqo_on<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_accent<span class="main"><span class="main">]</span></span> w<span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> UNIV_Times_UNIV<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> t<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> transp_on_def trans_def prod_le_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> wf_greek_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">(</span>greek_less <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">⊆</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"well_order <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> total_well_order_extension <span class="quoted"><span class="quoted">‹wf <span class="free">r</span>›</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">-</span> Id"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹well_order <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reflcl <span class="skolem">q'</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> well_order_on_def linear_order_on_def partial_order_on_def preorder_on_def
      refl_on_def q'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹well_order <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trans <span class="skolem">q'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"irrefl <span class="skolem">q'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> well_order_on_def linear_order_on_def partial_order_on_def preorder_on_def antisym_def
    trans_def irrefl_def q'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">⊆</span> <span class="skolem">q</span>›</span></span> <span class="quoted"><span class="quoted">‹wf <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">⊆</span> <span class="skolem">q'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wqo_on <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>greek_less <span class="skolem">q'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span><span class="main">)</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> wqo_on_hom<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">a</span></span> <span class="bound"><span class="bound">b</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">a</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">b</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">∈</span></span> <span class="main"><span class="main">(</span></span>greek_less <span class="skolem"><span class="skolem">q'</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main"><span class="hidden">⇧</span><sup>=</sup></span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"id"</span></span></span> <span class="quoted"><span class="quoted">UNIV</span></span>
         <span class="quoted"><span class="quoted"><span class="quoted">"list_emb <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">a</span></span> <span class="bound"><span class="bound">b</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">a</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">b</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">∈</span></span> <span class="main"><span class="main">(</span></span>letter_less <span class="skolem"><span class="skolem">q'</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main"><span class="hidden">⇧</span><sup>=</sup></span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> surj_id<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"transp_on <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>greek_less <span class="skolem">q'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span><span class="main">)</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">using</span></span> trans_greek_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> trans_def transp_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>UNIV<span class="main">.</span> list_emb <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>letter_less <span class="skolem">q'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span>
          <span class="main">(</span>id <span class="bound">x</span><span class="main">,</span> id <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>greek_less <span class="skolem">q'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> greek_embed<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹trans <span class="skolem">q'</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wqo_on <span class="main">(</span>list_emb <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>letter_less <span class="skolem">q'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span><span class="main">)</span><span class="main">)</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">using</span></span> higman<span class="main">[</span><span class="operator">OF</span> wqo_letter_less<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹trans <span class="skolem">q'</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹well_order <span class="skolem">q</span>›</span></span> <span class="quoted"><span class="quoted">‹reflcl <span class="skolem">q'</span> <span class="main">=</span> <span class="skolem">q</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> well_order_implies_wqo<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> wqo_on_imp_wfp_on<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> strict_order_strict<span class="main">[</span><span class="operator">OF</span> strict_order_greek_less<span class="main">]</span>
    <span class="quoted"><span class="quoted">‹irrefl <span class="skolem">q'</span>›</span></span> <span class="quoted"><span class="quoted">‹trans <span class="skolem">q'</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wfp_on <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="skolem">q'</span><span class="main">)</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> mono_greek_less <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">⊆</span> <span class="skolem">q'</span>›</span></span> wf_subset <span class="keyword1"><span class="command">unfolding</span></span> wf_iff_wfp_on<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> mono_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Comparisons›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pairwise_imp_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set_mset <span class="free">M</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span> <span class="main">∈</span> set_mset <span class="free">N</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span><span class="main">,</span> <span class="free">N</span><span class="main">)</span> <span class="main">∈</span> mult <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms one_step_implies_mult<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">{#}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> singleton_greek_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">as</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">as</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> set_mset <span class="main">(</span>ms_of_greek <span class="free">as</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> as ms_of_greek_elem<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">as</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e</span><span class="main">,</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adj_msog_def under_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ms_of_greek <span class="main">[</span><span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ms_of_greek_def adj_msog_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> accent.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> greek_less_unfold<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> pairwise_imp_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> peak_greek_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">as</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">[</span><span class="main">(</span>Grave<span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">]</span><span class="main">,</span><span class="main">[]</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> cs<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">cs</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="free">a</span> <span class="main">∪</span> under <span class="free">r</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">[</span><span class="main">(</span>Acute<span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">]</span><span class="main">,</span><span class="main">[]</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> bs<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">bs</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">b'</span> <span class="main">@</span> <span class="free">cs</span> <span class="main">@</span> <span class="free">a'</span> <span class="main">@</span> <span class="free">bs</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span>Acute<span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Grave<span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Acute<span class="main">,</span><span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Grave<span class="main">,</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ms_of_greek <span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">b'</span> <span class="main">@</span> <span class="free">cs</span> <span class="main">@</span> <span class="free">a'</span> <span class="main">@</span> <span class="free">bs</span><span class="main">)</span><span class="main">,</span> ms_of_greek <span class="main">[</span><span class="var">?A</span><span class="main">,</span><span class="var">?B</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> mult <span class="main">(</span>letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> pairwise_imp_mult<span class="main">)</span>
    <span class="comment1">(* we distinguish 5 cases depending on where in xs an element e originates *)</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> set_mset <span class="main">(</span>ms_of_greek <span class="free">as</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> as ms_of_greek_elem<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">as</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adj_msog <span class="main">[]</span> <span class="main">(</span><span class="free">b'</span> <span class="main">@</span> <span class="free">cs</span> <span class="main">@</span> <span class="free">a'</span> <span class="main">@</span> <span class="free">bs</span><span class="main">)</span> <span class="skolem">e</span><span class="main">,</span> <span class="main">(</span><span class="var">?A</span><span class="main">,</span><span class="main">[</span><span class="var">?B</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adj_msog_def under_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> set_mset <span class="main">(</span>ms_of_greek <span class="free">b'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> b' singleton_greek_less<span class="main">[</span><span class="operator">OF</span> as<span class="main">]</span> ms_of_greek_elem<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">b'</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adj_msog <span class="free">as</span> <span class="main">(</span><span class="free">cs</span> <span class="main">@</span> <span class="free">a'</span> <span class="main">@</span> <span class="free">bs</span><span class="main">)</span> <span class="skolem">e</span><span class="main">,</span> <span class="main">(</span><span class="var">?B</span><span class="main">,</span><span class="main">[</span><span class="var">?A</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adj_msog_def ms_of_greek_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> set_mset <span class="main">(</span>ms_of_greek <span class="free">cs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> cs ms_of_greek_elem<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">cs</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adj_msog <span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">b'</span><span class="main">)</span> <span class="main">(</span><span class="free">a'</span> <span class="main">@</span> <span class="free">bs</span><span class="main">)</span> <span class="skolem">e</span><span class="main">,</span> <span class="main">(</span><span class="var">?A</span><span class="main">,</span><span class="main">[</span><span class="var">?B</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span> <span class="main">∨</span>
            <span class="main">(</span>adj_msog <span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">b'</span><span class="main">)</span> <span class="main">(</span><span class="free">a'</span> <span class="main">@</span> <span class="free">bs</span><span class="main">)</span> <span class="skolem">e</span><span class="main">,</span> <span class="main">(</span><span class="var">?B</span><span class="main">,</span><span class="main">[</span><span class="var">?A</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adj_msog_def under_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> set_mset <span class="main">(</span>ms_of_greek <span class="free">a'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> a' singleton_greek_less<span class="main">[</span><span class="operator">OF</span> bs<span class="main">]</span> ms_of_greek_elem<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">a'</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adj_msog <span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">b'</span> <span class="main">@</span> <span class="free">cs</span><span class="main">)</span> <span class="free">bs</span> <span class="skolem">e</span><span class="main">,</span> <span class="main">(</span><span class="var">?A</span><span class="main">,</span><span class="main">[</span><span class="var">?B</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adj_msog_def ms_of_greek_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> set_mset <span class="main">(</span>ms_of_greek <span class="free">bs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> bs ms_of_greek_elem<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">bs</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adj_msog <span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">b'</span> <span class="main">@</span> <span class="free">cs</span> <span class="main">@</span> <span class="free">a'</span><span class="main">)</span> <span class="main">[]</span> <span class="skolem">e</span><span class="main">,</span> <span class="main">(</span><span class="var">?B</span><span class="main">,</span><span class="main">[</span><span class="var">?A</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adj_msog_def under_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ms_of_greek <span class="main">[</span><span class="var">?A</span><span class="main">,</span><span class="var">?B</span><span class="main">]</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span><span class="var">?B</span><span class="main">,</span><span class="main">[</span><span class="var">?A</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="var">?A</span><span class="main">,</span><span class="main">[</span><span class="var">?B</span><span class="main">]</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adj_msog_def ms_of_greek_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set_mset <span class="main">(</span>ms_of_greek <span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">b'</span> <span class="main">@</span> <span class="free">cs</span> <span class="main">@</span> <span class="free">a'</span> <span class="main">@</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
      <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span>set_mset <span class="main">(</span>ms_of_greek <span class="main">[</span><span class="var">?A</span><span class="main">,</span><span class="var">?B</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> msog_append<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ms_of_greek_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> greek_less_unfold<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rcliff_greek_less1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="comment1">(* unused assumption kept for symmetry with lcliff_greek_less1 *)</span>
  <span class="keyword2"><span class="keyword">and</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">as</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="free">a</span> <span class="main">∩</span> under <span class="free">r</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">[</span><span class="main">(</span>Grave<span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">]</span><span class="main">,</span><span class="main">[]</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> cs<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">cs</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a'</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span>Macron<span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> bs<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">bs</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">b'</span> <span class="main">@</span> <span class="free">cs</span> <span class="main">@</span> <span class="free">a'</span> <span class="main">@</span> <span class="free">bs</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span>Macron<span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Grave<span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Macron<span class="main">,</span><span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Grave<span class="main">,</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"ms_of_greek <span class="main">[</span><span class="var">?A</span><span class="main">,</span><span class="var">?B</span><span class="main">]</span> <span class="main">=</span> <span class="main">{#</span><span class="main">(</span><span class="var">?B</span><span class="main">,</span><span class="main">[</span><span class="var">?A</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="var">?A</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">#}</span>"</span></span> <span class="quoted"><span class="quoted">"ms_of_greek <span class="main">[</span><span class="var">?A</span><span class="main">]</span> <span class="main">=</span> <span class="main">{#</span><span class="main">(</span><span class="var">?A</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ms_of_greek_def adj_msog_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"ms_of_greek <span class="main">[</span><span class="main">(</span>Macron<span class="main">,</span> <span class="free">a</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>Grave<span class="main">,</span> <span class="free">b</span><span class="main">)</span><span class="main">]</span> <span class="main">-</span> <span class="main">{#</span><span class="main">(</span><span class="main">(</span>Macron<span class="main">,</span> <span class="free">a</span><span class="main">)</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">#}</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="comment1">(* we distinguish 5 cases depending on where in xs an element e originates *)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> set_mset <span class="main">(</span>ms_of_greek <span class="free">as</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> as ms_of_greek_elem<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">as</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adj_msog <span class="main">[]</span> <span class="main">(</span><span class="free">b'</span> <span class="main">@</span> <span class="free">cs</span> <span class="main">@</span> <span class="free">a'</span> <span class="main">@</span> <span class="free">bs</span><span class="main">)</span> <span class="skolem">e</span><span class="main">,</span> <span class="main">(</span><span class="var">?B</span><span class="main">,</span><span class="main">[</span><span class="var">?A</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adj_msog_def under_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> set_mset <span class="main">(</span>ms_of_greek <span class="free">b'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> b' singleton_greek_less as ms_of_greek_elem<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">b'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adj_msog <span class="free">as</span> <span class="main">(</span><span class="free">cs</span> <span class="main">@</span> <span class="free">a'</span> <span class="main">@</span> <span class="free">bs</span><span class="main">)</span> <span class="skolem">e</span><span class="main">,</span> <span class="main">(</span><span class="var">?B</span><span class="main">,</span><span class="main">[</span><span class="var">?A</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adj_msog_def ms_of_greek_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> set_mset <span class="main">(</span>ms_of_greek <span class="free">cs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> cs ms_of_greek_elem<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">cs</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adj_msog <span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">b'</span><span class="main">)</span> <span class="main">(</span><span class="free">a'</span> <span class="main">@</span> <span class="free">bs</span><span class="main">)</span> <span class="skolem">e</span><span class="main">,</span> <span class="main">(</span><span class="var">?B</span><span class="main">,</span><span class="main">[</span><span class="var">?A</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adj_msog_def under_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> set_mset <span class="main">(</span>ms_of_greek <span class="free">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> bs ms_of_greek_elem<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">bs</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adj_msog <span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">b'</span> <span class="main">@</span> <span class="free">cs</span> <span class="main">@</span> <span class="free">a'</span><span class="main">)</span> <span class="main">[]</span> <span class="skolem">e</span><span class="main">,</span> <span class="main">(</span><span class="var">?B</span><span class="main">,</span><span class="main">[</span><span class="var">?A</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adj_msog_def under_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ms_of_greek <span class="main">[</span><span class="var">?A</span><span class="main">,</span><span class="var">?B</span><span class="main">]</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span><span class="var">?B</span><span class="main">,</span><span class="main">[</span><span class="var">?A</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="var">?A</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adj_msog_def ms_of_greek_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set_mset <span class="main">(</span>ms_of_greek <span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">b'</span> <span class="main">@</span> <span class="free">cs</span> <span class="main">@</span> <span class="free">a'</span> <span class="main">@</span> <span class="free">bs</span><span class="main">)</span> <span class="main">-</span> <span class="main">{#</span><span class="main">(</span><span class="var">?A</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">#}</span><span class="main">)</span><span class="main">.</span>
    <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span>set_mset <span class="main">(</span>ms_of_greek <span class="main">[</span><span class="var">?A</span><span class="main">,</span><span class="var">?B</span><span class="main">]</span> <span class="main">-</span> <span class="main">{#</span><span class="main">(</span><span class="var">?A</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">#}</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> msog_append <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a' msog_append <span class="dynamic"><span class="dynamic">ac_simps</span></span> * adj_msog_single<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> one_step_implies_mult<span class="main">[</span><span class="operator">OF</span> ** this<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{#</span><span class="main">(</span><span class="var">?A</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">#}</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ms_of_greek <span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">b'</span> <span class="main">@</span> <span class="free">cs</span> <span class="main">@</span> <span class="free">a'</span> <span class="main">@</span> <span class="free">bs</span><span class="main">)</span><span class="main">,</span> ms_of_greek <span class="main">[</span><span class="var">?A</span><span class="main">,</span><span class="var">?B</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> mult <span class="main">(</span>letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> a' msog_append <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a' <span class="dynamic"><span class="dynamic">ac_simps</span></span> * adj_msog_single<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> greek_less_unfold<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rcliff_greek_less2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="comment1">(* unused assumption kept for symmetry with lcliff_greek_less2 *)</span>
  <span class="keyword2"><span class="keyword">and</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">as</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">[</span><span class="main">(</span>Grave<span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">]</span><span class="main">,</span><span class="main">[]</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> cs<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">cs</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="free">a</span> <span class="main">∪</span> under <span class="free">r</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">b'</span> <span class="main">@</span> <span class="free">cs</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span>Macron<span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Grave<span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Macron<span class="main">,</span><span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Grave<span class="main">,</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ms_of_greek <span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">b'</span> <span class="main">@</span> <span class="free">cs</span><span class="main">)</span><span class="main">,</span> ms_of_greek <span class="main">[</span><span class="var">?A</span><span class="main">,</span><span class="var">?B</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> mult <span class="main">(</span>letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> pairwise_imp_mult<span class="main">)</span>
    <span class="comment1">(* we distinguish 3 cases depending on where in xs an element e originates *)</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> set_mset <span class="main">(</span>ms_of_greek <span class="free">as</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> as ms_of_greek_elem<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">as</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adj_msog <span class="main">[]</span> <span class="main">(</span><span class="free">b'</span> <span class="main">@</span> <span class="free">cs</span><span class="main">)</span> <span class="skolem">e</span><span class="main">,</span> <span class="main">(</span><span class="var">?A</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adj_msog_def under_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> set_mset <span class="main">(</span>ms_of_greek <span class="free">b'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> b' singleton_greek_less<span class="main">[</span><span class="operator">OF</span> as<span class="main">]</span> ms_of_greek_elem<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">b'</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adj_msog <span class="free">as</span> <span class="main">(</span><span class="free">cs</span><span class="main">)</span> <span class="skolem">e</span><span class="main">,</span> <span class="main">(</span><span class="var">?B</span><span class="main">,</span><span class="main">[</span><span class="var">?A</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adj_msog_def ms_of_greek_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> set_mset <span class="main">(</span>ms_of_greek <span class="free">cs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> cs ms_of_greek_elem<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">cs</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adj_msog <span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">b'</span><span class="main">)</span> <span class="main">[]</span> <span class="skolem">e</span><span class="main">,</span> <span class="main">(</span><span class="var">?A</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span> <span class="main">∨</span>
            <span class="main">(</span>adj_msog <span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">b'</span><span class="main">)</span> <span class="main">[]</span> <span class="skolem">e</span><span class="main">,</span> <span class="main">(</span><span class="var">?B</span><span class="main">,</span><span class="main">[</span><span class="var">?A</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adj_msog_def under_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"ms_of_greek <span class="main">[</span><span class="var">?A</span><span class="main">,</span><span class="var">?B</span><span class="main">]</span> <span class="main">=</span> <span class="main">{#</span> <span class="main">(</span><span class="var">?B</span><span class="main">,</span><span class="main">[</span><span class="var">?A</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="var">?A</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span> <span class="main">#}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adj_msog_def ms_of_greek_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set_mset <span class="main">(</span>ms_of_greek <span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">b'</span> <span class="main">@</span> <span class="free">cs</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
      <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span>set_mset <span class="main">(</span>ms_of_greek <span class="main">[</span><span class="var">?A</span><span class="main">,</span><span class="var">?B</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> letter_less <span class="free">r</span> <span class="keyword1">&lt;*lex*&gt;</span> greek_less <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> msog_append adj_msog_single <span class="dynamic"><span class="dynamic">ac_simps</span></span> *<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ms_of_greek_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> greek_less_unfold<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> snd_inv_greek <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="main">(</span>inv_greek <span class="free">as</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">`</span> set <span class="free">as</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inv_greek_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lcliff_greek_less1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">as</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b'</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span>Macron<span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> cs<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">cs</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">[</span><span class="main">(</span>Acute<span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">]</span><span class="main">,</span><span class="main">[]</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> bs<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">bs</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="free">a</span> <span class="main">∩</span> under <span class="free">r</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">b'</span> <span class="main">@</span> <span class="free">cs</span> <span class="main">@</span> <span class="free">a'</span> <span class="main">@</span> <span class="free">bs</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span>Acute<span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Macron<span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"inv_greek <span class="main">[</span><span class="main">(</span>Acute<span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Macron<span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span>Macron<span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Grave<span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_greek_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv_greek <span class="main">(</span>inv_greek <span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">b'</span> <span class="main">@</span> <span class="free">cs</span> <span class="main">@</span> <span class="free">a'</span> <span class="main">@</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
   inv_greek <span class="main">(</span>inv_greek <span class="main">(</span><span class="main">[</span><span class="main">(</span>Acute<span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Macron<span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> inv_greek_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹trans <span class="free">r</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> inv_greek_append append_assoc *<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rcliff_greek_less1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inv_greek_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lcliff_greek_less2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> cs<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">cs</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="free">a</span> <span class="main">∪</span> under <span class="free">r</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">[</span><span class="main">(</span>Acute<span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">]</span><span class="main">,</span><span class="main">[]</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> bs<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">bs</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cs</span> <span class="main">@</span> <span class="free">a'</span> <span class="main">@</span> <span class="free">bs</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span>Acute<span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Macron<span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"inv_greek <span class="main">[</span><span class="main">(</span>Acute<span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Macron<span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span>Macron<span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Grave<span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_greek_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inv_greek <span class="main">(</span>inv_greek <span class="main">(</span><span class="free">cs</span> <span class="main">@</span> <span class="free">a'</span> <span class="main">@</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
    inv_greek <span class="main">(</span>inv_greek <span class="main">(</span><span class="main">[</span><span class="main">(</span>Acute<span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Macron<span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> inv_greek_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹trans <span class="free">r</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> inv_greek_append append_assoc *<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rcliff_greek_less2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inv_greek_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Labeled abstract rewriting›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">L</span> <span class="free">R</span> <span class="free">E</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lstep</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> letter <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">lstep</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">a</span> <span class="keyword1">of</span> Acute <span class="main">⇒</span> <span class="main">(</span><span class="free">L</span> <span class="bound">i</span><span class="main">)</span><span class="main">¯</span> <span class="main">|</span> Grave <span class="main">⇒</span> <span class="free">R</span> <span class="bound">i</span> <span class="main">|</span> Macron <span class="main">⇒</span> <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">lconv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> greek <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lconv</span> <span class="main">[]</span> <span class="main">=</span> Id"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">lconv</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> lstep <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">O</span> <span class="free">lconv</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lconv_append<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"lconv <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> lconv <span class="free">xs</span> <span class="keyword1">O</span> lconv <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> conversion_join_or_peak_or_cliff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>join<span class="main">)</span> <span class="free">as</span> <span class="free">bs</span> <span class="free">cs</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"set <span class="free">as</span> <span class="main">⊆</span> <span class="main">{</span>Grave<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">bs</span> <span class="main">⊆</span> <span class="main">{</span>Macron<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">cs</span> <span class="main">⊆</span> <span class="main">{</span>Acute<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ds</span> <span class="main">=</span> <span class="free">as</span> <span class="main">@</span> <span class="free">bs</span> <span class="main">@</span> <span class="free">cs</span>"</span></span>
  <span class="main">|</span> <span class="main">(</span>peak<span class="main">)</span> <span class="free">as</span> <span class="free">bs</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ds</span> <span class="main">=</span> <span class="free">as</span> <span class="main">@</span> <span class="main">(</span><span class="main">[</span>Acute<span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Grave<span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="free">bs</span>"</span></span>
  <span class="main">|</span> <span class="main">(</span>lcliff<span class="main">)</span> <span class="free">as</span> <span class="free">bs</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ds</span> <span class="main">=</span> <span class="free">as</span> <span class="main">@</span> <span class="main">(</span><span class="main">[</span>Acute<span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Macron<span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="free">bs</span>"</span></span>
  <span class="main">|</span> <span class="main">(</span>rcliff<span class="main">)</span> <span class="free">as</span> <span class="free">bs</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ds</span> <span class="main">=</span> <span class="free">as</span> <span class="main">@</span> <span class="main">(</span><span class="main">[</span>Macron<span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Grave<span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="free">bs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ds</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">thesis</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">d</span> <span class="skolem">ds</span> <span class="skolem">thesis</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">as</span> <span class="skolem">bs</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ds</span> <span class="main">=</span> <span class="skolem">as</span> <span class="main">@</span> <span class="main">(</span><span class="main">[</span>Acute<span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Grave<span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">#</span> <span class="skolem">as</span>"</span></span> <span class="quoted"><span class="skolem">bs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">as</span> <span class="skolem">bs</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ds</span> <span class="main">=</span> <span class="skolem">as</span> <span class="main">@</span> <span class="main">(</span><span class="main">[</span>Acute<span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Macron<span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">#</span> <span class="skolem">as</span>"</span></span> <span class="quoted"><span class="skolem">bs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">as</span> <span class="skolem">bs</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ds</span> <span class="main">=</span> <span class="skolem">as</span> <span class="main">@</span> <span class="main">(</span><span class="main">[</span>Macron<span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Grave<span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">#</span> <span class="skolem">as</span>"</span></span> <span class="quoted"><span class="skolem">bs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">as</span> <span class="skolem">bs</span> <span class="skolem">cs</span> <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">as</span> <span class="main">⊆</span> <span class="main">{</span>Grave<span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">bs</span> <span class="main">⊆</span> <span class="main">{</span>Macron<span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">cs</span> <span class="main">⊆</span> <span class="main">{</span>Acute<span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ds</span> <span class="main">=</span> <span class="skolem">as</span> <span class="main">@</span> <span class="skolem">bs</span> <span class="main">@</span> <span class="skolem">cs</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">d</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Grave <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> * IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">#</span> <span class="skolem">as</span>"</span></span> <span class="quoted"><span class="skolem">bs</span></span> <span class="quoted"><span class="skolem">cs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Macron <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">as</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> * Macron IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">as</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">#</span> <span class="skolem">bs</span>"</span></span> <span class="quoted"><span class="skolem">cs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">as</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> * Macron IH<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">@</span> <span class="skolem">bs</span> <span class="main">@</span> <span class="skolem">cs</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Acute <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">as</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">note</span></span> as <span class="main">=</span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bs</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> * as Acute IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">#</span> <span class="skolem">cs</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">b</span> <span class="skolem">bs</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> * as Acute IH<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs</span> <span class="main">@</span> <span class="skolem">cs</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">as</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> * Acute IH<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">@</span> <span class="skolem">bs</span> <span class="main">@</span> <span class="skolem">cs</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> map_eq_append_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">ys1</span> <span class="main">@</span> <span class="free">ys2</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">xs1</span> <span class="free">xs2</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys1</span> <span class="main">=</span> map <span class="free">f</span> <span class="free">xs1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys2</span> <span class="main">=</span> map <span class="free">f</span> <span class="free">xs2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="free">xs1</span> <span class="main">@</span> <span class="free">xs2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">ys1</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">thesis</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs'</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs1</span> <span class="skolem">xs2</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> map <span class="free">f</span> <span class="skolem">xs1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys2</span> <span class="main">=</span> map <span class="free">f</span> <span class="skolem">xs2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">=</span> <span class="skolem">xs1</span> <span class="main">@</span> <span class="skolem">xs2</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs1</span>"</span></span> <span class="quoted"><span class="skolem">xs2</span></span><span class="main">]</span> IH<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="skolem">xs'</span> <span class="main">=</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="free">ys2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons IH<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> Cons<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> map_eq_append_splits <span class="main">=</span> map_eq_append_split map_eq_append_split<span class="main">[</span><span class="operator">OF</span> sym<span class="main">]</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">conversion'</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> <span class="free">R</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> <span class="free">E</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> <span class="free">L</span> <span class="bound">i</span><span class="main">)</span><span class="main">¯</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">valley'</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span>  <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> <span class="free">R</span> <span class="bound">i</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="keyword1">O</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> <span class="free">E</span> <span class="bound">i</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="keyword1">O</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> <span class="free">L</span> <span class="bound">i</span><span class="main">)</span><span class="main">¯</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conversion_to_lconv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> conversion' <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">xs</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_rtrancl_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> base <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> base<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">u'</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> step<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">p</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u'</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> lstep <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> accent.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="skolem">xs</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> step<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">#</span> <span class="skolem">xs</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lpeak</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> rel <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> greek <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lpeak</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">as</span> <span class="bound">b'</span> <span class="bound">cs</span> <span class="bound">a'</span> <span class="bound">bs</span><span class="main">.</span> snd <span class="main">`</span> set <span class="bound">as</span> <span class="main">⊆</span> under <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="bound">b'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">[</span><span class="main">(</span>Grave<span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">,</span><span class="main">[]</span><span class="main">}</span> <span class="main">∧</span>
    snd <span class="main">`</span> set <span class="bound">cs</span> <span class="main">⊆</span> under <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∪</span> under <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="bound">a'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">[</span><span class="main">(</span>Acute<span class="main">,</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">,</span><span class="main">[]</span><span class="main">}</span> <span class="main">∧</span>
    snd <span class="main">`</span> set <span class="bound">bs</span> <span class="main">⊆</span> under <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="bound">as</span> <span class="main">@</span> <span class="bound">b'</span> <span class="main">@</span> <span class="bound">cs</span> <span class="main">@</span> <span class="bound">a'</span> <span class="main">@</span> <span class="bound">bs</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lcliff</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> rel <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> greek <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lcliff</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">as</span> <span class="bound">b'</span> <span class="bound">cs</span> <span class="bound">a'</span> <span class="bound">bs</span><span class="main">.</span> snd <span class="main">`</span> set <span class="bound">as</span> <span class="main">⊆</span> under <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="bound">b'</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span>Macron<span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">]</span> <span class="main">∧</span>
    snd <span class="main">`</span> set <span class="bound">cs</span> <span class="main">⊆</span> under <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="bound">a'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">[</span><span class="main">(</span>Acute<span class="main">,</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">,</span><span class="main">[]</span><span class="main">}</span> <span class="main">∧</span>
    snd <span class="main">`</span> set <span class="bound">bs</span> <span class="main">⊆</span> under <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∩</span> under <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="bound">as</span> <span class="main">@</span> <span class="bound">b'</span> <span class="main">@</span> <span class="bound">cs</span> <span class="main">@</span> <span class="bound">a'</span> <span class="main">@</span> <span class="bound">bs</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">cs</span> <span class="bound">a'</span> <span class="bound">bs</span><span class="main">.</span> snd <span class="main">`</span> set <span class="bound">cs</span> <span class="main">⊆</span> under <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∪</span> under <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="bound">a'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">[</span><span class="main">(</span>Acute<span class="main">,</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">,</span><span class="main">[]</span><span class="main">}</span> <span class="main">∧</span>
    snd <span class="main">`</span> set <span class="bound">bs</span> <span class="main">⊆</span> under <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="bound">cs</span> <span class="main">@</span> <span class="bound">a'</span> <span class="main">@</span> <span class="bound">bs</span><span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rcliff</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> rel <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> greek <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rcliff</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">as</span> <span class="bound">b'</span> <span class="bound">cs</span> <span class="bound">a'</span> <span class="bound">bs</span><span class="main">.</span> snd <span class="main">`</span> set <span class="bound">as</span> <span class="main">⊆</span> under <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∩</span> under <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="bound">b'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">[</span><span class="main">(</span>Grave<span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">,</span><span class="main">[]</span><span class="main">}</span> <span class="main">∧</span>
    snd <span class="main">`</span> set <span class="bound">cs</span> <span class="main">⊆</span> under <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="bound">a'</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span>Macron<span class="main">,</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">]</span> <span class="main">∧</span>
    snd <span class="main">`</span> set <span class="bound">bs</span> <span class="main">⊆</span> under <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="bound">as</span> <span class="main">@</span> <span class="bound">b'</span> <span class="main">@</span> <span class="bound">cs</span> <span class="main">@</span> <span class="bound">a'</span> <span class="main">@</span> <span class="bound">bs</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">as</span> <span class="bound">b'</span> <span class="bound">cs</span><span class="main">.</span> snd <span class="main">`</span> set <span class="bound">as</span> <span class="main">⊆</span> under <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="bound">b'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">[</span><span class="main">(</span>Grave<span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">,</span><span class="main">[]</span><span class="main">}</span> <span class="main">∧</span>
    snd <span class="main">`</span> set <span class="bound">cs</span> <span class="main">⊆</span> under <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∪</span> under <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="bound">as</span> <span class="main">@</span> <span class="bound">b'</span> <span class="main">@</span> <span class="bound">cs</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dd_commute_modulo_conv<span class="main">[</span><span class="operator">case_names</span> wf trans peak lcliff rcliff<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> pk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">L</span> <span class="bound">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">xs</span><span class="main">.</span> lpeak <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="bound">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> lc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">L</span> <span class="bound">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">xs</span><span class="main">.</span> lcliff <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="bound">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">E</span> <span class="bound">a</span><span class="main">)</span><span class="main">¯</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">xs</span><span class="main">.</span> rcliff <span class="free">r</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="bound">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conversion' UNIV <span class="main">⊆</span> valley' UNIV"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> subrelI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> conversion' UNIV"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> conversion_to_lconv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> valley' UNIV"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"greek_less <span class="free"><span class="free">r</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> wf_greek_less<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹wf <span class="free">r</span>›</span></span> <span class="quoted"><span class="quoted">‹trans <span class="free">r</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">xs</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conversion_join_or_peak_or_cliff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"map fst <span class="skolem"><span class="skolem">xs</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">as</span> <span class="skolem">bs</span> <span class="skolem">cs</span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">as</span> <span class="main">⊆</span> <span class="main">{</span>Grave<span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">bs</span> <span class="main">⊆</span> <span class="main">{</span>Macron<span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">cs</span> <span class="main">⊆</span> <span class="main">{</span>Acute<span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">as</span> <span class="main">@</span> <span class="skolem">bs</span> <span class="main">@</span> <span class="skolem">cs</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> valley' UNIV"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> map_eq_append_splits<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">as'</span> <span class="skolem">bs'</span> <span class="skolem">cs'</span> <span class="skolem">bcs'</span>
        <span class="keyword3"><span class="command">assume</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">as</span> <span class="main">⊆</span> <span class="main">{</span>Grave<span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">=</span> map fst <span class="skolem">as'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          bs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">bs</span> <span class="main">⊆</span> <span class="main">{</span>Macron<span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs</span> <span class="main">=</span> map fst <span class="skolem">bs'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          cs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">cs</span> <span class="main">⊆</span> <span class="main">{</span>Acute<span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cs</span> <span class="main">=</span> map fst <span class="skolem">cs'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">as'</span> <span class="main">@</span> <span class="skolem">bcs'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bcs'</span> <span class="main">=</span> <span class="skolem">bs'</span> <span class="main">@</span> <span class="skolem">cs'</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> as<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> as<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> as'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">as'</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">.</span> <span class="free">R</span> <span class="bound">a</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">as'</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x'</span> <span class="skolem">xs</span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="bound">i</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">.</span> <span class="free">R</span> <span class="bound">a</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">.</span> <span class="free">R</span> <span class="bound">a</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_trans<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> bs<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> bs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> bs'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">bs'</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">.</span> <span class="free">E</span> <span class="bound">a</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">bs'</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x'</span> <span class="skolem">xs</span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span> <span class="bound">i</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">.</span> <span class="free">E</span> <span class="bound">a</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">.</span> <span class="free">E</span> <span class="bound">a</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_trans<span class="main">)</span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> cs<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> cs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> cs'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">cs'</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">.</span> <span class="free">L</span> <span class="bound">a</span><span class="main">)</span><span class="main">¯</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">cs'</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x'</span> <span class="skolem">xs</span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">L</span> <span class="bound">i</span><span class="main">)</span><span class="main">¯</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">.</span> <span class="free">L</span> <span class="bound">a</span><span class="main">)</span><span class="main">¯</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">.</span> <span class="free">L</span> <span class="bound">a</span><span class="main">)</span><span class="main">¯</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_trans<span class="main">)</span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>2<span class="main">)</span> as' bs' cs' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> valley' UNIV"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> xs lconv_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">meson</span> relcomp.simps<span class="main">)</span> 
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">as</span> <span class="skolem">bs</span> <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">as</span> <span class="main">@</span> <span class="main">(</span><span class="main">[</span>Acute<span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Grave<span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">bs</span>"</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">q</span> <span class="skolem">t'</span> <span class="skolem">s'</span> <span class="skolem">u'</span>
        <span class="keyword3"><span class="command">assume</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span>Acute<span class="main">,</span><span class="skolem">a</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Grave<span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">p</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">,</span><span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">L</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">,</span><span class="skolem">u'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u'</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">q</span>"</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">js</span></span> <span class="keyword2"><span class="keyword">where</span></span> lp<span class="main">:</span> <span class="quoted"><span class="quoted">"lpeak <span class="free">r</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">js</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> js<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t'</span><span class="main">,</span><span class="skolem">u'</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">js</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pk<span class="main">[</span><span class="operator">OF</span> a b<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> lp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">js</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span>Acute<span class="main">,</span><span class="skolem">a</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Grave<span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> lpeak_def <span class="keyword1"><span class="command">using</span></span> peak_greek_less<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">@</span> <span class="skolem">js</span> <span class="main">@</span> <span class="skolem">q</span><span class="main">,</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xs
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> greek_less_app_mono1 greek_less_app_mono2 <span class="quoted"><span class="quoted">‹trans <span class="free">r</span>›</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="main">(</span><span class="skolem">p</span> <span class="main">@</span> <span class="skolem">js</span> <span class="main">@</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> p q js <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> valley' UNIV"</span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> valley' UNIV"</span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> map_eq_append_splits relcompEpair <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append.simps<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">as</span> <span class="skolem">bs</span> <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">as</span> <span class="main">@</span> <span class="main">(</span><span class="main">[</span>Acute<span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Macron<span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">bs</span>"</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">q</span> <span class="skolem">t'</span> <span class="skolem">s'</span> <span class="skolem">u'</span>
        <span class="keyword3"><span class="command">assume</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span>Acute<span class="main">,</span><span class="skolem">a</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Macron<span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">p</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">,</span><span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">L</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">,</span><span class="skolem">u'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u'</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">q</span>"</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">js</span></span> <span class="keyword2"><span class="keyword">where</span></span> lp<span class="main">:</span> <span class="quoted"><span class="quoted">"lcliff <span class="free">r</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">js</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> js<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t'</span><span class="main">,</span><span class="skolem">u'</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">js</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lc<span class="main">[</span><span class="operator">OF</span> a b<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> lp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">js</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span>Acute<span class="main">,</span><span class="skolem">a</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Macron<span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> lcliff_def
        <span class="keyword1"><span class="command">using</span></span> lcliff_greek_less1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹trans <span class="free">r</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">a</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> lcliff_greek_less2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹trans <span class="free">r</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">@</span> <span class="skolem">js</span> <span class="main">@</span> <span class="skolem">q</span><span class="main">,</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xs
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> greek_less_app_mono1 greek_less_app_mono2 <span class="quoted"><span class="quoted">‹trans <span class="free">r</span>›</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="main">(</span><span class="skolem">p</span> <span class="main">@</span> <span class="skolem">js</span> <span class="main">@</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> p q js <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> valley' UNIV"</span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> valley' UNIV"</span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> map_eq_append_splits relcompEpair <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append.simps<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">as</span> <span class="skolem">bs</span> <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">as</span> <span class="main">@</span> <span class="main">(</span><span class="main">[</span>Macron<span class="main">]</span> <span class="main">@</span> <span class="main">[</span>Grave<span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">bs</span>"</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">q</span> <span class="skolem">t'</span> <span class="skolem">s'</span> <span class="skolem">u'</span>
        <span class="keyword3"><span class="command">assume</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span>Macron<span class="main">,</span><span class="skolem">a</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Grave<span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">p</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">,</span><span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">a</span><span class="main">)</span><span class="main">¯</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">,</span><span class="skolem">u'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u'</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">q</span>"</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">js</span></span> <span class="keyword2"><span class="keyword">where</span></span> lp<span class="main">:</span> <span class="quoted"><span class="quoted">"rcliff <span class="free">r</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">js</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> js<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t'</span><span class="main">,</span><span class="skolem">u'</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">js</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rc<span class="main">[</span><span class="operator">OF</span> a b<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> lp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">js</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span>Macron<span class="main">,</span><span class="skolem">a</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>Grave<span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> rcliff_def
        <span class="keyword1"><span class="command">using</span></span> rcliff_greek_less1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹trans <span class="free">r</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> rcliff_greek_less2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹trans <span class="free">r</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">a</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">@</span> <span class="skolem">js</span> <span class="main">@</span> <span class="skolem">q</span><span class="main">,</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">∈</span> greek_less <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xs
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> greek_less_app_mono1 greek_less_app_mono2 <span class="quoted"><span class="quoted">‹trans <span class="free">r</span>›</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="main">(</span><span class="skolem">p</span> <span class="main">@</span> <span class="skolem">js</span> <span class="main">@</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> p q js <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> valley' UNIV"</span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> valley' UNIV"</span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> map_eq_append_splits relcompEpair <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append.simps<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Results›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Church-Rosser modulo›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Decreasing diagrams for Church-Rosser modulo, commutation version.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dd_commute_modulo<span class="main">[</span><span class="operator">case_names</span> wf trans peak lcliff rcliff<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> pk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">L</span> <span class="bound">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="bound">b</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="bound">a</span><span class="main">)</span> <span class="keyword1">O</span> <span class="main">(</span><span class="free">R</span> <span class="bound">b</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span> <span class="keyword1">O</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="bound">a</span> <span class="main">∪</span> under <span class="free">r</span> <span class="bound">b</span><span class="main">)</span> <span class="keyword1">O</span>
      <span class="main">(</span><span class="main">(</span><span class="free">L</span> <span class="bound">a</span><span class="main">)</span><span class="main">¯</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span> <span class="keyword1">O</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> lc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">L</span> <span class="bound">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span> <span class="bound">b</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="bound">a</span><span class="main">)</span> <span class="keyword1">O</span> <span class="free">E</span> <span class="bound">b</span> <span class="keyword1">O</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="bound">a</span><span class="main">)</span> <span class="keyword1">O</span>
      <span class="main">(</span><span class="main">(</span><span class="free">L</span> <span class="bound">a</span><span class="main">)</span><span class="main">¯</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span> <span class="keyword1">O</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="bound">a</span> <span class="main">∩</span> under <span class="free">r</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="bound">a</span> <span class="main">∪</span> under <span class="free">r</span> <span class="bound">b</span><span class="main">)</span> <span class="keyword1">O</span> <span class="main">(</span><span class="main">(</span><span class="free">L</span> <span class="bound">a</span> <span class="main">)</span><span class="main">¯</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span> <span class="keyword1">O</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">E</span> <span class="bound">a</span><span class="main">)</span><span class="main">¯</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="bound">b</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="bound">a</span> <span class="main">∩</span> under <span class="free">r</span> <span class="bound">b</span><span class="main">)</span> <span class="keyword1">O</span> <span class="main">(</span><span class="free">R</span> <span class="bound">b</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span> <span class="keyword1">O</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="bound">b</span><span class="main">)</span> <span class="keyword1">O</span>
      <span class="free">E</span> <span class="bound">a</span> <span class="keyword1">O</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="bound">a</span><span class="main">)</span> <span class="keyword1">O</span> <span class="main">(</span><span class="free">R</span> <span class="bound">b</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span> <span class="keyword1">O</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="bound">a</span> <span class="main">∪</span> under <span class="free">r</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conversion' UNIV <span class="main">⊆</span> valley' UNIV"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dd_commute_modulo_conv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>peak <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> conversion_to_lconv<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="skolem">as</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">as</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="skolem">b</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">[</span><span class="main">(</span>Grave<span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">]</span><span class="main">,</span><span class="main">[]</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">b'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="skolem">a</span> <span class="main">∪</span> under <span class="free">r</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> conversion_to_lconv<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="skolem">cs</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="skolem">a</span> <span class="main">∪</span> under <span class="free">r</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">cs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="free">L</span> <span class="skolem">a</span><span class="main">)</span><span class="main">¯</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">[</span><span class="main">(</span>Acute<span class="main">,</span><span class="skolem">a</span><span class="main">)</span><span class="main">]</span><span class="main">,</span><span class="main">[]</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">a'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> conversion_to_lconv<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="skolem">bs</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xs</span><span class="main">.</span> lpeak <span class="free">r</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="bound">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="bound">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">as</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">b'</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">cs</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">a'</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">bs</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> lconv_append lpeak_def<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> pk<span class="main">[</span><span class="operator">OF</span> peak<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>lcliff <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> conversion_to_lconv<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="skolem">as</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">as</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span>Macron<span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">b'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> conversion_to_lconv<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="skolem">cs</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">cs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="free">L</span> <span class="skolem">a</span><span class="main">)</span><span class="main">¯</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">[</span><span class="main">(</span>Acute<span class="main">,</span><span class="skolem">a</span><span class="main">)</span><span class="main">]</span><span class="main">,</span><span class="main">[]</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">a'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="skolem">a</span> <span class="main">∩</span> under <span class="free">r</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> conversion_to_lconv<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="skolem">bs</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="skolem">a</span> <span class="main">∩</span> under <span class="free">r</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xs</span><span class="main">.</span> lcliff <span class="free">r</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="bound">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="bound">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">as</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">b'</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">cs</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">a'</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">bs</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> lconv_append lcliff_def<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="skolem">a</span> <span class="main">∪</span> under <span class="free">r</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> conversion_to_lconv<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="skolem">cs</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="skolem">a</span> <span class="main">∪</span> under <span class="free">r</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">cs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="free">L</span> <span class="skolem">a</span><span class="main">)</span><span class="main">¯</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">[</span><span class="main">(</span>Acute<span class="main">,</span><span class="skolem">a</span><span class="main">)</span><span class="main">]</span><span class="main">,</span><span class="main">[]</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">a'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> conversion_to_lconv<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="skolem">bs</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xs</span><span class="main">.</span> lcliff <span class="free">r</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="bound">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="bound">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">cs</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">a'</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">bs</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> lconv_append lcliff_def<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> lc<span class="main">[</span><span class="operator">OF</span> lcliff<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>rcliff <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="skolem">a</span> <span class="main">∩</span> under <span class="free">r</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> conversion_to_lconv<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="skolem">as</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="skolem">a</span> <span class="main">∩</span> under <span class="free">r</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">as</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="skolem">b</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">[</span><span class="main">(</span>Grave<span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">]</span><span class="main">,</span><span class="main">[]</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">b'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> conversion_to_lconv<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="skolem">cs</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">cs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span>Macron<span class="main">,</span><span class="skolem">a</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">a'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> conversion_to_lconv<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="skolem">bs</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xs</span><span class="main">.</span> rcliff <span class="free">r</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="bound">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="bound">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">as</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">b'</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">cs</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">a'</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">bs</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> lconv_append rcliff_def<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> conversion_to_lconv<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="skolem">as</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">as</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="skolem">b</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">[</span><span class="main">(</span>Grave<span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">]</span><span class="main">,</span><span class="main">[]</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">b'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> conversion' <span class="main">(</span>under <span class="free">r</span> <span class="skolem">a</span> <span class="main">∪</span> under <span class="free">r</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> conversion_to_lconv<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="skolem">cs</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="skolem">a</span> <span class="main">∪</span> under <span class="free">r</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="skolem">cs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xs</span><span class="main">.</span> rcliff <span class="free">r</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="bound">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> lconv <span class="bound">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">as</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">b'</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">cs</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> lconv_append rcliff_def<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> rc<span class="main">[</span><span class="operator">OF</span> rcliff<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Decreasing diagrams for Church-Rosser modulo.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dd_cr_modulo<span class="main">[</span><span class="operator">case_names</span> wf trans symE peak cliff<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> sym <span class="main">(</span><span class="free">E</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> pk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">L</span> <span class="bound">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">L</span> <span class="bound">b</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> conversion' <span class="free">L</span> <span class="free">L</span> <span class="free">E</span> <span class="main">(</span>under <span class="free">r</span> <span class="bound">a</span><span class="main">)</span> <span class="keyword1">O</span> <span class="main">(</span><span class="free">L</span> <span class="bound">b</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span> <span class="keyword1">O</span> conversion' <span class="free">L</span> <span class="free">L</span> <span class="free">E</span> <span class="main">(</span>under <span class="free">r</span> <span class="bound">a</span> <span class="main">∪</span> under <span class="free">r</span> <span class="bound">b</span><span class="main">)</span> <span class="keyword1">O</span>
      <span class="main">(</span><span class="main">(</span><span class="free">L</span> <span class="bound">a</span><span class="main">)</span><span class="main">¯</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span> <span class="keyword1">O</span> conversion' <span class="free">L</span> <span class="free">L</span> <span class="free">E</span> <span class="main">(</span>under <span class="free">r</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> cl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">L</span> <span class="bound">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span> <span class="bound">b</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> conversion' <span class="free">L</span> <span class="free">L</span> <span class="free">E</span> <span class="main">(</span>under <span class="free">r</span> <span class="bound">a</span><span class="main">)</span> <span class="keyword1">O</span> <span class="free">E</span> <span class="bound">b</span> <span class="keyword1">O</span> conversion' <span class="free">L</span> <span class="free">L</span> <span class="free">E</span> <span class="main">(</span>under <span class="free">r</span> <span class="bound">a</span><span class="main">)</span> <span class="keyword1">O</span>
      <span class="main">(</span><span class="main">(</span><span class="free">L</span> <span class="bound">a</span><span class="main">)</span><span class="main">¯</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span> <span class="keyword1">O</span> conversion' <span class="free">L</span> <span class="free">L</span> <span class="free">E</span> <span class="main">(</span>under <span class="free">r</span> <span class="bound">a</span> <span class="main">∩</span> under <span class="free">r</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> conversion' <span class="free">L</span> <span class="free">L</span> <span class="free">E</span> <span class="main">(</span>under <span class="free">r</span> <span class="bound">a</span> <span class="main">∪</span> under <span class="free">r</span> <span class="bound">b</span><span class="main">)</span> <span class="keyword1">O</span> <span class="main">(</span><span class="main">(</span><span class="free">L</span> <span class="bound">a</span> <span class="main">)</span><span class="main">¯</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span> <span class="keyword1">O</span> conversion' <span class="free">L</span> <span class="free">L</span> <span class="free">E</span> <span class="main">(</span>under <span class="free">r</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conversion' <span class="free">L</span> <span class="free">L</span> <span class="free">E</span> UNIV <span class="main">⊆</span> valley' <span class="free">L</span> <span class="free">L</span> <span class="free">E</span> UNIV"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dd_commute_modulo<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> E' <span class="main">=</span> E<span class="main">[</span><span class="operator">unfolded</span> sym_conv_converse_eq<span class="main">]</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>rcliff <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> cl<span class="main">[</span><span class="operator">OF</span> rcliff<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rcliff<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> E'<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">unfolded</span> converse_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> E' converse_inward<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Commutation and confluence›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">conversion''</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">¯</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">valley''</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="keyword1">O</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">¯</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Decreasing diagrams for commutation.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dd_commute<span class="main">[</span><span class="operator">case_names</span> wf trans peak<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> pk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">L</span> <span class="bound">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="bound">b</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> conversion'' <span class="free">L</span> <span class="free">R</span> <span class="main">(</span>under <span class="free">r</span> <span class="bound">a</span><span class="main">)</span> <span class="keyword1">O</span> <span class="main">(</span><span class="free">R</span> <span class="bound">b</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span> <span class="keyword1">O</span> conversion'' <span class="free">L</span> <span class="free">R</span> <span class="main">(</span>under <span class="free">r</span> <span class="bound">a</span> <span class="main">∪</span> under <span class="free">r</span> <span class="bound">b</span><span class="main">)</span> <span class="keyword1">O</span>
      <span class="main">(</span><span class="main">(</span><span class="free">L</span> <span class="bound">a</span><span class="main">)</span><span class="main">¯</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span> <span class="keyword1">O</span> conversion'' <span class="free">L</span> <span class="free">R</span> <span class="main">(</span>under <span class="free">r</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"commute <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="free">L</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="free">R</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="free">L</span> <span class="bound">i</span><span class="main">)</span><span class="main">¯</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="keyword1">O</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="free">R</span> <span class="bound">i</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⊆</span> conversion'' <span class="free">L</span> <span class="free">R</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">regexp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> valley'' <span class="free">L</span> <span class="free">R</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dd_commute_modulo<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">L</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">{}</span>"</span></span><span class="main">]</span> pk <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> commute_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Decreasing diagrams for confluence.›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> dd_cr<span class="main">[</span><span class="operator">case_names</span> wf trans peak<span class="main">]</span> <span class="main">=</span>
  dd_commute<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">L</span></span> <span class="quoted"><span class="free">L</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">L</span><span class="main">,</span> <span class="operator">unfolded</span> CR_iff_self_commute<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Extended decreasing diagrams›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> rel"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"refl <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> compat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="keyword1">O</span> <span class="free">q</span> <span class="main">⊆</span> <span class="free">r</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">down</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> rel<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> rel<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">down</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">j</span> <span class="main">∈</span> under <span class="free">q</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="bound">j</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> Union_down<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> down <span class="free">L</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="free">L</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹refl <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> refl_on_def under_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Extended decreasing diagrams for commutation.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> edd_commute<span class="main">[</span><span class="operator">case_names</span> wf transr transq reflq compat peak<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">L</span> <span class="bound">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="bound">b</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> conversion'' <span class="free">L</span> <span class="free">R</span> <span class="main">(</span>under <span class="free">r</span> <span class="bound">a</span><span class="main">)</span> <span class="keyword1">O</span> <span class="main">(</span>down <span class="free">R</span> <span class="bound">b</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span> <span class="keyword1">O</span> conversion'' <span class="free">L</span> <span class="free">R</span> <span class="main">(</span>under <span class="free">r</span> <span class="bound">a</span> <span class="main">∪</span> under <span class="free">r</span> <span class="bound">b</span><span class="main">)</span> <span class="keyword1">O</span>
      <span class="main">(</span><span class="main">(</span>down <span class="free">L</span> <span class="bound">a</span><span class="main">)</span><span class="main">¯</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span> <span class="keyword1">O</span> conversion'' <span class="free">L</span> <span class="free">R</span> <span class="main">(</span>under <span class="free">r</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"commute <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="free">L</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="free">R</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Union_down<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">L</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> Union_down<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">R</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dd_commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"down <span class="free"><span class="free">L</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"down <span class="free"><span class="free">R</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>peak <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> a'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a'</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">L</span> <span class="skolem">a'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b'</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="skolem">b'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> under_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a'</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">a'</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">q</span> <span class="main">⟹</span> under <span class="free">r</span> <span class="bound">a'</span> <span class="main">⊆</span> under <span class="free">r</span> <span class="bound">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> compat <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> under_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> aux1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a'</span> <span class="bound">a</span> <span class="bound">L</span><span class="main">.</span> <span class="main">(</span><span class="bound">a'</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">q</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> under <span class="free">r</span> <span class="bound">a'</span><span class="main">.</span> <span class="bound">L</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> under <span class="free">r</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">L</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> aux2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a'</span> <span class="bound">a</span> <span class="bound">L</span><span class="main">.</span> <span class="main">(</span><span class="bound">a'</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">q</span> <span class="main">⟹</span> down <span class="bound">L</span> <span class="bound">a'</span> <span class="main">⊆</span> down <span class="bound">L</span> <span class="bound">a</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹trans <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> under_def trans_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> aux3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">L</span><span class="main">.</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> under <span class="free">r</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">L</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> under <span class="free">r</span> <span class="bound">a</span><span class="main">.</span> down <span class="bound">L</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹refl <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> under_def refl_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> aux1<span class="main">[</span><span class="operator">OF</span> a'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">L</span></span><span class="main">]</span> aux1<span class="main">[</span><span class="operator">OF</span> a'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">R</span></span><span class="main">]</span> aux2<span class="main">[</span><span class="operator">OF</span> a'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">L</span></span><span class="main">]</span>
       aux1<span class="main">[</span><span class="operator">OF</span> b'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">L</span></span><span class="main">]</span> aux1<span class="main">[</span><span class="operator">OF</span> b'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">R</span></span><span class="main">]</span> aux2<span class="main">[</span><span class="operator">OF</span> b'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">R</span></span><span class="main">]</span>
       aux3<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">L</span></span><span class="main">]</span> aux3<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">R</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ pk<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">L</span> <span class="skolem">a'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="skolem">b'</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> UN_Un<span class="main">)</span>
     <span class="main">(</span><span class="operator">intro</span> relcomp_mono rtrancl_mono Un_mono iffD2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> converse_mono<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Extended decreasing diagrams for confluence.›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> edd_cr<span class="main">[</span><span class="operator">case_names</span> wf transr transq reflq compat peak<span class="main">]</span> <span class="main">=</span>
  edd_commute<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">L</span></span> <span class="quoted"><span class="free">L</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">L</span><span class="main">,</span> <span class="operator">unfolded</span> CR_iff_self_commute<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context *)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* Decreasing_Diagrams_II *)</span>
</pre>
</div>