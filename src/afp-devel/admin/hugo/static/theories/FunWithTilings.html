<div id="Tilings">
<div class="head">
<h1>Theory Tilings</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:     Lawrence C Paulson, Cambridge University Computer Laboratory
                Tobias Nipkow, TUM
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Tilings <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Inductive Tiling›</span></span>


<span class="keyword1"><span class="command">inductive_set</span></span>
  <span class="entity">tiling</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set <span class="main">⇒</span> <span class="tfree">'a</span> set set"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
empty <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∈</span> <span class="free">tiling</span> <span class="free">A</span>"</span></span> <span class="main">|</span>
Un <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∈</span> <span class="free">tiling</span> <span class="free">A</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟧</span>
                         <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∈</span> <span class="free">tiling</span> <span class="free">A</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> tiling_UnI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">t</span> <span class="main">∈</span> tiling <span class="free">A</span><span class="main">;</span> <span class="free">u</span> <span class="main">∈</span> tiling <span class="free">A</span><span class="main">;</span> <span class="free">t</span> <span class="main">∩</span> <span class="free">u</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span>  <span class="free">t</span> <span class="main">∪</span> <span class="free">u</span> <span class="main">∈</span> tiling <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> tiling<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_assoc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> tiling_Diff1E<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">-</span><span class="free">a</span> <span class="main">∈</span> tiling <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⊆</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> tiling <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2-3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">t</span> <span class="main">=</span> <span class="bound">r</span> <span class="keyword1">Un</span> <span class="free">a</span> <span class="main">&amp;</span> <span class="bound">r</span> <span class="keyword1">Int</span> <span class="free">a</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_disjoint Int_commute Un_Diff_cancel Un_absorb1 Un_commute<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Un_Diff<span class="main">)</span>
       <span class="main">(</span><span class="operator">metis</span> Compl_Diff_eq Diff_Compl Diff_empty Int_commute Un_Diff_cancel
              Un_commute double_complement tiling.Un<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tiling_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> finite <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> tiling <span class="free">A</span> <span class="main">⟹</span> finite <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> tiling<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹The Mutilated Chess Board Cannot be Tiled by Dominoes›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The originator of this problem is Max Black, according to J A
Robinson. It was popularized as the \emph{Mutilated Checkerboard Problem} by
J McCarthy.›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">domino</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> nat<span class="main">)</span> set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
horiz <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span> Suc <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free">domino</span>"</span></span> <span class="main">|</span>
vertl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="free">domino</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> domino_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> domino <span class="main">⟹</span> finite <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> domino.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> tiling_finite<span class="main">[</span><span class="operator">OF</span> domino_finite<span class="main">,</span> <span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹\medskip Sets of squares of the given colour›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">coloured</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">×</span> nat<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">coloured</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">whites</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> nat<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">whites</span> <span class="main">≡</span> coloured <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">blacks</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> nat<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">blacks</span> <span class="main">≡</span> coloured <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹\medskip Chess boards›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Sigma_Suc1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> Suc <span class="free">n</span><span class="main">}</span> <span class="main">×</span> <span class="free">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="free">n</span><span class="main">}</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Sigma_Suc2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> Suc <span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> dominoes_tile_row <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">}</span> <span class="main">∈</span> tiling domino"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>Un_insert_left <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> dominoes_tile_matrix<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">*</span><span class="free">n</span><span class="main">}</span> <span class="main">∈</span> tiling domino"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹\medskip <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">coloured</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and Dominoes›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coloured_insert <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"coloured <span class="free">b</span> <span class="main">∩</span> <span class="main">(</span>insert <span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span>
   <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">then</span> insert <span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>coloured <span class="free">b</span> <span class="main">∩</span> <span class="free">t</span><span class="main">)</span>
    <span class="keyword1">else</span> coloured <span class="free">b</span> <span class="main">∩</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coloured_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> domino_singletons<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> domino <span class="main">⟹</span>
   <span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> whites <span class="main">∩</span> <span class="free">d</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span> blacks <span class="main">∩</span> <span class="free">d</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> domino.cases<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_Suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹\medskip Tilings of dominoes›</span></span>

<span class="keyword1"><span class="command">declare</span></span>
  Int_Un_distrib <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  Diff_Int_distrib <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> tiling_domino_0_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> tiling domino <span class="main">==&gt;</span> card<span class="main">(</span>whites <span class="main">∩</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> card<span class="main">(</span>blacks <span class="main">∩</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> tiling<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> domino_singletons<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span> <span class="bound">C</span><span class="main">.</span> <span class="bound">C</span> <span class="main">∩</span> <span class="improper">a</span> <span class="main">=</span> <span class="main">{</span><span class="bound">p</span><span class="main">}</span> <span class="main">--&gt;</span> <span class="bound">p</span> <span class="main">∉</span> <span class="improper">t</span>"</span></span><span class="main">)</span>
  <span class="comment1">― ‹this lemma tells us that both ``inserts'' are non-trivial›</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹\medskip Final argument is surprisingly complex›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> gen_mutil_not_tiling<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> tiling domino <span class="main">==&gt;</span>
  <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span> <span class="main">==&gt;</span>
  <span class="main">{</span><span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">t</span>
  <span class="main">==&gt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">m</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∉</span> tiling domino"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span>
  <span class="quoted"><span class="quoted">"card <span class="main">(</span>whites <span class="main">∩</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">m</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>
   card <span class="main">(</span>blacks <span class="main">∩</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">m</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> tiling_domino_0_1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiling_domino_0_1 <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coloured_def card_Diff2_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Apply the general theorem to the well-known case›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> mutil_not_tiling<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span> <span class="main">*</span> Suc <span class="free">m</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span> <span class="numeral">2</span> <span class="main">*</span> Suc <span class="free">n</span><span class="main">}</span>
   <span class="main">==&gt;</span> <span class="free">t</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span>Suc<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span><span class="main">,</span> Suc<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">∉</span> tiling domino"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> gen_mutil_not_tiling<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dominoes_tile_matrix<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹The Mutilated Chess Board Can be Tiled by Ls›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Remove a arbitrary square from a chess board of size $2^n \times 2^n$.
The result can be tiled by L-shaped tiles:
\begin{picture}(8,8)
\put(0,0){\framebox(4,4){}}
\put(4,0){\framebox(4,4){}}
\put(0,4){\framebox(4,4){}}
\end{picture}.
The four possible L-shaped tiles are obtained by dropping
one of the four squares from $\{(x,y),(x+1,y),(x,y+1),(x+1,y+1)\}$:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">L2</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">L3</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">L0</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">L1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹All tiles:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Ls</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">*</span> nat<span class="main">)</span> set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Ls</span> <span class="main">≡</span> <span class="main">{</span> L0 <span class="bound">x</span> <span class="bound">y</span> <span class="main">|</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> True<span class="main">}</span> <span class="main">∪</span> <span class="main">{</span> L1 <span class="bound">x</span> <span class="bound">y</span> <span class="main">|</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> True<span class="main">}</span> <span class="main">∪</span>
      <span class="main">{</span> L2 <span class="bound">x</span> <span class="bound">y</span> <span class="main">|</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> True<span class="main">}</span> <span class="main">∪</span> <span class="main">{</span> L3 <span class="bound">x</span> <span class="bound">y</span> <span class="main">|</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> True<span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> LinLs<span class="main">:</span> <span class="quoted"><span class="quoted">"L0 <span class="free">i</span> <span class="free">j</span> <span class="main">:</span> Ls <span class="main">&amp;</span> L1 <span class="free">i</span> <span class="free">j</span> <span class="main">:</span> Ls <span class="main">&amp;</span> L2 <span class="free">i</span> <span class="free">j</span> <span class="main">:</span> Ls <span class="main">&amp;</span> L3 <span class="free">i</span> <span class="free">j</span> <span class="main">:</span> Ls"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Ls_def<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Square $2^n \times 2^n$ grid, shifted by $i$ and $j$:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">square2</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">..&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> in_square2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">:</span> square2 <span class="free">n</span> <span class="free">i</span> <span class="free">j</span> <span class="main">⟷</span> <span class="free">i</span><span class="main">≤</span><span class="free">a</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">+</span><span class="free">i</span> <span class="main">∧</span> <span class="free">j</span><span class="main">≤</span><span class="free">b</span> <span class="main">∧</span> <span class="free">b</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">+</span><span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>square2_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> square2_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"square2 <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="main">=</span>
  square2 <span class="free">n</span> <span class="free">i</span> <span class="free">j</span> <span class="main">∪</span> square2 <span class="free">n</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="main">∪</span> square2 <span class="free">n</span> <span class="free">i</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span> <span class="main">∪</span>
  square2 <span class="free">n</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>square2_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> square2_disj<span class="main">:</span> <span class="quoted"><span class="quoted">"square2 <span class="free">n</span> <span class="free">i</span> <span class="free">j</span> <span class="main">∩</span> square2 <span class="free">n</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟷</span>
  <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">+</span><span class="free">i</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∨</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">+</span><span class="free">x</span> <span class="main">≤</span> <span class="free">i</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">+</span><span class="free">j</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">∨</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span><span class="main">+</span><span class="free">y</span> <span class="main">≤</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>square2_def<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>max <span class="free">i</span> <span class="free">x</span><span class="main">,</span> max <span class="free">j</span> <span class="free">y</span><span class="main">)</span> <span class="main">:</span> square2 <span class="free">n</span> <span class="free">i</span> <span class="free">j</span> <span class="main">∩</span> square2 <span class="free">n</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Some specific lemmas:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pos_pow2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">declare</span></span> nat_zero_less_power_iff<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> zero_less_power<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> Diff_insert_if<span class="main">:</span> <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">a</span><span class="main">:</span><span class="free">A</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">-</span> insert <span class="free">a</span> <span class="free">B</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">~:</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">-</span> insert <span class="free">a</span> <span class="free">B</span> <span class="main">=</span> <span class="free">A</span><span class="main">-</span><span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> DisjI1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">Int</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="free">X</span><span class="main">)</span> <span class="keyword1">Int</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> DisjI2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">Int</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">A</span> <span class="keyword1">Int</span> <span class="main">(</span><span class="free">B</span><span class="main">-</span><span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The main theorem:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Ls_can_tile<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">+</span> <span class="free">i</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">+</span> <span class="free">j</span>
  <span class="main">⟹</span> square2 <span class="free">n</span> <span class="free">i</span> <span class="free">j</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">}</span> <span class="main">:</span> tiling Ls"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>square2_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> Suc<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> a <span class="main">=</span> Suc<span class="main">(</span>2-3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> b <span class="main">=</span> Suc<span class="main">(</span>4-5<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span> <span class="main">∨</span>
         <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span><span class="main">≤</span><span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">+</span><span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span> <span class="main">∨</span>
         <span class="skolem">a</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span> <span class="main">∧</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span><span class="main">≤</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">+</span><span class="skolem">j</span> <span class="main">∨</span>
         <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span><span class="main">≤</span><span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">+</span><span class="skolem">i</span> <span class="main">∧</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span><span class="main">≤</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">&lt;</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">+</span><span class="skolem">j</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span><span class="main">|</span><span class="var">?B</span><span class="main">|</span><span class="var">?C</span><span class="main">|</span><span class="var">?D</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"square2 <span class="skolem">n</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">}</span> <span class="main">:</span> tiling Ls"</span></span> <span class="keyword1"><span class="command">using</span></span> IH a b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"square2 <span class="skolem">n</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span><span class="main">,</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">:</span> tiling Ls"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span><span class="main">(</span><span class="operator">insert</span> pos_pow2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"square2 <span class="skolem">n</span> <span class="skolem">i</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span><span class="main">)</span><span class="main">}</span> <span class="main">:</span> tiling Ls"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span><span class="main">(</span><span class="operator">insert</span> pos_pow2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"square2 <span class="skolem">n</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span><span class="main">,</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span><span class="main">)</span><span class="main">}</span> <span class="main">:</span> tiling Ls"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span><span class="main">(</span><span class="operator">insert</span> pos_pow2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"square2 <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">}</span> <span class="main">-</span> L0 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> tiling Ls"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  a b <span class="quoted"><span class="quoted">‹<span class="var">?A</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> square2_Suc L0_def Un_Diff Diff_insert_if<span class="main">)</span>
         <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tiling_UnI DisjI1 DisjI2 square2_disj<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span>
                   <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Int_Un_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"square2 <span class="skolem">n</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">}</span> <span class="main">:</span> tiling Ls"</span></span> <span class="keyword1"><span class="command">using</span></span> IH a b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"square2 <span class="skolem">n</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">:</span> tiling Ls"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span><span class="main">(</span><span class="operator">insert</span> pos_pow2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"square2 <span class="skolem">n</span> <span class="skolem">i</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span><span class="main">)</span><span class="main">}</span> <span class="main">:</span> tiling Ls"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span><span class="main">(</span><span class="operator">insert</span> pos_pow2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"square2 <span class="skolem">n</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span><span class="main">,</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span><span class="main">)</span><span class="main">}</span> <span class="main">:</span> tiling Ls"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span><span class="main">(</span><span class="operator">insert</span> pos_pow2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"square2 <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">}</span> <span class="main">-</span> L1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> tiling Ls"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  a b <span class="quoted"><span class="quoted">‹<span class="var">?B</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> square2_Suc L1_def Un_Diff Diff_insert_if le_diff_conv2<span class="main">)</span>
         <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tiling_UnI DisjI1 DisjI2 square2_disj<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span>
                   <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Int_Un_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"square2 <span class="skolem">n</span> <span class="skolem">i</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">}</span> <span class="main">:</span> tiling Ls"</span></span> <span class="keyword1"><span class="command">using</span></span> IH a b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"square2 <span class="skolem">n</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">:</span> tiling Ls"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span><span class="main">(</span><span class="operator">insert</span> pos_pow2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"square2 <span class="skolem">n</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span><span class="main">,</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">:</span> tiling Ls"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span><span class="main">(</span><span class="operator">insert</span> pos_pow2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"square2 <span class="skolem">n</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span><span class="main">,</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span><span class="main">)</span><span class="main">}</span> <span class="main">:</span> tiling Ls"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span><span class="main">(</span><span class="operator">insert</span> pos_pow2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"square2 <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">}</span> <span class="main">-</span> L3 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> tiling Ls"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  a b <span class="quoted"><span class="quoted">‹<span class="var">?C</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> square2_Suc L3_def Un_Diff Diff_insert_if le_diff_conv2<span class="main">)</span>
         <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tiling_UnI DisjI1 DisjI2 square2_disj<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span>
                   <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Int_Un_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"square2 <span class="skolem">n</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span><span class="main">)</span> <span class="main">-</span><span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">}</span> <span class="main">:</span> tiling Ls"</span></span> <span class="keyword1"><span class="command">using</span></span> IH a b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"square2 <span class="skolem">n</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">:</span> tiling Ls"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span><span class="main">(</span><span class="operator">insert</span> pos_pow2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"square2 <span class="skolem">n</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span><span class="main">,</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">:</span> tiling Ls"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span><span class="main">(</span><span class="operator">insert</span> pos_pow2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"square2 <span class="skolem">n</span> <span class="skolem">i</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span><span class="main">)</span><span class="main">}</span> <span class="main">:</span> tiling Ls"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span><span class="main">(</span><span class="operator">insert</span> pos_pow2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"square2 <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">}</span> <span class="main">-</span> L2 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> tiling Ls"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  a b <span class="quoted"><span class="quoted">‹<span class="var">?D</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> square2_Suc L2_def Un_Diff Diff_insert_if le_diff_conv2<span class="main">)</span>
         <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tiling_UnI DisjI1 DisjI2 square2_disj<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span>
                   <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Int_Un_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⟹</span> L0 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊆</span> square2 <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a b <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>L0_def<span class="main">)</span> <span class="operator">arith</span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⟹</span> L1 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊆</span> square2 <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a b <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>L1_def<span class="main">)</span> <span class="operator">arith</span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">⟹</span> L3 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊆</span> square2 <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a b <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>L3_def<span class="main">)</span> <span class="operator">arith</span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">⟹</span> L2 <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊆</span> square2 <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a b <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>L2_def<span class="main">)</span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> LinLs tiling_Diff1E<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Ls_can_tile00<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="free">n</span> <span class="main">⟹</span> square2 <span class="free">n</span> <span class="main">0</span> <span class="main">0</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> tiling Ls"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> Ls_can_tile<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>