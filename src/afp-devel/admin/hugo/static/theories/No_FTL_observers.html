<div id="SpaceTime">
<div class="head">
<h1>Theory SpaceTime</h1>
</div>
<pre class="source"><span class="comment1">(*
   Author: Mike Stannett
   Date: 22 October 2012
   m.stannett@sheffield.ac.uk
   Updated 28 April 2016 to run under Isabelle2016.
*)</span>
<span class="keyword1"><span class="command">theory</span></span> SpaceTime
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="comment1">(* A linordered_field is a field with a linear (total) order 
  INHERITED SYNTAX: 
    linorder: &lt;, ≤, ≥, &gt;
    field: a * b, a / b, inverse a
           a + b, a - b, -a
           0, 1
*)</span>


<span class="comment1">(*
  A vector has four components
*)</span>
<span class="keyword1"><span class="command">record</span></span> <span class="tfree">'a</span> Vector <span class="main">=</span>
  tdir <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
  xdir <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
  ydir <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
  zdir <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>


<span class="comment1">(*
  A point has four coordinates.
*)</span>
<span class="keyword1"><span class="command">record</span></span> <span class="tfree">'a</span> Point <span class="main">=</span> 
  tval <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
  xval <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
  yval <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
  zval <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>


<span class="comment1">(*
  To specify a line, give its local origin ("basepoint") together with its direction.
*)</span>
<span class="keyword1"><span class="command">record</span></span> <span class="tfree">'a</span> Line  <span class="main">=</span>
  basepoint <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point"</span></span>
  direction <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Vector"</span></span>


<span class="comment1">(*
  To specify a plane, give its local origin ("pbasepoint") together with two basis vectors
*)</span>
<span class="keyword1"><span class="command">record</span></span> <span class="tfree">'a</span> Plane <span class="main">=</span>
  pbasepoint <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point"</span></span>
  direction1 <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Vector"</span></span>
  direction2 <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Vector"</span></span>

<span class="comment1">(*
  To specify an upright cone, give its vertex and slope.
*)</span>
<span class="keyword1"><span class="command">record</span></span> <span class="tfree">'a</span> Cone <span class="main">=</span>
  vertex <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point"</span></span>
  slope  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>


<span class="comment1">(*
  The set of quantities is assumed to be an ordered field. We shall
  sometimes need to assume that the field is also Euclidean, ie
  square roots exists, but this is not a general requirement so it
  will be added as a separate axiom class later.
*)</span>
<span class="keyword1"><span class="command">class</span></span> Quantities <span class="main">=</span> linordered_field


<span class="comment1">(*
  Vectors are defined over the field of quantities
*)</span>
<span class="keyword1"><span class="command">class</span></span> Vectors <span class="main">=</span> Quantities
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">abbreviation</span></span>  <span class="entity">vecZero</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Vector"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">0</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">vecZero</span> <span class="main">≡</span> <span class="main">⦇</span> tdir <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">,</span> xdir <span class="main">=</span> <span class="main">0</span><span class="main">,</span> ydir <span class="main">=</span> <span class="main">0</span><span class="main">,</span> zdir <span class="main">=</span> <span class="main">0</span> <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">vecPlus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Vector <span class="main">⇒</span> <span class="tfree">'a</span> Vector <span class="main">⇒</span> <span class="tfree">'a</span> Vector"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⊕</span>"</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">vecPlus</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">⦇</span> tdir <span class="main">=</span> tdir <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">+</span> tdir <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> xdir <span class="main">=</span> xdir <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">+</span> xdir <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> 
                     ydir <span class="main">=</span> ydir <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">+</span> ydir <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> zdir <span class="main">=</span> zdir <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">+</span> zdir <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">vecMinus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Vector <span class="main">⇒</span> <span class="tfree">'a</span> Vector <span class="main">⇒</span> <span class="tfree">'a</span> Vector"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⊖</span>"</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">vecMinus</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">⦇</span> tdir <span class="main">=</span> tdir <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">-</span> tdir <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> xdir <span class="main">=</span> xdir <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">-</span> xdir <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> 
                      ydir <span class="main">=</span> ydir <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">-</span> ydir <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> zdir <span class="main">=</span> zdir <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">-</span> zdir <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">vecNegate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Vector <span class="main">⇒</span> <span class="tfree">'a</span> Vector"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">~</span> _"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">vecNegate</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="main">⦇</span> tdir <span class="main">=</span> uminus <span class="main">(</span>tdir <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span><span class="main">,</span> xdir <span class="main">=</span> uminus <span class="main">(</span>xdir <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span><span class="main">,</span> 
                     ydir <span class="main">=</span> uminus <span class="main">(</span>ydir <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span><span class="main">,</span> zdir <span class="main">=</span> uminus <span class="main">(</span>zdir <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span> <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">innerProd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Vector <span class="main">⇒</span> <span class="tfree">'a</span> Vector <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">dot</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">innerProd</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span>tdir <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">*</span> tdir <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>xdir <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">*</span> xdir <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">+</span> 
                     <span class="main">(</span>ydir <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">*</span> ydir <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>zdir <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">*</span> zdir <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">sqrlen</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Vector <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sqrlen</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="keyword1">dot</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">minkowskiProd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Vector <span class="main">⇒</span> <span class="tfree">'a</span> Vector <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">mdot</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">minkowskiProd</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span>tdir <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">*</span> tdir <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> 
                       <span class="main">-</span>  <span class="main">(</span><span class="main">(</span>xdir <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">*</span> xdir <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>ydir <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">*</span> ydir <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>zdir <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">*</span> zdir <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">mSqrLen</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Vector <span class="main">⇒</span>  <span class="tfree">'a</span>"</span></span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mSqrLen</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="keyword1">mdot</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">vecScale</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> Vector <span class="main">⇒</span> <span class="tfree">'a</span> Vector"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">**</span>"</span> 200<span class="main">)</span>  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">vecScale</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="main">⦇</span> tdir <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">*</span> tdir <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span> xdir <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">*</span> xdir <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span> ydir <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">*</span> ydir <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span> zdir <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">*</span> zdir <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">orthogonal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Vector <span class="main">⇒</span> <span class="tfree">'a</span> Vector <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊥</span>"</span> 150<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">orthogonal</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="keyword1">dot</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="comment1">(*
  vector addition and subtraction do what's expected
*)</span>

<span class="keyword1"><span class="command">lemma</span></span> lemVecZeroMinus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊖</span> <span class="free">u</span> <span class="main">=</span> <span class="main">~</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> lemVecSelfMinus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">⊖</span> <span class="free">u</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> lemVecPlusCommute<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">⊕</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v</span> <span class="main">⊕</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lemVecPlusAssoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊕</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span> <span class="main">⊕</span> <span class="free">v</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lemVecPlusMinus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">~</span> <span class="free">v</span><span class="main">)</span>  <span class="main">=</span> <span class="free">u</span> <span class="main">⊖</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.add_uminus_conv_diff<span class="main">)</span>


<span class="comment1">(*
  Dot product commutes.
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> lemDotCommute<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span> <span class="keyword1">dot</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span> <span class="keyword1">dot</span> <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>


<span class="comment1">(*
  Minkowski product commutes.
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> lemMDotCommute<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span> <span class="keyword1">mdot</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span> <span class="keyword1">mdot</span> <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mult.commute<span class="main">)</span>


<span class="comment1">(* Scaling can be done in stages *)</span>
<span class="keyword1"><span class="command">lemma</span></span> lemScaleScale<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">**</span><span class="main">(</span><span class="free">b</span><span class="main">**</span><span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">b</span><span class="main">)</span><span class="main">**</span><span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main">)</span>



<span class="comment1">(* Scaling by 1 has no effect *)</span>
<span class="keyword1"><span class="command">lemma</span></span> lemScale1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">**</span> <span class="free">u</span> <span class="main">=</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>



<span class="comment1">(* Scaling by 0 gives the null vector *)</span>
<span class="keyword1"><span class="command">lemma</span></span> lemScale0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">**</span> <span class="free">u</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>



<span class="comment1">(* Scaling by a negative value reverses *)</span>
<span class="keyword1"><span class="command">lemma</span></span> lemScaleNeg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">k</span><span class="main">)</span><span class="main">**</span><span class="free">u</span> <span class="main">=</span> <span class="main">~</span> <span class="main">(</span><span class="free">k</span><span class="main">**</span><span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>



<span class="comment1">(* The null vector is invariant under scaling *)</span>
<span class="keyword1"><span class="command">lemma</span></span> lemScaleOrigin<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">**</span><span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>



<span class="comment1">(* Scaling distributes over addition *)</span>
<span class="keyword1"><span class="command">lemma</span></span> lemScaleOverAdd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">**</span><span class="main">(</span><span class="free">u</span> <span class="main">⊕</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span><span class="main">**</span><span class="free">u</span> <span class="main">⊕</span> <span class="free">k</span><span class="main">**</span><span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>34<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lemAddOverScale<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">**</span><span class="free">u</span> <span class="main">⊕</span> <span class="free">b</span><span class="main">**</span><span class="free">u</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">**</span><span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>


<span class="comment1">(* Scaling can be reversed *)</span>
<span class="keyword1"><span class="command">lemma</span></span> lemScaleInverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="free">k</span><span class="main">**</span><span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="main">(</span>inverse <span class="free">k</span><span class="main">)</span><span class="main">**</span><span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inverse <span class="free">k</span><span class="main">)</span><span class="main">**</span><span class="free">v</span> <span class="main">=</span> <span class="main">(</span>inverse <span class="free">k</span> <span class="main">*</span> <span class="free">k</span><span class="main">)</span><span class="main">**</span><span class="free">u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lemScaleScale assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mult.assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> field_inverse assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> lemScale1<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>
 


<span class="comment1">(* Being orthogonal is mutual *)</span>
<span class="keyword1"><span class="command">lemma</span></span> lemOrthoSym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">⊥</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">⊥</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> lemDotCommute orthogonal.simps<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>



<span class="comment1">(*
  Points have coordinates in the field of quantities.
*)</span>
<span class="keyword1"><span class="command">class</span></span> Points <span class="main">=</span> Quantities <span class="main">+</span> Vectors
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">origin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">origin</span> <span class="main">≡</span> <span class="main">⦇</span> tval <span class="main">=</span> <span class="main">0</span><span class="main">,</span> xval <span class="main">=</span> <span class="main">0</span><span class="main">,</span> yval <span class="main">=</span> <span class="main">0</span><span class="main">,</span> zval <span class="main">=</span> <span class="main">0</span> <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">vectorJoining</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Vector"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">from</span> _ <span class="keyword1">to</span> _"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">vectorJoining</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>
      <span class="main">=</span> <span class="main">⦇</span> tdir <span class="main">=</span> tval <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">-</span> tval <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> xdir <span class="main">=</span> xval <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">-</span> xval <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> 
          ydir <span class="main">=</span> yval <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">-</span> yval <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> zdir <span class="main">=</span> zval <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">-</span> zval <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">moveBy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Vector <span class="main">⇒</span> <span class="tfree">'a</span> Point"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">↝</span>"</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">moveBy</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> 
      <span class="main">=</span> <span class="main">⦇</span> tval <span class="main">=</span> tval <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">+</span> tdir <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span> xval <span class="main">=</span> xval <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">+</span> xdir <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span> 
          yval <span class="main">=</span> yval <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">+</span> ydir <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span> zval <span class="main">=</span> zval <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">+</span> zdir <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">positionVector</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Vector"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">positionVector</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">⦇</span> tdir <span class="main">=</span> tval <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> xdir <span class="main">=</span> xval <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> ydir <span class="main">=</span> yval <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> zdir <span class="main">=</span> zval <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">before</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Point <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">≲</span>"</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">before</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span>tval <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">&lt;</span> tval <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">after</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Point <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">≳</span>"</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">after</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span>tval <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">&gt;</span> tval <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">sametime</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Point <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">≈</span>"</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">sametime</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span>tval <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> tval <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> lemFromToTo<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">from</span> <span class="free">p</span> <span class="keyword1">to</span> <span class="free">q</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="keyword1">from</span> <span class="free">q</span> <span class="keyword1">to</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">from</span> <span class="free">p</span> <span class="keyword1">to</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> shared<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">valp</span> <span class="bound">valq</span> <span class="bound">valr</span><span class="main">.</span><span class="main">(</span> <span class="bound">valq</span> <span class="main">-</span> <span class="bound">valp</span> <span class="main">+</span> <span class="main">(</span><span class="bound">valr</span> <span class="main">-</span> <span class="bound">valq</span><span class="main">)</span> <span class="main">=</span> <span class="bound">valr</span> <span class="main">-</span> <span class="bound">valp</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_uminus_conv_diff add_diff_cancel 
                semiring_normalization_rules<span class="main"><span class="main">(</span></span>24<span class="main"><span class="main">)</span></span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>25<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> lemMoveByMove<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">↝</span> <span class="free">u</span> <span class="main">↝</span> <span class="free">v</span> <span class="main">=</span> <span class="free">p</span> <span class="main">↝</span> <span class="main">(</span><span class="free">u</span> <span class="main">⊕</span> <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> lemScaleLinear<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">↝</span> <span class="free">a</span><span class="main">**</span><span class="free">u</span> <span class="main">↝</span> <span class="free">b</span><span class="main">**</span><span class="free">v</span> <span class="main">=</span> <span class="free">p</span> <span class="main">↝</span> <span class="main">(</span><span class="free">a</span><span class="main">**</span><span class="free">u</span> <span class="main">⊕</span> <span class="free">b</span><span class="main">**</span><span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="comment1">(*
  Lines are defined using a basepoint and a direction.
*)</span>
<span class="keyword1"><span class="command">class</span></span> Lines <span class="main">=</span> Quantities <span class="main">+</span> Vectors <span class="main">+</span> Points
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">onAxisT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     <span class="quoted"><span class="quoted">"<span class="free">onAxisT</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>xval <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>yval <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>zval <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">space2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> Point<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> Point<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">space2</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> 
      <span class="main">=</span> <span class="main">(</span>xval <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">-</span> xval <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">*</span><span class="main">(</span>xval <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">-</span> xval <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> 
      <span class="main">+</span> <span class="main">(</span>yval <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">-</span> yval <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">*</span><span class="main">(</span>yval <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">-</span> yval <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> 
      <span class="main">+</span> <span class="main">(</span>zval <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">-</span> zval <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">*</span><span class="main">(</span>zval <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">-</span> zval <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">time2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> Point<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> Point<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">time2</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span>tval <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">-</span> tval <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">*</span><span class="main">(</span>tval <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">-</span> tval <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">speed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> Point<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> Point<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">speed</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span>space2 <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">/</span>  time2 <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">mkLine</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point <span class="main">=&gt;</span> <span class="tfree">'a</span> Vector <span class="main">⇒</span> <span class="tfree">'a</span> Line"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">mkLine</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">=</span> <span class="main">⦇</span> basepoint <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> direction <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">lineJoining</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Line"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">line</span> <span class="keyword1">joining</span> _ <span class="keyword1">to</span> _"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">lineJoining</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">⦇</span> basepoint <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> direction <span class="main">=</span> <span class="keyword1">from</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">to</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">parallel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Line <span class="main">⇒</span> <span class="tfree">'a</span> Line <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">∥</span> "</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">parallel</span> <span class="free"><span class="bound"><span class="entity">lineA</span></span></span> <span class="free"><span class="bound"><span class="entity">lineB</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>direction <span class="free"><span class="bound"><span class="entity">lineA</span></span></span> <span class="main">=</span> vecZero<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>direction <span class="free"><span class="bound"><span class="entity">lineB</span></span></span> <span class="main">=</span> vecZero<span class="main">)</span> 
                                   <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span><span class="main">(</span><span class="bound">k</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">∧</span> direction <span class="free"><span class="bound"><span class="entity">lineB</span></span></span> <span class="main">=</span> <span class="bound">k</span><span class="main">**</span>direction <span class="free"><span class="bound"><span class="entity">lineA</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">collinear</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Point <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">collinear</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">α</span> <span class="bound">β</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span><span class="bound">α</span> <span class="main">+</span> <span class="bound">β</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>  <span class="main">∧</span>
            positionVector <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="bound">α</span><span class="main">**</span><span class="main">(</span>positionVector <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">⊕</span> <span class="bound">β</span><span class="main">**</span><span class="main">(</span>positionVector <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">inLine</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Line <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">inLine</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> collinear <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>basepoint <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">(</span>basepoint <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">↝</span> direction <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">meets</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Line <span class="main">⇒</span> <span class="tfree">'a</span> Line <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">meets</span> <span class="free"><span class="bound"><span class="entity">line1</span></span></span> <span class="free"><span class="bound"><span class="entity">line2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span><span class="main">(</span>inLine <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">line1</span></span></span> <span class="main">∧</span> inLine <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">line2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


  <span class="keyword1"><span class="command">lemma</span></span> lemParallelReflexive<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">lineA</span> <span class="main">∥</span> <span class="free">lineA</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">dir</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dir</span> <span class="main">=</span> direction <span class="free">lineA</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">dir</span> <span class="main">=</span> <span class="main">1</span><span class="main">**</span><span class="skolem">dir</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dir_def parallel.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">lemma</span></span> lemParallelSym<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">lineA</span> <span class="main">∥</span> <span class="free">lineB</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">lineB</span> <span class="main">∥</span> <span class="free">lineA</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> case1<span class="main">:</span> <span class="quoted"><span class="quoted">"direction <span class="free">lineA</span> <span class="main">=</span> vecZero <span class="main">⟶</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> case2<span class="main">:</span> <span class="quoted"><span class="quoted">"direction <span class="free">lineB</span> <span class="main">=</span> vecZero <span class="main">⟶</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> case3<span class="main">:</span> <span class="quoted"><span class="quoted">"direction <span class="free">lineA</span> <span class="main">≠</span> vecZero <span class="main">∧</span> direction <span class="free">lineB</span> <span class="main">≠</span> vecZero"</span></span>
      <span class="keyword1"><span class="command">have</span></span> exists_kab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">kab</span><span class="main">.</span><span class="main">(</span><span class="bound">kab</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">∧</span> direction <span class="free">lineB</span> <span class="main">=</span> <span class="bound">kab</span><span class="main">**</span>direction <span class="free">lineA</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> parallel.simps assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> case3<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">kab</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">kab</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">kab</span><span class="main">.</span><span class="main">(</span><span class="bound">kab</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">∧</span> direction <span class="free">lineB</span> <span class="main">=</span> <span class="bound">kab</span><span class="main">**</span>direction <span class="free">lineA</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> kab_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">kab</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> direction <span class="free">lineB</span> <span class="main">=</span> <span class="skolem">kab</span><span class="main">**</span>direction <span class="free">lineA</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> exists_kab kab_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Hilbert_Choice.exE_some<span class="main">)</span>

      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">kba</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">kba</span> <span class="main">=</span> inverse <span class="skolem">kab</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> kba_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">kba</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inverse_zero_imp_zero kab_props kba_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direction <span class="free">lineA</span> <span class="main">=</span> <span class="skolem">kba</span><span class="main">**</span>direction <span class="free">lineB</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> kba_def lemScaleInverse kab_props<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> kba_nonzero parallel.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>direction <span class="free">lineA</span> <span class="main">≠</span> vecZero <span class="main">∧</span> direction <span class="free">lineB</span> <span class="main">≠</span> vecZero<span class="main">)</span> <span class="main">⟶</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> case1 case2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">lemma</span></span> lemParallelTrans<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">lineA</span> <span class="main">∥</span> <span class="free">lineB</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="free">lineB</span> <span class="main">∥</span> <span class="free">lineC</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"direction <span class="free">lineB</span> <span class="main">≠</span> vecZero"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">lineA</span> <span class="main">∥</span> <span class="free">lineC</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> case1<span class="main">:</span> <span class="quoted"><span class="quoted">"direction <span class="free">lineA</span> <span class="main">=</span> vecZero <span class="main">⟶</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> case2<span class="main">:</span> <span class="quoted"><span class="quoted">"direction <span class="free">lineC</span> <span class="main">=</span> vecZero <span class="main">⟶</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> case3<span class="main">:</span> <span class="quoted"><span class="quoted">"direction <span class="free">lineA</span> <span class="main">≠</span> vecZero <span class="main">∧</span> direction <span class="free">lineC</span> <span class="main">≠</span> vecZero"</span></span>

      <span class="keyword1"><span class="command">have</span></span> exists_kab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">kab</span><span class="main">.</span><span class="main">(</span><span class="bound">kab</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">∧</span> direction <span class="free">lineB</span> <span class="main">=</span> <span class="bound">kab</span><span class="main">**</span>direction <span class="free">lineA</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> parallel.simps assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> case3 assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">kab</span></span> <span class="keyword2"><span class="keyword">where</span></span> kab_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">kab</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> direction <span class="free">lineB</span> <span class="main">=</span> <span class="skolem">kab</span><span class="main">**</span>direction <span class="free">lineA</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> exists_kbc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">kbc</span><span class="main">.</span><span class="main">(</span><span class="bound">kbc</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">∧</span> direction <span class="free">lineC</span> <span class="main">=</span> <span class="bound">kbc</span><span class="main">**</span>direction <span class="free">lineB</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> parallel.simps assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> case3 assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">kbc</span></span> <span class="keyword2"><span class="keyword">where</span></span> kbc_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">kbc</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> direction <span class="free">lineC</span> <span class="main">=</span> <span class="skolem">kbc</span><span class="main">**</span>direction <span class="free">lineB</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">kac</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">kac</span> <span class="main">=</span> <span class="skolem">kbc</span> <span class="main">*</span> <span class="skolem">kab</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> kac_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">kac</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> kab_props kac_def kbc_props no_zero_divisors<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direction <span class="free">lineC</span> <span class="main">=</span> <span class="skolem">kac</span><span class="main">**</span>direction <span class="free">lineA</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> kab_props kbc_props kac_def lemScaleScale<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> kac_nonzero parallel.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>direction <span class="free">lineA</span> <span class="main">≠</span> vecZero <span class="main">∧</span> direction <span class="free">lineC</span> <span class="main">≠</span> vecZero<span class="main">)</span> <span class="main">⟶</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> case1 case2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> -<span class="main">)</span> lemLineIdentity<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">lineA</span> <span class="main">=</span> <span class="main">⦇</span> basepoint <span class="main">=</span> basepoint <span class="free">lineB</span><span class="main">,</span> direction <span class="main">=</span> direction <span class="free">lineB</span> <span class="main">⦈</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">lineA</span> <span class="main">=</span> <span class="free">lineB</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"basepoint <span class="free">lineA</span> <span class="main">=</span> basepoint <span class="free">lineB</span> <span class="main">∧</span> direction <span class="free">lineA</span> <span class="main">=</span> direction <span class="free">lineB</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">lemma</span></span> lemDirectionJoining<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vectorJoining <span class="free">p</span> <span class="main">(</span><span class="free">p</span> <span class="main">↝</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span><span class="main">(</span><span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span> <span class="main">-</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_uminus_conv_diff diff_add_cancel semiring_normalization_rules<span class="main"><span class="main">(</span></span>24<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> lemDirectionFromTo<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"direction <span class="main">(</span><span class="keyword1">line</span> <span class="keyword1">joining</span> <span class="free">p</span> <span class="keyword1">to</span> <span class="main">(</span><span class="free">p</span> <span class="main">↝</span> <span class="free">dir</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">dir</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direction <span class="main">(</span><span class="keyword1">line</span> <span class="keyword1">joining</span> <span class="free">p</span> <span class="keyword1">to</span> <span class="main">(</span><span class="free">p</span> <span class="main">↝</span> <span class="free">dir</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">from</span> <span class="free">p</span> <span class="keyword1">to</span> <span class="main">(</span><span class="free">p</span> <span class="main">↝</span> <span class="free">dir</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemDirectionJoining<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>



  <span class="keyword1"><span class="command">lemma</span></span> lemLineEndpoint<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">↝</span> <span class="main">(</span><span class="keyword1">from</span> <span class="free">p</span> <span class="keyword1">to</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">+</span> <span class="main">(</span><span class="bound">b</span> <span class="main">-</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_add_cancel semiring_normalization_rules<span class="main"><span class="main">(</span></span>24<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">lemma</span></span> lemNullLine<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"direction <span class="free">lineA</span> <span class="main">=</span> vecZero"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"inLine <span class="free">x</span> <span class="free">lineA</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> basepoint <span class="free">lineA</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bp</span> <span class="main">=</span> basepoint <span class="free">lineA</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"collinear <span class="free">x</span> <span class="main">(</span>basepoint <span class="free">lineA</span><span class="main">)</span> <span class="main">(</span>basepoint <span class="free">lineA</span> <span class="main">↝</span> direction <span class="free">lineA</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inLine.simps assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"collinear <span class="free">x</span> <span class="skolem">bp</span> <span class="main">(</span><span class="skolem">bp</span> <span class="main">↝</span> vecZero<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bp_def  assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"collinear <span class="free">x</span> <span class="skolem">bp</span> <span class="skolem">bp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span><span class="main">(</span> <span class="main">(</span><span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>  
                  <span class="main">(</span>positionVector <span class="free">x</span> <span class="main">=</span> <span class="bound">a</span><span class="main">**</span><span class="main">(</span>positionVector <span class="skolem">bp</span><span class="main">)</span> <span class="main">⊕</span> <span class="bound">b</span><span class="main">**</span><span class="main">(</span>positionVector <span class="skolem">bp</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> collinear.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"positionVector <span class="free">x</span> <span class="main">=</span> positionVector <span class="skolem">bp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemScale1 lemAddOverScale<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">lemma</span></span> lemLineContainsBasepoint<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inLine <span class="free">p</span> <span class="main">(</span><span class="keyword1">line</span> <span class="keyword1">joining</span> <span class="free">p</span> <span class="keyword1">to</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">linePQ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">linePQ</span> <span class="main">=</span> <span class="keyword1">line</span> <span class="keyword1">joining</span> <span class="free">p</span> <span class="keyword1">to</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> bp<span class="main">:</span> <span class="quoted"><span class="quoted">"basepoint <span class="skolem">linePQ</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linePQ_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> dir<span class="main">:</span> <span class="quoted"><span class="quoted">"direction <span class="skolem">linePQ</span> <span class="main">=</span> <span class="keyword1">from</span> <span class="free">p</span> <span class="keyword1">to</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linePQ_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> endq<span class="main">:</span> <span class="quoted"><span class="quoted">"basepoint <span class="skolem">linePQ</span> <span class="main">↝</span> direction <span class="skolem">linePQ</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bp dir lemLineEndpoint<span class="main">)</span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>  <span class="main">∧</span> <span class="main">(</span>positionVector <span class="free">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">**</span><span class="main">(</span>positionVector <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">0</span><span class="main">**</span><span class="main">(</span>positionVector <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"collinear <span class="free">p</span> <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> collinear.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"collinear <span class="free">p</span> <span class="main">(</span>basepoint <span class="skolem">linePQ</span><span class="main">)</span> <span class="main">(</span>basepoint <span class="skolem">linePQ</span> <span class="main">↝</span> direction <span class="skolem">linePQ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bp endq<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linePQ_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">lemma</span></span> lemLineContainsEndpoint<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inLine <span class="free">q</span> <span class="main">(</span><span class="keyword1">line</span> <span class="keyword1">joining</span> <span class="free">p</span> <span class="keyword1">to</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">linePQ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">linePQ</span> <span class="main">=</span> <span class="keyword1">line</span> <span class="keyword1">joining</span> <span class="free">p</span> <span class="keyword1">to</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> bp<span class="main">:</span> <span class="quoted"><span class="quoted">"basepoint <span class="skolem">linePQ</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linePQ_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> dir<span class="main">:</span> <span class="quoted"><span class="quoted">"direction <span class="skolem">linePQ</span> <span class="main">=</span> <span class="keyword1">from</span> <span class="free">p</span> <span class="keyword1">to</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linePQ_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> endq<span class="main">:</span> <span class="quoted"><span class="quoted">"basepoint <span class="skolem">linePQ</span> <span class="main">↝</span> direction <span class="skolem">linePQ</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bp dir lemLineEndpoint<span class="main">)</span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>  <span class="main">∧</span> <span class="main">(</span>positionVector <span class="free">q</span> <span class="main">=</span> <span class="main">0</span><span class="main">**</span><span class="main">(</span>positionVector <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">1</span><span class="main">**</span><span class="main">(</span>positionVector <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"collinear <span class="free">q</span> <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> collinear.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"collinear <span class="free">q</span> <span class="main">(</span>basepoint <span class="skolem">linePQ</span><span class="main">)</span> <span class="main">(</span>basepoint <span class="skolem">linePQ</span> <span class="main">↝</span> direction <span class="skolem">linePQ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bp endq<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linePQ_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>



  <span class="keyword1"><span class="command">lemma</span></span> lemDirectionReverse<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">q</span> <span class="keyword1">to</span> <span class="free">p</span> <span class="main">=</span> vecNegate <span class="main">(</span><span class="keyword1">from</span> <span class="free">p</span> <span class="keyword1">to</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


  <span class="keyword1"><span class="command">lemma</span></span> lemParallelJoin<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">line</span> <span class="keyword1">joining</span> <span class="free">p</span> <span class="keyword1">to</span> <span class="free">q</span> <span class="main">∥</span> <span class="keyword1">line</span> <span class="keyword1">joining</span> <span class="free">q</span> <span class="keyword1">to</span> <span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="keyword1">line</span> <span class="keyword1">joining</span> <span class="free">p</span> <span class="keyword1">to</span> <span class="free">q</span> <span class="main">∥</span> <span class="keyword1">line</span> <span class="keyword1">joining</span> <span class="free">p</span> <span class="keyword1">to</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">linePQ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">linePQ</span> <span class="main">=</span> <span class="keyword1">line</span> <span class="keyword1">joining</span> <span class="free">p</span> <span class="keyword1">to</span> <span class="free">q</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lineQR</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lineQR</span> <span class="main">=</span> <span class="keyword1">line</span> <span class="keyword1">joining</span> <span class="free">q</span> <span class="keyword1">to</span> <span class="free">r</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">linePR</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">linePR</span> <span class="main">=</span> <span class="keyword1">line</span> <span class="keyword1">joining</span> <span class="free">p</span> <span class="keyword1">to</span> <span class="free">r</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> case1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>direction <span class="skolem">linePQ</span> <span class="main">=</span> vecZero<span class="main">)</span> <span class="main">⟶</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linePQ_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> case2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>direction <span class="skolem">linePR</span> <span class="main">=</span> vecZero<span class="main">)</span> <span class="main">⟶</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linePR_def<span class="main">)</span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> case3<span class="main">:</span> <span class="quoted"><span class="quoted">"direction <span class="skolem">linePQ</span> <span class="main">≠</span> vecZero <span class="main">∧</span> direction <span class="skolem">linePR</span> <span class="main">≠</span> vecZero"</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> case3a<span class="main">:</span> <span class="quoted"><span class="quoted">"direction <span class="skolem">lineQR</span> <span class="main">=</span> vecZero"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inLine <span class="free">r</span> <span class="skolem">lineQR</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemLineContainsEndpoint lineQR_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> basepoint <span class="skolem">lineQR</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemNullLine case3a<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lineQR_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">linePQ</span> <span class="main">=</span> <span class="skolem">linePR</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linePQ_def linePR_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemParallelReflexive linePQ_def linePR_def<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> rtp3a<span class="main">:</span> <span class="quoted"><span class="quoted">"direction <span class="skolem">lineQR</span> <span class="main">=</span> vecZero <span class="main">⟶</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> case3b<span class="main">:</span> <span class="quoted"><span class="quoted">"direction <span class="skolem">lineQR</span> <span class="main">≠</span> vecZero"</span></span>

        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">dirPQ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dirPQ</span> <span class="main">=</span> <span class="keyword1">from</span> <span class="free">p</span> <span class="keyword1">to</span> <span class="free">q</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> dir_pq<span class="main">:</span> <span class="quoted"><span class="quoted">"direction <span class="skolem">linePQ</span> <span class="main">=</span> <span class="skolem">dirPQ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linePQ_def dirPQ_def<span class="main">)</span>

        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">dirQR</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dirQR</span> <span class="main">=</span> <span class="keyword1">from</span> <span class="free">q</span> <span class="keyword1">to</span> <span class="free">r</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> dir_qr<span class="main">:</span> <span class="quoted"><span class="quoted">"direction <span class="skolem">lineQR</span> <span class="main">=</span> <span class="skolem">dirQR</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lineQR_def dirQR_def<span class="main">)</span>
  
        <span class="keyword1"><span class="command">have</span></span> exists_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span><span class="main">(</span><span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> direction <span class="skolem">lineQR</span> <span class="main">=</span> <span class="bound">k</span><span class="main">**</span>direction <span class="skolem">linePQ</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> linePQ_def lineQR_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> parallel.simps case3b case3<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">dirQR</span><span class="main">=</span> <span class="skolem">k</span><span class="main">**</span><span class="skolem">dirPQ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dir_pq dir_qr<span class="main">)</span>

        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">scalar</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">scalar</span> <span class="main">=</span> <span class="main">1</span><span class="main">+</span><span class="skolem">k</span>"</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">↝</span> <span class="skolem">dirPQ</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">=</span> <span class="free">q</span> <span class="main">↝</span> <span class="skolem">dirQR</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemLineEndpoint dirPQ_def dirQR_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">p</span> <span class="main">↝</span> <span class="skolem">dirPQ</span> <span class="main">↝</span> <span class="main">(</span><span class="skolem">k</span><span class="main">**</span><span class="skolem">dirPQ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> k_props<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> scalarPR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">p</span> <span class="main">↝</span> <span class="skolem">scalar</span><span class="main">**</span><span class="skolem">dirPQ</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemScaleLinear lemScale1 lemAddOverScale scalar_def<span class="main">)</span>

        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> scalar0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">scalar</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lemScale0 scalarPR scalar0<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direction <span class="skolem">linePR</span> <span class="main">=</span> vecZero"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linePR_def<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> case3<span class="main">)</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> scalar_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">scalar</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">linePR</span> <span class="main">=</span> <span class="keyword1">line</span> <span class="keyword1">joining</span> <span class="free">p</span> <span class="keyword1">to</span> <span class="main">(</span><span class="free">p</span> <span class="main">↝</span> <span class="skolem">scalar</span><span class="main">**</span><span class="skolem">dirPQ</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> linePR_def scalarPR<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direction <span class="skolem">linePR</span> <span class="main">=</span> <span class="skolem">scalar</span><span class="main">**</span><span class="skolem">dirPQ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemDirectionFromTo<span class="main">)</span>
    
        <span class="keyword1"><span class="command">hence</span></span> scalar_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">scalar</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> direction <span class="skolem">linePR</span> <span class="main">=</span> <span class="skolem">scalar</span><span class="main">**</span>direction <span class="skolem">linePQ</span>"</span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> scalar_nonzero dir_pq<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> parallel.simps linePR_def linePQ_def<span class="main">)</span> 
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direction <span class="skolem">lineQR</span> <span class="main">≠</span> vecZero <span class="main">⟶</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rtp3a<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>direction <span class="skolem">linePQ</span> <span class="main">≠</span> vecZero <span class="main">∧</span> direction <span class="skolem">linePR</span> <span class="main">≠</span> vecZero<span class="main">)</span> <span class="main">⟶</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> case1 case2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">lemma</span></span> lemDirectionCollinear<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"collinear <span class="free">u</span> <span class="free">v</span> <span class="main">(</span><span class="free">v</span> <span class="main">↝</span> <span class="free">d</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">β</span><span class="main">.</span><span class="main">(</span><span class="keyword1">from</span> <span class="free">u</span> <span class="keyword1">to</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="bound">β</span><span class="main">)</span><span class="main">**</span><span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> basic1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span><span class="main">(</span>positionVector <span class="main">(</span><span class="bound">u</span> <span class="main">↝</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>positionVector <span class="bound">u</span><span class="main">)</span> <span class="main">⊕</span> <span class="bound">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> basic2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="bound">v</span> <span class="bound">w</span><span class="main">.</span><span class="main">(</span><span class="bound">u</span> <span class="main">=</span> <span class="bound">v</span> <span class="main">⊕</span> <span class="bound">w</span> <span class="main">⟶</span> <span class="bound">v</span> <span class="main">⊖</span> <span class="bound">u</span> <span class="main">=</span> vecNegate <span class="bound">w</span> <span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">metis</span> add_uminus_conv_diff diff_add_cancel minus_add 
              semiring_normalization_rules<span class="main"><span class="main">(</span></span>24<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> basic3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span><span class="main">(</span><span class="keyword1">from</span> <span class="bound">u</span> <span class="keyword1">to</span> <span class="bound">v</span> <span class="main">=</span> positionVector <span class="bound">v</span> <span class="main">⊖</span> positionVector <span class="bound">u</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> basic4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="bound">v</span> <span class="bound">w</span><span class="main">.</span><span class="main">(</span><span class="bound">v</span> <span class="main">⊖</span> <span class="bound">u</span> <span class="main">=</span> vecNegate <span class="bound">w</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">=</span> <span class="bound">v</span> <span class="main">⊕</span> <span class="bound">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_uminus_conv_diff diff_add_cancel lemScale1 mult.left_neutral 
          semiring_normalization_rules<span class="main"><span class="main">(</span></span>24<span class="main"><span class="main">)</span></span> vecScale.simps<span class="main">)</span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"collinear <span class="free">u</span> <span class="free">v</span> <span class="main">(</span><span class="free">v</span> <span class="main">↝</span> <span class="free">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">α</span> <span class="bound">β</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span><span class="bound">α</span> <span class="main">+</span> <span class="bound">β</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>  <span class="main">∧</span>
         positionVector <span class="free">u</span> <span class="main">=</span> <span class="bound">α</span><span class="main">**</span><span class="main">(</span>positionVector <span class="free">v</span><span class="main">)</span> <span class="main">⊕</span> <span class="bound">β</span><span class="main">**</span><span class="main">(</span>positionVector <span class="main">(</span><span class="free">v</span> <span class="main">↝</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm collinear.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="keyword2"><span class="keyword">where</span></span> props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">α</span> <span class="main">+</span> <span class="skolem">β</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>  <span class="main">∧</span>
              positionVector <span class="free">u</span> <span class="main">=</span> <span class="skolem">α</span><span class="main">**</span><span class="main">(</span>positionVector <span class="free">v</span><span class="main">)</span> <span class="main">⊕</span> <span class="skolem">β</span><span class="main">**</span><span class="main">(</span>positionVector <span class="main">(</span><span class="free">v</span> <span class="main">↝</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"positionVector <span class="free">u</span> <span class="main">=</span> <span class="main">1</span><span class="main">**</span><span class="main">(</span>positionVector <span class="free">v</span><span class="main">)</span> <span class="main">⊕</span> <span class="skolem">β</span><span class="main">**</span><span class="free">d</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> basic1 lemScaleOverAdd lemVecPlusAssoc lemAddOverScale props<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"positionVector <span class="free">u</span> <span class="main">=</span> positionVector <span class="free">v</span> <span class="main">⊕</span> <span class="skolem">β</span><span class="main">**</span><span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemScale1<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"positionVector <span class="free">v</span> <span class="main">⊖</span> positionVector <span class="free">u</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">β</span><span class="main">)</span><span class="main">**</span><span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> basic2 lemScaleNeg<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">β</span><span class="main">.</span><span class="main">(</span><span class="keyword1">from</span> <span class="free">u</span> <span class="keyword1">to</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="bound">β</span><span class="main">)</span><span class="main">**</span><span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> basic3<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> fwd<span class="main">:</span> <span class="quoted"><span class="quoted">"collinear <span class="free">u</span> <span class="free">v</span> <span class="main">(</span><span class="free">v</span> <span class="main">↝</span> <span class="free">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">β</span><span class="main">.</span><span class="main">(</span><span class="keyword1">from</span> <span class="free">u</span> <span class="keyword1">to</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="bound">β</span><span class="main">)</span><span class="main">**</span><span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">β</span><span class="main">.</span><span class="main">(</span><span class="keyword1">from</span> <span class="free">u</span> <span class="keyword1">to</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="bound">β</span><span class="main">)</span><span class="main">**</span><span class="free">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="keyword2"><span class="keyword">where</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">u</span> <span class="keyword1">to</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">β</span><span class="main">)</span><span class="main">**</span><span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">β</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> αβ_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">+</span> <span class="skolem">β</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> α_def<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">u</span> <span class="keyword1">to</span> <span class="free">v</span> <span class="main">=</span> vecNegate <span class="main">(</span><span class="skolem">β</span><span class="main">**</span><span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm lemScaleNeg<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"positionVector <span class="free">v</span> <span class="main">⊖</span> positionVector <span class="free">u</span> <span class="main">=</span> vecNegate <span class="main">(</span><span class="skolem">β</span><span class="main">**</span><span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"positionVector <span class="free">u</span> <span class="main">=</span> positionVector <span class="free">v</span> <span class="main">⊕</span> <span class="skolem">β</span><span class="main">**</span><span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> basic4<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"positionVector <span class="free">u</span> <span class="main">=</span> <span class="main">1</span><span class="main">**</span><span class="main">(</span>positionVector <span class="free">v</span><span class="main">)</span> <span class="main">⊕</span> <span class="skolem">β</span><span class="main">**</span><span class="free">d</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemScale1<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">α</span> <span class="main">+</span> <span class="skolem">β</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>  <span class="main">∧</span>
            positionVector <span class="free">u</span> <span class="main">=</span> <span class="skolem">α</span><span class="main">**</span><span class="main">(</span>positionVector <span class="free">v</span><span class="main">)</span> <span class="main">⊕</span> <span class="skolem">β</span><span class="main">**</span><span class="main">(</span>positionVector <span class="main">(</span><span class="free">v</span> <span class="main">↝</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> αβ_sum basic1 lemScaleOverAdd lemVecPlusAssoc lemAddOverScale<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"collinear <span class="free">u</span> <span class="free">v</span> <span class="main">(</span><span class="free">v</span> <span class="main">↝</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">β</span><span class="main">.</span><span class="main">(</span><span class="keyword1">from</span> <span class="free">u</span> <span class="keyword1">to</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="bound">β</span><span class="main">)</span><span class="main">**</span><span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> collinear <span class="free">u</span> <span class="free">v</span> <span class="main">(</span><span class="free">v</span> <span class="main">↝</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fwd<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">lemma</span></span> lemParallelNotMeet<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">lineA</span> <span class="main">∥</span> <span class="free">lineB</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"direction <span class="free">lineA</span> <span class="main">≠</span> vecZero"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"direction <span class="free">lineB</span> <span class="main">≠</span> vecZero"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"inLine <span class="free">x</span> <span class="free">lineA</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>inLine <span class="free">x</span> <span class="free">lineB</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>meets <span class="free">lineA</span> <span class="free">lineB</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>

    <span class="keyword1"><span class="command">have</span></span> basic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span> <span class="bound">q</span> <span class="bound">v</span> <span class="bound">a</span><span class="main">.</span><span class="main">(</span><span class="keyword1">from</span> <span class="bound">p</span> <span class="keyword1">to</span> <span class="bound">q</span> <span class="main">=</span> <span class="bound">a</span><span class="main">**</span><span class="bound">v</span> <span class="main">⟶</span> <span class="keyword1">from</span> <span class="bound">q</span> <span class="keyword1">to</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="bound">a</span><span class="main">)</span><span class="main">**</span><span class="bound">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lemScaleNeg<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minus_diff_eq<span class="main">)</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bpA</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bpA</span> <span class="main">=</span> basepoint <span class="free">lineA</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">dirA</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dirA</span> <span class="main">=</span> direction <span class="free">lineA</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bpB</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bpB</span> <span class="main">=</span> basepoint <span class="free">lineB</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">dirB</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dirB</span> <span class="main">=</span> direction <span class="free">lineB</span>"</span></span>

    <span class="comment1">(* lineA is parallel to lineB *)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">lineB</span> <span class="main">∥</span> <span class="free">lineA</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemParallelSym assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> exists_kab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">kab</span><span class="main">.</span><span class="main">(</span><span class="bound">kab</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">∧</span> direction <span class="free">lineA</span> <span class="main">=</span> <span class="bound">kab</span><span class="main">**</span>direction <span class="free">lineB</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> parallel.simps assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">kab</span></span> <span class="keyword2"><span class="keyword">where</span></span> kab_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">kab</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">dirA</span> <span class="main">=</span> <span class="skolem">kab</span><span class="main">**</span><span class="skolem">dirB</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dirA_def dirB_def<span class="main">)</span>

    <span class="comment1">(* x is in lineA *)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"collinear <span class="free">x</span> <span class="skolem">bpA</span> <span class="main">(</span><span class="skolem">bpA</span> <span class="main">↝</span> <span class="skolem">dirA</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> inLine.simps bpA_def dirA_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">x</span> <span class="keyword1">to</span> <span class="skolem">bpA</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">β</span><span class="main">)</span><span class="main">**</span><span class="skolem">dirA</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemDirectionCollinear<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> x_to_bpA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">x</span> <span class="keyword1">to</span> <span class="skolem">bpA</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="skolem">β</span><span class="main">)</span><span class="main">*</span><span class="skolem">kab</span><span class="main">)</span><span class="main">**</span><span class="skolem">dirB</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemScaleScale kab_props<span class="main">)</span>

    <span class="comment1">(* Assume the claim is false, and show that x is in lineB, contrary to assumption *)</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> converse<span class="main">:</span> <span class="quoted"><span class="quoted">"meets <span class="free">lineA</span> <span class="free">lineB</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span><span class="main">(</span>inLine <span class="bound">p</span> <span class="free">lineA</span> <span class="main">∧</span> inLine <span class="bound">p</span> <span class="free">lineB</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> converse meets.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span>  p_in_AB<span class="main">:</span> <span class="quoted"><span class="quoted">"inLine <span class="skolem">p</span> <span class="free">lineA</span> <span class="main">∧</span> inLine <span class="skolem">p</span> <span class="free">lineB</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"collinear <span class="skolem">p</span> <span class="skolem">bpA</span> <span class="main">(</span><span class="skolem">bpA</span> <span class="main">↝</span> <span class="skolem">dirA</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> p_in_AB inLine.simps bpA_def dirA_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">βA</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="skolem">p</span> <span class="keyword1">to</span> <span class="skolem">bpA</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">βA</span><span class="main">)</span><span class="main">**</span><span class="skolem">dirA</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemDirectionCollinear<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="skolem">bpA</span> <span class="keyword1">to</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">βA</span><span class="main">)</span><span class="main">**</span><span class="skolem">dirA</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> basic minus_minus<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> bpA_to_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="skolem">bpA</span> <span class="keyword1">to</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">βA</span><span class="main">*</span><span class="skolem">kab</span><span class="main">)</span><span class="main">**</span><span class="skolem">dirB</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemScaleScale kab_props<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"collinear <span class="skolem">p</span> <span class="skolem">bpB</span> <span class="main">(</span><span class="skolem">bpB</span> <span class="main">↝</span> <span class="skolem">dirB</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> p_in_AB inLine.simps bpB_def dirB_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">βB</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_to_bpB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="skolem">p</span> <span class="keyword1">to</span> <span class="skolem">bpB</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">βB</span><span class="main">)</span><span class="main">**</span><span class="skolem">dirB</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemDirectionCollinear<span class="main">)</span>

      <span class="comment1">(* Express from x to bpB directly in terms of dirB *)</span>

      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="skolem">β</span><span class="main">)</span><span class="main">*</span><span class="skolem">kab</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">βA</span><span class="main">*</span><span class="skolem">kab</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="skolem">βB</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> x_to_bpB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">from</span> <span class="free">x</span> <span class="keyword1">to</span> <span class="skolem">bpA</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="keyword1">from</span> <span class="skolem">bpA</span> <span class="keyword1">to</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="keyword1">from</span> <span class="skolem">p</span> <span class="keyword1">to</span> <span class="skolem">bpB</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">from</span> <span class="free">x</span> <span class="keyword1">to</span> <span class="skolem">bpB</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemFromToTo<span class="main">)</span>      
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">x</span> <span class="keyword1">to</span> <span class="skolem">bpB</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="skolem">β</span><span class="main">)</span><span class="main">*</span><span class="skolem">kab</span><span class="main">)</span><span class="main">**</span><span class="skolem">dirB</span> <span class="main">⊕</span> <span class="main">(</span><span class="skolem">βA</span><span class="main">*</span><span class="skolem">kab</span><span class="main">)</span><span class="main">**</span><span class="skolem">dirB</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">-</span><span class="skolem">βB</span><span class="main">)</span><span class="main">**</span><span class="skolem">dirB</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> x_to_bpA bpA_to_p p_to_bpB<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">x</span> <span class="keyword1">to</span> <span class="skolem">bpB</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">γ</span><span class="main">)</span><span class="main">**</span><span class="skolem">dirB</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemAddOverScale add.assoc γ_def minus_minus<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"collinear <span class="free">x</span> <span class="skolem">bpB</span> <span class="main">(</span><span class="skolem">bpB</span> <span class="main">↝</span> <span class="skolem">dirB</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemDirectionCollinear<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inLine <span class="free">x</span> <span class="free">lineB</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inLine.simps bpB_def dirB_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"meets <span class="free">lineA</span> <span class="free">lineB</span> <span class="main">⟶</span> inLine <span class="free">x</span> <span class="free">lineB</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">lemma</span></span> lemAxisIsLine<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"onAxisT <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"onAxisT <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"onAxisT <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"collinear <span class="free">x</span> <span class="free">y</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ratio</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ratio</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span>tval <span class="free">y</span> <span class="main">-</span> tval <span class="free">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>tval <span class="free">z</span> <span class="main">-</span> tval <span class="free">y</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> x_onAxis<span class="main">:</span> <span class="quoted"><span class="quoted">"xval <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> yval <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> zval <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> onAxisT.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> y_onAxis<span class="main">:</span> <span class="quoted"><span class="quoted">"xval <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> yval <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> zval <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> onAxisT.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> z_onAxis<span class="main">:</span> <span class="quoted"><span class="quoted">"xval <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> yval <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> zval <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> onAxisT.simps<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"tval <span class="free">z</span> <span class="main">-</span> tval <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> z_onAxis y_onAxis<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"tval <span class="free">z</span> <span class="main">≠</span> tval <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> eq_iff_diff_eq_0<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> tvalyz_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"tval <span class="free">z</span> <span class="main">-</span> tval <span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_iff_diff_eq_0<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> x_to_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">x</span> <span class="keyword1">to</span> <span class="free">y</span> <span class="main">=</span> <span class="main">⦇</span> tdir <span class="main">=</span> tval <span class="free">y</span> <span class="main">-</span> tval <span class="free">x</span><span class="main">,</span> xdir <span class="main">=</span> <span class="main">0</span><span class="main">,</span> ydir <span class="main">=</span> <span class="main">0</span><span class="main">,</span> zdir <span class="main">=</span> <span class="main">0</span> <span class="main">⦈</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_onAxis y_onAxis<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> y_to_z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">y</span> <span class="keyword1">to</span> <span class="free">z</span> <span class="main">=</span> <span class="main">⦇</span> tdir <span class="main">=</span> tval <span class="free">z</span> <span class="main">-</span> tval <span class="free">y</span><span class="main">,</span> xdir <span class="main">=</span> <span class="main">0</span><span class="main">,</span> ydir <span class="main">=</span> <span class="main">0</span><span class="main">,</span> zdir <span class="main">=</span> <span class="main">0</span> <span class="main">⦈</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>y_onAxis z_onAxis<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">x</span> <span class="keyword1">to</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">ratio</span><span class="main">)</span><span class="main">**</span><span class="main">(</span><span class="keyword1">from</span> <span class="free">y</span> <span class="keyword1">to</span> <span class="free">z</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_to_y y_to_z ratio_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_self eq_divide_imp minus_diff_eq mult_eq_0_iff 
                tvalyz_nonzero x_onAxis y_onAxis z_onAxis<span class="main">)</span>
     <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"collinear <span class="free">x</span> <span class="free">y</span> <span class="main">(</span><span class="free">y</span> <span class="main">↝</span> <span class="main">(</span><span class="keyword1">from</span> <span class="free">y</span> <span class="keyword1">to</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemDirectionCollinear<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemLineEndpoint<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> lemSpace2Sym<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"space2 <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> space2 <span class="free">y</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xsep</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xsep</span> <span class="main">=</span> xval <span class="free">x</span> <span class="main">-</span> xval <span class="free">y</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ysep</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ysep</span> <span class="main">=</span> yval <span class="free">x</span> <span class="main">-</span> yval <span class="free">y</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">zsep</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zsep</span> <span class="main">=</span> zval <span class="free">x</span> <span class="main">-</span> zval <span class="free">y</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> spacexy<span class="main">:</span> <span class="quoted"><span class="quoted">"space2 <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">xsep</span><span class="main">*</span><span class="skolem">xsep</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">ysep</span><span class="main">*</span><span class="skolem">ysep</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">zsep</span><span class="main">*</span><span class="skolem">zsep</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xsep_def ysep_def zsep_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> spaceyx<span class="main">:</span> <span class="quoted"><span class="quoted">"space2 <span class="free">y</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">xsep</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="skolem">xsep</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="skolem">ysep</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="skolem">ysep</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="skolem">zsep</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="skolem">zsep</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xsep_def ysep_def zsep_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> spacexy diff_0_right minus_diff_eq minus_mult_left minus_mult_right<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> lemTime2Sym<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"time2 <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> time2 <span class="free">y</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">tsep</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tsep</span> <span class="main">=</span> tval <span class="free">x</span> <span class="main">-</span> tval <span class="free">y</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> timexy<span class="main">:</span> <span class="quoted"><span class="quoted">"time2 <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="skolem">tsep</span><span class="main">*</span><span class="skolem">tsep</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tsep_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> timeyx<span class="main">:</span> <span class="quoted"><span class="quoted">"time2 <span class="free">y</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">tsep</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="skolem">tsep</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tsep_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> timexy diff_0_right minus_diff_eq minus_mult_left minus_mult_right<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(*
  A plane is determined by a basepoint with two directions.
*)</span>
<span class="keyword1"><span class="command">class</span></span> Planes <span class="main">=</span> Quantities <span class="main">+</span> Lines
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">mkPlane</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Vector <span class="main">⇒</span> <span class="tfree">'a</span> Vector <span class="main">⇒</span> <span class="tfree">'a</span> Plane"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">mkPlane</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">d1</span></span></span> <span class="free"><span class="bound"><span class="entity">d2</span></span></span> <span class="main">=</span> <span class="main">⦇</span> pbasepoint <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> direction1 <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d1</span></span></span><span class="main">,</span> direction2 <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d2</span></span></span> <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">coplanar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Point <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">coplanar</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> 
      <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">α</span> <span class="bound">β</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span><span class="bound">α</span> <span class="main">+</span>  <span class="bound">β</span> <span class="main">+</span>  <span class="bound">γ</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>  <span class="main">∧</span>
            positionVector <span class="free"><span class="bound"><span class="entity">e</span></span></span> 
              <span class="main">=</span> <span class="main">(</span><span class="bound">α</span><span class="main">**</span><span class="main">(</span>positionVector <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">⊕</span> <span class="bound">β</span><span class="main">**</span><span class="main">(</span>positionVector <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">⊕</span> <span class="bound">γ</span><span class="main">**</span><span class="main">(</span>positionVector <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">inPlane</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Plane <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">inPlane</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">pl</span></span></span> <span class="main">=</span> coplanar <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span>pbasepoint <span class="free"><span class="bound"><span class="entity">pl</span></span></span><span class="main">)</span> <span class="main">(</span>pbasepoint <span class="free"><span class="bound"><span class="entity">pl</span></span></span> <span class="main">↝</span> direction1 <span class="free"><span class="bound"><span class="entity">pl</span></span></span><span class="main">)</span>
                                               <span class="main">(</span>pbasepoint <span class="free"><span class="bound"><span class="entity">pl</span></span></span> <span class="main">↝</span> direction2 <span class="free"><span class="bound"><span class="entity">pl</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">samePlane</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Plane <span class="main">⇒</span> <span class="tfree">'a</span> Plane <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">samePlane</span> <span class="free"><span class="bound"><span class="entity">pl</span></span></span> <span class="free"><span class="bound"><span class="entity">pl'</span></span></span> <span class="main">=</span> <span class="main">(</span>inPlane <span class="main">(</span>pbasepoint <span class="free"><span class="bound"><span class="entity">pl</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">pl'</span></span></span> <span class="main">∧</span>
                         inPlane <span class="main">(</span>pbasepoint <span class="free"><span class="bound"><span class="entity">pl</span></span></span> <span class="main">↝</span> direction1 <span class="free"><span class="bound"><span class="entity">pl</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">pl'</span></span></span> <span class="main">∧</span>
                         inPlane <span class="main">(</span>pbasepoint <span class="free"><span class="bound"><span class="entity">pl</span></span></span> <span class="main">↝</span> direction2 <span class="free"><span class="bound"><span class="entity">pl</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">pl'</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lemPlaneContainsBasePoint<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inPlane <span class="main">(</span>pbasepoint <span class="free">pl</span><span class="main">)</span> <span class="free">pl</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> rtp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">+</span> <span class="skolem">β</span> <span class="main">+</span> <span class="skolem">γ</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> α_def β_def γ_def<span class="main">)</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> pbasepoint <span class="free">pl</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> pbasepoint <span class="free">pl</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> pbasepoint <span class="free">pl</span> <span class="main">↝</span> direction1 <span class="free">pl</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> pbasepoint <span class="free">pl</span> <span class="main">↝</span> direction2 <span class="free">pl</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> rtp2<span class="main">:</span> <span class="quoted"><span class="quoted">"positionVector <span class="skolem">e</span> <span class="main">=</span> <span class="skolem">α</span><span class="main">**</span><span class="main">(</span>positionVector <span class="skolem">x</span><span class="main">)</span> 
                                 <span class="main">⊕</span> <span class="skolem">β</span><span class="main">**</span><span class="main">(</span>positionVector <span class="skolem">y</span><span class="main">)</span> <span class="main">⊕</span> <span class="skolem">γ</span><span class="main">**</span><span class="main">(</span>positionVector <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e_def x_def α_def β_def γ_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> sameplane<span class="main">:</span> <span class="quoted"><span class="quoted">"coplanar <span class="skolem">e</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coplanar.simps rtp1 rtp2<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coplanar <span class="skolem">e</span> <span class="main">(</span>pbasepoint <span class="free">pl</span><span class="main">)</span> <span class="main">(</span>pbasepoint <span class="free">pl</span> <span class="main">↝</span> direction1 <span class="free">pl</span><span class="main">)</span> 
                                      <span class="main">(</span>pbasepoint <span class="free">pl</span> <span class="main">↝</span> direction2 <span class="free">pl</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_def y_def z_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inPlane <span class="skolem">e</span> <span class="free">pl</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="comment1">(*
  An upright cone is determined by its vertex + slope (ie, speed).
*)</span>

<span class="keyword1"><span class="command">class</span></span> Cones <span class="main">=</span> Quantities <span class="main">+</span> Lines <span class="main">+</span> Planes <span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="comment1">(* the tangent plane at a point on a cone *)</span>
  <span class="free"><span class="free"><span class="free">tangentPlane</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Cone <span class="main">⇒</span> <span class="tfree">'a</span> Plane"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> 
  <span class="comment1">(* The pbasepoint of the plane-at-e is e *)</span>
  AxTangentBase<span class="main">:</span> <span class="quoted"><span class="quoted">"pbasepoint <span class="main">(</span><span class="free">tangentPlane</span> <span class="free">e</span> <span class="free">cone</span><span class="main">)</span> <span class="main">=</span> <span class="free">e</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
  <span class="comment1">(* The tangent plane contains the vertex *)</span>
  AxTangentVertex<span class="main">:</span> <span class="quoted"><span class="quoted">"inPlane <span class="main">(</span>vertex <span class="free">cone</span><span class="main">)</span> <span class="main">(</span><span class="free">tangentPlane</span> <span class="free">e</span> <span class="free">cone</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
  <span class="comment1">(* The tangent plane meets the cone in a line *)</span>
  AxConeTangent<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">onCone</span> <span class="free">e</span> <span class="free">cone</span><span class="main">)</span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">(</span>inPlane <span class="free">pt</span> <span class="main">(</span><span class="free">tangentPlane</span> <span class="free">e</span> <span class="free">cone</span><span class="main">)</span> <span class="main">∧</span> <span class="free">onCone</span> <span class="free">pt</span> <span class="free">cone</span><span class="main">)</span> 
                                                           <span class="main">⟷</span> collinear <span class="main">(</span>vertex <span class="free">cone</span><span class="main">)</span> <span class="free">e</span> <span class="free">pt</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
  <span class="comment1">(* The tangent plane is tangential to all cones with vertex in that plane, and
     the intersection lines are parallel. *)</span>
  AxParallelCones<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">onCone</span> <span class="free">e</span> <span class="free">econe</span> <span class="main">∧</span> <span class="free">e</span> <span class="main">≠</span> vertex <span class="free">econe</span> <span class="main">∧</span> <span class="free">onCone</span> <span class="free">f</span> <span class="free">fcone</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">≠</span> vertex <span class="free">fcone</span>
                      <span class="main">∧</span> inPlane <span class="free">f</span> <span class="main">(</span><span class="free">tangentPlane</span> <span class="free">e</span> <span class="free">econe</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">⟶</span>  <span class="main">(</span>samePlane <span class="main">(</span><span class="free">tangentPlane</span> <span class="free">e</span> <span class="free">econe</span><span class="main">)</span> <span class="main">(</span><span class="free">tangentPlane</span> <span class="free">f</span> <span class="free">fcone</span><span class="main">)</span>
                          <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>lineJoining <span class="main">(</span>vertex <span class="free">econe</span><span class="main">)</span> <span class="free">e</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span>lineJoining <span class="main">(</span>vertex <span class="free">fcone</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
  <span class="comment1">(* 
     if f is outside a cone, there is a tangent plane to that cone which contains f. The 
     tangent plane is determined by some e lying on the intersection line with the cone.
  *)</span>
  AxParallelConesE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">outsideCone</span> <span class="free">f</span> <span class="free">cone</span>
    <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span><span class="main">(</span><span class="free">onCone</span> <span class="bound">e</span> <span class="free">cone</span> <span class="main">∧</span> <span class="bound">e</span> <span class="main">≠</span> vertex <span class="free">cone</span> <span class="main">∧</span> inPlane <span class="free">f</span> <span class="main">(</span><span class="free">tangentPlane</span> <span class="bound">e</span> <span class="free">cone</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
<span class="comment1">(* 
  Given distinct e f on the t-axis, and g off the axis, we can 
  find a point p on the line e-g such that the line f-p has 
  slope s. This can be proven using AxEuclidean, by taking the 
  intersection of a line with a cone.
*)</span>
  AxSlopedLineInVerticalPlane<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>onAxisT <span class="free">e</span><span class="main">;</span> onAxisT <span class="free">f</span><span class="main">;</span> <span class="free">e</span> <span class="main">≠</span> <span class="free">f</span><span class="main">;</span> <span class="main">¬</span><span class="main">(</span>onAxisT <span class="free">g</span><span class="main">)</span><span class="main">⟧</span>
     <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span><span class="main">(</span> <span class="main">∃</span><span class="bound">p</span> <span class="main">.</span> <span class="main">(</span>collinear <span class="free">e</span> <span class="free">g</span> <span class="bound">p</span> <span class="main">∧</span> <span class="main">(</span>space2 <span class="bound">p</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="bound">s</span><span class="main">*</span><span class="bound">s</span><span class="main">)</span><span class="main">*</span>time2 <span class="bound">p</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">onCone</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Cone <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">onCone</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">cone</span></span></span>  
      <span class="main">=</span> <span class="main">(</span>space2 <span class="main">(</span>vertex <span class="free"><span class="bound"><span class="entity">cone</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>  <span class="main">=</span> <span class="main">(</span>slope <span class="free"><span class="bound"><span class="entity">cone</span></span></span> <span class="main">*</span> slope <span class="free"><span class="bound"><span class="entity">cone</span></span></span><span class="main">)</span> <span class="main">*</span> time2 <span class="main">(</span>vertex <span class="free"><span class="bound"><span class="entity">cone</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">insideCone</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Cone <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">insideCone</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">cone</span></span></span>  
      <span class="main">=</span> <span class="main">(</span>space2 <span class="main">(</span>vertex <span class="free"><span class="bound"><span class="entity">cone</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">&lt;</span> <span class="main">(</span>slope <span class="free"><span class="bound"><span class="entity">cone</span></span></span> <span class="main">*</span> slope <span class="free"><span class="bound"><span class="entity">cone</span></span></span><span class="main">)</span> <span class="main">*</span> time2 <span class="main">(</span>vertex <span class="free"><span class="bound"><span class="entity">cone</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">outsideCone</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Cone <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">outsideCone</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">cone</span></span></span>  
      <span class="main">=</span> <span class="main">(</span>space2 <span class="main">(</span>vertex <span class="free"><span class="bound"><span class="entity">cone</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">&gt;</span> <span class="main">(</span>slope <span class="free"><span class="bound"><span class="entity">cone</span></span></span> <span class="main">*</span> slope <span class="free"><span class="bound"><span class="entity">cone</span></span></span><span class="main">)</span> <span class="main">*</span> time2 <span class="main">(</span>vertex <span class="free"><span class="bound"><span class="entity">cone</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">mkCone</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> Cone"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">mkCone</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">⦇</span> vertex <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> slope <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> lemVertexOnCone<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"onCone <span class="main">(</span>vertex <span class="free">cone</span><span class="main">)</span> <span class="free">cone</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">lemma</span></span> lemOutsideNotOnCone<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"outsideCone <span class="free">f</span> <span class="free">cone</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>onCone <span class="free">f</span> <span class="free">cone</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms less_irrefl onCone.simps outsideCone.simps<span class="main">)</span>

  

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> SpaceTime <span class="main">=</span> Quantities <span class="main">+</span> Vectors <span class="main">+</span> Points <span class="main">+</span> Lines <span class="main">+</span> Planes <span class="main">+</span> Cones

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SomeFunc">
<div class="head">
<h1>Theory SomeFunc</h1>
</div>
<pre class="source"><span class="comment1">(*
   Author: Mike Stannett
   Date: 27 April 2016
   m.stannett@sheffield.ac.uk
*)</span>
<span class="keyword1"><span class="command">theory</span></span> SomeFunc
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">fun</span></span>  <span class="entity">someFunc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">someFunc</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lemSomeFunc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span> <span class="main">.</span> <span class="free">P</span> <span class="free">x</span> <span class="bound">y</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> someFunc <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="free">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> someI_ex<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Axioms">
<div class="head">
<h1>Theory Axioms</h1>
</div>
<pre class="source"><span class="comment1">(*
   Author: Mike Stannett
   Date: 22 October 2012
   m.stannett@sheffield.ac.uk
   Updated 28 April 2016 to run under Isabelle2016.
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Axioms
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SpaceTime.html">SpaceTime</a> <a href="SomeFunc.html">SomeFunc</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">record</span></span> Body <span class="main">=</span>
  Ph <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span>
  IOb <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span>


<span class="keyword1"><span class="command">class</span></span> WorldView <span class="main">=</span> SpaceTime <span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="comment1">(* Worldview relation *)</span>
  <span class="free"><span class="free"><span class="free">W</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Body <span class="main">⇒</span> Body <span class="main">⇒</span> <span class="tfree">'a</span> Point <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1">sees</span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1">at</span></span></span> _"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">and</span></span>
  <span class="comment1">(* Worldview transformation *)</span>
  <span class="free"><span class="free"><span class="free">wvt</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Body <span class="main">⇒</span> Body <span class="main">⇒</span> <span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Point"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  AxWVT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> IOb <span class="free">m</span><span class="main">;</span> IOb <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">W</span> <span class="free">k</span> <span class="free">b</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">W</span> <span class="free">m</span> <span class="free">b</span> <span class="main">(</span><span class="free">wvt</span> <span class="free">m</span> <span class="free">k</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
  AxWVTSym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> IOb <span class="free">m</span><span class="main">;</span> IOb <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">y</span> <span class="main">=</span> <span class="free">wvt</span> <span class="free">k</span> <span class="free">m</span> <span class="free">x</span>  <span class="main">⟷</span>  <span class="free">x</span> <span class="main">=</span> <span class="free">wvt</span> <span class="free">m</span> <span class="free">k</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="comment1">(* THE BASIC AXIOMS *)</span>
<span class="comment1">(* ================ *)</span>


<span class="keyword1"><span class="command">class</span></span> AxiomPreds <span class="main">=</span> WorldView 
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">sqrtTest</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     <span class="quoted"><span class="quoted">"<span class="free">sqrtTest</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">cTest</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Body <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">cTest</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">(</span> 
               <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span>Ph <span class="bound">p</span> <span class="main">∧</span> W <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="bound">p</span> <span class="bound">x</span> <span class="main">∧</span> W <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="bound">p</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span>space2 <span class="bound">x</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">*</span><span class="main">(</span>time2 <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> 
             <span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(*
  AxEuclidean
  Quantities form a Euclidean field, ie positive quantities have
  square roots. We introduce a function, sqrt, that determines them.
*)</span>
<span class="keyword1"><span class="command">class</span></span> AxEuclidean <span class="main">=</span> AxiomPreds <span class="main">+</span> Quantities <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  AxEuclidean<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">≥</span> Groups.zero_class.zero<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> sqrtTest <span class="free">x</span> <span class="bound">r</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">sqrt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     <span class="quoted"><span class="quoted">"<span class="free">sqrt</span> <span class="main">≡</span> someFunc sqrtTest"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> lemSqrt<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> sqrt <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≥</span> <span class="main">0</span>  <span class="main">∧</span>  <span class="free">r</span><span class="main">*</span><span class="free">r</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> rootExists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> sqrtTest <span class="free">x</span> <span class="bound">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AxEuclidean assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrtTest <span class="free">x</span> <span class="main">(</span>sqrt <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemSomeFunc<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="comment1">(* 
   AxLight
   There is an inertial observer, according to whom, any light
   signal moves with the same velocity in any direction 
*)</span>
<span class="keyword1"><span class="command">class</span></span> AxLight <span class="main">=</span> WorldView <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  AxLight<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">v</span><span class="main">.</span><span class="main">(</span> IOb <span class="bound">m</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span><span class="main">(</span> 
              <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span><span class="main">(</span>Ph <span class="bound">p</span> <span class="main">∧</span> W <span class="bound">m</span> <span class="bound">p</span> <span class="bound">x</span> <span class="main">∧</span> W <span class="bound">m</span> <span class="bound">p</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span>space2 <span class="bound">x</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">(</span><span class="bound">v</span> <span class="main">*</span> <span class="bound">v</span><span class="main">)</span><span class="main">*</span>time2 <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> 
            <span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">end</span></span>



<span class="comment1">(*
  AxPh
  For any inertial observer, the speed of light is the same in every
  direction everywhere, and it is finite. Furthermore, it is possible
  to send out a light signal in any direction.
*)</span>
<span class="keyword1"><span class="command">class</span></span> AxPh <span class="main">=</span> WorldView <span class="main">+</span> AxiomPreds <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  AxPh<span class="main">:</span> <span class="quoted"><span class="quoted">"IOb <span class="free">m</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> cTest <span class="free">m</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Body <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≡</span> someFunc cTest"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">lightcone</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Body <span class="main">⇒</span> <span class="tfree">'a</span> Point <span class="main">⇒</span> <span class="tfree">'a</span> Cone"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">lightcone</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> mkCone <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>c <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lemCProps<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"IOb <span class="free">m</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> c <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span>Ph <span class="bound">p</span> <span class="main">∧</span> W <span class="free">m</span> <span class="bound">p</span> <span class="bound">x</span> <span class="main">∧</span> W <span class="free">m</span> <span class="bound">p</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">⟷</span> <span class="main">(</span> space2 <span class="bound">x</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">(</span>c <span class="free">m</span> <span class="main">*</span> c <span class="free">m</span><span class="main">)</span><span class="main">*</span>time2 <span class="bound">x</span> <span class="bound">y</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> vExists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> cTest <span class="free">m</span> <span class="bound">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AxPh assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cTest <span class="free">m</span> <span class="main">(</span>c <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemSomeFunc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lemCCone<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"IOb <span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"onCone <span class="free">y</span> <span class="main">(</span>lightcone <span class="free">m</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span>Ph <span class="bound">p</span> <span class="main">∧</span> W <span class="free">m</span> <span class="bound">p</span> <span class="free">x</span> <span class="main">∧</span> W <span class="free">m</span> <span class="bound">p</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span><span class="main">(</span>Ph <span class="bound">p</span> <span class="main">∧</span> W <span class="free">m</span> <span class="bound">p</span> <span class="free">x</span> <span class="main">∧</span> W <span class="free">m</span> <span class="bound">p</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">⟷</span> <span class="main">(</span> space2 <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>c <span class="free">m</span> <span class="main">*</span> c <span class="free">m</span><span class="main">)</span><span class="main">*</span>time2 <span class="free">x</span> <span class="free">y</span> <span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> lemCProps<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> ph_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>space2 <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>c <span class="free">m</span> <span class="main">*</span> c <span class="free">m</span><span class="main">)</span><span class="main">*</span>time2 <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span><span class="main">(</span>Ph <span class="bound">p</span> <span class="main">∧</span> W <span class="free">m</span> <span class="bound">p</span> <span class="free">x</span> <span class="main">∧</span> W <span class="free">m</span> <span class="bound">p</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lcmx</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lcmx</span> <span class="main">=</span> lightcone <span class="free">m</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> lcmx_vertex<span class="main">:</span> <span class="quoted"><span class="quoted">"vertex <span class="skolem">lcmx</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lcmx_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> lcmx_slope<span class="main">:</span> <span class="quoted"><span class="quoted">"slope <span class="skolem">lcmx</span> <span class="main">=</span> c <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lcmx_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"onCone <span class="free">y</span> <span class="skolem">lcmx</span> <span class="main">⟶</span> <span class="main">(</span>space2 <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>c <span class="free">m</span> <span class="main">*</span> c <span class="free">m</span><span class="main">)</span><span class="main">*</span>time2 <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lcmx_vertex lcmx_slope onCone.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"space2 <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>c <span class="free">m</span> <span class="main">*</span> c <span class="free">m</span><span class="main">)</span><span class="main">*</span>time2 <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lcmx_def assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ph_exists<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lemCPos<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"IOb <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"c <span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> lemCProps<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> lemCPhoton<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"IOb <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span>Ph <span class="bound">p</span> <span class="main">∧</span> W <span class="free">m</span> <span class="bound">p</span> <span class="bound">x</span> <span class="main">∧</span> W <span class="free">m</span> <span class="bound">p</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span>space2 <span class="bound">x</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">(</span>c <span class="free">m</span> <span class="main">*</span> c <span class="free">m</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>time2 <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> lemCProps<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>



<span class="comment1">(*
  AxEv
  Inertial observers see the same events (meetings of bodies).
  This also enables us to discuss the worldview transformation.
*)</span>
<span class="keyword1"><span class="command">class</span></span> AxEv <span class="main">=</span> WorldView <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  AxEv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> IOb <span class="free">m</span><span class="main">;</span> IOb <span class="free">k</span><span class="main">⟧</span> <span class="main">⟹</span>  <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span>W <span class="free">m</span> <span class="bound">b</span> <span class="free">x</span>  <span class="main">⟷</span> W <span class="free">k</span> <span class="bound">b</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">end</span></span>



<span class="comment1">(*
  Inertial observers can move with any speed slower than that of light
*)</span>
<span class="keyword1"><span class="command">class</span></span> AxThExp <span class="main">=</span> WorldView <span class="main">+</span> AxPh <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
    AxThExp<span class="main">:</span> <span class="quoted"><span class="quoted">"IOb <span class="free">m</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span><span class="main">(</span> 
       <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span><span class="main">(</span>IOb <span class="bound">k</span> <span class="main">∧</span> W <span class="free">m</span> <span class="bound">k</span> <span class="bound">x</span> <span class="main">∧</span> W <span class="free">m</span> <span class="bound">k</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span>space2 <span class="bound">x</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="main">(</span>c <span class="free">m</span> <span class="main">*</span> c <span class="free">m</span><span class="main">)</span> <span class="main">*</span> time2 <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> 
       <span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">end</span></span>



<span class="comment1">(*
  Every inertial observer is stationary according to himself
*)</span>
<span class="keyword1"><span class="command">class</span></span> AxSelf <span class="main">=</span> WorldView <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  AxSelf<span class="main">:</span> <span class="quoted"><span class="quoted">"IOb <span class="free">m</span>  <span class="main">⟹</span>  <span class="main">(</span>W <span class="free">m</span> <span class="free">m</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>onAxisT <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">end</span></span>



<span class="comment1">(* 
  All inertial observers agree that the speed of light is 1
*)</span>
<span class="keyword1"><span class="command">class</span></span> AxC <span class="main">=</span> WorldView <span class="main">+</span> AxPh <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  AxC<span class="main">:</span> <span class="quoted"><span class="quoted">"IOb <span class="free">m</span> <span class="main">⟹</span> c <span class="free">m</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="comment1">(*
  Inertial observers agree as to the spatial distance between two
  events if these two events are simultaneous for both of them.
*)</span>
<span class="keyword1"><span class="command">class</span></span> AxSym <span class="main">=</span> WorldView <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  AxSym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> IOb <span class="free">m</span><span class="main">;</span> IOb <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span>
            <span class="main">(</span>W <span class="free">m</span> <span class="free">e</span> <span class="free">x</span> <span class="main">∧</span> W <span class="free">m</span> <span class="free">f</span> <span class="free">y</span> <span class="main">∧</span> W <span class="free">k</span> <span class="free">e</span> <span class="free">x'</span><span class="main">∧</span> W <span class="free">k</span> <span class="free">f</span> <span class="free">y'</span> <span class="main">∧</span>
            tval <span class="free">x</span> <span class="main">=</span> tval <span class="free">y</span> <span class="main">∧</span> tval <span class="free">x'</span> <span class="main">=</span> tval <span class="free">y'</span> <span class="main">)</span>
          <span class="main">⟶</span> <span class="main">(</span>space2 <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> space2 <span class="free">x'</span> <span class="free">y'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">end</span></span>



<span class="comment1">(*
  AxLines
  All observers agree about lines
*)</span>
<span class="keyword1"><span class="command">class</span></span> AxLines <span class="main">=</span> WorldView <span class="main">+</span> 
<span class="keyword2"><span class="keyword">assumes</span></span>
  AxLines<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> IOb <span class="free">m</span><span class="main">;</span> IOb <span class="free">k</span><span class="main">;</span> collinear <span class="free">x</span> <span class="free">p</span> <span class="free">q</span> <span class="main">⟧</span> <span class="main">⟹</span> 
     collinear <span class="main">(</span>wvt <span class="free">k</span> <span class="free">m</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>wvt <span class="free">k</span> <span class="free">m</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>wvt <span class="free">k</span> <span class="free">m</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">end</span></span>



<span class="comment1">(*
  AxPlanes
  All observers agree about planes
*)</span>
<span class="keyword1"><span class="command">class</span></span> AxPlanes <span class="main">=</span> WorldView <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  AxPlanes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> IOb <span class="free">m</span><span class="main">;</span> IOb <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> 
     <span class="main">(</span>coplanar <span class="free">e</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span>  <span class="main">⟶</span> coplanar <span class="main">(</span>wvt <span class="free">k</span> <span class="free">m</span> <span class="free">e</span><span class="main">)</span> <span class="main">(</span>wvt <span class="free">k</span> <span class="free">m</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>wvt <span class="free">k</span> <span class="free">m</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>wvt <span class="free">k</span> <span class="free">m</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">end</span></span>



<span class="comment1">(*
  AxCones
  All observers agree about lightcones
*)</span>
<span class="keyword1"><span class="command">class</span></span> AxCones <span class="main">=</span> WorldView <span class="main">+</span> AxPh <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
  AxCones<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> IOb <span class="free">m</span><span class="main">;</span> IOb <span class="free">k</span> <span class="main">⟧</span> <span class="main">⟹</span> 
     <span class="main">(</span> onCone <span class="free">x</span> <span class="main">(</span><span class="free">lightCone</span> <span class="free">m</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟶</span> onCone <span class="main">(</span>wvt <span class="free">k</span> <span class="free">m</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>lightcone <span class="free">k</span> <span class="main">(</span>wvt <span class="free">k</span> <span class="free">m</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">end</span></span>



<span class="comment1">(*
  All inertial observers see time travelling in the same direction. That
  is, if m thinks that k reached y after he reached x, then
  k should also think that he reached y after he reached x.
*)</span>
<span class="keyword1"><span class="command">class</span></span> AxTime <span class="main">=</span> WorldView <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> 
  AxTime<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> IOb <span class="free">m</span><span class="main">;</span> IOb <span class="free">k</span> <span class="main">⟧</span> 
              <span class="main">⟹</span><span class="main">(</span> <span class="free">x</span> <span class="main">≲</span> <span class="free">y</span> <span class="main">⟶</span> wvt <span class="free">k</span> <span class="free">m</span> <span class="free">x</span> <span class="main">≲</span> wvt <span class="free">k</span> <span class="free">m</span> <span class="free">y</span> <span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SpecRel">
<div class="head">
<h1>Theory SpecRel</h1>
</div>
<pre class="source"><span class="comment1">(*
   Author: Mike Stannett
   Date: 22 October 2012
   m.stannett@sheffield.ac.uk
   Updated 28 April 2016 to run under Isabelle2016.
*)</span>
<span class="keyword1"><span class="command">theory</span></span> SpecRel
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Axioms.html">Axioms</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">class</span></span> SpecRel <span class="main">=</span> WorldView <span class="main">+</span> AxPh <span class="main">+</span> AxEv <span class="main">+</span> AxSelf <span class="main">+</span> AxSym
<span class="comment1">(*
  The following proof  assumes that the quantity field is Euclidean. It
  may be possible to produce a proof without this constraint.
*)</span>

  <span class="main">+</span> AxEuclidean

<span class="comment1">(*
  We also assume for now that lines, planes and lightcones are
  preserved by the worldview transformation.
*)</span>

  <span class="main">+</span> AxLines <span class="main">+</span> AxPlanes <span class="main">+</span> AxCones

<span class="keyword2"><span class="keyword">begin</span></span>


<span class="comment1">(* *******************************************************************
*                                                                    *
*     THEOREM:                                                       *
*     No inertial observer can move faster than light.               *
*                                                                    *
** **************************************************************** *)</span>

  <span class="keyword1"><span class="command">lemma</span></span> lemZEG<span class="main">:</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">-</span> <span class="free">e</span> <span class="main">=</span> <span class="free">g</span> <span class="main">-</span> <span class="free">e</span> <span class="main">+</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">-</span> <span class="free">e</span> <span class="main">+</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">g</span> <span class="main">-</span> <span class="free">e</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add_diff_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">-</span> <span class="free">e</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">-</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free">e</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.diff_add_cancel 
                local.ring_normalization_rules<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
                local.semiring_normalization_rules<span class="main"><span class="main">(</span></span>24<span class="main"><span class="main">)</span></span> 
                local.semiring_normalization_rules<span class="main"><span class="main">(</span></span>25<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> calculation<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> noFTLObserver<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> iobm<span class="main">:</span>  <span class="quoted"><span class="quoted">"IOb <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     iobk<span class="main">:</span>  <span class="quoted"><span class="quoted">"IOb <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     mke<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">sees</span> <span class="free">k</span> <span class="keyword1">at</span> <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     mkf<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">sees</span> <span class="free">k</span> <span class="keyword1">at</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     enotf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≠</span> <span class="free">f</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"space2 <span class="free">e</span> <span class="free">f</span> <span class="main">≤</span> <span class="main">(</span>c <span class="free">m</span> <span class="main">*</span> c <span class="free">m</span><span class="main">)</span> <span class="main">*</span> time2 <span class="free">e</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  <span class="comment1">(* by reductio *)</span>

<span class="comment1">(* Step 1: Suppose k is going FTL from m's viewpoint. *)</span>
<span class="keyword1"><span class="command">{</span></span>
  <span class="keyword3"><span class="command">assume</span></span> converse<span class="main">:</span> <span class="quoted"><span class="quoted">"space2 <span class="free">e</span> <span class="free">f</span> <span class="main">&gt;</span> <span class="main">(</span>c <span class="free">m</span> <span class="main">*</span> c <span class="free">m</span><span class="main">)</span> <span class="main">*</span> time2 <span class="free">e</span> <span class="free">f</span>"</span></span> 


<span class="comment1">(* Step 2: Consider the m-lightcone at e *)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">eCone</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">eCone</span> <span class="main">=</span> mkCone <span class="free">e</span> <span class="main">(</span>c <span class="free">m</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">have</span></span> e_on_econe<span class="main">:</span> <span class="quoted"><span class="quoted">"onCone <span class="free">e</span> <span class="skolem">eCone</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eCone_def<span class="main">)</span>



<span class="comment1">(* Step 3: There is a tangent plane for eCone containing both e and f,
   defined using some point g on the tangent line  *)</span>

  <span class="keyword1"><span class="command">have</span></span> e_is_vertex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> vertex <span class="skolem">eCone</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eCone_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> cm_is_slope<span class="main">:</span> <span class="quoted"><span class="quoted">"c <span class="free">m</span> <span class="main">=</span> slope <span class="skolem">eCone</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eCone_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> outside<span class="main">:</span> <span class="quoted"><span class="quoted">"outsideCone <span class="free">f</span> <span class="skolem">eCone</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> e_is_vertex cm_is_slope converse outsideCone.simps<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"outsideCone <span class="free">f</span> <span class="skolem">eCone</span> 
    <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span>onCone <span class="bound">x</span> <span class="skolem">eCone</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> vertex <span class="skolem">eCone</span> <span class="main">∧</span> inPlane <span class="free">f</span> <span class="main">(</span>tangentPlane <span class="bound">x</span> <span class="skolem">eCone</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> AxParallelConesE<span class="main">)</span>

  <span class="keyword1"><span class="command">hence</span></span> tplane_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span>onCone <span class="bound">x</span> <span class="skolem">eCone</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> vertex <span class="skolem">eCone</span> <span class="main">∧</span> inPlane <span class="free">f</span> <span class="main">(</span>tangentPlane <span class="bound">x</span> <span class="skolem">eCone</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> outside<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>onCone <span class="skolem">g</span> <span class="skolem">eCone</span> <span class="main">∧</span> <span class="skolem">g</span> <span class="main">≠</span> vertex <span class="skolem">eCone</span> <span class="main">∧</span> inPlane <span class="free">f</span> <span class="main">(</span>tangentPlane <span class="skolem">g</span> <span class="skolem">eCone</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> g_on_eCone<span class="main">:</span> <span class="quoted"><span class="quoted">"onCone <span class="skolem">g</span> <span class="skolem">eCone</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> g_props<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> g_not_vertex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> vertex <span class="skolem">eCone</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> g_props<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">tplane</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tplane</span> <span class="main">=</span> tangentPlane <span class="skolem">g</span> <span class="skolem">eCone</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> e_in_tplane<span class="main">:</span> <span class="quoted"><span class="quoted">"inPlane <span class="free">e</span> <span class="skolem">tplane</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AxTangentVertex e_is_vertex tplane_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f_in_tplane<span class="main">:</span> <span class="quoted"><span class="quoted">"inPlane <span class="free">f</span> <span class="skolem">tplane</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> g_props tplane_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> g_in_tplane<span class="main">:</span> <span class="quoted"><span class="quoted">"inPlane <span class="skolem">g</span> <span class="skolem">tplane</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemPlaneContainsBasePoint tplane_def AxTangentBase<span class="main">)</span>

  <span class="comment1">(* We'll need to show that e-f-g aren't collinear *)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>onCone <span class="skolem">g</span> <span class="skolem">eCone</span><span class="main">)</span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">(</span>inPlane <span class="free">f</span> <span class="main">(</span>tangentPlane <span class="skolem">g</span> <span class="skolem">eCone</span><span class="main">)</span> <span class="main">∧</span> onCone <span class="free">f</span> <span class="skolem">eCone</span><span class="main">)</span> 
                                                           <span class="main">⟷</span> collinear <span class="main">(</span>vertex <span class="skolem">eCone</span><span class="main">)</span> <span class="skolem">g</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AxConeTangent<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> axconetangent<span class="main">:</span> <span class="quoted"><span class="quoted">"collinear <span class="free">e</span> <span class="skolem">g</span> <span class="free">f</span> <span class="main">⟶</span> onCone <span class="free">f</span> <span class="skolem">eCone</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> g_on_eCone e_is_vertex<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>onCone <span class="free">f</span> <span class="skolem">eCone</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> outside lemOutsideNotOnCone<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> g_not_collinear<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>collinear <span class="free">e</span> <span class="skolem">g</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> axconetangent<span class="main">)</span>



<span class="comment1">(* Step 4: k considers wvte and wvtf to be distinct points on the t-axis, and wvtg is off 
           k's t-axis. *)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">wvte</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">wvte</span> <span class="main">=</span> wvt <span class="free">k</span> <span class="free">m</span> <span class="free">e</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">wvtf</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">wvtf</span> <span class="main">=</span> wvt <span class="free">k</span> <span class="free">m</span> <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">wvtg</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">wvtg</span> <span class="main">=</span> wvt <span class="free">k</span> <span class="free">m</span> <span class="skolem">g</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"W <span class="free">k</span> <span class="free">k</span> <span class="skolem">wvte</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> wvte_def AxWVT mke iobm iobk<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> wvte_onAxis<span class="main">:</span> <span class="quoted"><span class="quoted">"onAxisT <span class="skolem">wvte</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AxSelf iobk<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"W <span class="free">k</span> <span class="free">k</span> <span class="skolem">wvtf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> wvtf_def AxWVT mkf iobm iobk<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> wvtf_onAxis<span class="main">:</span> <span class="quoted"><span class="quoted">"onAxisT <span class="skolem">wvtf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AxSelf iobk<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> wvte_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> wvt <span class="free">m</span> <span class="free">k</span> <span class="skolem">wvte</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AxWVTSym iobk iobm wvte_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> wvtf_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> wvt <span class="free">m</span> <span class="free">k</span> <span class="skolem">wvtf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AxWVTSym iobk iobm wvtf_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> wvtg_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> wvt <span class="free">m</span> <span class="free">k</span> <span class="skolem">wvtg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AxWVTSym iobk iobm wvtg_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> e_not_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≠</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> e_is_vertex g_not_vertex<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f_not_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> outside lemOutsideNotOnCone g_on_eCone<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> wvt_e_not_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">wvte</span> <span class="main">≠</span> <span class="skolem">wvtf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> wvte_inv wvtf_inv enotf<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> wvt_f_not_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">wvtf</span> <span class="main">≠</span> <span class="skolem">wvtg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> wvtf_inv wvtg_inv f_not_g<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> wvt_g_not_e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">wvtg</span> <span class="main">≠</span> <span class="skolem">wvte</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> wvtg_inv wvte_inv e_not_g<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> if_g_onAxis<span class="main">:</span>  <span class="quoted"><span class="quoted">"onAxisT <span class="skolem">wvtg</span> <span class="main">⟶</span> collinear <span class="skolem">wvte</span> <span class="skolem">wvtg</span> <span class="skolem">wvtf</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemAxisIsLine wvte_onAxis wvtf_onAxis wvt_e_not_f wvt_f_not_g wvt_g_not_e<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"collinear <span class="skolem">wvte</span> <span class="skolem">wvtg</span> <span class="skolem">wvtf</span> <span class="main">⟶</span> collinear <span class="free">e</span> <span class="skolem">g</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AxLines iobm iobk wvte_inv wvtf_inv wvtg_inv<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"onAxisT <span class="skolem">wvtg</span> <span class="main">⟶</span> collinear <span class="free">e</span> <span class="skolem">g</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> if_g_onAxis<span class="main">)</span>

  <span class="keyword1"><span class="command">hence</span></span> wvtg_offAxis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>onAxisT <span class="skolem">wvtg</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> g_not_collinear<span class="main">)</span>
 



<span class="comment1">(* Step 5: There is a point z with various contradictory properties. *)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span><span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span><span class="main">(</span> collinear <span class="skolem">wvte</span> <span class="skolem">wvtg</span> <span class="bound">p</span> <span class="main">∧</span> <span class="main">(</span>space2 <span class="bound">p</span> <span class="skolem">wvtf</span> <span class="main">=</span> <span class="main">(</span><span class="bound">s</span><span class="main">*</span><span class="bound">s</span><span class="main">)</span><span class="main">*</span>time2 <span class="bound">p</span> <span class="skolem">wvtf</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AxSlopedLineInVerticalPlane wvte_onAxis wvtf_onAxis wvtg_offAxis wvt_e_not_f<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> exists_wvtz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span><span class="main">(</span> collinear <span class="skolem">wvte</span> <span class="skolem">wvtg</span> <span class="bound">p</span> <span class="main">∧</span> <span class="main">(</span>space2 <span class="bound">p</span> <span class="skolem">wvtf</span> <span class="main">=</span> <span class="main">(</span>c <span class="free">k</span> <span class="main">*</span> c <span class="free">k</span><span class="main">)</span><span class="main">*</span>time2 <span class="bound">p</span> <span class="skolem">wvtf</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">wvtz</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    wvtz_props<span class="main">:</span> <span class="quoted"><span class="quoted">"collinear <span class="skolem">wvte</span> <span class="skolem">wvtg</span> <span class="skolem">wvtz</span> <span class="main">∧</span> <span class="main">(</span>space2 <span class="skolem">wvtz</span> <span class="skolem">wvtf</span> <span class="main">=</span> <span class="main">(</span>c <span class="free">k</span> <span class="main">*</span> c <span class="free">k</span><span class="main">)</span><span class="main">*</span>time2 <span class="skolem">wvtz</span> <span class="skolem">wvtf</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> wvtf_speed<span class="main">:</span> <span class="quoted"><span class="quoted">"space2 <span class="skolem">wvtz</span> <span class="skolem">wvtf</span> <span class="main">=</span> <span class="main">(</span>c <span class="free">k</span> <span class="main">*</span> c <span class="free">k</span><span class="main">)</span><span class="main">*</span>time2 <span class="skolem">wvtz</span> <span class="skolem">wvtf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> wvt <span class="free">m</span> <span class="free">k</span> <span class="skolem">wvtz</span>"</span></span>  
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">wvtzCone</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">wvtzCone</span> <span class="main">=</span> lightcone <span class="free">k</span> <span class="skolem">wvtz</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> wvtz_is_vertex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">wvtz</span> <span class="main">=</span> vertex <span class="skolem">wvtzCone</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wvtzCone_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ck_is_slope<span class="main">:</span> <span class="quoted"><span class="quoted">"c <span class="free">k</span> <span class="main">=</span> slope <span class="skolem">wvtzCone</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wvtzCone_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"space2 <span class="main">(</span>vertex <span class="skolem">wvtzCone</span><span class="main">)</span> <span class="skolem">wvtf</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>slope <span class="skolem">wvtzCone</span><span class="main">)</span> <span class="main">*</span><span class="main">(</span>slope <span class="skolem">wvtzCone</span><span class="main">)</span><span class="main">)</span><span class="main">*</span>time2 <span class="main">(</span>vertex <span class="skolem">wvtzCone</span><span class="main">)</span> <span class="skolem">wvtf</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> wvtf_speed wvtz_is_vertex ck_is_slope<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"onCone <span class="skolem">wvtf</span> <span class="skolem">wvtzCone</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> onCone.simps<span class="main">)</span>

  <span class="keyword1"><span class="command">hence</span></span> wvtf_on_wvtzCone<span class="main">:</span> <span class="quoted"><span class="quoted">"onCone <span class="main">(</span>wvt <span class="free">m</span> <span class="free">k</span> <span class="skolem">wvtf</span><span class="main">)</span> <span class="main">(</span>lightcone <span class="free">m</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> iobm iobk AxCones wvtzCone_def z_def<span class="main">)</span>



  <span class="comment1">(* f is on the lightcone at z *)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">zCone</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zCone</span> <span class="main">=</span> lightcone <span class="free">m</span> <span class="skolem">z</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_is_vertex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> vertex <span class="skolem">zCone</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zCone_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> cm_is_zSlope<span class="main">:</span> <span class="quoted"><span class="quoted">"c <span class="free">m</span> <span class="main">=</span> slope <span class="skolem">zCone</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zCone_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> f_on_zCone<span class="main">:</span> <span class="quoted"><span class="quoted">"onCone <span class="free">f</span> <span class="skolem">zCone</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> wvtf_inv wvtf_on_wvtzCone zCone_def<span class="main">)</span>



  <span class="comment1">(* whence z is on the lightcone at f *)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"space2 <span class="main">(</span>vertex <span class="skolem">zCone</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span>slope <span class="skolem">zCone</span> <span class="main">*</span> slope <span class="skolem">zCone</span><span class="main">)</span><span class="main">*</span>time2 <span class="main">(</span>vertex <span class="skolem">zCone</span><span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zCone_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"space2 <span class="skolem">z</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span>c <span class="free">m</span> <span class="main">*</span> c <span class="free">m</span><span class="main">)</span><span class="main">*</span>time2 <span class="skolem">z</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> z_is_vertex cm_is_zSlope<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> fz_speed<span class="main">:</span> <span class="quoted"><span class="quoted">"space2 <span class="free">f</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span>c <span class="free">m</span> <span class="main">*</span> c <span class="free">m</span><span class="main">)</span><span class="main">*</span>time2 <span class="free">f</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemSpace2Sym lemTime2Sym<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fCone</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fCone</span> <span class="main">=</span> lightcone <span class="free">m</span> <span class="free">f</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> f_is_fVertex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> vertex <span class="skolem">fCone</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fCone_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> cm_is_fSlope<span class="main">:</span> <span class="quoted"><span class="quoted">"c <span class="free">m</span> <span class="main">=</span> slope <span class="skolem">fCone</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fCone_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"space2 <span class="main">(</span>vertex <span class="skolem">fCone</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>slope <span class="skolem">fCone</span><span class="main">)</span> <span class="main">*</span><span class="main">(</span>slope <span class="skolem">fCone</span><span class="main">)</span><span class="main">)</span><span class="main">*</span>time2 <span class="main">(</span>vertex <span class="skolem">fCone</span><span class="main">)</span> <span class="skolem">z</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fz_speed f_is_fVertex cm_is_fSlope<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> z_on_fCone<span class="main">:</span> <span class="quoted"><span class="quoted">"onCone <span class="skolem">z</span> <span class="skolem">fCone</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> onCone.simps<span class="main">)</span>



  <span class="comment1">(* z is also on the lightcone at e, as well as in the tangent plane at g *)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"collinear <span class="skolem">wvte</span> <span class="skolem">wvtg</span> <span class="skolem">wvtz</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> wvtz_props<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> egz_collinear<span class="main">:</span> <span class="quoted"><span class="quoted">"collinear <span class="free">e</span> <span class="skolem">g</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> wvte_inv wvtg_inv z_def AxLines iobm iobk<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> z_geometry<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inPlane <span class="skolem">z</span> <span class="main">(</span>tangentPlane <span class="skolem">g</span> <span class="skolem">eCone</span><span class="main">)</span> <span class="main">∧</span> onCone <span class="skolem">z</span> <span class="skolem">eCone</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AxConeTangent e_is_vertex g_on_eCone<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> z_on_eCone<span class="main">:</span> <span class="quoted"><span class="quoted">"onCone <span class="skolem">z</span> <span class="skolem">eCone</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> z_geometry<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> z_in_tplane<span class="main">:</span> <span class="quoted"><span class="quoted">"inPlane <span class="skolem">z</span> <span class="skolem">tplane</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> z_geometry tplane_def<span class="main">)</span>

  <span class="keyword1"><span class="command">hence</span></span> z_not_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> z_on_eCone outside lemOutsideNotOnCone<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> z_not_fVertex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> vertex <span class="skolem">fCone</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fCone_def z_not_f<span class="main">)</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"space2 <span class="free">f</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span>c <span class="free">m</span> <span class="main">*</span> c <span class="free">m</span><span class="main">)</span><span class="main">*</span>time2 <span class="free">f</span> <span class="free">e</span> <span class="main">∧</span> space2 <span class="free">f</span> <span class="free">e</span> <span class="main">=</span> space2 <span class="free">e</span> <span class="free">f</span> <span class="main">∧</span> time2 <span class="free">f</span> <span class="free">e</span> <span class="main">=</span> time2 <span class="free">e</span> <span class="free">f</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemSpace2Sym lemTime2Sym fz_speed assm<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"space2 <span class="free">e</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span>c <span class="free">m</span> <span class="main">*</span> c <span class="free">m</span><span class="main">)</span><span class="main">*</span>time2 <span class="free">e</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_irrefl converse<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> z_not_e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


  <span class="comment1">(* but the lines e-z and f-z must be parallel *)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lineA</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lineA</span> <span class="main">=</span> lineJoining <span class="free">e</span> <span class="skolem">z</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lineB</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lineB</span> <span class="main">=</span> lineJoining <span class="free">f</span> <span class="skolem">z</span>"</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"direction <span class="skolem">lineA</span> <span class="main">=</span> vecZero"</span></span>
    <span class="keyword1"><span class="command">have</span></span> lemnullline<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>direction <span class="skolem">lineA</span> <span class="main">=</span> vecZero <span class="main">∧</span> inLine <span class="skolem">z</span> <span class="skolem">lineA</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">z</span> <span class="main">=</span> basepoint <span class="skolem">lineA</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemNullLine<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inLine <span class="skolem">z</span> <span class="skolem">lineA</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lineA_def lemLineContainsEndpoint<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> z_is_bp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> basepoint <span class="skolem">lineA</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemnullline assm<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"basepoint <span class="skolem">lineA</span> <span class="main">=</span> <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lineA_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> z_is_bp z_not_e<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> ez_not_null<span class="main">:</span> <span class="quoted"><span class="quoted">"direction <span class="skolem">lineA</span> <span class="main">≠</span> vecZero"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"direction <span class="skolem">lineB</span> <span class="main">=</span> vecZero"</span></span>
    <span class="keyword1"><span class="command">have</span></span> lemnullline<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>direction <span class="skolem">lineB</span> <span class="main">=</span> vecZero <span class="main">∧</span> inLine <span class="skolem">z</span> <span class="skolem">lineB</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">z</span> <span class="main">=</span> basepoint <span class="skolem">lineB</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemNullLine<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inLine <span class="skolem">z</span> <span class="skolem">lineB</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lineB_def lemLineContainsEndpoint<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> z_is_bp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> basepoint <span class="skolem">lineB</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemnullline assm<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"basepoint <span class="skolem">lineB</span> <span class="main">=</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lineB_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> z_is_bp z_not_f<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> fz_not_null<span class="main">:</span> <span class="quoted"><span class="quoted">"direction <span class="skolem">lineB</span> <span class="main">≠</span> vecZero"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"samePlane <span class="skolem">tplane</span> <span class="main">(</span>tangentPlane <span class="skolem">z</span> <span class="skolem">fCone</span><span class="main">)</span>
           <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>lineJoining <span class="free">e</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span>lineJoining <span class="free">f</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AxParallelCones tplane_def
              g_on_eCone g_not_vertex z_on_fCone z_not_fVertex z_in_tplane
              e_is_vertex f_is_fVertex<span class="main">)</span>

    <span class="keyword1"><span class="command">hence</span></span> eg_par_fz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lineJoining <span class="free">e</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span>lineJoining <span class="free">f</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> case1<span class="main">:</span> <span class="quoted"><span class="quoted">"direction <span class="main">(</span>lineJoining <span class="free">e</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> vecZero"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direction <span class="main">(</span>lineJoining <span class="free">e</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">from</span> <span class="free">e</span> <span class="keyword1">to</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">e</span> <span class="keyword1">to</span> <span class="skolem">g</span> <span class="main">=</span> vecZero"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> case1<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> e_not_g<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> eg_not_null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>direction <span class="main">(</span>lineJoining <span class="free">e</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> vecZero<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> direction <span class="main">(</span>lineJoining <span class="free">f</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">**</span>direction <span class="main">(</span>lineJoining <span class="free">e</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fz_not_null eg_not_null eg_par_fz parallel.simps lineB_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> f_to_z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">f</span> <span class="keyword1">to</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">**</span><span class="main">(</span><span class="keyword1">from</span> <span class="free">e</span> <span class="keyword1">to</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> a_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_props<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> eg_dir<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">e</span> <span class="keyword1">to</span> <span class="skolem">g</span> <span class="main">=</span> direction <span class="main">(</span>lineJoining <span class="free">e</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> gz_dir<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="skolem">g</span> <span class="keyword1">to</span> <span class="skolem">z</span> <span class="main">=</span> direction <span class="main">(</span>lineJoining <span class="skolem">g</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> egz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">↝</span> <span class="main">(</span><span class="keyword1">from</span> <span class="skolem">g</span> <span class="keyword1">to</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemLineEndpoint<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"collinear <span class="free">e</span> <span class="skolem">g</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">↝</span> <span class="main">(</span><span class="keyword1">from</span> <span class="skolem">g</span> <span class="keyword1">to</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> egz_collinear<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> e_to_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">e</span> <span class="keyword1">to</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">b</span><span class="main">)</span><span class="main">**</span><span class="main">(</span><span class="keyword1">from</span> <span class="skolem">g</span> <span class="keyword1">to</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemDirectionCollinear<span class="main">)</span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">e</span> <span class="keyword1">to</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">b</span><span class="main">)</span><span class="main">**</span><span class="main">(</span><span class="keyword1">from</span> <span class="skolem">g</span> <span class="keyword1">to</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> e_to_g<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">e</span> <span class="keyword1">to</span> <span class="skolem">g</span> <span class="main">=</span> vecZero"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assm<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direction <span class="main">(</span>lineJoining <span class="free">e</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> vecZero"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eg_not_null lineA_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> b_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">binv</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">binv</span> <span class="main">=</span> inverse <span class="main">(</span><span class="main">-</span><span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">factor</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">factor</span> <span class="main">=</span> <span class="main">1</span><span class="main">+</span><span class="skolem">binv</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> binv_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">binv</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> b_nonzero add.comm_neutral binv_def nonzero_imp_inverse_nonzero right_minus<span class="main">)</span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">e</span> <span class="keyword1">to</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">b</span><span class="main">)</span><span class="main">**</span><span class="main">(</span><span class="keyword1">from</span> <span class="skolem">g</span> <span class="keyword1">to</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> e_to_g<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> g_to_z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">from</span> <span class="skolem">g</span> <span class="keyword1">to</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">binv</span><span class="main">**</span><span class="main">(</span><span class="keyword1">from</span> <span class="free">e</span> <span class="keyword1">to</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> b_nonzero lemScaleInverse binv_def<span class="main">)</span>

    
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">e</span> <span class="keyword1">to</span> <span class="skolem">z</span> <span class="main">=</span> <span class="keyword1">from</span> <span class="free">e</span> <span class="keyword1">to</span> <span class="skolem">g</span> <span class="main">⊕</span> <span class="keyword1">from</span> <span class="skolem">g</span> <span class="keyword1">to</span> <span class="skolem">z</span>"</span></span>      
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lemZEG<span class="main">)</span>


    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">e</span> <span class="keyword1">to</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">from</span> <span class="free">e</span> <span class="keyword1">to</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⊕</span> <span class="skolem">binv</span><span class="main">**</span><span class="main">(</span><span class="keyword1">from</span> <span class="free">e</span> <span class="keyword1">to</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> g_to_z<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> e_to_z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">e</span> <span class="keyword1">to</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">factor</span><span class="main">**</span><span class="main">(</span><span class="keyword1">from</span> <span class="free">e</span> <span class="keyword1">to</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemAddOverScale lemScale1 factor_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ez_dir<span class="main">:</span> <span class="quoted"><span class="quoted">"direction <span class="main">(</span>lineJoining <span class="free">e</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">from</span> <span class="free">e</span> <span class="keyword1">to</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> eg_dir<span class="main">:</span> <span class="quoted"><span class="quoted">"direction <span class="main">(</span>lineJoining <span class="free">e</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">from</span> <span class="free">e</span> <span class="keyword1">to</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">factor</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">e</span> <span class="keyword1">to</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">factor</span><span class="main">**</span><span class="main">(</span><span class="keyword1">from</span> <span class="free">e</span> <span class="keyword1">to</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> e_to_z<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">e</span> <span class="keyword1">to</span> <span class="skolem">z</span> <span class="main">=</span> vecZero"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assm<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"direction <span class="main">(</span>lineJoining <span class="free">e</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> vecZero"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ez_not_null lineA_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> factor_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">factor</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"direction <span class="main">(</span>lineJoining <span class="free">e</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">factor</span><span class="main">**</span><span class="main">(</span>direction <span class="main">(</span>lineJoining <span class="free">e</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> e_to_z ez_dir eg_dir<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lineJoining <span class="free">e</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span>lineJoining <span class="free">e</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> parallel.simps factor_nonzero<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lineJoining <span class="free">e</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span>lineJoining <span class="free">e</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemParallelSym<span class="main">)</span>

    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lineJoining <span class="free">e</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span>lineJoining <span class="free">f</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemParallelTrans eg_par_fz eg_not_null<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> A_par_B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lineA</span> <span class="main">∥</span> <span class="skolem">lineB</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lineA_def lineB_def<span class="main">)</span>


  <span class="comment1">(* which is impossible because this means they are distinct parallel lines that meet *)</span>

  <span class="keyword1"><span class="command">have</span></span> e_in_lineA<span class="main">:</span> <span class="quoted"><span class="quoted">"inLine <span class="free">e</span> <span class="skolem">lineA</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lineA_def lemLineContainsBasepoint<span class="main">)</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">have</span></span> basic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="bound">a</span><span class="main">)</span><span class="main">*</span><span class="bound">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="bound">a</span><span class="main">)</span><span class="main">*</span><span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">a</span><span class="main">*</span><span class="bound">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="bound">b</span><span class="main">*</span><span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> equation_minus_iff minus_mult_commute minus_mult_right 
                semiring_normalization_rules<span class="main"><span class="main">(</span></span>17<span class="main"><span class="main">)</span></span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>19<span class="main"><span class="main">)</span></span><span class="main">)</span>

    <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"inLine <span class="free">e</span> <span class="skolem">lineB</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> coll<span class="main">:</span> <span class="quoted"><span class="quoted">"collinear <span class="free">e</span> <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="main">↝</span> direction <span class="skolem">lineB</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lineB_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="keyword2"><span class="keyword">where</span></span> props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">from</span> <span class="free">e</span> <span class="keyword1">to</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">β</span><span class="main">)</span><span class="main">**</span><span class="main">(</span>direction <span class="skolem">lineB</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemDirectionCollinear<span class="main">)</span>
    
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"tval <span class="free">f</span> <span class="main">-</span> tval <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">β</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>tval <span class="skolem">z</span> <span class="main">-</span> tval <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> xval <span class="free">f</span> <span class="main">-</span> xval <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">β</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>xval <span class="skolem">z</span> <span class="main">-</span> xval <span class="free">f</span><span class="main">)</span>
        <span class="main">∧</span> yval <span class="free">f</span> <span class="main">-</span> yval <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">β</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>yval <span class="skolem">z</span> <span class="main">-</span> yval <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> zval <span class="free">f</span> <span class="main">-</span> zval <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">β</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>zval <span class="skolem">z</span> <span class="main">-</span> zval <span class="free">f</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lineB_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> speeds<span class="main">:</span> <span class="quoted"><span class="quoted">"time2 <span class="free">f</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">β</span><span class="main">*</span><span class="skolem">β</span><span class="main">)</span><span class="main">*</span>time2 <span class="skolem">z</span> <span class="free">f</span> <span class="main">∧</span> space2 <span class="free">f</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">β</span><span class="main">*</span><span class="skolem">β</span><span class="main">)</span><span class="main">*</span>space2 <span class="skolem">z</span> <span class="free">f</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> basic<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>19<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>19<span class="main"><span class="main">)</span></span> 
                semiring_normalization_rules<span class="main"><span class="main">(</span></span>34<span class="main"><span class="main">)</span></span><span class="main">)</span>
      
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"space2 <span class="free">f</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span>c <span class="free">m</span> <span class="main">*</span> c <span class="free">m</span><span class="main">)</span><span class="main">*</span>time2 <span class="free">f</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fz_speed<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"space2 <span class="skolem">z</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span>c <span class="free">m</span> <span class="main">*</span> c <span class="free">m</span><span class="main">)</span><span class="main">*</span>time2 <span class="skolem">z</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemSpace2Sym lemTime2Sym<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"space2 <span class="free">f</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">β</span><span class="main">*</span><span class="skolem">β</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>c <span class="free">m</span> <span class="main">*</span> c <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">*</span>time2 <span class="skolem">z</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> speeds mult.assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"space2 <span class="free">f</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span>c <span class="free">m</span> <span class="main">*</span> c <span class="free">m</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">β</span><span class="main">*</span><span class="skolem">β</span><span class="main">)</span><span class="main">*</span>time2 <span class="skolem">z</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc mult.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"space2 <span class="free">f</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span>c <span class="free">m</span> <span class="main">*</span> c <span class="free">m</span><span class="main">)</span><span class="main">*</span>time2 <span class="free">f</span> <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc speeds<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"space2 <span class="free">e</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span>c <span class="free">m</span> <span class="main">*</span> c <span class="free">m</span><span class="main">)</span><span class="main">*</span>time2 <span class="free">e</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemSpace2Sym lemTime2Sym<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_irrefl converse<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> e_not_in_lineB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>inLine <span class="free">e</span> <span class="skolem">lineB</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inLine <span class="skolem">z</span> <span class="skolem">lineA</span> <span class="main">∧</span> inLine <span class="skolem">z</span> <span class="skolem">lineB</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lemLineContainsEndpoint lineA_def lineB_def<span class="main">)</span>  
  <span class="keyword1"><span class="command">hence</span></span> A_meets_B<span class="main">:</span> <span class="quoted"><span class="quoted">"meets <span class="skolem">lineA</span> <span class="skolem">lineB</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A_par_B ez_not_null fz_not_null e_in_lineA e_not_in_lineB lemParallelNotMeet<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>space2 <span class="free">e</span> <span class="free">f</span> <span class="main">&gt;</span> <span class="main">(</span>c <span class="free">m</span> <span class="main">*</span> c <span class="free">m</span><span class="main">)</span> <span class="main">*</span> time2 <span class="free">e</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>