<div id="C_Algebras">
<div class="head">
<h1>Theory C_Algebras</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: Binary Multirelations
Author: Hitoshi Furusawa, Georg Struth
Maintainer: &lt;g.struth at sheffield.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹C-Algebras›</span></span>

<span class="keyword1"><span class="command">theory</span></span> C_Algebras
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../Kleene_Algebra/Dioid.html">Kleene_Algebra.Dioid</a> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">no_notation</span></span>
  times <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹C-Monoids›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We start with the c-monoid axioms. These can be found in Section~4 of~\cite{FurusawaS15a}.›</span></span>

<span class="keyword1"><span class="command">class</span></span> proto_monoid <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">s_id</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span></span></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free"><span class="free"><span class="free">s_prod</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">⋅</span></span></span>"</span> 80<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> s_prod_idl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">1<span class="hidden">⇩</span><sub>σ</sub></span></span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  s_prod_idr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="keyword1"><span class="free">1<span class="hidden">⇩</span><sub>σ</sub></span></span>  <span class="main">=</span> <span class="free">x</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> proto_bi_monoid <span class="main">=</span> proto_monoid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">c_id</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span></span></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free"><span class="free"><span class="free">c_prod</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">∥</span></span></span>"</span> 80<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> c_prod_idl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">1<span class="hidden">⇩</span><sub>π</sub></span></span> <span class="main"><span class="free">∥</span></span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> c_prod_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main"><span class="free">∥</span></span> <span class="free">y</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="free">y</span> <span class="main"><span class="free">∥</span></span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> c_prod_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">∥</span></span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main"><span class="free">∥</span></span> <span class="free">x</span>"</span></span> 

<span class="keyword1"><span class="command">class</span></span> c_monoid <span class="main">=</span> proto_bi_monoid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> c2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="free">y</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> c3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> c4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> c5 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we define domain explicitly as at the beginning of Section 4 in~\cite{FurusawaS15a} 
and start proving the algebraic facts from Section 4. Those involving concrete multirelations, such as Proposition 4.1,
are considered in the theory file for multirelations.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> c_monoid<span class="main">)</span> <span class="entity">d</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> c_prod_idr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c_prod_comm<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We prove the retraction properties of Lemma 4.2.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> c_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c_prod_idr local.c1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> d_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span>d <span class="free">x</span><span class="main">)</span> <span class="main">=</span> d <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.d_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p_id_idem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c4<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 4.3.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> c2_d<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.d_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cd_2_var<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c2_d local.c4<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dc_prop1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c2_d<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dc_prop2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">=</span> d <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c4 local.d_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ds_prop <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">=</span> d <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c_prod_assoc local.d_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.d_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Part (5) of this Lemma has already been verified above. The next two statements 
verify the two algebraic properties mentioned in the proof of Proposition 4.4.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dc_iso <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span>d <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">=</span> d <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> cd_iso <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Proposition 4.5.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_conc6<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> d <span class="free">x</span> <span class="main">∥</span> d <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c3<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ds_prop local.c_prod_assoc local.c_prod_comm local.d_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_conc_s_prod_ax<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">∥</span> d <span class="free">y</span> <span class="main">=</span> d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">∥</span> d <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">∥</span> d <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> d <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> d_conc6 local.c3 local.c_prod_assoc local.d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> d <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> local.d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_rest_ax <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c2_d<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> d_loc_ax <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span><span class="main">)</span> <span class="main">=</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c4<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.d_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_exp_ax <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span>d <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span>d <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> d <span class="main">(</span>d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_conc6<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> d <span class="main">(</span>d <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_conc6 d_conc_s_prod_ax<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> d <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_conc6 d_conc_s_prod_ax<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_comm_ax<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span> <span class="main">=</span> d <span class="free">y</span> <span class="main">⋅</span> d <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>d <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span>d <span class="free">y</span><span class="main">)</span> <span class="main">=</span> d <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_conc6 d_conc_s_prod_ax<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> d <span class="main">(</span><span class="free">y</span> <span class="main">∥</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.c_prod_comm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_conc6 d_conc_s_prod_ax<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_s_id_prop <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we verify the conditions of Proposition 4.6.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_s_prod_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span>d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span><span class="main">)</span> <span class="main">=</span> d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> d_p_prod_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span>d <span class="free">x</span> <span class="main">∥</span> d <span class="free">y</span><span class="main">)</span> <span class="main">=</span> d <span class="free">x</span> <span class="main">∥</span> d <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> c2_d d_conc6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> d_idem2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">x</span> <span class="main">=</span> d <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d_exp_ax d_rest_ax<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> d_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> d <span class="free">z</span> <span class="main">=</span> d <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span>d <span class="free">y</span> <span class="main">⋅</span> d <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> d <span class="bound">x</span> <span class="main">⋅</span> d <span class="bound">y</span> <span class="main">=</span> d <span class="main">(</span><span class="bound">x</span> <span class="main">∥</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_conc6 d_conc_s_prod_ax<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c_prod_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iso_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>d <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">=</span> d <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.d_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 4.7.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> x_c_par_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">=</span> d <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c2_d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> d_rest_ax <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_idem_par <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">∥</span> d <span class="free">x</span> <span class="main">=</span> d <span class="free">x</span> "</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_conc_s_prod_ax<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> d_inter_r<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">∥</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>d <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span>d <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>d <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">∥</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="free">y</span> <span class="main">∥</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c2_d local.c_prod_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="free">y</span> <span class="main">∥</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.c_prod_assoc local.c_prod_comm <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c2_d local.c_prod_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now we provide the counterexamples of Lemma 4.8.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> d <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> d <span class="free">z</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> d <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> d <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> d <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹C-Trioids›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We can now define the class of c-trioids and prove properties in this class. This covers 
the algebraic material of Section 5 in~\cite{FurusawaS15a}.›</span></span>

<span class="keyword1"><span class="command">class</span></span> proto_dioid <span class="main">=</span> join_semilattice_zero <span class="main">+</span> proto_monoid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  s_prod_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  s_prod_subdistl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  s_prod_annil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> s_prod_isol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> join.sup.boundedE order_prop s_prod_subdistl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> s_prod_isor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.order_prop local.s_prod_distr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> proto_trioid <span class="main">=</span> proto_dioid <span class="main">+</span> proto_bi_monoid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  p_prod_distl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∥</span> <span class="free">y</span> <span class="main">+</span> <span class="free">x</span> <span class="main">∥</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  p_rpd_annir <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∥</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> proto_trioid <span class="main">⊆</span> ab_semigroup_mult <span class="quoted">c_prod</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∥</span> <span class="skolem">y</span> <span class="main">∥</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">∥</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">∥</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> c_prod_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∥</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">∥</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> c_prod_comm<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> proto_trioid <span class="main">⊆</span> dioid_one_zero <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∥)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∥</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">∥</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">∥</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c_prod_comm local.p_prod_distl<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.c_prod_idl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.mult_commute<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add.left_neutral<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∥</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.mult_commute<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∥</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> p_rpd_annir<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add_idem<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∥</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">∥</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">∥</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> p_prod_distl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">class</span></span> c_trioid <span class="main">=</span> proto_trioid <span class="main">+</span> c_monoid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  c6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">≤</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We show that every c-trioid is a c-monoid.›</span></span>

<span class="keyword1"><span class="command">subclass</span></span> c_monoid <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">subclass</span></span> proto_trioid <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zero_p_id_prop <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c4<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following facts prove and refute properties related to sequential and parallel subidentities.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_subid<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.c6 local.c_idem local.d_def local.dc local.mult_isor<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⟹</span> d <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> p_id_term<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.c6<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Proposition 5.1. is covered by the theory file on multirelations. 
We verify the remaining conditions in Proposition 5.2.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dlp_ax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> d <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> d_add_ax<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> d <span class="free">x</span> <span class="main">+</span> d <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.distrib_right local.s_prod_distr<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.d_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_sub_id_ax<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.c6 local.mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_zero_ax <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.d_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We verify the algebraic conditions in Proposition 5.3.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_absorb1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">+</span> <span class="main">(</span>d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span><span class="main">)</span> <span class="main">=</span> d <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">+</span> <span class="main">(</span>d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> d <span class="free">x</span> <span class="main">+</span> <span class="main">(</span>d <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d_sub_id_ax c2_d d_def join.sup.bounded_iff join.sup.semilattice_axioms join.sup_ge1 s_prod_isol semilattice.idem<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">+</span> <span class="main">(</span>d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> d <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">≤</span> d <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span>d <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span>d <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> join.sup_ge1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_absorb2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span>d <span class="free">x</span> <span class="main">+</span> d <span class="free">y</span><span class="main">)</span> <span class="main">=</span> d <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> d <span class="free">x</span> <span class="main">=</span> d <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.c1 local.dc_prop1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d_absorb1 local.c2_d local.p_prod_distl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_dist1<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span>d <span class="free">y</span> <span class="main">+</span> d <span class="free">z</span><span class="main">)</span> <span class="main">=</span> d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span> <span class="main">+</span> d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c2_d local.p_prod_distl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> d_dist2<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">+</span> <span class="main">(</span>d <span class="free">y</span> <span class="main">⋅</span> d <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>d <span class="free">x</span> <span class="main">+</span> d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span>d <span class="free">x</span> <span class="main">+</span> d <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>d <span class="free">x</span> <span class="main">+</span> d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span>d <span class="free">x</span> <span class="main">+</span> d <span class="free">z</span><span class="main">)</span> <span class="main">=</span> d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">x</span> <span class="main">+</span> d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">z</span> <span class="main">+</span> d <span class="free">y</span> <span class="main">⋅</span> d <span class="free">x</span> <span class="main">+</span> d <span class="free">y</span> <span class="main">⋅</span> d <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_assoc d_dist1 local.s_prod_distr <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> d <span class="free">x</span> <span class="main">+</span> d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">z</span> <span class="main">+</span> d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span> <span class="main">+</span> d <span class="free">y</span> <span class="main">⋅</span> d <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.d_comm_ax <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_add_prod_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span>d <span class="free">x</span> <span class="main">+</span> d <span class="free">y</span><span class="main">)</span> <span class="main">=</span> d <span class="free">x</span> <span class="main">+</span> d <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_add_ax<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following properties are not covered in the article.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> x_zero_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> <span class="free">y</span> <span class="main">=</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c2_d<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cda_add_ax<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">+</span> d <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_add_ax local.s_prod_distr<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> d_x_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_zero_prop<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 5.4 is verified below because its proofs are simplified by using facts from the next subsection.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Results for Concurrent Dynamic Algebra›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following proofs and refutation are related to Section 6 in~\cite{FurusawaS15a}. 
We do not consider those involving Kleene algebras in this section. We also do not introduce specific 
notation for diamond operators.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First we prove Lemma 6.1. Part (1) and (3) have already been verified above. Part (2) and (4) require
additional assumptions which are present in the context of concurrent dynamic algebra~\cite{FurusawaS15b}. We
also present the counterexamples from Lemma 6.3.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> d <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> d <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"d<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> d <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span> 
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span>  cda_ax1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> d <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> d <span class="free">z</span><span class="main">)</span> <span class="main">⟹</span> d<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> d <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.d_loc_ax<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> d_inter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> d <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> d <span class="free">z</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> d <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> d <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cda_ax2<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> d <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> d <span class="free">z</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> d <span class="free">z</span><span class="main">)</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> d <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms local.d_conc6 local.d_conc_s_prod_ax local.d_loc_ax<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we present some results that do not feature in the article.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">nitpick</span></span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_x_zero_prop <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∥</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">nitpick</span></span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">∥</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">nitpick</span></span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∥</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">nitpick</span></span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 5.4›</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> d_lb1<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span> <span class="main">≤</span> d <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_def add_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> d_lb2<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span> <span class="main">≤</span> d <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> d_lb1 local.d_comm_ax <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> d_glb<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">z</span> <span class="main">≤</span> d <span class="free">x</span> <span class="main">∧</span> d <span class="free">z</span> <span class="main">≤</span> d <span class="free">y</span> <span class="main">⟹</span> d <span class="free">z</span> <span class="main">≤</span> d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_dist2 local.less_eq_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> d_glb_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">z</span> <span class="main">≤</span> d <span class="free">x</span> <span class="main">∧</span> d <span class="free">z</span> <span class="main">≤</span> d <span class="free">y</span> <span class="main">⟷</span> d <span class="free">z</span> <span class="main">≤</span> d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> d_glb d_lb1 d_lb2 local.order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> x_zero_le_c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">≤</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_id_term<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p_subid_lb1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.mult_isol x_zero_le_c <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> p_subid_lb2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.mult_commute p_subid_lb1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> p_subid_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.c1 zero_p_id_prop<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p_subid_glb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.mult_isol_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> p_subid_glb_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.order_trans p_subid_glb p_subid_lb1 p_subid_lb2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> x_c_glb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∧</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.mult_isol_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> x_c_lb1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.c6 local.mult_isol_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
 
<span class="keyword1"><span class="command">lemma</span></span> x_c_lb2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.mult_commute x_c_lb1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> x_c_glb_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∧</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⟷</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> local.order.trans x_c_glb x_c_lb1 x_c_lb2<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹C-Lattices›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We can now define c-lattices and prove the results from Section 7 in~\cite{FurusawaS15a}.›</span></span>

<span class="keyword1"><span class="command">class</span></span> pbl_monoid <span class="main">=</span> proto_trioid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">U</span></span></span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">meet</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">⊓</span></span></span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> U_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> meet_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main"><span class="free">⊓</span></span> <span class="free">y</span><span class="main">)</span> <span class="main"><span class="free">⊓</span></span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main"><span class="free">⊓</span></span> <span class="main">(</span><span class="free">y</span> <span class="main"><span class="free">⊓</span></span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> meet_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊓</span></span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main"><span class="free">⊓</span></span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> meet_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊓</span></span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> absorp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⊓</span></span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> absorp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main"><span class="free">⊓</span></span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> lattice <span class="quoted"><span class="quoted">"<span class="main">(⊓)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.absorp2 local.less_eq_def add_commute<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a local.meet_comm <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⊓</span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> b local.absorp1 local.less_eq_def local.meet_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> meet_glb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> meet_prop<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> pbdl_monoid <span class="main">=</span> pbl_monoid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lat_dist1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lat_dist2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.lat_dist1 add_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lat_dist3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.absorp1 local.meet_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> lat_dist2 local.absorp2 add_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lat_dist4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lat_dist3 local.meet_comm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 
<span class="keyword1"><span class="command">lemma</span></span> d_equiv_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">+</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">z</span> <span class="main">+</span> <span class="free">y</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">z</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.add_zerol<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The symbol $\overline{1}_\pi$ from~\cite{FurusawaS15a} is written nc in this theory file.›</span></span>

<span class="keyword1"><span class="command">class</span></span> c_lattice <span class="main">=</span>  pbdl_monoid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">nc</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cl1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">nc</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> U"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  cl2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">nc</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> cl3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">∥</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> cl4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∥</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> cl5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> cl6 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> cl7 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> cl8 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> cl9 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>         
  <span class="keyword2"><span class="keyword">and</span></span> cl10<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">nc</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">nc</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">nc</span>"</span></span>   
  <span class="keyword2"><span class="keyword">and</span></span> cl11 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">nc</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="free">nc</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">nc</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">nc</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We show that every c-lattice is a c-trioid (Proposition 7.1) Proposition 7.2 is again 
covered by the theory for multirelations.›</span></span>

<span class="keyword1"><span class="command">subclass</span></span> c_trioid
  <span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∥</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.cl4<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.absorp1 local.cl2 local.cl5<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> local.cl7<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">≤</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.absorp1 local.cl2 local.cl5 local.inf_le1 local.s_prod_idl<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> x local.eq_iff local.cl3 local.mult_1_right local.mult_commute local.mult_isol local.s_prod_idr<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First we verify the complementation conditions after the definition of c-lattices.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> c_nc_comp1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">+</span> nc <span class="main">=</span> U"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.cl1 local.s_prod_idl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> c_nc_comp2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⊓</span> nc <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.add_zero_l local.cl2 local.s_prod_annil<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>  c_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c_nc_comp2 local.add_zeror local.cl2 local.lat_dist3 local.meet_comm<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we verify the conditions in Proposition 7.2.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_s_subid<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.cl9 local.d_def local.d_subid local.inf.absorb_iff1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> term_p_subid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c_0 local.cl6 local.inf.absorb_iff1 local.p_id_term<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> term_p_subid_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> c_0 local.inf.absorb_iff1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> vec_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">⋅</span> U <span class="main">=</span> <span class="free">x</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c2_d<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nc_iff1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> nc <span class="main">⟷</span> <span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> 
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> nc"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊓</span> nc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.inf.absorb_iff1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊓</span> nc <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm c_0 c_nc_comp2 local.cl2 local.less_eq_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c_nc_comp1 local.U_def local.add_comm local.lat_dist3 local.inf.absorb_iff1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊓</span> nc"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> nc"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.inf.absorb_iff1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nc_iff2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> nc <span class="main">⟷</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> c_0 nc_iff1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The results of Lemma 7.3 are again at the multirelational level. 
Hence we continue with Lemma 7.4.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> assoc_p_subid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c_0 local.c6 local.cl5 local.inf.absorb_iff1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> zero_assoc3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.cl5 local.s_prod_annil<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> x_zero_interr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.cl4<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> p_subid_interr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c4 local.cl4<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> d_interr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> d <span class="free">z</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> d <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> d <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.cl4<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subidem_par<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∥</span> <span class="free">x</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.cl3 local.cl7<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> meet_le_par<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∥</span> <span class="free">y</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.meet_idem <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> local.inf_le1 local.inf_le2 local.mult_isol_var local.order_trans subidem_par <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Next we verify Lemma 7.5 and prove some related properties.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> x_split <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> U"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.U_def local.inf.absorb_iff1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span>nc <span class="main">+</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.lat_dist3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> x_split_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.c_0 x_split<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> s_subid_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> nc <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.lat_dist3 local.meet_comm<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c_0 local.meet_assoc local.meet_comm local.s_prod_idl<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.absorp1 local.add_zeror local.lat_dist1 local.meet_comm<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sub_id_le_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">≤</span> nc"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.inf.absorb_iff2 local.inf_left_commute local.meet_comm s_subid_closed<span class="main">)</span>

 <span class="keyword1"><span class="command">lemma</span></span> s_x_c <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c_0 local.s_prod_idl <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.c6 local.inf_le1 local.inf_le2 local.meet_prop local.order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> local.less_eq_def local.no_trivial_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> s_x_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.cl6 s_x_c<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> c_nc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⊓</span> nc <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⊓</span> nc <span class="main">≤</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> local.c6 local.dual_order.trans local.inf_le1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.inf_le2 nc_iff2 term_p_subid_var<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zero_nc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">⊓</span> nc <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c_nc local.cl6<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nc_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> local.inf_le2 nc_iff2<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 7.6.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> c_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"U <span class="main">⋅</span> <span class="main">0</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c_nc_comp1 c_0 local.absorp1 local.meet_comm<span class="main">)</span>  

<span class="keyword1"><span class="command">lemma</span></span> c_x_prop <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> c_def local.cl6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> U_idem_s_prod <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"U <span class="main">⋅</span> U <span class="main">=</span> U"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.U_def local.eq_iff local.s_prod_idl local.s_prod_isor<span class="main">)</span>
 
<span class="keyword1"><span class="command">lemma</span></span> U_idem_p_prod <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"U <span class="main">∥</span> U <span class="main">=</span> U"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.U_def local.eq_iff subidem_par <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">lemma</span></span> U_c <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"U <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> U_idem_s_prod local.c_def zero_assoc3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> s_le_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">≤</span> nc"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.meet_idem sub_id_le_nc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nc_c <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nc <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nc <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> nc <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⋅</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_assoc3<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> nc <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_0<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nc <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">≤</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.c6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">≤</span> nc <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.s_prod_isor s_le_nc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nc_nc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nc <span class="main">⋅</span> nc <span class="main">=</span> nc"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nc <span class="main">⋅</span> nc <span class="main">=</span> <span class="main">(</span>nc <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> nc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.cl11 local.meet_idem<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> U_nc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"U <span class="main">⋅</span> nc <span class="main">=</span> U"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"U <span class="main">⋅</span> nc <span class="main">=</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">+</span> nc<span class="main">)</span> <span class="main">⋅</span> nc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⋅</span> nc <span class="main">+</span> nc <span class="main">⋅</span> nc"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.s_prod_distr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">+</span> nc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nc_U <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nc <span class="main">⋅</span> U <span class="main">=</span> U"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nc <span class="main">⋅</span> U <span class="main">=</span> nc <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">+</span> nc <span class="main">⋅</span> nc"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.cl1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nc_nc_par <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nc <span class="main">∥</span> nc <span class="main">=</span> nc"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nc <span class="main">∥</span> nc <span class="main">=</span> <span class="main">(</span>nc <span class="main">∥</span> nc <span class="main">⊓</span> nc<span class="main">)</span>  <span class="main">+</span> <span class="main">(</span>nc <span class="main">∥</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> nc  <span class="main">+</span> <span class="main">(</span>nc <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span>nc <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.meet_comm local.inf.absorb_iff1 subidem_par x_zero_interr<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> nc <span class="main">+</span> <span class="main">0</span> <span class="main">∥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.absorp1 local.meet_comm nc_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute local.add_zerol local.annil<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
                                       
<span class="keyword1"><span class="command">lemma</span></span> U_nc_par <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"U <span class="main">∥</span> nc <span class="main">=</span> nc"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"U <span class="main">∥</span> nc <span class="main">=</span> nc <span class="main">∥</span> nc <span class="main">+</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> nc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c_nc_comp1 local.add_comm local.distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> nc <span class="main">+</span> nc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We prove Lemma 7.8 and related properties.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> x_y_split <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c_0 local.cl6 local.s_prod_distr x_split<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> x_y_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x_y_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.lat_dist3 add_commute<span class="main">)</span>  
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.add_zeror s_x_zero<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> s_nc_U<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⋅</span> nc <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⋅</span> U"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⋅</span> U <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> nc <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.lat_dist3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.add_zeror s_x_c<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sid_le_nc_var<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">∥</span> nc"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> nc<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> local.inf.absorb1 local.inf.commute s_le_nc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">∥</span> nc <span class="main">+</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> nc <span class="main">+</span> <span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.inf.commute local.inf.left_commute local.lat_dist4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> local.inf.commute local.join.sup.absorb_iff1 meet_le_par<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> s_nc_par_U<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">∥</span> nc <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">∥</span> U"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">∥</span> U <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> nc <span class="main">+</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c_nc_comp1 local.add_comm local.distrib_left local.mult_oner<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">∥</span> nc<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.lat_dist3 local.meet_comm<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">∥</span> nc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.add_comm local.less_eq_def local.meet_comm sid_le_nc_var<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> x_c_nc_split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> nc <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> nc"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.cl11 local.mult_commute local.p_prod_distl x_y_split<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> x_c_U_split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> U <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> U"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> U <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> U <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> U <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> U"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> U_c U_idem_s_prod U_nc local.add_assoc' local.cl1 local.distrib_left local.mult_oner x_y_split<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> nc <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute c_nc_comp1 local.cl1 local.combine_common_factor local.mult_1_right local.mult_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> nc <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.add_ac<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> local.add_commute x_c_nc_split x_y_split<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c_nc_comp1 calculation local.add_comm local.distrib_left local.mult_oner<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Domain in C-Lattices›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now prove variants of the domain axioms and verify the properties of Section 8 in~\cite{FurusawaS15a}.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cl9_d <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.d_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cl10_d<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.cl10 local.d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> cl11_d <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.c2_d <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> cl10_d_var1<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⋅</span> nc"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cl10_d x_y_prop<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cl10_d_var2<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> U"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cl10_d s_nc_U<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cl10_d_var3<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⋅</span> U"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cl10_d_var1 s_nc_U<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We verify the remaining properties of Lemma 8.1.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_U <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d U <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.d_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> d_nc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d nc <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 
<span class="keyword1"><span class="command">lemma</span></span> alt_d_def_nc_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> nc"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cl10_d_var1 x_y_prop<span class="main">)</span>    

<span class="keyword1"><span class="command">lemma</span></span> alt_d_def_nc_U<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> alt_d_def_nc_nc local.c2_d s_nc_U<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We verify the identity before Lemma 8.2 of~\cite{FurusawaS15a} together with variants.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_def_split <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">+</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> d <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.d_add_ax x_split_var<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> d_def_split_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">=</span> d <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d_def_split local.d_x_zero<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ax7 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⋅</span> U<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">=</span> d <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cl10_d_var3 d_def_split_var<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 8.2.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dom12_d<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> nc"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> nc <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> nc"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x_y_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> nc<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> nc<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.lat_dist3 local.mult_commute local.p_prod_distl add_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">+</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute c_0 cl10_d_var1 local.add_zerol local.annil local.c2_d local.d_def local.mult_commute local.mult_onel local.zero_p_id_prop x_split<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d_def_split<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dom12_d_U<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dom12_d s_nc_par_U<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dom_def_var<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> U <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_0 local.d_def zero_assoc3<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Lemma 8.3.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ax5_d <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> U <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> U"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> U <span class="main">=</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc <span class="main">+</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_commute local.cl1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ax5_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">⋅</span> U <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> U"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.x_zero_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">lemma</span></span> x_c_U_split2<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">⋅</span> nc <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> nc"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c2_d x_c_nc_split<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> x_c_U_split3<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">⋅</span> U <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> U <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> U"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d_def_split local.s_prod_distr ax5_0 ax5_d<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> x_c_U_split_d<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">⋅</span> U <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> U <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> U"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.c2_d x_c_U_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 

<span class="keyword1"><span class="command">lemma</span></span> x_U_prop2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> nc <span class="main">=</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.c2_d local.cl11 x_y_split<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> x_U_prop3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> U <span class="main">=</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> U <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ax5_d x_y_split<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> d_x_nc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">=</span> d <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.c4 local.d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> d_x_U <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> U<span class="main">)</span> <span class="main">=</span> d <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c4 local.d_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next properties of domain are important, but do not feature in~\cite{FurusawaS15a}. 
Proofs can be found in~\cite{FurusawaS15b}.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_llp1<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">≤</span> d <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> d <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.d_rest_ax local.s_prod_isor<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> d_llp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> d <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⟹</span> d <span class="free">x</span> <span class="main">≤</span> d <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> d <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> d <span class="main">(</span><span class="bound">x</span> <span class="main">∥</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> d <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.c2_d local.d_conc6 local.d_conc_s_prod_ax <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">≤</span> d <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> local.c2_d local.c6 local.c_prod_comm local.eq_iff local.mult_isol local.mult_oner<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> demod1<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> d <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span> <span class="main">≤</span> d <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> d <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> <span class="bound">v</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> local.c2_d local.s_prod_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> <span class="bound">v</span><span class="main">)</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.c4 local.cl3 local.dual_order.trans<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.c2_d local.s_prod_idr<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> demod2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span> <span class="main">≤</span> d <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⟹</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> d <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span> <span class="main">≤</span> d <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> d <span class="main">(</span>d <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.d_def local.d_loc_ax local.mult_isor local.s_prod_isor<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> local.d_conc6 local.d_conc_s_prod_ax local.d_glb_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Structural Properties of C-Lattices›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now we consider the results from Section 9 and 10 in~\cite{FurusawaS15a}. 
First we verify the conditions for Proposition 9.1.›</span></span>
      
<span class="keyword1"><span class="command">lemma</span></span> d_meet_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span>d <span class="free">x</span> <span class="main">⊓</span> d <span class="free">y</span><span class="main">)</span> <span class="main">=</span> d <span class="free">x</span> <span class="main">⊓</span> d <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> d_s_subid local.d_sub_id_ax local.inf_le1 local.order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> d_s_prod_eq_meet<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span> <span class="main">=</span> d <span class="free">x</span> <span class="main">⊓</span> d <span class="free">y</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> local.d_lb1 local.d_lb2 local.meet_glb<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d_meet_closed local.inf_le1 local.inf_le2 local.d_glb<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> d_p_prod_eq_meet<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">∥</span> d <span class="free">y</span> <span class="main">=</span> d <span class="free">x</span> <span class="main">⊓</span> d <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_s_prod_eq_meet local.d_conc_s_prod_ax<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> s_id_par_s_prod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cl9_d local.d_conc_s_prod_ax<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> s_id_par <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">∥</span> <span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.meet_assoc local.meet_comm local.inf.absorb_iff1 meet_le_par <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We verify the remaining conditions in Proposition 9.2.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> p_subid_par_eq_meet<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.meet_glb local.order.antisym local.p_subid_lb1 local.p_subid_lb2 meet_le_par<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p_subid_par_eq_meet_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c_x_prop p_subid_par_eq_meet zero_assoc3<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> x_zero_add_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.s_prod_distr<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> x_zero_meet_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c_0 local.cl6 local.meet_assoc local.meet_comm<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following set of lemmas investigates the closure properties of vectors, including Lemma 9,3.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> U_par_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">⋅</span> <span class="free">c</span><span class="main">)</span> <span class="main">∥</span> U <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> U_par_s_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U <span class="main">=</span> U"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> U_par_p_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U <span class="main">=</span> U"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> U_par_nc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nc <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U <span class="main">=</span> U"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> d_add_var<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">+</span> d <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> d <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.d_add_ax local.s_prod_distr<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> d_interr_U<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>d <span class="free">x</span> <span class="main">⋅</span> U<span class="main">)</span> <span class="main">∥</span> <span class="main">(</span>d <span class="free">y</span> <span class="main">⋅</span> U<span class="main">)</span> <span class="main">=</span> d <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> U"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.cl4 local.d_conc6<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> d_meet<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊓</span> <span class="bound">y</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">z</span> <span class="main">⊓</span> <span class="main">(</span><span class="bound">y</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">z</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"d <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">⊓</span> d <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span>d <span class="free">x</span> <span class="main">⊓</span> d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>d <span class="free">x</span> <span class="main">⊓</span> d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span>d <span class="free">x</span> <span class="main">⊓</span> d <span class="free">y</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.d_sub_id_ax local.meet_assoc local.inf.absorb_iff1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>d <span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">⊓</span> <span class="main">(</span>d <span class="free">y</span> <span class="main">⊓</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.d_sub_id_ax local.inf.absorb_iff1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Proposition 9.4›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nc_zero_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊓</span> nc <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.inf.commute local.inf_absorb2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nc_s <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> nc <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.inf.absorb_iff1 s_le_nc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> nc_add_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> nc"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.lat_dist4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> nc_meet_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">⊓</span> nc"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.meet_assoc local.meet_comm local.inf_le1 local.inf.absorb_iff1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> nc_scomp_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> nc"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_0 nc_iff1 zero_assoc3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nc_scomp_closed_alt <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> nc <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.inf.absorb_iff1 nc_scomp_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> nc_ccomp_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">≤</span>  nc"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">≤</span> nc <span class="main">∥</span> nc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> local.inf_le2 local.mult_isol_var<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nc_ccomp_closed_alt <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> nc <span class="main">=</span> <span class="free">x</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> U_nc_par local.U_def local.inf_le2 local.mult_isol_var local.inf.absorb_iff1<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 9.6.›</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> tarski_prod<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊓</span> nc <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> nc <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">=</span> nc"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> d <span class="bound">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>d <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">z</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span>  <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span>  <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊓</span> nc <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span>  assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊓</span> nc <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="skolem">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">y</span> <span class="main">⊓</span> nc <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm c_0 local.cl6 local.meet_comm nc_zero zero_assoc3<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊓</span> nc <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="skolem">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>d <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="skolem">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> d <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span>nc <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="skolem">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>  
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> d <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assm assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="skolem">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">y</span> <span class="main">⊓</span> nc <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assm<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We show the remaining conditions of Proposition 9.8.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nc_prod_aux <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">⋅</span> nc <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">⋅</span> nc <span class="main">=</span> <span class="main">(</span>d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">⋅</span> nc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span>nc <span class="main">⋅</span> nc<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cl11_d d_x_nc local.cl11 local.meet_idem nc_ccomp_closed_alt nc_nc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nc_vec_add_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc <span class="main">+</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">⋅</span> nc <span class="main">=</span>  <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc <span class="main">+</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.s_prod_distr<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nc_vec_par_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> nc <span class="main">=</span>  <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.cl4<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nc_vec_par_is_meet<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span>d <span class="bound">x</span> <span class="main">⊓</span> d <span class="bound">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">z</span> <span class="main">=</span> d <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">z</span> <span class="main">⊓</span> d <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">∥</span> <span class="main">(</span>d <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">∥</span> d <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> nc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.cl4<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⊓</span> d <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> nc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_p_prod_eq_meet<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nc_vec_meet_closed<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span>d <span class="bound">x</span> <span class="main">⊓</span> d <span class="bound">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">z</span> <span class="main">=</span> d <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">z</span> <span class="main">⊓</span> d <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">⋅</span> nc <span class="main">=</span>  <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">⋅</span> nc <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> nc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms nc_vec_par_is_meet<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nc_vec_par_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms nc_vec_par_is_meet<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nc_vec_seq_closed<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊓</span> nc <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> nc <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">=</span> nc"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> d <span class="bound">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>d <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">z</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> nc <span class="main">=</span>  <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> one <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊓</span> nc <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> nc <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊓</span> nc <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> nc <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> tarski_prod<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> one <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Proposition 10.1 and 10.2.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iso3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span>d <span class="free">x</span> <span class="main">⋅</span> U<span class="main">)</span> <span class="main">=</span> d <span class="free">x</span> "</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> iso4 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⋅</span> U <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c3 local.c4 vec_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iso5 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c3 local.c4<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iso6 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> iso3_sharp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span>d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">=</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> d_s_subid local.c4 local.d_def local.inf_le1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> iso4_sharp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">⋅</span> nc <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c2_d local.c4<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iso5_sharp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c3 local.c4<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> iso6_sharp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> nc <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.c4 local.cl11 nc_c <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We verify Lemma 15.2 at this point, because it is helpful for the following proofs.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> uc_par_meet<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∥</span> U <span class="main">⊓</span> <span class="free">y</span> <span class="main">∥</span> U <span class="main">=</span> <span class="free">x</span> <span class="main">∥</span> U <span class="main">∥</span> <span class="free">y</span> <span class="main">∥</span> U"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> local.c_prod_assoc meet_le_par<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> U_idem_p_prod local.U_def local.c_prod_assoc local.meet_prop local.mult.left_commute local.mult_double_iso<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> uc_unc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∥</span> U <span class="main">∥</span> <span class="free">x</span> <span class="main">∥</span> U <span class="main">=</span> <span class="free">x</span> <span class="main">∥</span> U"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.meet_idem uc_par_meet<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> uc_interr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">z</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">z</span> <span class="main">∥</span> U<span class="main">)</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">z</span> <span class="main">∥</span> U<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">z</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">=</span> <span class="free">z</span> <span class="main">∥</span> U"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.c_prod_assoc uc_unc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.cl4<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We verify the remaining cases of Proposition 10.3.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sc_hom_meet<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>d <span class="free">x</span> <span class="main">⊓</span> d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">(</span>d <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⊓</span> <span class="main">(</span>d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d_p_prod_eq_meet local.c3 p_subid_par_eq_meet_var<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sc_hom_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>d <span class="free">x</span> <span class="main">⋅</span> d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">(</span>d <span class="free">x</span> <span class="main">⊓</span> d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_s_prod_eq_meet<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> cs_hom_meet<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>  <span class="main">=</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⊓</span> d <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d_p_prod_eq_meet local.d_conc6 p_subid_par_eq_meet_var<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sv_hom_meet<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>d <span class="free">x</span> <span class="main">⊓</span> d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> U <span class="main">=</span> <span class="main">(</span>d <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> U <span class="main">⊓</span> <span class="main">(</span>d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> U"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>d <span class="free">x</span> <span class="main">⊓</span> d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> U <span class="main">=</span> <span class="main">(</span><span class="main">(</span>d <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> U<span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="main">(</span>d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> U<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_interr_U d_p_prod_eq_meet local.d_conc6<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c2_d local.c_prod_assoc uc_par_meet<span class="main">)</span>   
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> sv_hom_par<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> U <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> U<span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> U<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.cl4<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vs_hom_meet<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span><span class="main">)</span> <span class="main">=</span> d <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⊓</span> d <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⊓</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∥</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> d_p_prod_eq_meet local.d_conc6 local.d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> U <span class="main">⊓</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> U <span class="main">=</span> <span class="bound">x</span> <span class="main">∥</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> U"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.d_def sv_hom_meet <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.d_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cv_hom_meet<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> U <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> U <span class="main">⊓</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> U"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_p_prod_eq_meet local.c2_d local.d_conc6 sv_hom_meet<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> local.c2_d local.c3 p_subid_par_eq_meet_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cv_hom_par <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">x</span> <span class="main">∥</span> U <span class="main">∥</span> <span class="free">y</span> <span class="main">∥</span> U <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">∥</span> U"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> U_idem_p_prod local.mult.left_commute local.mult_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vc_hom_meet<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cv_hom_meet iso5 local.c3 p_subid_par_eq_meet_var<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vc_hom_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c4<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span>U <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assoc_p_subid local.cl8<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span>nc <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute c_nc_comp1 local.s_prod_distr<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute c_x_prop local.absorp2 local.c4 local.meet_comm local.mult_oner p_subid_par_eq_meet_var<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assoc_p_subid calculation<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Proposition 10.4.›</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> nsv_hom_meet<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>d <span class="free">x</span> <span class="main">⊓</span> d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> nc <span class="main">=</span> <span class="main">(</span>d <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> nc <span class="main">⊓</span> <span class="main">(</span>d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> nc"</span></span>
<span class="keyword1"><span class="command">proof</span></span>  <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>d <span class="free">x</span> <span class="main">⊓</span> d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> nc <span class="main">≤</span> <span class="main">(</span>d <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> nc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.s_prod_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>d <span class="free">x</span> <span class="main">⊓</span> d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> nc <span class="main">≤</span> <span class="main">(</span>d <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> nc"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>d <span class="free">x</span> <span class="main">⊓</span> d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> nc <span class="main">≤</span> <span class="main">(</span>d <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> nc <span class="main">⊓</span> <span class="main">(</span>d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> nc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.s_prod_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>d <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> nc <span class="main">⊓</span> <span class="main">(</span>d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> nc <span class="main">≤</span> <span class="main">(</span><span class="main">(</span>d <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="main">(</span>d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> meet_le_par<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>d <span class="free">x</span> <span class="main">∥</span> d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> nc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.cl4 nc_nc_par subidem_par<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>d <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> nc <span class="main">⊓</span> <span class="main">(</span>d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> nc <span class="main">≤</span> <span class="main">(</span>d <span class="free">x</span> <span class="main">⊓</span> d <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> nc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_p_prod_eq_meet<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nsv_hom_par<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> nc <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> nc<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.cl4<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vec_p_prod_meet<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span>  nc<span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">∥</span> <span class="main">(</span>d <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cl11_d<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">∥</span> d <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> nc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nsv_hom_par<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⊓</span> d <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> nc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_p_prod_eq_meet<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>  <span class="main">=</span> <span class="main">(</span>d <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span>  nc<span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span>d <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nsv_hom_meet<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> calculation<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nvs_hom_meet<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span><span class="main">)</span> <span class="main">=</span> d <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">⊓</span> d <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d_p_prod_eq_meet local.d_conc6 vec_p_prod_meet<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ncv_hom_meet<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> nc <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> nc <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> nc"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d_p_prod_eq_meet local.c2_d local.c3 local.d_conc6 nsv_hom_meet p_subid_par_eq_meet_var<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ncv_hom_par<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">∥</span> nc <span class="main">=</span> <span class="free">x</span> <span class="main">∥</span> nc <span class="main">∥</span> <span class="free">y</span> <span class="main">∥</span> nc"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.mult_assoc local.mult_commute nc_nc_par<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nvc_hom_meet<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span>  nc <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span>  nc<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> nc<span class="main">)</span> <span class="main">⋅</span> nc<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.c3 p_subid_par_eq_meet_var vec_p_prod_meet<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Terminal and Nonterminal Elements›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now we define the projection functions on terminals and nonterminal parts and verify the properties
of Section 11 in~\cite{FurusawaS15a}.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tau</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">τ</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">τ</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nu</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">ν</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">ν</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> nc"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 11.1.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tau_int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c_0 local.inf_le1 tau_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nu_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tau_ret <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="main">(</span><span class="keyword1">τ</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">τ</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tau_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_ret <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.meet_assoc nu_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tau_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">τ</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.order_prop local.s_prod_distr tau_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.inf_mono nu_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 11.2.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tau_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tau_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nu_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> tau_s <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tau_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_s <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nu_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> tau_c <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> c_x_prop tau_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_c <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> c_nc_comp2 nu_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">lemma</span></span> tau_nc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> nc <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nc_iff2 tau_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_nc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> nc <span class="main">=</span> nc"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nu_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> tau_U <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> U <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> c_def tau_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_U <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> U <span class="main">=</span> nc"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.U_def local.meet_comm local.inf.absorb_iff1 nu_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 11.3.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tau_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tau_def x_zero_add_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.lat_dist3 local.meet_comm nu_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tau_meet <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">τ</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tau_def x_zero_meet_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_meet <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">ν</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nc_meet_closed nu_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> tau_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.add_comm nu_def tau_def x_y_split zero_assoc3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">lemma</span></span> tau_par <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">τ</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tau_def x_zero_interr <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_par_aux1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∥</span> <span class="keyword1">τ</span> <span class="free">y</span> <span class="main">=</span> d <span class="main">(</span><span class="keyword1">τ</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c2_d local.mult_commute tau_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_par_aux2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">ν</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">ν</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nu_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_par_aux3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">τ</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">τ</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.mult_commute nc_ccomp_closed_alt nu_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_par_aux4 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">τ</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">τ</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nu_def tau_def tau_par zero_nc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_par<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> d <span class="main">(</span><span class="keyword1">τ</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">+</span> d <span class="main">(</span><span class="keyword1">τ</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">ν</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">ν</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">τ</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">τ</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">ν</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">τ</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">τ</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.distrib_left local.distrib_right nu_add nu_def tau_def x_split_var join.sup.commute join.sup.left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">ν</span> <span class="free">y</span>  <span class="main">+</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">τ</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">ν</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> calculation local.c_prod_comm<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> local.join.sup_assoc local.join.sup_commute local.mult_commute nu_par_aux1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 11.5.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sprod_tau_nu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.add_comm nu_def tau_def x_y_split<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pprod_tau_nu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∥</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">+</span> d <span class="main">(</span><span class="keyword1">τ</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">+</span> d <span class="main">(</span><span class="keyword1">τ</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">τ</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∥</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nu_def tau_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>d <span class="main">(</span><span class="keyword1">τ</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">+</span> d <span class="main">(</span><span class="keyword1">τ</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">ν</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">τ</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nu_par<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> add_assoc add_commute calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now verify some additional properties which are not mentioned in the paper.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tau_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">τ</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tau_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tau_interr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">z</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.cl4 tau_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tau_le_c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.x_zero_le_c tau_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> c_le_tauc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">≤</span> <span class="keyword1">τ</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.eq_refl tau_c <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">lemma</span></span> x_alpha_tau <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nu_def tau_def x_split_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">lemma</span></span> alpha_tau_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">τ</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nu_def tau_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tau_alpha_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nu_def tau_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sprod_tau_nu_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">τ</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nu_add sprod_tau_nu<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tau_s_prod <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tau_def zero_assoc3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> alpha_fp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.add_zeror tau_alpha_zero tau_def x_alpha_tau<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> alpha_prod_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nu_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> alpha_par_prod <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="keyword1">ν</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">ν</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nu_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p_prod_tau_alpha<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∥</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">∥</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">τ</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∥</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">x</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x_alpha_tau <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">ν</span> <span class="free">y</span>  <span class="main">+</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">τ</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">τ</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute local.combine_common_factor local.p_prod_distl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">ν</span> <span class="free">y</span>  <span class="main">+</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">τ</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span>  <span class="main">∥</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">ν</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">τ</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> calculation local.add_comm local.distrib_left local.distrib_right x_alpha_tau<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> p_prod_tau_alpha_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∥</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">∥</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> p_prod_tau_alpha tau_par<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> alpha_par<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">∥</span> <span class="free">y</span> <span class="main">+</span> <span class="free">x</span> <span class="main">∥</span> <span class="keyword1">ν</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="keyword1">ν</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nu_add p_prod_tau_alpha_var<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.mult_commute add_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> alpha_tau <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> alpha_tau_zero tau_s_prod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_par_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟹</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∥</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> alpha_par_prod local.mult_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tau_seq_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>  <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.cl6 tau_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tau_seq_prop2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>  <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> d_nu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span>d <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> d <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span>d <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.c2_d<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> d <span class="main">(</span><span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">+</span> d <span class="main">(</span><span class="keyword1">τ</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">ν</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  nu_par<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> alpha_par local.c2_d nu_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 11.6 and 11.7.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nu_ideal1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.meet_prop local.inf.absorb_iff1 nu_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tau_ideal1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">τ</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">τ</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.dual_order.trans tau_def term_p_subid_var<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_ideal2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.lat_dist3 local.meet_comm<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tau_ideal2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">τ</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span> <span class="keyword1">τ</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> tau_ideal3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟹</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tau_seq_prop<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We prove the precongruence properties of Lemma 11.9.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tau_add_precong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">τ</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">τ</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> local.less_eq_def local.s_prod_distr tau_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">z</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> add_assoc add_commute local.s_prod_distr<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> local.order_prop local.s_prod_distr tau_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tau_meet_precong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">τ</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">τ</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">⊓</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.le_iff_inf tau_def x_zero_meet_closed<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> local.inf_left_commute local.le_iff_inf local.meet_comm tau_def x_zero_meet_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> tau_par_precong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">τ</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">y</span> <span class="main">∥</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">τ</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∥</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> local.dual_order.trans local.p_subid_lb1 tau_def tau_par<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">y</span> <span class="main">∥</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">τ</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">τ</span> <span class="free">y</span>›</span></span> local.mult_isor<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tau_seq_precongl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">τ</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.s_prod_isol<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_add_precong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⊓</span> <span class="keyword1">ν</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.inf.absorb_iff1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="bound">a</span><span class="main">)</span> <span class="main">⊓</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> local.lat_dist2 nu_add<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> local.inf.absorb_iff1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nu_meet_precong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.less_eq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> local.lat_dist4 nu_meet<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> local.less_eq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nu_seq_precongr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a local.less_eq_def local.s_prod_distr nu_iso<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We prove the congruence properties of Corollary~11.11.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tcg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>  <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">tcg</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">τ</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="keyword1">τ</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="keyword1">τ</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="keyword1">τ</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ncg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>  <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">ncg</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="keyword1">ν</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tcg_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"tcg <span class="free">x</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tcg_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tcg_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>tcg <span class="free">x</span> <span class="free">y</span><span class="main">;</span> tcg <span class="free">y</span> <span class="free">z</span><span class="main">⟧</span> <span class="main">⟹</span> tcg <span class="free">x</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tcg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> tcg_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"tcg <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> tcg <span class="free">y</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tcg_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ncg_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"ncg <span class="free">x</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ncg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> ncg_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>ncg <span class="free">x</span> <span class="free">y</span><span class="main">;</span> ncg <span class="free">y</span> <span class="free">z</span><span class="main">⟧</span> <span class="main">⟹</span> ncg <span class="free">x</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ncg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> ncg_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"ncg <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> ncg <span class="free">y</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ncg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> tcg_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"tcg <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">τ</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">τ</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tcg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ncg_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"ncg <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.eq_iff ncg_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tcg_add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">τ</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> tcg_meet<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">τ</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> tcg_par<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">τ</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span> <span class="main">∥</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">y</span> <span class="main">∥</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 

<span class="keyword1"><span class="command">lemma</span></span> tcg_seql<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">τ</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> ncg_add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> ncg_meet<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> ncg_seqr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.eq_iff nu_seq_precongr<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Powers in C-Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define the power functions from Section~6 in~\cite{FurusawaS15a} after Lemma~12.4.›</span></span>

<span class="keyword1"><span class="command">context</span></span> proto_dioid
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">p_power</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>  <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">p_power</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span>       <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span> <span class="main">|</span>
 <span class="quoted"><span class="quoted">"<span class="free">p_power</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> <span class="free">p_power</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">power_rd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>  <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">power_rd</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span>       <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span>
 <span class="quoted"><span class="quoted">"<span class="free">power_rd</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> <span class="free">power_rd</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">power_sq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>  <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">power_sq</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span>       <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span> <span class="main">|</span>
 <span class="quoted"><span class="quoted">"<span class="free">power_sq</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> <span class="free">power_sq</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma~12.5›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> power_rd_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"power_rd <span class="free">x</span> <span class="free">n</span> <span class="main">≤</span> power_rd <span class="free">x</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Suc_eq_plus1 local.add_comm local.add_iso local.s_prod_isol power_rd.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> power_sq_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"power_sq <span class="free">x</span> <span class="free">n</span> <span class="main">≤</span> power_sq <span class="free">x</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Suc_eq_plus1 local.add_comm local.add_iso local.s_prod_isol power_sq.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pow_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"p_power <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="free">n</span> <span class="main">≤</span> p_power <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Suc_eq_plus1 local.p_power.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> local.s_prod_isol<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pow_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"p_power <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> p_power <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="free">n</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"p_power <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> p_power <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> p_power <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"p_power <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> p_power <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> local.p_power.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> p_power <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> p_power <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.s_prod_distr local.s_prod_idl<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> p_power <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> p_power <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span>  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> p_power <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> p_power <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> p_power <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc_eq_plus1 local.less_eq_def local.s_prod_isol pow_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> f1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we verify facts from the proofs of Lemma~12.6.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> power_rd_le_sq<span class="main">:</span> <span class="quoted"><span class="quoted">"power_rd <span class="free">x</span> <span class="free">n</span> <span class="main">≤</span> power_sq <span class="free">x</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.join.le_supI2 local.s_prod_isol<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> power_sq_le_rd<span class="main">:</span> <span class="quoted"><span class="quoted">"power_sq <span class="free">x</span> <span class="free">n</span> <span class="main">≤</span> power_rd <span class="free">x</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.join.le_supI2 local.s_prod_isol<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> power_sq_power<span class="main">:</span> <span class="quoted"><span class="quoted">"power_sq <span class="free">x</span> <span class="free">n</span> <span class="main">=</span> p_power <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> Suc_eq_plus1 pow_prop power_sq.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹C-Kleene Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The definition of c-Kleene algebra is slightly different from that in Section~6
of~\cite{FurusawaS15a}. It is used to prove properties from Section~6 and Section~12.›</span></span>

<span class="keyword1"><span class="command">class</span></span> c_kleene_algebra <span class="main">=</span> c_lattice <span class="main">+</span> star_op <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> star_unfold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> star_induct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> star_irr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.star_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> star_unfold_part<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.star_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> star_ext_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.s_prod_isol star_irr <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> star_ext<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.order_trans star_ext_aux star_unfold_part <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> star_co_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span>  <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.s_prod_isol star_irr <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> star_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> local.less_eq_def star_unfold_part<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> local.less_eq_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">+</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> local.add_assoc' local.s_prod_distr<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> local.add_assoc' local.less_eq_def local.star_induct star_irr <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> star_unfold_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span>  <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.star_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> local.eq_refl local.join.sup_mono local.s_prod_isol local.star_unfold<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.star_induct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 12.2.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nu_star1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">z</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_assoc local.sprod_tau_nu<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms local.s_prod_distr local.s_prod_idl <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.s_prod_isor local.star_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> calculation local.star_induct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nu_star2<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.nu_int local.s_prod_isor star_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span>  <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.s_prod_isol local.join.sup_mono local.tau_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.s_prod_isol star_ext star_irr<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms local.order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nu_star<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">z</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> local.dual_order.antisym nu_star1 nu_star2<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 12.3.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tau_star<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">τ</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.cl6 local.tau_def star_unfold_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tau_star_var<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">z</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> local.add_0_right local.add_comm local.s_prod_distr local.s_prod_idl local.tau_def local.tau_zero nu_star<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_star_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute local.less_eq_def local.meet_prop local.nc_nc local.nu_def local.order.refl local.s_le_nc local.star_induct star_iso<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_star_nu <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.nu_ideal1 local.nu_ret nu_star_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> nu_star_tau <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">τ</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tau_star <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> tau_star_tau <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">τ</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">τ</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.s_prod_distr tau_star <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> tau_star_nu <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.alpha_fp local.tau_def nu_star_nu <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally we verify Lemma 6.2. Proofs can be found in~\cite{FurusawaS15b}.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_star_unfold <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⋅</span> d <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="bound">y</span> <span class="main">⋅</span> d <span class="bound">z</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"d <span class="free">y</span> <span class="main">+</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> d <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> d <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d <span class="free">y</span> <span class="main">+</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> d <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> d <span class="free">y</span> <span class="main">+</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> d <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.c4 local.d_def local.dc_prop1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  d <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⋅</span> d <span class="free">y</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> d <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.d_add_ax<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  d <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⋅</span> d <span class="free">y</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⋅</span> d <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> d <span class="main">(</span><span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⋅</span> d <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.s_prod_distr <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_star_sim1<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> d <span class="bound">z</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> d <span class="bound">z</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> d <span class="bound">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="main">(</span>d <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span>d <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">z</span> <span class="main">=</span> d <span class="bound">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> d <span class="free">z</span> <span class="main">≤</span> d <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> d <span class="free">z</span> <span class="main">≤</span> d <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
<span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> d <span class="skolem">z</span> <span class="main">≤</span> d <span class="skolem">z</span> <span class="main">⋅</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="main">(</span>d <span class="skolem">z</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">≤</span> d <span class="skolem">z</span> <span class="main">⋅</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> local.s_prod_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="main">(</span>d <span class="skolem">z</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">≤</span> d <span class="skolem">z</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">∥</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b local.c2_d local.mult_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">∥</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> local.eq_refl local.mult_commute local.mult_isol_var local.join.sup_idem star_unfold_part<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">∥</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">∥</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> local.distrib_right' local.dual_order.trans local.join.sup.cobounded2<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> local.c2_d local.mult_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"d <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="main">(</span>d <span class="skolem">z</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">≤</span> d <span class="skolem">z</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.s_prod_isol star_irr <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> d <span class="skolem">z</span> <span class="main">≤</span> d <span class="skolem">z</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_star_induct<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> d <span class="bound">z</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> d <span class="bound">z</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> d <span class="bound">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="main">(</span>d <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span>d <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">z</span> <span class="main">=</span> d <span class="bound">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> d <span class="free">y</span> <span class="main">⟹</span> d <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> d <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> d <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> d <span class="skolem">y</span> <span class="main">≤</span> d <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> demod1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> d <span class="skolem">y</span> <span class="main">≤</span> d <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> d_star_sim1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> d <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> demod2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹C-Omega Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹These structures do not feature in~\cite{FurusawaS15a}, but in fact, 
many lemmas from Section 13 can be proved in this setting. The proto-quantales and c-quantales
using in~\cite{FurusawaS15a} provide a more expressive setting in which least and greatest fixpoints 
need not be postulated; they exists due to properties of sequential composition and addition over 
complete lattices.›</span></span>

<span class="keyword1"><span class="command">class</span></span> c_omega_algebra <span class="main">=</span> c_kleene_algebra <span class="main">+</span> omega_op <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> om_unfold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> om_coinduct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 13.4.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> om_unfold_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> local.om_coinduct local.om_unfold local.s_prod_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> om_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.om_coinduct local.s_prod_isor om_unfold_eq<span class="main">)</span>
 
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 13.5.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zero_om <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.s_prod_annil om_unfold_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> s_id_om <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">=</span> U"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.U_def local.eq_iff local.om_coinduct<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p_id_om <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.c_x_prop om_unfold_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nc_om <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nc<span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">=</span> U"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.U_def local.eq_iff local.s_le_nc om_iso s_id_om <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> U_om <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"U<span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">=</span> U"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.U_def local.eq_iff local.om_coinduct<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 13.6.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tau_om1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.om_coinduct local.s_prod_isor local.tau_def local.tau_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> tau_om2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">=</span> <span class="keyword1">τ</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.cl6 local.tau_def om_unfold_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tau_om3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">τ</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">≤</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tau_om1<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 13.7.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> om_nu_tau<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_assoc local.s_prod_distr local.s_prod_idl <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_assoc local.cl5 local.lat_dist1 local.inf.absorb_iff1 local.s_prod_subdistl local.tau_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.sprod_tau_nu<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> local.om_coinduct <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹C-Nabla Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Nabla-algebras provide yet another way of formalising non-terminating behaviour in Section 13.›</span></span>

<span class="keyword1"><span class="command">class</span></span> c_nabla_algebra <span class="main">=</span> c_omega_algebra <span class="main">+</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">nabla</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">∇</span></span></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nabla_unfold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∇</span></span>  <span class="free">x</span> <span class="main">≤</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main"><span class="free">∇</span></span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> nabla_coinduct<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">y</span> <span class="main">≤</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> d <span class="free">y</span> <span class="main">≤</span> <span class="main"><span class="free">∇</span></span> <span class="free">x</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nabla_unfold_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="free">x</span> <span class="main">=</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">∇</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="free">x</span> <span class="main">≤</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">∇</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.nabla_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">∇</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">∇</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.d_def local.mult_commute local.mult_isol local.nabla_unfold local.s_prod_isol local.s_prod_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">∇</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.d_loc_ax <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">∇</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">∇</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.nabla_coinduct<span class="main">)</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nabla_le_s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.d_sub_id_ax nabla_unfold_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nabla_nu <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="main">∇</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">∇</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.nu_ideal1 local.nu_s nabla_le_s <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

 
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Proposition 13.9.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nabla_omega_U<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="main">(</span>d <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> d <span class="bound">y</span> <span class="main">)</span> <span class="main">⋅</span> <span class="bound">z</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">=</span> <span class="main">∇</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> U"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span> <span class="main">≤</span> <span class="main">∇</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.nabla_coinduct local.om_unfold_eq local.order_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">≤</span> <span class="main">∇</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.dlp_ax local.dual_order.trans local.s_prod_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>  <span class="main">≤</span> <span class="main">∇</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> U"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.U_def local.dual_order.trans local.s_prod_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">∇</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> U<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> d <span class="main">(</span><span class="main">∇</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> U"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms local.d_s_subid nabla_le_s<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="main">∇</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> U"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.d_s_subid nabla_le_s nabla_nu local.alpha_prod_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> d <span class="main">(</span><span class="keyword1">ν</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="main">∇</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> U"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.ax5_d local.nu_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> d <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">∇</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> U"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.alpha_prod_closed nabla_nu<span class="main">)</span> 
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> U <span class="main">≤</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.nabla_unfold local.om_coinduct local.s_prod_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Corollary 13.10.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nabla_omega_U_cor<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="main">(</span>d <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> d <span class="bound">y</span> <span class="main">)</span> <span class="main">⋅</span> <span class="bound">z</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∇</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> U <span class="main">+</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms nabla_omega_U local.om_nu_tau<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 13.11.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nu_om_nu<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="main">(</span>d <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> d <span class="bound">y</span> <span class="main">)</span> <span class="main">⋅</span> <span class="bound">z</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">∇</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> nc"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">ν</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span><span class="main">∇</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> U<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms nabla_omega_U <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">ν</span> <span class="main">(</span>d <span class="main">(</span><span class="main">∇</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> U<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.d_s_subid nabla_le_s<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∇</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">ν</span> U"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.d_nu local.d_s_subid nabla_le_s<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> local.nu_U <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tau_om_nu<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="main">(</span>d <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> d <span class="bound">y</span> <span class="main">)</span> <span class="main">⋅</span> <span class="bound">z</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">∇</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">τ</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">τ</span> <span class="main">(</span><span class="main">∇</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> U<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms nabla_omega_U<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">∇</span> <span class="main">(</span><span class="keyword1">ν</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">τ</span> U"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.tau_s_prod <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> local.tau_U <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Proposition 13.12.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> wf_eq_defl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> d <span class="bound">y</span> <span class="main">≤</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟶</span> d <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> local.d_add_ax local.d_rest_ax local.less_eq_def local.s_prod_annil<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.c2_d local.c4 local.d_def local.mult_commute local.mult_onel local.p_rpd_annir local.s_prod_isor<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> defl_eq_om_trivial<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.join.bot_unique local.om_coinduct <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> wf_eq_om_trivial<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">=</span> <span class="main">0</span>  <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> d <span class="bound">y</span> <span class="main">≤</span> d <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟶</span> d <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> defl_eq_om_trivial wf_eq_defl<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Proto-Quantales›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally we define the class of proto-quantales and prove some of the 
remaining facts from the article. Full c-quantales, as defined there, are not needed
for these proofs.›</span></span>

<span class="keyword1"><span class="command">class</span></span> proto_quantale <span class="main">=</span> complete_lattice <span class="main">+</span> proto_monoid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Sup_mult_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"Sup <span class="free">X</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> Sup <span class="main">{</span><span class="bound">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> isol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> pd<span class="main">?</span><span class="main">:</span> proto_dioid <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted">sup</span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="quoted"><span class="quoted">"Sup <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>sup <span class="bound">x</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.le_iff_sup<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.order.strict_iff_order<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> sup <span class="main">(</span>sup <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">z</span> <span class="main">=</span> sup <span class="bound">x</span> <span class="main">(</span>sup <span class="bound">y</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.sup_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> sup <span class="bound">x</span> <span class="bound">y</span> <span class="main">=</span> sup <span class="bound">y</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.sup_commute<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> sup <span class="bound">x</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> sup <span class="main">(</span>Sup <span class="main">{}</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> sup <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="main">(</span>sup <span class="bound">y</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.isol<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> Sup <span class="main">{}</span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">=</span> Sup <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span> <span class="bound">a</span><span class="main">.</span> <span class="main">{}</span> <span class="main">≠</span> <span class="bound">A</span> <span class="main">∨</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">aa</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ab</span><span class="main">.</span> <span class="main">(</span><span class="bound">aa</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> <span class="bound">ab</span> <span class="main">⋅</span> <span class="bound">a</span> <span class="main">∧</span> <span class="bound">ab</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Sup <span class="main">{}</span> <span class="main">⋅</span> <span class="skolem">x</span> <span class="main">=</span> Sup <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.Sup_mult_distr <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span>sup <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">z</span> <span class="main">=</span> sup <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span> <span class="main">(</span><span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sup <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">z</span> <span class="main">=</span> Sup <span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">}</span> <span class="main">⋅</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sup <span class="main">(</span><span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Sup_mult_distr<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Sup_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sup <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">z</span> <span class="main">=</span> sup <span class="main">(</span><span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">star_rd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">star_rd</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Sup <span class="main">{</span>power_rd <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">i</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℕ</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">star_sq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">star_sq</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Sup <span class="main">{</span>power_sq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">i</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℕ</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now we prove Lemma 12.6.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> star_rd_le_sq<span class="main">:</span> <span class="quoted"><span class="quoted">"star_rd <span class="free">x</span> <span class="main">≤</span> star_sq <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> star_rd_def star_sq_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Sup_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> pd.power_rd_le_sq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> star_sq_le_rd<span class="main">:</span> <span class="quoted"><span class="quoted">"star_sq <span class="free">x</span> <span class="main">≤</span> star_rd <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> star_rd_def star_sq_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Sup_mono<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nats_1 Nats_add Suc_eq_plus1 local.Sup_empty pd.power_sq_le_rd<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> star_rd_sq<span class="main">:</span> <span class="quoted"><span class="quoted">"star_rd <span class="free">x</span> <span class="main">=</span> star_sq <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.dual_order.antisym star_rd_le_sq star_sq_le_rd<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> star_sq_power<span class="main">:</span> <span class="quoted"><span class="quoted">"star_sq <span class="free">x</span> <span class="main">=</span> Sup <span class="main">{</span>pd.p_power <span class="main">(</span>sup <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="free">x</span><span class="main">)</span> <span class="bound">i</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℕ</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> star_sq_def pd.power_sq_power <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Sup_eqI<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following lemma should be somewhere close to complete lattices.›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> sup <span class="main">(</span><span class="free">z</span><span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> proto_quantale<span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> mono_def order_refl pd.s_prod_isol sup.mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> gfp_lfp_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"sup <span class="main">(</span>gfp <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> proto_quantale<span class="main">)</span><span class="main">.</span> <span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lfp <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> sup <span class="free">z</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> gfp <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> sup <span class="free">z</span>  <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gfp_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lfp_le_gfp mono_aux<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Multirelations">
<div class="head">
<h1>Theory Multirelations</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: Binary Multirelations
Author: Hitoshi Furusawa, Georg Struth
Maintainer: &lt;g.struth at sheffield.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Multirelations›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Multirelations
<span class="keyword2"><span class="keyword">imports</span></span> <a href="C_Algebras.html">C_Algebras</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define a type synonym for multirelations.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> mrel <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">*</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span><span class="main">)</span> set"</span></span>

<span class="keyword1"><span class="command">no_notation</span></span>  s_prod <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 80<span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> s_id <span class="main">(</span><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> c_prod <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">∥</span>"</span> 80<span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> c_id <span class="main">(</span><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now we start with formalising the multirelational model. First
  we define  sequential composition and paraellel composition of multirelations, their units and 
the universal multirelation as in Section 2 of the article.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">s_prod</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mrel <span class="main">⇒</span> <span class="tfree">'a</span> mrel <span class="main">⇒</span> <span class="tfree">'a</span> mrel"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main"><span class="free">⋅</span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">f</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">{</span><span class="bound">f</span> <span class="bound">b</span> <span class="main">|</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">s_id</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mrel"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">1<span class="hidden">⇩</span><sub>σ</sub></span></span> <span class="main">≡</span> <span class="main">⋃</span><span class="bound">a</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">p_prod</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mrel <span class="main">⇒</span> <span class="tfree">'a</span> mrel <span class="main">⇒</span> <span class="tfree">'a</span> mrel"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">∥</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main"><span class="free">∥</span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span> <span class="bound">C</span><span class="main">.</span> <span class="bound">A</span> <span class="main">=</span> <span class="bound">B</span> <span class="main">∪</span> <span class="bound">C</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">C</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>
 
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">p_id</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mrel"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">1<span class="hidden">⇩</span><sub>π</sub></span></span> <span class="main">≡</span> <span class="main">⋃</span><span class="bound">a</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mrel"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> UNIV <span class="main">∧</span> <span class="bound">A</span> <span class="main">⊆</span> UNIV<span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">NC</span> <span class="main">≡</span> U <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We write NC where $\overline{1_\pi}$ is written in~\cite{FurusawaS15a}.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we prove some basic set-theoretic properties.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> s_prod_im<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">f</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s_prod_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> s_prod_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">f</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="free">A</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> s_prod_im<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> s_id_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⟷</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_id_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p_prod_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∥</span> <span class="free">S</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span> <span class="bound">C</span><span class="main">.</span> <span class="free">A</span> <span class="main">=</span> <span class="bound">B</span> <span class="main">∪</span> <span class="bound">C</span> <span class="main">∧</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="bound">C</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_prod_def<span class="main">)</span>

<span class="keyword1"><span class="command">named_theorems</span></span> mr_simp
<span class="keyword1"><span class="command">declare</span></span> s_prod_im <span class="main">[</span><span class="operator">mr_simp</span><span class="main">]</span> p_prod_def <span class="main">[</span><span class="operator">mr_simp</span><span class="main">]</span> s_id_def <span class="main">[</span><span class="operator">mr_simp</span><span class="main">]</span> p_id_def <span class="main">[</span><span class="operator">mr_simp</span><span class="main">]</span> U_def <span class="main">[</span><span class="operator">mr_simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Multirelations and Proto-Dioids›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We can now show that multirelations form proto-trioids. 
This is Proposition 5.1, and it subsumes Proposition 4.1,›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> mrel_proto_trioid<span class="main">:</span> proto_trioid <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∥)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> UN_singleton<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∥</span> <span class="bound">y</span> <span class="main">∥</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∥</span> <span class="main">(</span><span class="bound">y</span> <span class="main">∥</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span> Un_assoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Un_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∥</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">∥</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊆</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∪</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊂</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊆</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> psubset_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∪</span> <span class="bound">y</span> <span class="main">∪</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∪</span> <span class="main">(</span><span class="bound">y</span> <span class="main">∪</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∪</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">∪</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∪</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">{}</span> <span class="main">∪</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∪</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">z</span> <span class="main">∪</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">∪</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">z</span> <span class="main">⊆</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="bound">y</span> <span class="main">∪</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">{}</span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∥</span> <span class="main">(</span><span class="bound">y</span> <span class="main">∪</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∥</span> <span class="bound">y</span> <span class="main">∪</span> <span class="bound">x</span> <span class="main">∥</span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∥</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Simple Properties›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This covers all the identities in the display before Lemma 2.1  except the two following ones.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> s_prod_assoc1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span> <span class="main">)</span> <span class="main">⋅</span> <span class="free">T</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> seq_conc_subdistr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">∥</span> <span class="free">S</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">T</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span> UnI1 UnI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we provide some counterexamples. These do not feature in~\cite{FurusawaS15a}.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>  <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span> 
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">∪</span> <span class="free">T</span><span class="main">)</span> <span class="main">=</span> <span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span> <span class="main">∪</span> <span class="free">R</span> <span class="main">⋅</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s_prod_im<span class="main">)</span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s_prod_im<span class="main">)</span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">∥</span> <span class="free">R</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">T</span> <span class="main">=</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">quickcheck</span></span> 
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we prove the distributivity and associativity laws for sequential subidentities 
mentioned before Lemma 2.1›</span></span>   

<span class="keyword1"><span class="command">lemma</span></span> subid_aux2<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span><span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> s_prod_test_aux1<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s_prod_im<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mrel_proto_trioid.s_prod_idr mrel_proto_trioid.s_prod_isol singletonD subid_aux2 subset_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> s_prod_test_aux2<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> s_prod_test<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⋅</span> <span class="free">P</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms s_prod_test_aux1 s_prod_test_aux2<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> test_s_prod_aux1<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span>  <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">⋅</span> <span class="free">R</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms mrel_proto_trioid.s_prod_idl s_id_iff s_prod_iff subid_aux2<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> test_s_prod_aux2<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">⋅</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms s_prod_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> test_s_prod<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">⋅</span> <span class="free">R</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms test_s_prod_aux1 test_s_prod_aux2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> test_assoc1<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">P</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">S</span> <span class="main">=</span> <span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">P</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">P</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">S</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">P</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> s_prod_assoc1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">P</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">P</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">A</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">P</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">f</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="main">{</span><span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">f</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms test_s_prod<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="main">{</span><span class="bound">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">f</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⋅</span> <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">f</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms s_prod_test<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">P</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> test_assoc2<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">S</span> <span class="main">=</span> <span class="free">P</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">S</span> <span class="main">⊆</span>  <span class="free">P</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> s_prod_assoc1<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">P</span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">A</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms test_s_prod<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">f</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">f</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">⋅</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">f</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms test_s_prod<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">P</span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> test_assoc3<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">P</span> <span class="main">=</span> <span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">P</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="free">P</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> s_prod_assoc1<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">A</span>
    <span class="keyword3"><span class="command">assume</span></span> hyp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="free">P</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">f</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⋅</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_prod_test s_prod_im<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">f</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="bound">f</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_prod_test assms<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">f</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">f</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_prod_test assms<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> s_distl_test<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">∪</span> <span class="free">T</span><span class="main">)</span> <span class="main">=</span> <span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span> <span class="main">∪</span> <span class="free">R</span> <span class="main">⋅</span> <span class="free">T</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms subid_aux2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we verify Lemma 2.1.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subid_par_idem<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">∥</span> <span class="free">R</span> <span class="main">=</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Un_absorb assms subid_aux2<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> term_par_idem<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">∥</span> <span class="free">R</span> <span class="main">=</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> U_par_idem<span class="main">:</span> <span class="quoted"><span class="quoted">"U <span class="main">∥</span> U <span class="main">=</span> U"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nc_par_idem<span class="main">:</span> <span class="quoted"><span class="quoted">"NC <span class="main">∥</span> NC <span class="main">=</span> NC"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we prove the properties of Lemma 2.2 and 3.2. First we prepare to show that multirelations form c-lattices.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define the domain operation on multirelations and verify the explicit definition from Section 3.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">d</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mrel <span class="main">⇒</span> <span class="tfree">'a</span> mrel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">|</span><span class="bound">a</span><span class="main">.</span> <span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">named_theorems</span></span> mrd_simp
<span class="keyword1"><span class="command">declare</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span> <span class="main">[</span><span class="operator">mrd_simp</span><span class="main">]</span> d_def <span class="main">[</span><span class="operator">mrd_simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> d_def_expl<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">R</span> <span class="main">=</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mrd_simp</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> set_eqI <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">interpretation</span></span> mrel_pbdl_monoid<span class="main">:</span> pbdl_monoid <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∥)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"U"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∩)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mrd_simp</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Here come the properties of Lemma 2.2.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="free">R</span> <span class="main">=</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> SUP_bot SUP_bot_conv<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sup_bot.left_neutral<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> t_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∥</span> <span class="free">T</span> <span class="main">⊆</span> <span class="free">T</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">B</span> <span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">C</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">B</span> <span class="main">∪</span> <span class="free">C</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cl4<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∥</span> <span class="free">T</span> <span class="main">⊆</span> <span class="free">T</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">R</span> <span class="main">∥</span> <span class="free">S</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">T</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">A</span>   
  <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span> <span class="bound">C</span><span class="main">.</span> <span class="skolem">A</span> <span class="main">=</span> <span class="bound">B</span> <span class="main">∪</span> <span class="bound">C</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">D</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">D</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d</span> <span class="main">∈</span> <span class="bound">D</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span><span class="main">,</span><span class="bound">f</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">B</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">D</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">E</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">E</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> <span class="bound">E</span><span class="main">.</span> <span class="main">(</span><span class="bound">e</span><span class="main">,</span><span class="bound">g</span> <span class="bound">e</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">`</span> <span class="bound">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">D</span> <span class="bound">E</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">D</span> <span class="main">∪</span> <span class="bound">E</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∥</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d</span> <span class="main">∈</span> <span class="bound">D</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span><span class="main">,</span><span class="bound">f</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> <span class="bound">E</span><span class="main">.</span> <span class="main">(</span><span class="bound">e</span><span class="main">,</span><span class="bound">g</span> <span class="bound">e</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">D</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">`</span> <span class="bound">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">D</span> <span class="bound">E</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">D</span> <span class="main">∪</span> <span class="bound">E</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∥</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d</span> <span class="main">∈</span> <span class="bound">D</span><span class="main">-</span><span class="bound">E</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span><span class="main">,</span><span class="bound">f</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> <span class="bound">E</span><span class="main">-</span><span class="bound">D</span><span class="main">.</span> <span class="main">(</span><span class="bound">e</span><span class="main">,</span><span class="bound">g</span> <span class="bound">e</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">D</span> <span class="main">∩</span> <span class="bound">E</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="bound">D</span><span class="main">-</span><span class="bound">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="bound">E</span><span class="main">-</span><span class="bound">D</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">y</span> <span class="main">∪</span> <span class="bound">g</span> <span class="bound">y</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="bound">D</span> <span class="main">∩</span> <span class="bound">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">D</span> <span class="bound">E</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">D</span> <span class="main">∪</span> <span class="bound">E</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∥</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d</span> <span class="main">∈</span> <span class="bound">D</span><span class="main">-</span><span class="bound">E</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span><span class="main">,</span><span class="bound">f</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> <span class="bound">E</span><span class="main">-</span><span class="bound">D</span><span class="main">.</span> <span class="main">(</span><span class="bound">e</span><span class="main">,</span><span class="bound">g</span> <span class="bound">e</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">D</span> <span class="main">∩</span> <span class="bound">E</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">f</span> <span class="bound">x</span> <span class="main">∪</span> <span class="bound">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="bound">D</span><span class="main">-</span><span class="bound">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="bound">E</span><span class="main">-</span><span class="bound">D</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">y</span> <span class="main">∪</span> <span class="bound">g</span> <span class="bound">y</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="bound">D</span> <span class="main">∩</span> <span class="bound">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">D</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">E</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_prod_def p_prod_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">D</span> <span class="bound">E</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">D</span> <span class="main">∪</span> <span class="bound">E</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∥</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">h</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d</span> <span class="main">∈</span> <span class="bound">D</span><span class="main">-</span><span class="bound">E</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span><span class="main">,</span><span class="bound">h</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> <span class="bound">E</span><span class="main">-</span><span class="bound">D</span><span class="main">.</span> <span class="main">(</span><span class="bound">e</span><span class="main">,</span> <span class="bound">h</span> <span class="bound">e</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">D</span> <span class="main">∩</span> <span class="bound">E</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="bound">D</span><span class="main">-</span><span class="bound">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="bound">E</span><span class="main">-</span><span class="bound">D</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">h</span> <span class="bound">y</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="bound">D</span> <span class="main">∩</span> <span class="bound">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">D</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">E</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="improper">D</span> <span class="main">-</span> <span class="improper">E</span><span class="main">)</span> <span class="keyword1">then</span> <span class="improper">f</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="improper">D</span> <span class="main">∩</span> <span class="improper">E</span> <span class="keyword1">then</span> <span class="main">(</span><span class="improper">f</span> <span class="bound">x</span> <span class="main">∪</span> <span class="improper">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="improper">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∥</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">h</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">h</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">∥</span> <span class="free">S</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cl3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">∥</span> <span class="free">T</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">A</span>
<span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">∥</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">∃</span><span class="bound">C</span> <span class="bound">D</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">C</span> <span class="main">∪</span> <span class="bound">D</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">C</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">D</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span> <span class="bound">g</span> <span class="bound">h</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">g</span> <span class="bound">b</span> <span class="main">∪</span> <span class="bound">h</span> <span class="bound">b</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">g</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">h</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bchoice<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">g</span> <span class="bound">h</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">g</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">h</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span>  <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span> <span class="bound">D</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">g</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span>  <span class="bound">C</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">h</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">h</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">∧</span>  <span class="bound">D</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="bound">C</span> <span class="main">∪</span> <span class="bound">D</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cl5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">T</span> <span class="main">⋅</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> <span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">T</span> <span class="main">⋅</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">T</span> <span class="main">⋅</span> <span class="main">{}</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">T</span> <span class="main">⋅</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> s_prod_assoc1<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">T</span> <span class="main">⋅</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">T</span> <span class="main">⋅</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">A</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span>  <span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">T</span> <span class="main">⋅</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">C</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">⋅</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">f</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">C</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">⋅</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">f</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">C</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">⋅</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>erased<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> SUP_bot_conv<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">f</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">f</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">⋅</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">f</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">⋅</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UN_E<span class="main">)</span> 
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">f</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">=</span>  <span class="main">⋃</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">⋅</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">C</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">⋅</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">T</span> <span class="main">⋅</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We continue verifying other c-lattice axioms›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cl8_var<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span> <span class="main">=</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mrd_simp</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> SUP_bot sup.commute sup_bot.right_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> cl9_var<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">R</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">R</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mrd_simp</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cl10_var<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">∩</span> <span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> NC<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def p_id_def s_id_def U_def s_prod_im<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UN_constant insert_not_empty<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Multirelations and C-Lattices›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we show that multirelations form c-lattices (Proposition 7.3) and prove further facts in this setting.›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> mrel_c_lattice<span class="main">:</span> c_lattice <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∥)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"U"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∩)</span>"</span></span> <span class="quoted"><span class="quoted">"NC"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'b</span> set<span class="main">)</span> set"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∪</span> <span class="skolem">x</span> <span class="main">⋅</span> NC <span class="main">=</span> <span class="skolem">x</span> <span class="main">⋅</span> U"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> UN_constant all_not_in_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∩</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">∪</span> NC<span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">∥</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">∥</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cl3<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∥</span> <span class="skolem">z</span> <span class="main">⊆</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∥</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">z</span> <span class="main">∥</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⋅</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cl4 seq_conc_subdistr subset_antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">⋅</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">⋅</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cl5<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="main">{}</span> <span class="main">⋅</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⋅</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cl8_var d_def_expl<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∩</span> NC <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">∩</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">∩</span> NC <span class="main">⋅</span> NC<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_Diff cl10_var d_def_expl<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∩</span> NC <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">∥</span> NC <span class="main">=</span> <span class="skolem">x</span> <span class="main">∩</span> NC <span class="main">⋅</span> NC"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def U_def p_id_def p_prod_def s_prod_im<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> UN_extend_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Un_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> set"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="bound">B</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="bound">B</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="bound">B</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">bb</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> set <span class="main">⇒</span> <span class="tfree">'b</span> set <span class="main">⇒</span> <span class="tfree">'b</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">BB</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">BBa</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        ff1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">BB</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="main">{}</span> <span class="main">≠</span> <span class="skolem">BB</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∉</span> <span class="skolem">BB</span> <span class="main">∨</span> <span class="main">{}</span> <span class="main">≠</span> <span class="skolem">BBa</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∧</span> <span class="main">⋃</span><span class="main">(</span><span class="skolem">BBa</span> <span class="main">`</span> <span class="skolem">BB</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> a1<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">b</span><span class="main">∈</span><span class="skolem">BB</span><span class="main">.</span> <span class="main">(</span><span class="bound">B</span><span class="main">::</span><span class="tfree">'b</span> set<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">B</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span> <span class="bound">Ba</span><span class="main">.</span> <span class="bound">B</span> <span class="main">∪</span> <span class="bound">Ba</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Bb</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="bound">Bb</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="main">{}</span> <span class="main">≠</span> <span class="bound">Bb</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="skolem">bb</span> <span class="bound">B</span> <span class="bound">Ba</span> <span class="bound">Bb</span> <span class="bound">f</span> <span class="main">∉</span> <span class="bound">Bb</span> <span class="main">∨</span> <span class="main">{}</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">(</span><span class="skolem">bb</span> <span class="bound">B</span> <span class="bound">Ba</span> <span class="bound">Bb</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">⋃</span><span class="main">(</span><span class="bound">f</span> <span class="main">`</span> <span class="bound">Bb</span><span class="main">)</span> <span class="main">=</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">{}</span> <span class="main">≠</span> <span class="bound">Ba</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ff1 SUP_bot_conv<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sup_bot.left_neutral<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span> <span class="bound">Ba</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">=</span> <span class="bound">B</span> <span class="main">∪</span> <span class="bound">Ba</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Ba</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="bound">Ba</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="bound">Ba</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="bound">Ba</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">b</span><span class="main">∈</span><span class="bound">Ba</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">Ba</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following facts from Lemma 2.2 remain to be shown.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> p_id_assoc1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">S</span> <span class="main">=</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p_id_assoc2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="free">T</span> <span class="main">=</span> <span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span> <span class="quasi_keyword">cong</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> SUP_cong_simp<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> seq_conc_subdistrl<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">∥</span> <span class="free">T</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">P</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms mrel_c_lattice.d_inter_r mrel_c_lattice.d_s_subid<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> test_s_prod_is_meet <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span> <span class="main">=</span> <span class="free">R</span> <span class="main">∩</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> test_p_prod_is_meet<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">∥</span> <span class="free">S</span> <span class="main">=</span> <span class="free">R</span> <span class="main">∩</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> test_multipliciativer<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">∩</span> <span class="free">S</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">T</span> <span class="main">=</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eqI <span class="dynamic"><span class="dynamic">mr_simp</span></span> subid_aux2<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we verify the remaining fact from Lemma 2.2; in fact it follows from the corresponding theorem of c-lattices.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> c6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⊆</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we verify Lemma 3.1.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> p_id_st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">|</span><span class="bound">a</span><span class="main">.</span>  <span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
 
<span class="keyword1"><span class="command">lemma</span></span> p_id_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="free">R</span> <span class="main">⋅</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p_id_zero_st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">|</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> s_id_st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">|</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> U_seq_st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⋅</span> U <span class="main">⟷</span> <span class="main">(</span><span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s_prod_im U_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> SUP_constant SUP_empty<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> U_par_st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∥</span> U <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we verify the relationships after Lemma 3.1.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> s_subid_iff1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⟷</span> <span class="free">R</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">=</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> s_subid_iff2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⟷</span> d <span class="free">R</span> <span class="main">=</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mrd_simp</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> p_subid_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⟷</span> <span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mrel_c_lattice.term_p_subid<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vec_iff1<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U <span class="main">=</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vec_iff2<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U <span class="main">=</span> <span class="free">R</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">Aa</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">AA</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> set<span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">v3</span></span><span class="main">⊆</span><span class="bound">x1</span><span class="main">.</span> <span class="main">(</span><span class="bound">x2</span><span class="main">,</span> <span class="bound">v3</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">x0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">AA</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="main">⊆</span> <span class="bound">x1</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x2</span><span class="main">,</span> <span class="skolem">AA</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">x0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
    <span class="keyword1"><span class="command">hence</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">AA</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="skolem">A</span> <span class="skolem">a</span> <span class="main">⊆</span> <span class="skolem">A</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">AA</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="skolem">A</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a1 U_par_st assms<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">aa</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">AA</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="skolem">A</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">aa</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">aa</span><span class="main">,</span> <span class="bound">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_id_st<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">AA</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="skolem">A</span> <span class="skolem">a</span> <span class="main">⊆</span> <span class="skolem">Aa</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">Aa</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> U_par_st assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vec_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U <span class="main">=</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vec_iff1 vec_iff2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ucl_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="bound">B</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">R</span> <span class="main">∥</span> U <span class="main">=</span> <span class="free">R</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nt_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> NC <span class="main">⟷</span> <span class="free">R</span> <span class="main">∩</span> NC <span class="main">=</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Next we provide a counterexample for the final paragraph of Section 3.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">∩</span> <span class="free">R</span> <span class="main">⋅</span> U <span class="main">=</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Next we present a counterexample for vectors mentioned before Lemma 9.3.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span>d <span class="free">R</span> <span class="main">⋅</span> U<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span>d <span class="free">S</span> <span class="main">⋅</span> U<span class="main">)</span> <span class="main">⋅</span> U <span class="main">=</span> <span class="main">(</span>d <span class="free">R</span> <span class="main">⋅</span> U<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span>d <span class="free">S</span> <span class="main">⋅</span> U<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Next we prove Tarski' rule (Lemma 9.3).›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tarski_aux<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span>  NC"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span> NC <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> NC<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> d <span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mrd_simp</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> d <span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> d <span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> <span class="free">A</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UN_constant<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span> NC <span class="main">⋅</span> <span class="main">(</span>d <span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> NC<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mrd_simp</span></span><span class="main">)</span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mrd_simp</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> UN_constant<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tarski<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"NC <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> NC<span class="main">)</span> <span class="main">=</span> NC"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> U_def p_id_def s_prod_im<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> assms tarski_aux subrelI<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we verify the assumptions of Proposition 9.8.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> d_assoc1<span class="main">:</span> <span class="quoted"><span class="quoted">"d <span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>d <span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d_def_expl mrel_c_lattice.d_def mrel_c_lattice.d_sub_id_ax test_assoc2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> d_meet_distr_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>d <span class="free">R</span> <span class="main">∩</span> d <span class="free">S</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">T</span> <span class="main">=</span> <span class="main">(</span>d <span class="free">R</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>d <span class="free">S</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mrd_simp</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 10.5.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> d <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> d <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> U <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> U<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> U<span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span><span class="main">)</span> <span class="main">=</span> d <span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⋅</span> d <span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∥</span> U <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> U<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> d <span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> d <span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> NC <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> NC<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span><span class="main">)</span> <span class="main">⋅</span> NC<span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> U_def p_id_def s_id_def s_prod_im<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"d <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> NC<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> NC<span class="main">)</span><span class="main">)</span> <span class="main">=</span> d <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> NC<span class="main">)</span> <span class="main">⋅</span> d <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> NC<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> U_def p_id_def s_prod_im p_prod_def d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∥</span> NC <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> NC<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> NC<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> NC<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> NC<span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>  <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> NC<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> NC<span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Terminal and Nonterminal Elements›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 11.4›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="main">{}</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s_prod_im p_id_def<span class="main">)</span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">∥</span> <span class="free">S</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 11.8.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span> 
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span> 
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 11.10.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="main">{}</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">⋅</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">{}</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="free">R</span> <span class="main">∥</span> <span class="free">T</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⊆</span> <span class="main">(</span><span class="free">S</span> <span class="main">∥</span> <span class="free">T</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="free">T</span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⊆</span> <span class="main">(</span><span class="free">T</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_id_def s_prod_im<span class="main">)</span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Corollary 11.12›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="main">{}</span> <span class="main">=</span> <span class="free">S</span> <span class="main">⋅</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="free">R</span> <span class="main">∥</span> <span class="free">T</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free">S</span> <span class="main">∥</span> <span class="free">T</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="free">S</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">⟹</span> <span class="main">(</span><span class="free">T</span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free">T</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">1<span class="hidden">⇩</span><sub>π</sub></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_id_def s_prod_im<span class="main">)</span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Multirelations, Proto-Quantales and Iteration›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> mrel_proto_quantale<span class="main">:</span> proto_quantale <span class="quoted"><span class="quoted">"<span class="keyword1">1<span class="hidden">⇩</span><sub>σ</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⋅)</span>"</span></span> <span class="quoted">Inter</span> <span class="quoted">Union</span> <span class="quoted"><span class="quoted">"<span class="main">(∩)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"U"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We reprove Corollary 13.2. because Isabelle does not pick it up from the quantale level.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> iso_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">S</span> <span class="main">∪</span> <span class="free">R</span> <span class="main">⋅</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monoI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> gfp_lfp_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"gfp <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">R</span> <span class="main">⋅</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∪</span> lfp <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">S</span> <span class="main">∪</span> <span class="free">R</span> <span class="main">⋅</span> <span class="bound">X</span><span class="main">)</span> <span class="main">⊆</span> gfp <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="free">S</span> <span class="main">∪</span> <span class="free">R</span> <span class="main">⋅</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lfp_le_gfp gfp_mono iso_prop<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Further Counterexamples›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 14,1. and 14.2›</span></span> 

<span class="keyword1"><span class="command">lemma</span></span>  <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">∥</span> <span class="free">R</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> 
   <span class="keyword1"><span class="command">nitpick</span></span>
   <span class="keyword1"><span class="command">oops</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">∥</span> <span class="free">S</span>"</span></span>
   <span class="keyword1"><span class="command">nitpick</span></span>
   <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">∥</span> <span class="free">S</span> <span class="main">∩</span> <span class="free">R</span> <span class="main">∥</span> <span class="free">T</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">∥</span> <span class="main">(</span><span class="free">S</span> <span class="main">∩</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">∥</span> <span class="free">T</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s_prod_im<span class="main">)</span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">R</span> <span class="main">∥</span> <span class="free">R</span> <span class="main">=</span> <span class="free">R</span><span class="main">;</span> <span class="free">S</span> <span class="main">∥</span> <span class="free">S</span> <span class="main">=</span> <span class="free">S</span><span class="main">;</span> <span class="free">T</span> <span class="main">∥</span> <span class="free">T</span> <span class="main">=</span> <span class="free">T</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">∥</span> <span class="free">T</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">R</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> <span class="free">R</span> <span class="main">∪</span> <span class="free">S</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">∥</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">quickcheck</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">R</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> <span class="free">R</span> <span class="main">∪</span> <span class="free">S</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">R</span> <span class="main">∥</span> <span class="free">S</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">quickcheck</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">R</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="free">T</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> <span class="free">R</span> <span class="main">∪</span> <span class="free">S</span> <span class="main">∪</span> <span class="free">T</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">R</span> <span class="main">∥</span> <span class="free">S</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">T</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">∥</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">quickcheck</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">R</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="free">T</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> <span class="free">R</span> <span class="main">∪</span> <span class="free">S</span> <span class="main">∪</span> <span class="free">T</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">R</span> <span class="main">∥</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="free">T</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">R</span> <span class="main">∥</span> <span class="free">S</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">T</span>"</span></span> 
  <span class="keyword1"><span class="command">quickcheck</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">R</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="free">T</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> <span class="free">R</span> <span class="main">∪</span> <span class="free">S</span> <span class="main">∪</span> <span class="free">T</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">∥</span> <span class="free">T</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">∥</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">quickcheck</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">R</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="free">T</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> <span class="free">R</span> <span class="main">∪</span> <span class="free">S</span> <span class="main">∪</span> <span class="free">T</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">∥</span> <span class="free">T</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">∥</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">quickcheck</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">R</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> <span class="free">R</span> <span class="main">∪</span> <span class="free">S</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">R</span> <span class="main">∥</span> <span class="free">S</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">R</span> <span class="main">∥</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">quickcheck</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">R</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> <span class="free">R</span> <span class="main">∪</span> <span class="free">S</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">R</span><span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">S</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">R</span> <span class="main">∥</span> <span class="free">S</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">R</span> <span class="main">∥</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">quickcheck</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Relationship with Up-Closed Multirelations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now define Parikh's sequential composition.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">s_prod_pa</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mrel <span class="main">⇒</span> <span class="tfree">'a</span> mrel <span class="main">⇒</span> <span class="tfree">'a</span> mrel"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊗</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main"><span class="free">⊗</span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We show that Parikh's definition doesn't preserve up-closure.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> up_closed_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">∥</span> U<span class="main">)</span><span class="main">)</span> <span class="main">∥</span> U <span class="main">=</span> <span class="main">(</span><span class="free">R</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">∥</span> U<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_prod_def s_prod_pa_def U_def<span class="main">)</span>
  <span class="keyword1"><span class="command">nitpick</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemma 15.1.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> onelem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">∥</span> U <span class="main">⊆</span> <span class="free">R</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">S</span> <span class="main">∥</span> U<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s_prod_im p_prod_def U_def s_prod_pa_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> twolem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">S</span> <span class="main">∥</span> U<span class="main">)</span>  <span class="main">⊆</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">∥</span> U"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">A</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">S</span> <span class="main">∥</span> U<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∥</span> U<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s_prod_pa_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="bound">C</span> <span class="main">⊆</span> <span class="skolem">A</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">C</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> U_par_st<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">b</span> <span class="main">⊆</span> <span class="skolem">A</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">f</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="bound">C</span> <span class="main">⊆</span> <span class="skolem">A</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">f</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="bound">C</span> <span class="main">⊆</span> <span class="skolem">A</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="bound">C</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span>"</span></span>     
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">∥</span> U"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> U_par_st<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pe_pa_sim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">⋅</span> <span class="free">S</span><span class="main">)</span> <span class="main">∥</span> U <span class="main">=</span> <span class="free">R</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">S</span> <span class="main">∥</span> U<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antisym onelem twolem<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pe_pa_sim_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">S</span> <span class="main">∥</span> U<span class="main">)</span><span class="main">)</span> <span class="main">∥</span> U <span class="main">=</span> <span class="main">(</span><span class="free">R</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">S</span> <span class="main">∥</span> U<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mrel_proto_trioid.mult_assoc pe_pa_sim<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pa_assoc1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">S</span> <span class="main">∥</span> U<span class="main">)</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">T</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">R</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">T</span> <span class="main">∥</span> U<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_prod_def s_prod_pa_def U_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The converse direction of associativity remains to be proved.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Corollary 15.3.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> up_closed_par_is_meet<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">∥</span> <span class="main">(</span><span class="free">S</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">R</span> <span class="main">∥</span> U<span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="free">S</span> <span class="main">∥</span> U<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">mr_simp</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>