<div id="Pi_Transcendental_Polynomial_Library">
<div class="head">
<h1>Theory Pi_Transcendental_Polynomial_Library</h1>
</div>
<pre class="source"><span class="comment1">(*
   File:      Pi_Transcendental_Polynomial_Library
   Author:    Manuel Eberl, TU München

   Various facts about univariate polynomials and some other things that probably belong in 
   the distribution.
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Preliminary facts›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Pi_Transcendental_Polynomial_Library
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Computational_Algebra.html">HOL-Computational_Algebra.Computational_Algebra</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* TODO: Move all this *)</span>
<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-Ints_sum"><span class="command">lemma</span></span> Ints_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">ℤ</span><span class="main">)</span> <span class="main">⟹</span> sum <span class="free">f</span> <span class="free">A</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-Ints_prod"><span class="command">lemma</span></span> Ints_prod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">ℤ</span><span class="main">)</span> <span class="main">⟹</span> prod <span class="free">f</span> <span class="free">A</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-sum_in_Rats"><span class="command">lemma</span></span> sum_in_Rats <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">)</span> <span class="main">⟹</span> sum <span class="free">f</span> <span class="free">A</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-prod_in_Rats"><span class="command">lemma</span></span> prod_in_Rats <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">)</span> <span class="main">⟹</span> prod <span class="free">f</span> <span class="free">A</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-poly_cnj"><span class="command">lemma</span></span> poly_cnj<span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span>poly <span class="free">p</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> poly <span class="main">(</span>map_poly cnj <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cnj <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_altdef degree_map_poly coeff_map_poly<span class="main">)</span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-poly_cnj_real"><span class="command">lemma</span></span> poly_cnj_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> poly.coeff <span class="free">p</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"cnj <span class="main">(</span>poly <span class="free">p</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> poly <span class="free">p</span> <span class="main">(</span>cnj <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map_poly cnj <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> poly_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_map_poly Reals_cnj_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> poly_cnj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-real_poly_cnj_root_iff"><span class="command">lemma</span></span> real_poly_cnj_root_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> poly.coeff <span class="free">p</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">(</span>cnj <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="free">p</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">(</span>cnj <span class="free">z</span><span class="main">)</span> <span class="main">=</span> cnj <span class="main">(</span>poly <span class="free">p</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_cnj_real assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="free">p</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-coeff_pcompose_linear"><span class="command">lemma</span></span> coeff_pcompose_linear<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>pcompose <span class="free">p</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">c</span><span class="main">:]</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="free">c</span> <span class="main">^</span> <span class="free">i</span> <span class="main">*</span> coeff <span class="free">p</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pcompose_pCons coeff_pCons mult_ac <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-coeff_pCons'"><span class="command">lemma</span></span> coeff_pCons'<span class="main">:</span> <span class="quoted"><span class="quoted">"poly.coeff <span class="main">(</span>pCons <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">c</span> <span class="keyword1">else</span> poly.coeff <span class="free">p</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-prod_smult"><span class="command">lemma</span></span> prod_smult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> Polynomial.smult <span class="main">(</span><span class="free">c</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Polynomial.smult <span class="main">(</span>prod <span class="free">c</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>prod <span class="free">p</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-degree_higher_pderiv"><span class="command">lemma</span></span> degree_higher_pderiv<span class="main">:</span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Polynomial.degree <span class="free">p</span> <span class="main">-</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_semiring_1<span class="main">,</span>semiring_no_zero_divisors<span class="main">,</span>semiring_char_0<span class="main">}</span> poly"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_pderiv<span class="main">)</span>
  
<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-sum_to_poly"><span class="command">lemma</span></span> sum_to_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">[:</span><span class="free">f</span> <span class="bound">x</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-diff_to_poly"><span class="command">lemma</span></span> diff_to_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">c</span><span class="main">:]</span> <span class="main">-</span> <span class="main">[:</span><span class="free">d</span><span class="main">:]</span> <span class="main">=</span> <span class="main">[:</span><span class="free">c</span> <span class="main">-</span> <span class="free">d</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_eq_iff mult_ac<span class="main">)</span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-mult_to_poly"><span class="command">lemma</span></span> mult_to_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">c</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="free">d</span><span class="main">:]</span> <span class="main">=</span> <span class="main">[:</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_eq_iff mult_ac<span class="main">)</span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-prod_to_poly"><span class="command">lemma</span></span> prod_to_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">[:</span><span class="free">f</span> <span class="bound">x</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_to_poly mult_ac<span class="main">)</span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-coeff_mult_0"><span class="command">lemma</span></span> coeff_mult_0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly.coeff <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> poly.coeff <span class="free">p</span> <span class="main">0</span> <span class="main">*</span> poly.coeff <span class="free">q</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_mult<span class="main">)</span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-card_poly_roots_bound"><span class="command">lemma</span></span> card_poly_roots_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">,</span>ring_no_zero_divisors<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">≤</span> degree <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> poly_eq_0_iff_dvd<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">=</span> Suc <span class="main">(</span>degree <span class="skolem">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> q<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> degree_mult_eq<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">≤</span> card <span class="main">(</span>insert <span class="skolem">x</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> poly_roots_finite <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> q<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> Suc <span class="main">(</span>card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_insert_le_m1<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> deg <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">≤</span> degree <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> less<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">…</span> <span class="main">=</span> degree <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-poly_eqI_degree"><span class="command">lemma</span></span> poly_eqI_degree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_ring_1<span class="main">,</span> ring_no_zero_divisors<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> poly <span class="free">q</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">&gt;</span> degree <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">&gt;</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> max <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">(</span>degree <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_diff_le_max<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> card <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> neq <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_mono poly_roots_finite<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">≥</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> neq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_poly_roots_bound<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-poly_root_order_induct"><span class="command">lemma</span></span> poly_root_order_induct <span class="main">[</span><span class="operator">case_names</span> 0 no_roots root<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">p</span>"</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">x</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">p</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">*</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> 3
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> order <span class="skolem">x</span> <span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order_1<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> order <span class="skolem">x</span> <span class="skolem">p</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> order_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order_root<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="skolem">p</span> <span class="main">=</span> order <span class="skolem">x</span> <span class="skolem">p</span> <span class="main">+</span> order <span class="skolem">x</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> q<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> order_mult<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order_power_n_n<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">=</span> order <span class="skolem">x</span> <span class="skolem">p</span> <span class="main">+</span> degree <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> q<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> degree_mult_eq<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_power_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> order_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">&lt;</span> degree <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> less<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> order_pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> order <span class="skolem">x</span> <span class="skolem">p</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order_root<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> q <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-complex_poly_decompose"><span class="command">lemma</span></span> complex_poly_decompose<span class="main">:</span>
  <span class="quoted"><span class="quoted">"smult <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">z</span></span><span class="main">|</span>poly <span class="free">p</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> order <span class="bound">z</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">::</span> complex poly<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> poly_root_order_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>no_roots <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>constant <span class="main">(</span>poly <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> constant_degree<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> fundamental_theorem_of_algebra <span class="keyword2"><span class="keyword">and</span></span> no_roots <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> degree_eq_zeroE<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>root <span class="skolem">p</span> <span class="skolem">x</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> root <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">z</span><span class="main">.</span> poly <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> insert <span class="skolem">x</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span>lead_coeff <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> 
           <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">z</span></span><span class="main">|</span>poly <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> order <span class="bound">z</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
        <span class="main">[:</span><span class="main">-</span> <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> order <span class="skolem">x</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> 
          smult <span class="main">(</span>lead_coeff <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">z</span><span class="main">∈</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> order <span class="bound">z</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> prod.insert<span class="main">)</span> 
       <span class="main">(</span><span class="operator">insert</span> root<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> poly_roots_finite <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_ac lead_coeff_mult lead_coeff_power<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> root <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> order_mult<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order_power_n_n order_0I<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">z</span><span class="main">∈</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> order <span class="bound">z</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∏</span><span class="bound">z</span><span class="main">∈</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> order <span class="bound">z</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> root <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">y</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order_0I<span class="main">)</span> <span class="operator">auto</span> 
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> root <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> order_mult<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> root.IH
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-order_pos_iff"><span class="command">lemma</span></span> order_pos_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> order <span class="free">a</span> <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> order_root<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lift_definition</span></span> poly_roots_mset <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> idom<span class="main">)</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> multiset"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Polynomial.order <span class="bound">x</span> <span class="bound">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> order <span class="bound">x</span> <span class="skolem">p</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order_pos_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ poly_roots_finite<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-poly_roots_mset_0"><span class="command">lemma</span></span> poly_roots_mset_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_roots_mset <span class="main">0</span> <span class="main">=</span> <span class="main">{#}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="operator">auto</span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-count_poly_roots_mset"><span class="command">lemma</span></span> count_poly_roots_mset <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> count <span class="main">(</span>poly_roots_mset <span class="free">p</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> order <span class="free">a</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer'</span> <span class="operator">auto</span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-set_count_poly_roots_mset"><span class="command">lemma</span></span> set_count_poly_roots_mset <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> set_mset <span class="main">(</span>poly_roots_mset <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_mset_def order_pos_iff<span class="main">)</span>


<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-image_prod_mset_multiplicity"><span class="command">lemma</span></span> image_prod_mset_multiplicity<span class="main">:</span>
  <span class="quoted"><span class="quoted">"prod_mset <span class="main">(</span>image_mset <span class="free">f</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> prod <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">^</span> count <span class="free">M</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>set_mset <span class="free">M</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>add <span class="skolem">x</span> <span class="skolem">M</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set_mset <span class="skolem">M</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">y</span><span class="main">∈</span>set_mset <span class="main">(</span>add_mset <span class="skolem">x</span> <span class="skolem">M</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">^</span> count <span class="main">(</span>add_mset <span class="skolem">x</span> <span class="skolem">M</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> 
            <span class="main">(</span><span class="main">∏</span><span class="bound">y</span><span class="main">∈</span>set_mset <span class="skolem">M</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="skolem">x</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">^</span> count <span class="skolem">M</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> True add <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">y</span><span class="main">∈</span>set_mset <span class="skolem">M</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">^</span> count <span class="skolem">M</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.distrib<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> add.IH <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">y</span><span class="main">∈</span>set_mset <span class="main">(</span>add_mset <span class="skolem">x</span> <span class="skolem">M</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">^</span> count <span class="main">(</span>add_mset <span class="skolem">x</span> <span class="skolem">M</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span>
              <span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">y</span><span class="main">∈</span>set_mset <span class="skolem">M</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">^</span> count <span class="main">(</span>add_mset <span class="skolem">x</span> <span class="skolem">M</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_in_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">y</span><span class="main">∈</span>set_mset <span class="skolem">M</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">^</span> count <span class="main">(</span>add_mset <span class="skolem">x</span> <span class="skolem">M</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> 
                 <span class="main">(</span><span class="main">∏</span><span class="bound">y</span><span class="main">∈</span>set_mset <span class="skolem">M</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">^</span> count <span class="skolem">M</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> add.IH <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-complex_poly_decompose_multiset"><span class="command">lemma</span></span> complex_poly_decompose_multiset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"smult <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈#</span>poly_roots_mset <span class="free">p</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">::</span> complex poly<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈#</span>poly_roots_mset <span class="free">p</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">x</span></span> <span class="main">|</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> order <span class="bound">x</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> image_prod_mset_multiplicity<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">…</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> complex_poly_decompose<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> monoid_add<span class="main">)</span> prod_list_prod_nth<span class="main">:</span>
  <span class="quoted"><span class="quoted">"prod_list <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">xs</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod_list <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.distinct_set_conv_list <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-prod_zero_iff'"><span class="command">lemma</span></span> prod_zero_iff'<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> prod <span class="free">f</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> <span class="main">{</span>comm_semiring_1<span class="main">,</span> semiring_no_zero_divisors<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-degree_prod_eq"><span class="command">lemma</span></span> degree_prod_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> degree <span class="main">(</span>prod <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> degree <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>comm_semiring_1<span class="main">,</span> semiring_no_zero_divisors<span class="main">}</span> poly"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_mult_eq prod_zero_iff'<span class="main">)</span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-lead_coeff_prod"><span class="command">lemma</span></span> lead_coeff_prod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> lead_coeff <span class="main">(</span>prod <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> lead_coeff <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> <span class="main">{</span>comm_semiring_1<span class="main">,</span> semiring_no_zero_divisors<span class="main">}</span> poly"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lead_coeff_mult prod_zero_iff'<span class="main">)</span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-complex_poly_decompose'"><span class="command">lemma</span></span> complex_poly_decompose'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">root</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span>degree <span class="free">p</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="free">root</span> <span class="bound">i</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">::</span> complex poly<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">roots</span></span> <span class="keyword2"><span class="keyword">where</span></span> roots<span class="main">:</span> <span class="quoted"><span class="quoted">"mset <span class="skolem">roots</span> <span class="main">=</span> poly_roots_mset <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_mset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> smult <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈#</span>poly_roots_mset <span class="free">p</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> complex_poly_decompose_multiset <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈#</span>poly_roots_mset <span class="free">p</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">←</span><span class="skolem">roots</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod_mset_prod_list <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> roots<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span>length <span class="skolem">roots</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">roots</span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod_list_prod_nth<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> atLeast0LessThan<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> smult <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span>length <span class="skolem">roots</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">roots</span> <span class="main">!</span> <span class="bound">i</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> length <span class="skolem">roots</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> roots <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eq<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_prod_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">roots</span></span></span> <span class="main"><span class="main"><span class="main">!</span></span></span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-rsquarefree_root_order"><span class="command">lemma</span></span> rsquarefree_root_order<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rsquarefree <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"order <span class="free">z</span> <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">z</span> <span class="free">p</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rsquarefree_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="free">z</span> <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order_root<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"order <span class="free">z</span> <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-complex_poly_decompose_rsquarefree"><span class="command">lemma</span></span> complex_poly_decompose_rsquarefree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rsquarefree <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"smult <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">z</span></span><span class="main">|</span>poly <span class="free">p</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">::</span> complex poly<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">z</span></span><span class="main">|</span>poly <span class="free">p</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">z</span></span><span class="main">|</span>poly <span class="free">p</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> order <span class="bound">z</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rsquarefree_root_order<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">…</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> complex_poly_decompose<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>  


<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-pcompose_conjugates_integer"><span class="command">lemma</span></span> pcompose_conjugates_integer<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> poly.coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"poly.coeff <span class="main">(</span>pcompose <span class="free">p</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="keyword1">𝗂</span><span class="main">:]</span> <span class="main">*</span> pcompose <span class="free">p</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="keyword1">𝗂</span><span class="main">:]</span><span class="main">)</span> <span class="free">i</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> poly.coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">::</span> complex"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly.coeff <span class="main">(</span>pcompose <span class="free">p</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="keyword1">𝗂</span><span class="main">:]</span> <span class="main">*</span> pcompose <span class="free">p</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="keyword1">𝗂</span><span class="main">:]</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span>
          <span class="keyword1">𝗂</span> <span class="main">^</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">i</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="var">?c</span> <span class="bound">k</span> <span class="main">*</span> <span class="var">?c</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> coeff_mult sum_distrib_left
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_mult coeff_pcompose_linear power_minus' 
                                    power_diff <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ints_sum<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">i</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="var">?c</span> <span class="bound">k</span> <span class="main">*</span> <span class="var">?c</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">i</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">k</span> <span class="main">*</span> <span class="var">?c</span> <span class="bound">k</span> <span class="main">*</span> <span class="var">?c</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S1</span> <span class="main">=</span> <span class="var">?S2</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">k</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">i</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="bound"><span class="bound"><span class="bound">k</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">k</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">i</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="bound"><span class="bound"><span class="bound">k</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S1</span> <span class="main">=</span> <span class="main">(</span><span class="var">?S1</span> <span class="main">+</span> <span class="var">?S2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">i</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?c</span> <span class="bound">k</span> <span class="main">*</span> <span class="var">?c</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_distribs sum.distrib sum_divide_distrib <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">i</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">i</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">k</span> <span class="main">*</span> <span class="var">?c</span> <span class="bound">k</span> <span class="main">*</span> <span class="var">?c</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_add power_diff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">^</span> <span class="free">i</span> <span class="main">*</span> <span class="main">…</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"even <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Ints_mult Ints_sum assms<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> evenE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> oddE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_mult<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-algebraic_times_i"><span class="command">lemma</span></span> algebraic_times_i<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> algebraicE<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> pcompose <span class="skolem">p</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="keyword1">𝗂</span><span class="main">:]</span> <span class="main">*</span> pcompose <span class="skolem">p</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="keyword1">𝗂</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p'</span> <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p'_def poly_pcompose <span class="dynamic"><span class="dynamic">algebra_simps</span></span> p <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> pcompose_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> poly.coeff <span class="skolem">p'</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> allI pcompose_conjugates_integer<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> algebraicI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p'</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-algebraic_times_i_iff"><span class="command">lemma</span></span> algebraic_times_i_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> algebraic <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> algebraic_times_i<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main">]</span> algebraic_times_i<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">𝗂</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">x</span></span>"</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Pi_Transcendental_Polynomial_Library-ratpolyE"><span class="command">lemma</span></span> ratpolyE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> poly.coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">q</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> map_poly of_rat <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..</span>Polynomial.degree <span class="free">p</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> poly.coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">=</span> of_rat <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Rats_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> bchoice<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> Polynomial.degree <span class="free">p</span> <span class="main">⟹</span> poly.coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">=</span> of_rat <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> Poly <span class="main">(</span>map <span class="skolem">f</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Polynomial.degree <span class="free">p</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> map_poly of_rat <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> poly_eqI<span class="main">)</span> 
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_map_poly q_def nth_default_def f coeff_eq_0 <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> upt_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Pi_Transcendental">
<div class="head">
<h1>Theory Pi_Transcendental</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:      Pi_Transcendendtal.thy
    Author:    Manuel Eberl, TU München

   A proof of the transcendence of pi
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Transcendence of $\pi$›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Pi_Transcendental
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../E_Transcendental/E_Transcendental.html">E_Transcendental.E_Transcendental</a>"</span>
  <span class="quoted">"<a href="../Symmetric_Polynomials/Symmetric_Polynomials.html">Symmetric_Polynomials.Symmetric_Polynomials</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Real_Asymp/Real_Asymp.html">HOL-Real_Asymp.Real_Asymp</a>"</span> 
  <a href="Pi_Transcendental_Polynomial_Library.html">Pi_Transcendental_Polynomial_Library</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Pi_Transcendental-ring_homomorphism_to_poly"><span class="command">lemma</span></span> ring_homomorphism_to_poly <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">[:</span><span class="bound">i</span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ring_closed<span class="main">)</span> coeff_power_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> coeff <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="free">m</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mpoly_coeff_1 coeff_mpoly_times <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prod_fun_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ring_closed<span class="main">)</span> coeff_prod_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> coeff <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> coeff <span class="main">(</span>prod <span class="free">f</span> <span class="free">X</span><span class="main">)</span> <span class="free">m</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mpoly_coeff_1 coeff_mpoly_times <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prod_fun_closed<span class="main">)</span>

<span class="keyword1" id="Pi_Transcendental-map_of_rat_of_int_poly"><span class="command">lemma</span></span> map_of_rat_of_int_poly <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map_poly of_rat <span class="main">(</span>of_int_poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> of_int_poly <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> poly_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_map_poly<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Given a polynomial with rational coefficients, we can obtain an integer polynomial that
  differs from it only by a nonzero constant by clearing the denominators.
›</span></span>
<span class="keyword1" id="Pi_Transcendental-ratpoly_to_intpoly"><span class="command">lemma</span></span> ratpoly_to_intpoly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> poly.coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">q</span> <span class="free">c</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Polynomial.smult <span class="main">(</span>inverse <span class="main">(</span>of_nat <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_int_poly <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> map_poly of_rat <span class="skolem">p'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ratpolyE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> Lcm <span class="main">(</span><span class="main">(</span>nat <span class="main">∘</span> snd <span class="main">∘</span> quotient_of <span class="main">∘</span> poly.coeff <span class="skolem">p'</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..</span>Polynomial.degree <span class="skolem">p'</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>snd <span class="main">(</span>quotient_of <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> quotient_of_denom_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">,</span> <span class="operator">OF</span> surjective_pairing<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> Polynomial.smult <span class="main">(</span>of_nat <span class="skolem">c</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly.coeff <span class="skolem">q</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&gt;</span> Polynomial.degree <span class="skolem">p'</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">n</span></span> 
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> fst <span class="main">(</span>quotient_of <span class="main">(</span>poly.coeff <span class="skolem">p'</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> nat <span class="main">(</span>snd <span class="main">(</span>quotient_of <span class="main">(</span>poly.coeff <span class="skolem">p'</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> mn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly.coeff <span class="skolem">p'</span> <span class="skolem">i</span> <span class="main">=</span> of_int <span class="skolem">m</span> <span class="main">/</span> of_nat <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> quotient_of_denom_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"poly.coeff <span class="skolem">p'</span> <span class="skolem">i</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> surjective_pairing<span class="main">]</span>
            quotient_of_div<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"poly.coeff <span class="skolem">p'</span> <span class="skolem">i</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> surjective_pairing<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> m_def n_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="keyword1">dvd</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_Lcm<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> c_def n_def o_def not_less<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span>of_int <span class="skolem">m</span> <span class="main">/</span> of_nat <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>of_nat <span class="main">(</span><span class="skolem">c</span> <span class="keyword1">div</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> of_int <span class="skolem">m</span> <span class="main">::</span> rat<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_nat_div<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> q_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> q_def coeff_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> int_polyE <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> q'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> of_int_poly <span class="skolem">q'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Polynomial.smult <span class="main">(</span>inverse <span class="main">(</span>of_nat <span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map_poly of_rat <span class="main">(</span>of_int_poly <span class="skolem">q'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> smult_conv_map_poly q'<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> p' <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> poly_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_map_poly q_def of_rat_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> q' p' <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">q'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Pi_Transcendental-symmetric_mpoly_symmetric_sum"><span class="command">lemma</span></span> symmetric_mpoly_symmetric_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">π</span><span class="main">.</span> <span class="bound">π</span> <span class="keyword1">permutes</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">π</span> <span class="keyword1">permutes</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">π</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="bound">π</span> <span class="keyword1">permutes</span> <span class="free">A</span> <span class="main">⟹</span> mpoly_map_vars <span class="bound">π</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">π</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> symmetric_mpoly_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">π</span> <span class="keyword3"><span class="command">assume</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">π</span> <span class="main">(</span>sum <span class="free">f</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> mpoly_map_vars <span class="skolem">π</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">π</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong assms π refl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">g</span> <span class="skolem">π</span><span class="main">`</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> π<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.reindex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">π</span> <span class="main">`</span> <span class="free">X</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> π<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_image<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">π</span> <span class="main">(</span>sum <span class="free">f</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> sum <span class="free">f</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* TODO: The version of this theorem in the AFP is to weak and should be replaced by this one. *)</span>
<span class="keyword1" id="Pi_Transcendental-symmetric_mpoly_symmetric_prod"><span class="command">lemma</span></span> symmetric_mpoly_symmetric_prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">permutes</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">π</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="bound">π</span> <span class="keyword1">permutes</span> <span class="free">A</span> <span class="main">⟹</span> mpoly_map_vars <span class="bound">π</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="free">A</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> symmetric_mpoly_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">π</span> <span class="keyword3"><span class="command">assume</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">π</span> <span class="main">(</span>prod <span class="free">f</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> mpoly_map_vars <span class="skolem">π</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong assms π refl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">g</span><span class="main">`</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.reindex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">`</span> <span class="free">X</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> permutes_image<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">π</span> <span class="main">(</span>prod <span class="free">f</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> prod <span class="free">f</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now prove the transcendence of $i\pi$, from which the transcendence of $\pi$ will follow
  as a trivial corollary. The first proof of this was given by von Lindemann~\cite{lindemann_pi82}.
  The central ingredient is the fundamental theorem of symmetric functions.

  The proof can, by now, be considered folklore and one can easily find many similar variants of
  it, but we mostly follows the nice exposition given by Niven~\cite{niven_pi39}.

  An independent previous formalisation in Coq that uses the same basic techniques was given by
  Bernard et al.~\cite{bernard_pi16}. They later also formalised the much stronger
  Lindemann--Weierstra{\ss} theorem~\cite{bernard_lw17}.
›</span></span>
<span class="keyword1" id="Pi_Transcendental-transcendental_i_pi"><span class="command">lemma</span></span> transcendental_i_pi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>algebraic <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="comment1">― ‹Suppose $i\pi$ were algebraic.›</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
  <span class="comment1">― ‹We obtain some nonzero integer polynomial that has $i\pi$ as a root. We can assume
      w.\,l.\,o.\,g.\ that the constant coefficient of this polynomial is nonzero.›</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>of_int_poly <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly.coeff <span class="skolem">p</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> algebraicE'_nonzero<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Polynomial.degree <span class="skolem">p</span>"</span></span>

  <span class="comment1">― ‹We define the sequence of the roots of this polynomial:›</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">root</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Polynomial.smult <span class="main">(</span>Polynomial.lead_coeff <span class="main">(</span>of_int_poly <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">root</span> <span class="bound">i</span> <span class="main">::</span> complex<span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> of_int_poly <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> complex_poly_decompose'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_int_poly <span class="skolem">p</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> root <span class="main">=</span> this <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>

  <span class="comment1">― ‹We note that $i\pi$ is, of course, among these roots.›</span>
  <span class="keyword1"><span class="command">from</span></span> p <span class="keyword2"><span class="keyword">and</span></span> root <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">idx</span></span> <span class="keyword2"><span class="keyword">where</span></span> idx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">idx</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">root</span> <span class="skolem">idx</span> <span class="main">=</span> <span class="keyword1">𝗂</span> <span class="main">*</span> pi"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_prod<span class="main">)</span>

  <span class="comment1">― ‹We now define a new polynomial <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>P'›</span></span>, whose roots are all numbers that arise as a
      sum of any subset of roots of <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>p›</span></span>. We also count all those subsets that sum up to 0
      and call their number <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>A›</span></span>.›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">root'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">root'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="skolem">root</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">∏</span><span class="bound"><span class="bound">X</span></span> <span class="main">|</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="bound">i</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">root'</span> <span class="bound">X</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> card <span class="main">{</span><span class="bound"><span class="bound">X</span></span><span class="main">∈</span>Pow <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">root'</span> <span class="bound">X</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P'_def P_def<span class="main">)</span>

  <span class="comment1">― ‹We give the name <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>Roots'›</span></span> to those subsets that do not sum to zero and note that there
      is at least one, namely $\{i\pi\}$.›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Roots'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Roots'</span> <span class="main">=</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">root'</span> <span class="bound">X</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Roots'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">idx</span><span class="main">}</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> idx <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots'_def root'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Roots'</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> card_Roots'<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">Roots'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_eq_0_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> P'_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">X</span><span class="main">∈</span>Pow <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">root'</span> <span class="bound">X</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">root'</span> <span class="bound">X</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> P'_def P_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.Sigma<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">X</span><span class="main">∈</span>Pow<span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">root'</span> <span class="bound">X</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> card_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">X</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span>card <span class="bound"><span class="bound"><span class="bound">X</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">X</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="bound"><span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">X</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">X</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold card_gt_0_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="comment1">― ‹Clearly, <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">A</span></span><span class="antiquote">}</span></span> is nonzero, since the empty set sums to 0.›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">X</span></span><span class="main">∈</span>Pow <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">root'</span> <span class="bound">X</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> root'_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A_def card_gt_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="comment1">― ‹Since $e^{i\pi} + 1 = 0$, we know the following:›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> exp <span class="main">(</span><span class="skolem">root</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> idx <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="comment1">― ‹We rearrange this product of sums into a sum of products and collect all summands that are
      1 into a separate sum, which we call <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">A</span></span><span class="antiquote">}</span></span>:›</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span>Pow <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> exp <span class="main">(</span><span class="skolem">root</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod_add<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span>Pow <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> exp <span class="main">(</span><span class="skolem">root'</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> exp_sum <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> root'_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pow <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">X</span></span><span class="main">∈</span>Pow <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">root'</span> <span class="bound">X</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound"><span class="bound">X</span></span><span class="main">∈</span>Pow <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">root'</span> <span class="bound">X</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">X</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> exp <span class="main">(</span><span class="skolem">root'</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">X</span></span> <span class="main">|</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">root'</span> <span class="bound">X</span> <span class="main">≠</span> <span class="main">0</span><span class="main">.</span> exp <span class="main">(</span><span class="skolem">root'</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                                       <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">X</span></span> <span class="main">|</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">root'</span> <span class="bound">X</span> <span class="main">=</span> <span class="main">0</span><span class="main">.</span> exp <span class="main">(</span><span class="skolem">root'</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">X</span></span> <span class="main">|</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">root'</span> <span class="bound">X</span> <span class="main">=</span> <span class="main">0</span><span class="main">.</span> exp <span class="main">(</span><span class="skolem">root'</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_def<span class="main">)</span>
  <span class="comment1">― ‹Finally, we obtain the fact that the sum of $\exp(u)$ with $u$ ranging over all the non-zero
      roots of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">P'</span></span><span class="antiquote">}</span></span> is a negative integer.›</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">X</span></span> <span class="main">|</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">root'</span> <span class="bound">X</span> <span class="main">≠</span> <span class="main">0</span><span class="main">.</span> exp <span class="main">(</span><span class="skolem">root'</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>of_nat <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_eq_0_iff2<span class="main">)</span>

  <span class="comment1">― ‹Next, we show that <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>P'›</span></span> is a rational polynomial since it can be written as a symmetric
      polynomial expression (with rational coefficients) in the roots of <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>p›</span></span>.›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ratpolys</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ratpolys</span> <span class="main">=</span> <span class="main">{</span><span class="bound">p</span><span class="main">::</span>complex poly<span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> poly.coeff <span class="bound">p</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ratpolysI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">ratpolys</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> poly.coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ratpolys_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">∈</span> <span class="skolem">ratpolys</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Pmv</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex poly mpoly"</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Pmv</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">∏</span><span class="bound"><span class="bound">X</span></span> <span class="main">|</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="bound">i</span><span class="main">.</span> Const <span class="main">(</span><span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">-</span>
                          <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> monom <span class="main">(</span>Poly_Mapping.single <span class="bound">i</span> <span class="main">1</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P'mv</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'mv</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">Pmv</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">[:</span><span class="skolem">root</span> <span class="bound">i</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">P'mv</span> <span class="main">∈</span> <span class="skolem">ratpolys</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> symmetric_poly_of_roots_in_subring<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> l <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">[:</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">:]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ring_closed <span class="skolem">ratpolys</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ratpolys_def coeff_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> ring_closed <span class="quoted"><span class="skolem">ratpolys</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> coeff <span class="skolem">P'mv</span> <span class="bound">m</span> <span class="main">∈</span> <span class="skolem">ratpolys</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P'mv_def Pmv_def coeff_monom when_def mpoly_coeff_Const coeff_pCons' ratpolysI
                 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> coeff_prod_closed minus_closed sum_closed uminus_closed<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">[:</span>poly.coeff <span class="main">(</span>of_int_poly <span class="skolem">p</span><span class="main">)</span> <span class="bound">i</span><span class="main">:]</span> <span class="main">∈</span> <span class="skolem">ratpolys</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ratpolysI allI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_pCons'<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span>inverse <span class="main">(</span>of_int <span class="main">(</span>Polynomial.lead_coeff <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">:]</span> <span class="main">*</span>
              <span class="main">[:</span>of_int <span class="main">(</span>Polynomial.lead_coeff <span class="skolem">p</span><span class="main">)</span> <span class="main">::</span> complex<span class="main">:]</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> poly_eqI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">(</span><span class="skolem">Pmv</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
        <span class="keyword1"><span class="command">unfolding</span></span> symmetric_mpoly_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">π</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword3"><span class="command">assume</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">π</span> <span class="main">(</span><span class="skolem">Pmv</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">X</span></span> <span class="main">|</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">.</span> Const <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">-</span>
                    <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> MPoly_Type.monom <span class="main">(</span>Poly_Mapping.single <span class="main">(</span><span class="skolem">π</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Pmv_def permutes_bij<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound"><span class="bound">X</span></span> <span class="main">|</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">.</span> Const <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">-</span>
                          <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">π</span><span class="main">`</span><span class="bound">X</span><span class="main">.</span> MPoly_Type.monom <span class="main">(</span>Poly_Mapping.single <span class="bound">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> π <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.reindex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_inj_on<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">X</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="skolem">π</span><span class="main">`</span><span class="bound">X</span><span class="main">)</span><span class="main">`</span><span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">}</span><span class="main">.</span> Const <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">-</span>
                          <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> MPoly_Type.monom <span class="main">(</span>Poly_Mapping.single <span class="bound">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.reindex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> inj_on_image permutes_inj_on<span class="main"><span class="main">[</span></span><span class="operator">OF</span> π<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="skolem">π</span><span class="main">`</span><span class="bound">X</span><span class="main">)</span><span class="main">`</span><span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="skolem">π</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> π <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> image_image_fixed_card_subset<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_inj_on<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> permutes_image π<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mpoly_map_vars <span class="skolem">π</span> <span class="main">(</span><span class="skolem">Pmv</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Pmv</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Pmv_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="skolem">P'mv</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> P'mv_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> symmetric_mpoly_prod<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> vars_P'mv<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="skolem">P'mv</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> P'mv_def Pmv_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_prod<span class="main"><span class="main">]</span></span> UN_least order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_diff<span class="main"><span class="main">]</span></span>
                   Un_least order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_sum<span class="main"><span class="main">]</span></span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_monom_subset<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> root<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ratpolysI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_pCons'<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">[:</span><span class="skolem">root</span> <span class="bound">i</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Pmv</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">P</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Pmv_def insertion_prod insertion_diff insertion_sum root'_def P_def
                    sum_to_poly <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> insertion_monom<span class="main">)</span>
      <span class="comment1">(* TODO: insertion_monom should not be a simp rule *)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">[:</span><span class="skolem">root</span> <span class="bound">i</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">P'mv</span> <span class="main">=</span> <span class="skolem">P'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P'mv_def insertion_prod P'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">∈</span> <span class="skolem">ratpolys</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="comment1">― ‹We clear the denominators and remove all powers of $X$ from <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">P'</span></span><span class="antiquote">}</span></span> to obtain a new
      integer polynomial <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>Q›</span></span>.›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q'</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">X</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">root'</span> <span class="bound">X</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">X</span><span class="main">∈</span>Pow <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">root'</span> <span class="bound">X</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P'_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pow <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">Roots'</span> <span class="main">∪</span>
               <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">∈</span> Pow <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">root'</span> <span class="bound">X</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> root'_def Roots'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">X</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">root'</span> <span class="bound">X</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span>
               <span class="skolem">Q'</span> <span class="main">*</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> card <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="skolem">root'</span> <span class="bound">X</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.union_disjoint<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q'_def Roots'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="skolem">root'</span> <span class="bound">X</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">root'</span> <span class="bound">X</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">…</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">-</span> <span class="main">1</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> A_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_Diff_singleton<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> root'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> Q'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">=</span> Polynomial.monom <span class="main">1</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">Q'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Polynomial.monom_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> degree_Q'<span class="main">:</span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="skolem">P'</span> <span class="main">=</span> Polynomial.degree <span class="skolem">Q'</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Q'<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q'_def Roots'_def degree_mult_eq Polynomial.degree_monom_eq degree_prod_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> poly.coeff <span class="skolem">Q'</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly.coeff <span class="skolem">Q'</span> <span class="skolem">i</span> <span class="main">=</span> Polynomial.coeff <span class="skolem">P'</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q' Polynomial.coeff_monom_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P'</span> <span class="main">∈</span> <span class="skolem">ratpolys</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ratpolys_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly.coeff <span class="skolem">Q'</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> ratpoly_to_intpoly<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">Q</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q'</span> <span class="main">=</span> Polynomial.smult <span class="main">(</span>inverse <span class="main">(</span>of_nat <span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_int_poly <span class="skolem">Q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Q Q' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> Q'<span class="main">:</span> <span class="quoted"><span class="quoted">"of_int_poly <span class="skolem">Q</span> <span class="main">=</span> Polynomial.smult <span class="main">(</span>of_nat <span class="skolem">c</span><span class="main">)</span> <span class="skolem">Q'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> degree_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="skolem">Q</span> <span class="main">=</span> Polynomial.degree <span class="skolem">Q'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Q<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polynomial.lead_coeff <span class="main">(</span>of_int_poly <span class="skolem">Q</span> <span class="main">::</span> complex poly<span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Q'<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_Q Q'_def lead_coeff_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> lead_coeff_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"Polynomial.lead_coeff <span class="skolem">Q</span> <span class="main">=</span> int <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> of_int_eq_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Polynomial.lead_coeff <span class="skolem">Q</span>"</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">c</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_int_eq_iff<span class="main">)</span>  
  <span class="keyword1"><span class="command">have</span></span> Q_decompose<span class="main">:</span> <span class="quoted"><span class="quoted">"of_int_poly <span class="skolem">Q</span> <span class="main">=</span>
               Polynomial.smult <span class="main">(</span>of_nat <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">X</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">root'</span> <span class="bound">X</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Q'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q'_def lead_coeff_Q<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>of_int_poly <span class="skolem">Q</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="skolem">idx</span><span class="main">}</span> <span class="main">∈</span> <span class="skolem">Roots'</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Roots'</span>›</span></span> idx 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> root'_def Q_decompose poly_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> degree_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="main">(</span>of_int_poly <span class="skolem">Q</span> <span class="main">::</span> complex poly<span class="main">)</span> <span class="main">=</span> card <span class="skolem">Roots'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Q'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q'_def degree_prod_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>of_int_poly <span class="skolem">Q</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> complex<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Q'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q'_def Roots'_def poly_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">Q</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>of_int_poly <span class="skolem">Q</span><span class="main">)</span> <span class="main">(</span><span class="skolem">root'</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Y</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹finite <span class="skolem">Roots'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q' Q'_def poly_prod<span class="main">)</span>

  <span class="comment1">― ‹We find some closed ball that contains all the roots of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">Q</span></span><span class="antiquote">}</span></span>.›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> Polynomial.degree <span class="skolem">Q</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_Q card_Roots' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> r_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Radius</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Radius</span> <span class="main">=</span> Max <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">Y</span><span class="main">.</span> norm <span class="main">(</span><span class="skolem">root'</span> <span class="bound">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">Roots'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Radius<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">root'</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">Radius</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Y</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Roots'</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Radius_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Radius<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">idx</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Radius</span> <span class="main">≥</span> pi"</span></span>
    <span class="keyword1"><span class="command">using</span></span> idx <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Roots'_def norm_mult root'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> Radius_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Radius</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Radius</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pi_gt3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>

  <span class="comment1">― ‹Since this ball is compact, <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">Q</span></span><span class="antiquote">}</span></span> is bounded on it. We obtain such a bound.›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"compact <span class="main">(</span>poly <span class="main">(</span>of_int_poly <span class="skolem">Q</span> <span class="main">::</span> complex poly<span class="main">)</span> <span class="main">`</span> cball <span class="main">0</span> <span class="skolem">Radius</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> compact_continuous_image <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q_ub</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> Q_ub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q_ub</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
                <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span> <span class="main">::</span> complex<span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> cball <span class="main">0</span> <span class="skolem">Radius</span> <span class="main">⟹</span> norm <span class="main">(</span>poly <span class="main">(</span>of_int_poly <span class="skolem">Q</span><span class="main">)</span> <span class="bound">u</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">Q_ub</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> compact_imp_bounded <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bounded_pos cball_def<span class="main">)</span>

  <span class="comment1">― ‹Using this, define another upper bound that we will need later.›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fp_ub</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fp_ub</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">c</span><span class="main">¦</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">*</span> <span class="bound">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> fact <span class="main">(</span><span class="bound">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">Radius</span> <span class="main">^</span> <span class="main">(</span><span class="bound">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">Q_ub</span> <span class="main">^</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> fp_ub_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">fp_ub</span> <span class="skolem">p</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">unfolding</span></span> fp_ub_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Radius</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> Q_ub
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_nonneg_nonneg divide_nonneg_pos zero_le_power<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> card <span class="skolem">Roots'</span> <span class="main">*</span> <span class="skolem">Radius</span> <span class="main">*</span> exp <span class="skolem">Radius</span>"</span></span>

  <span class="comment1">― ‹We will now show that any sufficiently large prime number leads to
      <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>C * fp_ub p ≥ 1›</span></span>, from which we will then derive a contradiction.›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">primes_at_top</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">primes_at_top</span> <span class="main">=</span> inf_class.inf sequentially <span class="main">(</span>principal <span class="main">{</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span>nat <span class="main">¦</span>poly <span class="skolem">Q</span> <span class="main">0</span><span class="main">¦</span><span class="main">,</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">A</span><span class="main">}</span><span class="main">.</span> <span class="bound">p</span> <span class="main">&gt;</span> <span class="bound">x</span><span class="main">)</span> sequentially"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_ball_finite ballI eventually_gt_at_top<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span>nat <span class="main">¦</span>poly <span class="skolem">Q</span> <span class="main">0</span><span class="main">¦</span><span class="main">,</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">A</span><span class="main">}</span><span class="main">.</span> <span class="bound">p</span> <span class="main">&gt;</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">primes_at_top</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> primes_at_top_def eventually_inf_principal <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span><span class="main">)</span> <span class="skolem">primes_at_top</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> primes_at_top_def eventually_inf_principal<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">*</span> <span class="skolem">fp_ub</span> <span class="bound">p</span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">primes_at_top</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&gt;</span> nat <span class="main">¦</span>poly <span class="skolem">Q</span> <span class="main">0</span><span class="main">¦</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&gt;</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&gt;</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_gt_1_nat<span class="main">)</span>

    <span class="comment1">― ‹We define the polynomial $f(X) = \frac{c^s}{(p-1)!} X^{p-1} Q(X)^p$, where $c$ is
        the leading coefficient of $Q$. We also define $F(X)$ to be the sum of all its
        derivatives.›</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fp</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex poly"</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fp</span> <span class="main">=</span> Polynomial.smult <span class="main">(</span>of_nat <span class="skolem">c</span> <span class="main">^</span> <span class="skolem">s</span> <span class="main">/</span> fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">(</span>Polynomial.monom <span class="main">1</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> of_int_poly <span class="skolem">Q</span> <span class="main">^</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Fp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Fp</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="skolem">s</span><span class="main">+</span><span class="skolem">p</span><span class="main">.</span> <span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">fp</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> poly <span class="skolem">fp</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> poly <span class="skolem">Fp</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> degree_fp<span class="main">:</span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="skolem">fp</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">+</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_Q card_Roots' <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fp_def s_def degree_mult_eq degree_monom_eq
                    degree_power_eq r_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

    <span class="comment1">― ‹Using the same argument as in the case of the transcendence of $e$, we now 
        consider the function
        \[I(u) := e^u F(0) - F(u) = u \int\limits_0^1 e^{(1-t)x} f(tx)\,\textrm{d}t\]
        whose absolute value can be bounded with a standard ``maximum times length'' estimate
        using our upper bound on $f$. All of this can be reused from the proof for $e$, so
        there is not much to do here. In particular, we will look at $\sum I(x_i)$ with the
        $x_i$ ranging over the roots of $Q$ and bound this sum in two different ways.›</span>
    <span class="keyword1"><span class="command">interpret</span></span> lindemann_weierstrass_aux <span class="quoted"><span class="skolem">fp</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> I_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"I <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> exp <span class="bound">u</span> <span class="main">*</span> <span class="skolem">F</span> <span class="main">0</span> <span class="main">-</span> <span class="skolem">F</span> <span class="bound">u</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I_def degree_fp F_def Fp_def poly_sum<span class="main">)</span>

    <span class="comment1">― ‹We show that <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">fp_ub</span></span><span class="antiquote">}</span></span> is indeed an upper bound for $f$.›</span>
    <span class="keyword1"><span class="command">have</span></span> fp_ub<span class="main">:</span>  <span class="quoted"><span class="quoted">"norm <span class="main">(</span>poly <span class="skolem">fp</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">fp_ub</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> cball <span class="main">0</span> <span class="skolem">Radius</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>poly <span class="skolem">fp</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">¦</span><span class="skolem">c</span><span class="main">¦</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>norm <span class="skolem">u</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span>
                                 norm <span class="main">(</span>poly <span class="main">(</span>of_int_poly <span class="skolem">Q</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fp_def f_def s_def norm_mult poly_monom norm_divide norm_power<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">fp_ub</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> fp_ub_def <span class="keyword1"><span class="command">using</span></span> that Q_ub <span class="quoted"><span class="quoted">‹<span class="skolem">Radius</span> <span class="main">≥</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mult_mono<span class="main"><span class="main">]</span></span> power_mono zero_le_power<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>    

    <span class="comment1">― ‹We now show that the following sum is an integer multiple of $p$. This argument again
        uses the fundamental theorem of symmetric functions, exploiting that the inner sums are
        symmetric over the roots of $Q$.›</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="skolem">p</span><span class="main">..</span><span class="skolem">s</span><span class="main">+</span><span class="skolem">p</span><span class="main">.</span> <span class="main">∑</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">fp</span><span class="main">)</span> <span class="main">(</span><span class="skolem">root'</span> <span class="bound">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> sum_divide_distrib<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> Ints_sum<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="skolem"><span class="skolem">a</span></span><span class="main"><span class="main">..</span></span><span class="skolem"><span class="skolem">b</span></span><span class="main"><span class="main">}</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">p</span><span class="main">..</span><span class="skolem">s</span><span class="main">+</span><span class="skolem">p</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">roots'</span></span> <span class="keyword2"><span class="keyword">where</span></span> roots'<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">roots'</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">roots'</span> <span class="main">=</span> <span class="skolem">Roots'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> finite_distinct_list <span class="quoted"><span class="quoted">‹finite <span class="skolem">Roots'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> length <span class="skolem">roots'</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fp'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fp'</span> <span class="main">=</span> <span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">fp</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> Polynomial.degree <span class="skolem">fp'</span>"</span></span>
      <span class="comment1">― ‹We define a multivariate polynomial for the inner sum $\sum f(x_i)/p$ in order
          to show that it is indeed a symmetric function over the $x_i$.›</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">(</span>smult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">d</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">l</span><span class="main">.</span> smult <span class="main">(</span>poly.coeff <span class="skolem">fp'</span> <span class="bound">k</span><span class="main">)</span>
                             <span class="main">(</span>monom <span class="main">(</span>Poly_Mapping.single <span class="bound">i</span> <span class="bound">k</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> of_int <span class="main">(</span><span class="skolem">c</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> complex mpoly<span class="main">)</span>"</span></span>

      <span class="comment1">― ‹The $j$-th coefficient of the $i$-th derivative of $f$ are integer multiples
          of $c^j p$ since $i \geq p$.›</span>
      <span class="keyword1"><span class="command">have</span></span> integer<span class="main">:</span> <span class="quoted"><span class="quoted">"poly.coeff <span class="skolem">fp'</span> <span class="skolem">j</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="skolem">c</span> <span class="main">^</span> <span class="skolem">j</span> <span class="main">*</span> of_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fp''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fp''</span> <span class="main">=</span> Polynomial.monom <span class="main">1</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">Q</span> <span class="main">^</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">^</span> <span class="skolem">s</span> <span class="main">*</span> poly.coeff <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>Polynomial.monom <span class="main">1</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">Q</span> <span class="main">^</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span>fact <span class="skolem">p</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">[:</span>fact <span class="skolem">i</span><span class="main">:]</span> <span class="main">::</span> int poly<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> fact_dvd<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span>fact <span class="skolem">i</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>Polynomial.monom <span class="main">1</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">Q</span> <span class="main">^</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fact_dvd_higher_pderiv<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">^</span> <span class="skolem">j</span> <span class="main">*</span> fact <span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def of_nat_mult <span class="keyword1"><span class="command">using</span></span> that i
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_dvd_mono<span class="main">)</span>
             <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> le_imp_power_dvd <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s_def d_def fp'_def degree_higher_pderiv degree_fp<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">x</span> <span class="main">/</span> <span class="main">(</span>of_int <span class="main">(</span><span class="skolem">c</span> <span class="main">^</span> <span class="skolem">j</span> <span class="main">*</span> fact <span class="skolem">p</span><span class="main">)</span> <span class="main">::</span> complex<span class="main">)</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> of_int_divide_in_Ints<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">x</span> <span class="main">/</span> <span class="main">(</span>of_int <span class="main">(</span><span class="skolem">c</span> <span class="main">^</span> <span class="skolem">j</span> <span class="main">*</span> fact <span class="skolem">p</span><span class="main">)</span> <span class="main">::</span> complex<span class="main">)</span> <span class="main">=</span>
                     poly.coeff <span class="skolem">fp'</span> <span class="skolem">j</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="skolem">c</span> <span class="main">^</span> <span class="skolem">j</span> <span class="main">*</span> of_nat <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fact_reduce<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="main">]</span></span> fp'_def fp_def higher_pderiv_smult x_def <span class="dynamic"><span class="dynamic">field_simps</span></span>
                   <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> coeff_of_int_poly higher_pderiv_of_int_poly<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="comment1">― ‹Evaluating $R$ yields is an integer since it is symmetric.›</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">root'</span> <span class="main">(</span><span class="skolem">roots'</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">R</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> symmetric_poly_of_roots_in_subring_monic allI<span class="main">)</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q'</span> <span class="main">=</span> of_int_poly <span class="skolem">Q</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span> <span class="main">/</span> of_nat <span class="skolem">c</span> <span class="main">::</span> complex<span class="main">:]</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"symmetric_mpoly <span class="main">{..&lt;</span><span class="skolem">l</span><span class="main">}</span> <span class="skolem">R</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> R_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> symmetric_mpoly_smult symmetric_mpoly_sum<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{..</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">d</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span> symmetric_mpoly_symmetric_sum<span class="main">)</span>
             <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mpoly_map_vars_monom permutes_bij permutep_single bij_imp_bij_inv permutes_inv_inv<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"MPoly_Type.coeff <span class="skolem">R</span> <span class="skolem">m</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="keyword1"><span class="command">unfolding</span></span> R_def coeff_sum coeff_smult sum_distrib_left
          <span class="keyword1"><span class="command">using</span></span> integer <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> R_def coeff_monom when_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ints_sum<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vars <span class="skolem">R</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="skolem">l</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> R_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_smult<span class="main"><span class="main">]</span></span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_sum<span class="main"><span class="main">]</span></span> UN_least
                    order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> vars_monom_subset<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ring_closed <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">auto</span>
  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">l</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="main">(</span>of_nat <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">root'</span> <span class="main">(</span><span class="skolem">roots'</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span>
                <span class="main">(</span><span class="main">∏</span><span class="bound">Y</span><span class="main">←</span><span class="skolem">roots'</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="main">(</span>of_nat <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">root'</span> <span class="bound">Y</span><span class="main">)</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod_list_prod_nth<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> atLeast0LessThan l_def<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="main">(</span>of_nat <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">root'</span> <span class="bound">Y</span><span class="main">)</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> roots' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.distinct_set_conv_list <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> Polynomial.smult <span class="main">(</span>of_nat <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="skolem">root'</span> <span class="bound">Y</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">c</span><span class="main">:]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pcompose_prod pcompose_pCons<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> Polynomial.smult <span class="main">(</span>of_nat <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="skolem">root'</span> <span class="bound">Y</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                     Polynomial.smult <span class="main">(</span>of_nat <span class="skolem">c</span> <span class="main">^</span> card <span class="skolem">Roots'</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">root'</span> <span class="bound">Y</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod_smult<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Polynomial.smult <span class="main">(</span>of_nat <span class="skolem">c</span> <span class="main">^</span> <span class="main">(</span>card <span class="skolem">Roots'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
                          <span class="main">(</span>Polynomial.smult <span class="skolem">c</span> <span class="main">(</span><span class="main">∏</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">root'</span> <span class="bound">Y</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Roots'</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Roots'</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> power_diff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc_le_eq card_gt_0_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polynomial.smult <span class="skolem">c</span> <span class="main">(</span><span class="main">∏</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">root'</span> <span class="bound">Y</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> of_int_poly <span class="skolem">Q</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Q_decompose <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Polynomial.smult <span class="main">(</span>of_nat <span class="skolem">c</span> <span class="main">^</span> <span class="main">(</span>card <span class="skolem">Roots'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">Q'</span> <span class="main">=</span>
                        <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">l</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="main">(</span>of_nat <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">root'</span> <span class="main">(</span><span class="skolem">roots'</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pcompose_smult Q'_def<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted">nat</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly.coeff <span class="main">(</span>Polynomial.smult <span class="main">(</span>of_nat <span class="skolem">c</span> <span class="main">^</span> <span class="main">(</span>card <span class="skolem">Roots'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">Q'</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="skolem">Q</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> greater
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q'_def coeff_pcompose_linear coeff_eq_0<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> equal
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Roots'</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> degree_Q card_Roots' lead_coeff_Q
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q'_def coeff_pcompose_linear lead_coeff_Q power_divide power_diff<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> less
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly.coeff <span class="main">(</span>Polynomial.smult <span class="main">(</span>of_nat <span class="skolem">c</span> <span class="main">^</span> <span class="main">(</span>card <span class="skolem">Roots'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">Q'</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span>
                  of_int <span class="main">(</span>poly.coeff <span class="skolem">Q</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>of_int <span class="main">(</span><span class="skolem">c</span> <span class="main">^</span> <span class="main">(</span>card <span class="skolem">Roots'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> of_int <span class="main">(</span><span class="skolem">c</span> <span class="main">^</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q'_def coeff_pcompose_linear power_divide<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less degree_Q
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Ints_mult of_int_divide_in_Ints<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> le_imp_power_dvd<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
      <span class="comment1">― ‹Moreover, by definition, evaluating <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">R</span></span><span class="antiquote">}</span></span> gives us $\sum f(x_i)/p$.›</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">root'</span> <span class="main">(</span><span class="skolem">roots'</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">R</span> <span class="main">=</span>
                   <span class="main">(</span><span class="main">∑</span><span class="bound">Y</span><span class="main">←</span><span class="skolem">roots'</span><span class="main">.</span> poly <span class="skolem">fp'</span> <span class="main">(</span><span class="skolem">root'</span> <span class="bound">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insertion_sum R_def poly_altdef d_def sum_list_sum_nth atLeast0LessThan
                    l_def power_mult_distrib <span class="dynamic"><span class="dynamic">algebra_simps</span></span> 
                    sum.swap<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span>Polynomial.degree <span class="skolem">fp'</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> insertion_monom<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">fp</span><span class="main">)</span> <span class="main">(</span><span class="skolem">root'</span> <span class="bound">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> roots' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_list_distinct_conv_sum_set<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fp'_def poly_pcompose<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">K</span></span> <span class="keyword2"><span class="keyword">where</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="skolem">p</span><span class="main">..</span><span class="skolem">s</span><span class="main">+</span><span class="skolem">p</span><span class="main">.</span> <span class="main">∑</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> 
                               poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">fp</span><span class="main">)</span> <span class="main">(</span><span class="skolem">root'</span> <span class="bound">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> of_int <span class="skolem">K</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ints_cases <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

    <span class="comment1">― ‹Next, we show that $F(0)$ is an integer and coprime to $p$.›</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F0</span></span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> F0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">0</span> <span class="main">=</span> of_int <span class="skolem">F0</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>int <span class="skolem">p</span><span class="main">)</span> <span class="skolem">F0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="skolem">p</span><span class="main">..</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">p</span><span class="main">.</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">fp</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="skolem">p</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sum_divide_distrib
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> Ints_sum<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">p</span><span class="main">..</span><span class="skolem">s</span><span class="main">+</span><span class="skolem">p</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fact <span class="skolem">p</span> <span class="keyword1">dvd</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">Q</span> <span class="main">^</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fact_dvd_poly_higher_pderiv_aux'<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">Q</span> <span class="main">^</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> fact <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">fp</span> <span class="main">=</span> Polynomial.smult <span class="main">(</span>of_nat <span class="skolem">c</span> <span class="main">^</span> <span class="skolem">s</span> <span class="main">/</span> fact <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
                <span class="main">(</span>of_int_poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">Q</span> <span class="main">^</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fp_def higher_pderiv_smult Polynomial.monom_altdef
                   <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> higher_pderiv_of_int_poly<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">…</span> <span class="main">0</span> <span class="main">/</span> of_nat <span class="skolem">p</span> <span class="main">=</span> of_int <span class="main">(</span><span class="skolem">c</span> <span class="main">^</span> <span class="skolem">s</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> k <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fact_reduce<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">fp</span><span class="main">)</span> <span class="main">0</span> <span class="main">/</span> of_nat <span class="skolem">p</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="skolem">p</span><span class="main">..</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">p</span><span class="main">.</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">fp</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> of_int <span class="skolem">S</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ints_cases <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">p</span><span class="main">.</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">fp</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> F_def Fp_def poly_sum<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>insert <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">{</span><span class="skolem">p</span><span class="main">..</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">p</span><span class="main">}</span><span class="main">.</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">fp</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right ballI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{..</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">p</span><span class="main">}</span> <span class="main">-</span> insert <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">{</span><span class="skolem">p</span><span class="main">..</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">p</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polynomial.monom <span class="main">1</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="skolem">fp</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fp_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dvd_smult<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> i <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">fp</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> poly_higher_pderiv_aux1'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">p</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Polynomial.monom_altdef<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">fp</span><span class="main">)</span> <span class="main">0</span> <span class="main">+</span> of_int <span class="skolem">S</span> <span class="main">*</span> of_nat <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">fp</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> of_int <span class="main">(</span><span class="skolem">c</span> <span class="main">^</span> <span class="skolem">s</span> <span class="main">*</span> poly <span class="skolem">Q</span> <span class="main">0</span> <span class="main">^</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> poly_higher_pderiv_aux2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"of_int_poly <span class="skolem">Q</span> <span class="main">^</span> <span class="skolem">p</span> <span class="main">::</span> complex poly"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fp_def higher_pderiv_smult Polynomial.monom_altdef<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">0</span> <span class="main">=</span> of_int <span class="main">(</span><span class="skolem">S</span> <span class="main">*</span> int <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">^</span> <span class="skolem">s</span> <span class="main">*</span> poly <span class="skolem">Q</span> <span class="main">0</span> <span class="main">^</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">p</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>int <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>poly <span class="skolem">Q</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prime_imp_coprime <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> dvd_imp_le_int<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>int <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">^</span> <span class="skolem">s</span> <span class="main">*</span> poly <span class="skolem">Q</span> <span class="main">0</span> <span class="main">^</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>int <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">S</span> <span class="main">*</span> int <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">^</span> <span class="skolem">s</span> <span class="main">*</span> poly <span class="skolem">Q</span> <span class="main">0</span> <span class="main">^</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> coprime_iff_gcd_eq_1 gcd_add_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">*</span> int <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">^</span> <span class="skolem">s</span> <span class="main">*</span> poly <span class="skolem">Q</span> <span class="main">0</span> <span class="main">^</span> <span class="skolem">p</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="comment1">― ‹Putting everything together, we have shown that $\sum I(x_i)$ is an integer coprime
        to $p$, and therefore a nonzero integer, and therefore has an absolute value of at least 1.›</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> I <span class="main">(</span><span class="skolem">root'</span> <span class="bound">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">F</span> <span class="main">0</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> exp <span class="main">(</span><span class="skolem">root'</span> <span class="bound">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="skolem">F</span> <span class="main">(</span><span class="skolem">root'</span> <span class="bound">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I_altdef sum_subtractf sum_distrib_left sum_distrib_right <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span>of_int <span class="main">(</span><span class="skolem">F0</span> <span class="main">*</span> int <span class="skolem">A</span><span class="main">)</span> <span class="main">+</span>
                      <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="skolem">s</span><span class="main">+</span><span class="skolem">p</span><span class="main">.</span> <span class="main">∑</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">fp</span><span class="main">)</span> <span class="main">(</span><span class="skolem">root'</span> <span class="bound">Y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> F0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Roots'_def eq F_def Fp_def poly_sum sum.swap<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span><span class="skolem">s</span><span class="main">+</span><span class="skolem">p</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="skolem">s</span><span class="main">+</span><span class="skolem">p</span><span class="main">.</span> <span class="main">∑</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">fp</span><span class="main">)</span> <span class="main">(</span><span class="skolem">root'</span> <span class="bound">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="skolem">p</span><span class="main">..</span><span class="skolem">s</span><span class="main">+</span><span class="skolem">p</span><span class="main">.</span> <span class="main">∑</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">fp</span><span class="main">)</span> <span class="main">(</span><span class="skolem">root'</span> <span class="bound">Y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right ballI sum.neutral<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">Y</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{..</span><span class="skolem">s</span><span class="main">+</span><span class="skolem">p</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">p</span><span class="main">..</span><span class="skolem">s</span><span class="main">+</span><span class="skolem">p</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">root'</span> <span class="skolem">Y</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">p</span> <span class="keyword1">dvd</span> of_int_poly <span class="skolem">Q</span> <span class="main">^</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_power_same<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dvd_iff_poly_eq_0 Y<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">root'</span> <span class="skolem">Y</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="skolem">fp</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fp_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvd_smult<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">fp</span><span class="main">)</span> <span class="main">(</span><span class="skolem">root'</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> poly_higher_pderiv_aux1'<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_int <span class="main">(</span><span class="skolem">K</span> <span class="main">*</span> int <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> I <span class="main">(</span><span class="skolem">root'</span> <span class="bound">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>of_int <span class="main">(</span><span class="skolem">K</span> <span class="main">*</span> int <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">F0</span> <span class="main">*</span> int <span class="skolem">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">p</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prime_imp_coprime<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dvd_imp_le<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>int <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">F0</span> <span class="main">*</span> int <span class="skolem">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> F0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>int <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">K</span> <span class="main">*</span> int <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">F0</span> <span class="main">*</span> int <span class="skolem">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> F0 <span class="keyword1"><span class="command">unfolding</span></span> coprime_iff_gcd_eq_1 gcd_add_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">K</span> <span class="main">*</span> int <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">F0</span> <span class="main">*</span> int <span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> notI<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">-</span>of_int <span class="main">(</span><span class="skolem">K</span> <span class="main">*</span> int <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">F0</span> <span class="main">*</span> int <span class="skolem">A</span><span class="main">)</span> <span class="main">::</span> complex<span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> norm_minus_cancel norm_of_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> norm <span class="main">(</span><span class="main">∑</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> I <span class="main">(</span><span class="skolem">root'</span> <span class="bound">Y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="comment1">― ‹The M--L bound on the integral gives us an upper bound:›</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">∑</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> I <span class="main">(</span><span class="skolem">root'</span> <span class="bound">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
                 <span class="main">(</span><span class="main">∑</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> norm <span class="main">(</span><span class="skolem">root'</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">*</span> exp <span class="main">(</span>norm <span class="main">(</span><span class="skolem">root'</span> <span class="bound">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">fp_ub</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum_norm_le lindemann_weierstrass_integral_bound fp_ub fp_ub_nonneg<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Y</span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> <span class="skolem">Roots'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> closed_segment <span class="main">0</span> <span class="main">(</span><span class="skolem">root'</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"closed_segment <span class="main">0</span> <span class="main">(</span><span class="skolem">root'</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">⊆</span> cball <span class="main">0</span> <span class="skolem">Radius</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Radius</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> Radius<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> closed_segment_subset<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> cball <span class="main">0</span> <span class="skolem">Radius</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">Y</span><span class="main">∈</span><span class="skolem">Roots'</span><span class="main">.</span> <span class="skolem">Radius</span> <span class="main">*</span> exp <span class="main">(</span><span class="skolem">Radius</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">fp_ub</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Radius <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono mult_right_mono mult_mono fp_ub_nonneg <span class="quoted"><span class="quoted">‹<span class="skolem">Radius</span> <span class="main">≥</span> <span class="main">0</span>›</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">C</span> <span class="main">*</span> <span class="skolem">fp_ub</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="skolem">C</span> <span class="main">*</span> <span class="skolem">fp_ub</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="comment1">― ‹It now only remains to show that this inequality is inconsistent for large $p$.
      This is obvious, since the upper bound is an exponential divided by a factorial and 
      therefore clearly tends to zero.›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">*</span> <span class="skolem">fp_ub</span> <span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">Radius</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">c</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">p</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">p</span><span class="main">)</span> <span class="main">*</span>
                                     <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">c</span><span class="main">¦</span> <span class="main">^</span> <span class="skolem">r</span> <span class="main">*</span> <span class="skolem">Radius</span> <span class="main">*</span> <span class="skolem">Q_ub</span><span class="main">)</span> <span class="main">^</span> <span class="bound">p</span> <span class="main">/</span> fact <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="var">?f</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> degree_Q card_Roots' <span class="quoted"><span class="quoted">‹<span class="skolem">Radius</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fact_reduce power_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> r_def
                   fp_ub_def power_diff power_mult_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">1</span> <span class="main">*</span> <span class="main">1</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big_small_mult landau_o.big_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>real_of_int <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">c</span><span class="main">¦</span> <span class="main">^</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">Radius</span> <span class="main">*</span> <span class="skolem">Q_ub</span><span class="main">)</span> <span class="main">^</span> <span class="bound">x</span> <span class="main">/</span> fact <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> power_over_fact_tendsto_0<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>real_of_int <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">c</span><span class="main">¦</span> <span class="main">^</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">Radius</span> <span class="main">*</span> <span class="skolem">Q_ub</span><span class="main">)</span> <span class="main">^</span> <span class="bound">x</span> <span class="main">/</span> fact <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> smalloI_tendsto<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">real_asymp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">*</span> <span class="skolem">fp_ub</span> <span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> smalloD_tendsto<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">*</span> <span class="skolem">fp_ub</span> <span class="bound">p</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">*</span> <span class="skolem">fp_ub</span> <span class="bound">p</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> order_tendstoD<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">*</span> <span class="skolem">fp_ub</span> <span class="bound">p</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">primes_at_top</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> primes_at_top_def eventually_inf_principal <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹eventually <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">*</span> <span class="skolem">fp_ub</span> <span class="bound">p</span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">primes_at_top</span>›</span></span>
  <span class="comment1">― ‹We therefore have a contradiction for any sufficiently large prime.›</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> False<span class="main">)</span> <span class="skolem">primes_at_top</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">auto</span>

  <span class="comment1">― ‹Since sufficiently large primes always exist, this concludes the theorem.›</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"frequently <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span><span class="main">)</span> sequentially"</span></span>
    <span class="keyword1"><span class="command">using</span></span> primes_infinite <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cofinite_eq_sequentially<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> Inf_many_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> frequently_def eventually_inf_principal primes_at_top_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> transcendental_pi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>algebraic pi"</span></span>
  <span class="keyword1"><span class="command">using</span></span> transcendental_i_pi <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> algebraic_times_i_iff<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>