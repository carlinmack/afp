<div id="InductiveUnwinding">
<div class="head">
<h1>Theory InductiveUnwinding</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       The Inductive Unwinding Theorem for CSP Noninterference Security
    Author:      Pasquale Noce
                 Security Certification Specialist at Arjo Systems - Gep S.p.A.
                 pasquale dot noce dot lavoro at gmail dot com
                 pasquale dot noce at arjowiggins-it dot com
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"The Inductive Unwinding Theorem"</span></span>

<span class="keyword1"><span class="command">theory</span></span> InductiveUnwinding
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../Noninterference_Ipurge_Unwinding/DeterministicProcesses.html">Noninterference_Ipurge_Unwinding.DeterministicProcesses</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

The necessary and sufficient condition for CSP noninterference security \cite{R2} stated by the
Ipurge Unwinding Theorem \cite{R3} is expressed in terms of a pair of event lists varying over the
set of process traces. This does not render it suitable for the subsequent application of rule
induction in the case of a process defined inductively, since rule induction may rather be applied
to a single variable ranging over an inductively defined set (cf. \cite{R6}).

However, the formulation of an inductive definition is the standard way of defining a process that
admits traces of unbounded length, indeed because it provides rule induction as a powerful method to
prove process properties, particularly noninterference security, by considering any indefinitely
long trace of the process. Therefore, it is essential to infer some condition equivalent to CSP
noninterference security and suitable for being handled by means of rule induction.

Starting from the Ipurge Unwinding Theorem, this paper derives a necessary and sufficient condition
for CSP noninterference security that involves a single event list varying over the set of process
traces, and is thus suitable for rule induction; hence its name, \emph{Inductive Unwinding Theorem}.
Similarly to the Ipurge Unwinding Theorem, the new theorem only requires to consider individual
accepted and refused events for each process trace, and applies to the general case of a possibly
intransitive noninterference policy. Specific variants of this theorem are additionally proven for
deterministic processes and trace set processes \cite{R3}.

For details about the theory of Communicating Sequential Processes, to which the notion of process
security defined in \cite{R2} and applied in this paper refers, cf. \cite{R4}.

As regards the formal contents of this paper, the salient points of definitions and proofs are
commented; for additional information, cf. Isabelle documentation, particularly \cite{R6},
\cite{R7}, \cite{R8}, and \cite{R9}.
›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Propaedeutic lemmas"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Here below are the proofs of some lemmas on the constants defined in \cite{R2} and \cite{R3} which
are propaedeutic to the demonstration of the Inductive Unwinding Theorem.

Among other things, the lemmas being proven formalize the following statements:

\begin{itemize}

\item
A set of domains <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">U</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> may affect a set of domains <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">V</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> via an event list <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, as
expressed through function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">sinks_aux</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, just in case <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">V</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> may be affected by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">U</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
via <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, as expressed through function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">sources_aux</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

\item
The event lists output by function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_tr</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are not longer than the corresponding input
ones.

\item
Function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_tr_rev</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is idempotent.

\end{itemize}

\null
›</span></span>

<span class="keyword1" id="InductiveUnwinding-sources_aux_single_dom"><span class="command">lemma</span></span> sources_aux_single_dom<span class="main">:</span>
 <span class="quoted"><span class="quoted">"sources_aux <span class="free">I</span> <span class="free">D</span> <span class="main">{</span><span class="free">u</span><span class="main">}</span> <span class="free">xs</span> <span class="main">=</span> insert <span class="free">u</span> <span class="main">(</span>sources <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sources_sinks sources_sinks_aux sinks_aux_single_dom<span class="main">)</span>

<span class="keyword1" id="InductiveUnwinding-sources_interference_eq"><span class="command">lemma</span></span> sources_interference_eq<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sources <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="free">x</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">D</span> <span class="free">x</span> <span class="main">∈</span> sources <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sources_sinks rev.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> converse_iff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> sinks_interference_eq<span class="main">)</span>

<span class="keyword1" id="InductiveUnwinding-ex_sinks_sources_aux_1"><span class="command">lemma</span></span> ex_sinks_sources_aux_1 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sources_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="free">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sources_aux_append<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">rule</span> impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">V</span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sources_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">V</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?V'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">V</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sources_aux <span class="free">I</span> <span class="free">D</span> <span class="bound">V</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="skolem">V</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sources_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?V</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="skolem">V</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">∨</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="skolem">V</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
     <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">∨</span> <span class="var">?B</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="var">?V'</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sources_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?V'</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="var">?V'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> D <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="var">?V'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="var">?V'</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sources_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?V'</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="var">?V</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sources_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?V</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="skolem">V</span><span class="main">.</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?B</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> <span class="var">?V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sources_aux_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="var">?V</span><span class="main">.</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="var">?V</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="var">?V</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sources_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?V</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="skolem">V</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="skolem">V</span><span class="main">.</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> <span class="var">?V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sources_aux_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="var">?V</span><span class="main">.</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="var">?V</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="InductiveUnwinding-ex_sinks_sources_aux_2"><span class="command">lemma</span></span> ex_sinks_sources_aux_2 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sources_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="free">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sources_aux_append<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">rule</span> impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">V</span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?V</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sources_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">V</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?V'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">V</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sources_aux <span class="free">I</span> <span class="free">D</span> <span class="bound">V</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="bound">V</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sources_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?V</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="skolem">V</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="skolem">V</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sources_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">V</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="skolem">V</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="skolem">V</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sources_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">V</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="skolem">V</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sources_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?V</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="var">?V</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="var">?V</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="var">?V</span><span class="main">.</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="var">?V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="skolem">V</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="skolem">V</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">V</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> G <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="skolem">V</span><span class="main">.</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="skolem">V</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="skolem">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="skolem">V</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="InductiveUnwinding-ex_sinks_sources_aux"><span class="command">lemma</span></span> ex_sinks_sources_aux<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sources_aux <span class="free">I</span> <span class="free">D</span> <span class="free">V</span> <span class="free">xs</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> ex_sinks_sources_aux_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ex_sinks_sources_aux_2<span class="main">)</span>

<span class="keyword1" id="InductiveUnwinding-ipurge_tr_rev_ipurge_tr_sources_aux_1"><span class="command">lemma</span></span> ipurge_tr_rev_ipurge_tr_sources_aux_1 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sources_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="free">zs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span>
  ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">=</span>
  ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="free">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">zs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">U</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> bex_simps<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="skolem">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="free">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_aux_nil<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="free">xs</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_aux_append_nil<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="skolem">zs</span> <span class="skolem">U</span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?U</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sources_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="main">[</span><span class="skolem">z</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?U'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span><span class="free">D</span> <span class="skolem">z</span><span class="main">)</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sources_aux <span class="free">I</span> <span class="free">D</span> <span class="bound">U</span> <span class="skolem">zs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span>
    ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="bound">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">@</span> <span class="skolem">zs</span><span class="main">)</span> <span class="main">=</span>
    ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="bound">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="skolem">zs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sources_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="skolem">zs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟶</span>
    ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">@</span> <span class="skolem">zs</span><span class="main">)</span> <span class="main">=</span>
    ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="skolem">zs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sources_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="main">(</span><span class="skolem">zs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">z</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sources_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="skolem">zs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> sources_aux_append<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span>
   <span class="quoted"><span class="quoted">"ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">@</span> <span class="skolem">zs</span><span class="main">)</span> <span class="main">=</span>
    ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="skolem">zs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">@</span> <span class="skolem">zs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">z</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
    ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">@</span> <span class="skolem">zs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">z</span><span class="main">]</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> C<span class="main">:</span>
   <span class="quoted"><span class="quoted">"ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">@</span> <span class="skolem">zs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">z</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
    ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">@</span> <span class="skolem">zs</span><span class="main">)</span> <span class="main">@</span> ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="main">[</span><span class="skolem">z</span><span class="main">]</span>"</span></span>
   <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">@</span> <span class="var">?ws</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_aux_append<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">@</span> <span class="skolem">zs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">z</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
    ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="main">(</span><span class="skolem">zs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">z</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> C<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="skolem">U</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">z</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">simp_all</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ipurge_tr_aux.simps<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="skolem">zs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> <span class="var">?U</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ex_sinks_sources_aux<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="skolem">zs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span>
     <span class="quoted"><span class="quoted">"ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="main">(</span><span class="skolem">zs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">z</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="skolem">zs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">z</span><span class="main">]</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
      ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="skolem">zs</span><span class="main">)</span> <span class="main">@</span> <span class="var">?ws</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_aux_append<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
      ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U'</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="skolem">zs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">z</span><span class="main">]</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span>
     <span class="quoted"><span class="quoted">"ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="main">(</span><span class="skolem">zs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">z</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U'</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="skolem">zs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">z</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span>
     <span class="quoted"><span class="quoted">"ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U'</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">@</span> <span class="skolem">zs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">z</span><span class="main">]</span> <span class="main">=</span>
      ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="main">(</span><span class="skolem">zs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">z</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span>
     <span class="quoted"><span class="quoted">"ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="main">(</span><span class="skolem">zs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">z</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="skolem">zs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sinks_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="skolem">zs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">D</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span>
       <span class="quoted"><span class="quoted">"ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="skolem">zs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">z</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
        ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="skolem">zs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">z</span><span class="main">]</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
        ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="var">?U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="skolem">zs</span><span class="main">)</span> <span class="main">@</span> <span class="var">?ws</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_aux_append<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
        ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="skolem">zs</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span>
       <span class="quoted"><span class="quoted">"ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="skolem">zs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">z</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
        ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="skolem">zs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span>
     <span class="quoted"><span class="quoted">"ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">@</span> <span class="skolem">zs</span><span class="main">)</span> <span class="main">=</span>
      ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="skolem">U</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="free">ys</span><span class="main">)</span> <span class="main">(</span><span class="skolem">zs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">z</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="InductiveUnwinding-ipurge_tr_rev_ipurge_tr_sources_1"><span class="command">lemma</span></span> ipurge_tr_rev_ipurge_tr_sources_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="free">y</span> <span class="main">∉</span> sources <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
   <span class="quoted"><span class="quoted">"ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">zs</span><span class="main">)</span> <span class="main">=</span>
    ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">)</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> sources <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">zs</span><span class="main">.</span> <span class="main">(</span><span class="free">D</span> <span class="free">y</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sources_interference_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">D</span> <span class="main">`</span> set <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> sources_aux <span class="free">I</span> <span class="free">D</span> <span class="main">{</span><span class="free">u</span><span class="main">}</span> <span class="free">zs</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sources_aux_single_dom<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span>
   <span class="quoted"><span class="quoted">"ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="main">{</span><span class="free">u</span><span class="main">}</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">=</span>
    ipurge_tr_rev_aux <span class="free">I</span> <span class="free">D</span> <span class="main">{</span><span class="free">u</span><span class="main">}</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> ipurge_tr_aux <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="main">`</span> set <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_rev_ipurge_tr_sources_aux_1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_aux_single_dom ipurge_tr_rev_aux_single_dom<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="InductiveUnwinding-ipurge_tr_length"><span class="command">lemma</span></span> ipurge_tr_length<span class="main">:</span>
 <span class="quoted"><span class="quoted">"length <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="InductiveUnwinding-sources_idem"><span class="command">lemma</span></span> sources_idem<span class="main">:</span>
 <span class="quoted"><span class="quoted">"sources <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> sources <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="InductiveUnwinding-ipurge_tr_rev_idem"><span class="command">lemma</span></span> ipurge_tr_rev_idem<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sources_idem<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Closure of the traces of a secure process under reverse intransitive purge"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The derivation of the Inductive Unwinding Theorem from the Ipurge Unwinding Theorem requires to
prove that the set of the traces of a secure process is closed under reverse intransitive purge,
i.e. function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_tr_rev</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> \cite{R3}. This can be expressed formally by means of the
following statement:

\null

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"secure <span class="free"><span class="free">P</span></span> <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="main"><span class="main">⟹</span></span> <span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">∈</span></span> traces <span class="free"><span class="free">P</span></span> <span class="main"><span class="main">⟹</span></span> ipurge_tr_rev <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">u</span></span> <span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">∈</span></span> traces <span class="free"><span class="free">P</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

\null

The reason why such closure property holds is that the reverse intransitive purge of a list
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with regard to a policy <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, an event-domain map <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">D</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and a domain <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">u</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
can equivalently be computed as follows: for each item <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> may
affect <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">u</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, retain <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and go on recursively using as input the sublist of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
following <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, say <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs'</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>; otherwise, discard <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and go on recursively using
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_tr <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">D</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">xs'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> \cite{R2} as input.

The result actually matches <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">u</span></span> <span class="free"><span class="free">xs</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. In fact, for each <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> not
affecting <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">u</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_tr <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">D</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">xs'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> retains any item of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs'</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> not affected
by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, which is the case for any item of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs'</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> affecting <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">u</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, since otherwise
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> would affect <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">u</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

Furthermore, if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a trace of a secure process, the result is still a trace. In fact, for
each <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> not affecting <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">u</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ys</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the partial output for the sublist of
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> preceding <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, then <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">ys</span></span> <span class="main"><span class="main">@</span></span> ipurge_tr <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">D</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">xs'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a trace provided such
is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">ys</span></span> <span class="main"><span class="main">@</span></span> <span class="free"><span class="free">x</span></span> <span class="main"><span class="main">#</span></span> <span class="free"><span class="free">xs'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, by virtue of the definition of CSP noninterference security \cite{R2}.
Hence, the property of being a trace is conserved upon each recursive call by the concatenation of
the partial output and the residual input, until the latter is nil and the former matches the total
output.

This argument shows that in order to prove by induction, under the aforesaid assumptions, that the
output of such a reverse intransitive purge function is a trace, the partial output has to be passed
to the function as an argument, in addition to the residual input, in the recursive calls contained
within the definition of the function. Therefore, the output of the function has to be accumulated
into one of its parameters, viz. the function needs to be tail-recursive. This suggests to prove the
properties of interest of the function by applying the ten-step proof method for theorems on
tail-recursive functions described in \cite{R1}.

The starting point is to formulate a naive definition of the function, which will then be refined as
specified by the proof method. The name of the refined function, from which the name of the naive
function here below is derived, will be <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_tr_rev_t›</span></span></span></span>, where suffix \emph{t} stands for
\emph{tail-recursive}.

\null
›</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="main">(</span>sequential<span class="main">)</span> <span class="entity">ipurge_tr_rev_t_naive</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> <span class="main">×</span> <span class="tfree">'d</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ipurge_tr_rev_t_naive</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span>
 <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> sources <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>
  <span class="keyword1">then</span> <span class="free">ipurge_tr_rev_t_naive</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span><span class="main">)</span>
  <span class="keyword1">else</span> <span class="free">ipurge_tr_rev_t_naive</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span>ipurge_tr <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">ipurge_tr_rev_t_naive</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

The parameter into which the output is accumulated is the last one.

As shown by the previous argument, the properties of function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ipurge_tr_rev_t_naive</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> that
would have to be proven are the following ones:

\null

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">ipurge_tr_rev_t_naive</span></span> <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">u</span></span> <span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">[]</span></span> <span class="main"><span class="main">=</span></span> ipurge_tr_rev <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">u</span></span> <span class="free"><span class="free">xs</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

\null

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"secure <span class="free"><span class="free">P</span></span> <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="main"><span class="main">⟹</span></span> <span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">∈</span></span> traces <span class="free"><span class="free">P</span></span> <span class="main"><span class="main">⟹</span></span> <span class="free"><span class="free">ipurge_tr_rev_t_naive</span></span> <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">u</span></span> <span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">[]</span></span> <span class="main"><span class="main">∈</span></span> traces <span class="free"><span class="free">P</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

\null

as they clearly entail the above formal statement of the target closure lemma.
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Step 1"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In the definition of the auxiliary tail-recursive function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ipurge_tr_rev_t_aux</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, the
Cartesian product of the input types of function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ipurge_tr_rev_t_naive</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> will be implemented
as a record type.

\null
›</span></span>

<span class="keyword1"><span class="command">record</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec <span class="main">=</span>
  Pol <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> <span class="main">×</span> <span class="tfree">'d</span><span class="main">)</span> set"</span></span>
  Map <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span>"</span></span>
  Dom <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'d</span></span></span>
  In <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
  Out <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="main">(</span>sequential<span class="main">)</span> <span class="entity">ipurge_tr_rev_t_aux</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ipurge_tr_rev_t_aux</span> <span class="main">⦇</span>Pol <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Map <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span> Dom <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span> In <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> Out <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">⦈</span> <span class="main">=</span>
 <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> sources <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>
  <span class="keyword1">then</span> <span class="free">ipurge_tr_rev_t_aux</span>
    <span class="main">⦇</span>Pol <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Map <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span> Dom <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span> In <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> Out <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span><span class="main">⦈</span>
  <span class="keyword1">else</span> <span class="free">ipurge_tr_rev_t_aux</span>
    <span class="main">⦇</span>Pol <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Map <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span> Dom <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span> In <span class="main">=</span> ipurge_tr <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> Out <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">ipurge_tr_rev_t_aux</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">atomize_elim</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec"</span></span>
  <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">I</span> <span class="bound">D</span> <span class="bound">u</span> <span class="bound">x</span> <span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span>
      <span class="skolem">X</span> <span class="main">=</span> <span class="main">⦇</span>Pol <span class="main">=</span> <span class="bound">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="bound">D</span><span class="main">,</span> Dom <span class="main">=</span> <span class="bound">u</span><span class="main">,</span> In <span class="main">=</span> <span class="bound">x</span> <span class="main">#</span> <span class="bound">xs</span><span class="main">,</span> Out <span class="main">=</span> <span class="bound">ys</span><span class="main">⦈</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">I</span> <span class="bound">D</span> <span class="bound">u</span> <span class="bound">ys</span><span class="main">.</span>
      <span class="skolem">X</span> <span class="main">=</span> <span class="main">⦇</span>Pol <span class="main">=</span> <span class="bound">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="bound">D</span><span class="main">,</span> Dom <span class="main">=</span> <span class="bound">u</span><span class="main">,</span> In <span class="main">=</span> <span class="main">[]</span><span class="main">,</span> Out <span class="main">=</span> <span class="bound">ys</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">X</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">subst</span> disj_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> spec <span class="main"><span class="main">[</span></span><span class="operator">OF</span> list.nchotomy<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">termination</span></span> <span class="quoted">ipurge_tr_rev_t_aux</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> length <span class="main">(</span>In <span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">I</span> <span class="skolem">x</span> <span class="skolem">xs</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>ipurge_tr <span class="skolem">I</span> <span class="skolem">D</span> <span class="main">(</span><span class="skolem">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">≤</span> length <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_length<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>ipurge_tr <span class="skolem">I</span> <span class="skolem">D</span> <span class="main">(</span><span class="skolem">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

As shown by this proof, the termination of function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_tr_rev_t_aux</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is guaranteed by the
fact, proven previously, that the event lists output by function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_tr</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are not longer
than the corresponding input ones.
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Step 2"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipurge_tr_rev_t_in</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> <span class="main">×</span> <span class="tfree">'d</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ipurge_tr_rev_t_in</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≡</span>
  <span class="main">⦇</span>Pol <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Map <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span> Dom <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span> In <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> Out <span class="main">=</span> <span class="main">[]</span><span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipurge_tr_rev_t_out</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ipurge_tr_rev_t_out</span> <span class="main">≡</span> Out"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipurge_tr_rev_t</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> <span class="main">×</span> <span class="tfree">'d</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ipurge_tr_rev_t</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≡</span>
  ipurge_tr_rev_t_out <span class="main">(</span>ipurge_tr_rev_t_aux <span class="main">(</span>ipurge_tr_rev_t_in <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Since the significant inputs of function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ipurge_tr_rev_t_naive</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> match pattern <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>_›</span></span></span></span>,
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>_›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>_›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>_›</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, those of function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_tr_rev_t_aux</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, as
returned by function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_tr_rev_t_in</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, match pattern
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⦇Pol = _, Map = _, Dom = _, In = _, Out = []⦈›</span></span></span></span>.

In terms of function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_tr_rev_t</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, the statements to be proven, henceforth respectively
named <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_tr_rev_t_equiv›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_tr_rev_t_trace›</span></span></span></span>, take the following form:

\null

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_t <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">u</span></span> <span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">=</span></span> ipurge_tr_rev <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">u</span></span> <span class="free"><span class="free">xs</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

\null

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"secure <span class="free"><span class="free">P</span></span> <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="main"><span class="main">⟹</span></span> <span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">∈</span></span> traces <span class="free"><span class="free">P</span></span> <span class="main"><span class="main">⟹</span></span> ipurge_tr_rev_t <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">u</span></span> <span class="free"><span class="free">xs</span></span> <span class="main"><span class="main">∈</span></span> traces <span class="free"><span class="free">P</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Step 3"</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">ipurge_tr_rev_t_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec set"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
R0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> <span class="free">ipurge_tr_rev_t_set</span> <span class="free">X</span>"</span></span> <span class="main">|</span>
R1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">⦇</span>Pol <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Map <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span> Dom <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span> In <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> Out <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">⦈</span>
        <span class="main">∈</span> <span class="free">ipurge_tr_rev_t_set</span> <span class="free">X</span><span class="main">;</span>
      <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> sources <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
     <span class="main">⦇</span>Pol <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Map <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span> Dom <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span> In <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> Out <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span><span class="main">⦈</span>
       <span class="main">∈</span> <span class="free">ipurge_tr_rev_t_set</span> <span class="free">X</span>"</span></span> <span class="main">|</span>
R2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">⦇</span>Pol <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Map <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span> Dom <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span> In <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> Out <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">⦈</span>
        <span class="main">∈</span> <span class="free">ipurge_tr_rev_t_set</span> <span class="free">X</span><span class="main">;</span>
      <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> sources <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
     <span class="main">⦇</span>Pol <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span> Map <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span> Dom <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span> In <span class="main">=</span> ipurge_tr <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> Out <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">⦈</span>
       <span class="main">∈</span> <span class="free">ipurge_tr_rev_t_set</span> <span class="free">X</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Step 4"</span></span>

<span class="keyword1" id="InductiveUnwinding-ipurge_tr_rev_t_subset"><span class="command">lemma</span></span> ipurge_tr_rev_t_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">∈</span> ipurge_tr_rev_t_set <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_set <span class="free">Y</span> <span class="main">⊆</span> ipurge_tr_rev_t_set <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> ipurge_tr_rev_t_set.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">∈</span> ipurge_tr_rev_t_set <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">D</span> <span class="skolem">u</span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">ys</span>
  <span class="keyword3"><span class="command">assume</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⦇</span>Pol <span class="main">=</span> <span class="skolem">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="skolem">D</span><span class="main">,</span> Dom <span class="main">=</span> <span class="skolem">u</span><span class="main">,</span> In <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">,</span> Out <span class="main">=</span> <span class="skolem">ys</span><span class="main">⦈</span>
       <span class="main">∈</span> ipurge_tr_rev_t_set <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="skolem">x</span> <span class="main">∈</span> sources <span class="skolem">I</span> <span class="skolem">D</span> <span class="skolem">u</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>Pol <span class="main">=</span> <span class="skolem">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="skolem">D</span><span class="main">,</span> Dom <span class="main">=</span> <span class="skolem">u</span><span class="main">,</span> In <span class="main">=</span> <span class="skolem">xs</span><span class="main">,</span> Out <span class="main">=</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">⦈</span>
    <span class="main">∈</span> ipurge_tr_rev_t_set <span class="free">X</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">D</span> <span class="skolem">u</span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">ys</span>
  <span class="keyword3"><span class="command">assume</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⦇</span>Pol <span class="main">=</span> <span class="skolem">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="skolem">D</span><span class="main">,</span> Dom <span class="main">=</span> <span class="skolem">u</span><span class="main">,</span> In <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">,</span> Out <span class="main">=</span> <span class="skolem">ys</span><span class="main">⦈</span>
       <span class="main">∈</span> ipurge_tr_rev_t_set <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="skolem">x</span> <span class="main">∉</span> sources <span class="skolem">I</span> <span class="skolem">D</span> <span class="skolem">u</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>Pol <span class="main">=</span> <span class="skolem">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="skolem">D</span><span class="main">,</span> Dom <span class="main">=</span> <span class="skolem">u</span><span class="main">,</span> In <span class="main">=</span> ipurge_tr <span class="skolem">I</span> <span class="skolem">D</span> <span class="main">(</span><span class="skolem">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">,</span> Out <span class="main">=</span> <span class="skolem">ys</span><span class="main">⦈</span>
    <span class="main">∈</span> ipurge_tr_rev_t_set <span class="free">X</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="InductiveUnwinding-ipurge_tr_rev_t_aux_set"><span class="command">lemma</span></span> ipurge_tr_rev_t_aux_set<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_aux <span class="free">X</span> <span class="main">∈</span> ipurge_tr_rev_t_set <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_t_aux.induct<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_t_aux.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> R0<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">u</span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="skolem">x</span> <span class="main">∈</span> sources <span class="skolem">I</span> <span class="skolem">D</span> <span class="skolem">u</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">⟹</span>
        ipurge_tr_rev_t_aux
          <span class="main">⦇</span>Pol <span class="main">=</span> <span class="skolem">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="skolem">D</span><span class="main">,</span> Dom <span class="main">=</span> <span class="skolem">u</span><span class="main">,</span> In <span class="main">=</span> <span class="skolem">xs</span><span class="main">,</span> Out <span class="main">=</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">⦈</span>
        <span class="main">∈</span> ipurge_tr_rev_t_set
          <span class="main">⦇</span>Pol <span class="main">=</span> <span class="skolem">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="skolem">D</span><span class="main">,</span> Dom <span class="main">=</span> <span class="skolem">u</span><span class="main">,</span> In <span class="main">=</span> <span class="skolem">xs</span><span class="main">,</span> Out <span class="main">=</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">⦈</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> ipurge_tr_rev_t_aux <span class="var">?Y</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="skolem">x</span> <span class="main">∉</span> sources <span class="skolem">I</span> <span class="skolem">D</span> <span class="skolem">u</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">⟹</span>
        ipurge_tr_rev_t_aux
          <span class="main">⦇</span>Pol <span class="main">=</span> <span class="skolem">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="skolem">D</span><span class="main">,</span> Dom <span class="main">=</span> <span class="skolem">u</span><span class="main">,</span> In <span class="main">=</span> ipurge_tr <span class="skolem">I</span> <span class="skolem">D</span> <span class="main">(</span><span class="skolem">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">,</span> Out <span class="main">=</span> <span class="skolem">ys</span><span class="main">⦈</span>
        <span class="main">∈</span> ipurge_tr_rev_t_set
          <span class="main">⦇</span>Pol <span class="main">=</span> <span class="skolem">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="skolem">D</span><span class="main">,</span> Dom <span class="main">=</span> <span class="skolem">u</span><span class="main">,</span> In <span class="main">=</span> ipurge_tr <span class="skolem">I</span> <span class="skolem">D</span> <span class="main">(</span><span class="skolem">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">,</span> Out <span class="main">=</span> <span class="skolem">ys</span><span class="main">⦈</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> ipurge_tr_rev_t_aux <span class="var">?Z</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_aux
      <span class="main">⦇</span>Pol <span class="main">=</span> <span class="skolem">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="skolem">D</span><span class="main">,</span> Dom <span class="main">=</span> <span class="skolem">u</span><span class="main">,</span> In <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">,</span> Out <span class="main">=</span> <span class="skolem">ys</span><span class="main">⦈</span>
    <span class="main">∈</span> ipurge_tr_rev_t_set
      <span class="main">⦇</span>Pol <span class="main">=</span> <span class="skolem">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="skolem">D</span><span class="main">,</span> Dom <span class="main">=</span> <span class="skolem">u</span><span class="main">,</span> In <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">,</span> Out <span class="main">=</span> <span class="skolem">ys</span><span class="main">⦈</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_aux <span class="var">?X</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="skolem">x</span> <span class="main">∈</span> sources <span class="skolem">I</span> <span class="skolem">D</span> <span class="skolem">u</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> sources.simps<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X</span> <span class="main">∈</span> ipurge_tr_rev_t_set <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R0<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X</span> <span class="main">∈</span> ipurge_tr_rev_t_set <span class="var">?X</span> <span class="main">⟹</span> <span class="var">?Y</span> <span class="main">∈</span> ipurge_tr_rev_t_set <span class="var">?X</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ True<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Y</span> <span class="main">∈</span> ipurge_tr_rev_t_set <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_set <span class="var">?Y</span> <span class="main">⊆</span> ipurge_tr_rev_t_set <span class="var">?X</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_rev_t_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_aux <span class="var">?Y</span> <span class="main">∈</span> ipurge_tr_rev_t_set <span class="var">?Y</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> A<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_aux <span class="var">?Y</span> <span class="main">∈</span> ipurge_tr_rev_t_set <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X</span> <span class="main">∈</span> ipurge_tr_rev_t_set <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R0<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X</span> <span class="main">∈</span> ipurge_tr_rev_t_set <span class="var">?X</span> <span class="main">⟹</span> <span class="var">?Z</span> <span class="main">∈</span> ipurge_tr_rev_t_set <span class="var">?X</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ False<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Z</span> <span class="main">∈</span> ipurge_tr_rev_t_set <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_set <span class="var">?Z</span> <span class="main">⊆</span> ipurge_tr_rev_t_set <span class="var">?X</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_rev_t_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_aux <span class="var">?Z</span> <span class="main">∈</span> ipurge_tr_rev_t_set <span class="var">?Z</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> B<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_aux <span class="var">?Z</span> <span class="main">∈</span> ipurge_tr_rev_t_set <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Step 5"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipurge_tr_rev_t_inv_1</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> <span class="main">×</span> <span class="tfree">'d</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ipurge_tr_rev_t_inv_1</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span>
  Out <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">@</span> ipurge_tr_rev <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span>In <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">=</span> ipurge_tr_rev <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipurge_tr_rev_t_inv_2</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> process <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'d</span> <span class="main">×</span> <span class="tfree">'d</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ipurge_tr_rev_t_inv_2</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span>
  secure <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">∈</span> traces <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟶</span> Out <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">@</span> In <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> traces <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Two invariants have been defined, one for each of lemmas <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_tr_rev_t_equiv›</span></span></span></span>,
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_tr_rev_t_trace›</span></span></span></span>.

More precisely, the invariants are <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_inv_1 <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">u</span></span> <span class="free"><span class="free">xs</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_inv_2 <span class="free"><span class="free">P</span></span> <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">xs</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, where the free variables are intended to match those
appearing in the aforesaid lemmas.
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Step 6"</span></span>

<span class="keyword1" id="InductiveUnwinding-ipurge_tr_rev_t_input_1"><span class="command">lemma</span></span> ipurge_tr_rev_t_input_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_inv_1 <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="main">⦇</span>Pol <span class="main">=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="free">D</span><span class="main">,</span> Dom <span class="main">=</span> <span class="free">u</span><span class="main">,</span> In <span class="main">=</span> <span class="free">xs</span><span class="main">,</span> Out <span class="main">=</span> <span class="main">[]</span><span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_t_inv_1_def<span class="main">)</span>

<span class="keyword1" id="InductiveUnwinding-ipurge_tr_rev_t_input_2"><span class="command">lemma</span></span> ipurge_tr_rev_t_input_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_inv_2 <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="free">xs</span> <span class="main">⦇</span>Pol <span class="main">=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="free">D</span><span class="main">,</span> Dom <span class="main">=</span> <span class="free">u</span><span class="main">,</span> In <span class="main">=</span> <span class="free">xs</span><span class="main">,</span> Out <span class="main">=</span> <span class="main">[]</span><span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_t_inv_2_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Step 7"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipurge_tr_rev_t_form</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> ipurge_rec <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ipurge_tr_rev_t_form</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> In <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>

<span class="keyword1" id="InductiveUnwinding-ipurge_tr_rev_t_intro_1"><span class="command">lemma</span></span> ipurge_tr_rev_t_intro_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span>ipurge_tr_rev_t_inv_1 <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="free">X</span><span class="main">;</span> ipurge_tr_rev_t_form <span class="free">X</span><span class="main">⟧</span> <span class="main">⟹</span>
  ipurge_tr_rev_t_out <span class="free">X</span> <span class="main">=</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_t_inv_1_def ipurge_tr_rev_t_form_def
 ipurge_tr_rev_t_out_def<span class="main">)</span>

<span class="keyword1" id="InductiveUnwinding-ipurge_tr_rev_t_intro_2"><span class="command">lemma</span></span> ipurge_tr_rev_t_intro_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span>ipurge_tr_rev_t_inv_2 <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="free">xs</span> <span class="free">X</span><span class="main">;</span> ipurge_tr_rev_t_form <span class="free">X</span><span class="main">⟧</span> <span class="main">⟹</span>
  secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="main">⟶</span> <span class="free">xs</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">⟶</span> ipurge_tr_rev_t_out <span class="free">X</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_t_inv_2_def ipurge_tr_rev_t_form_def
 ipurge_tr_rev_t_out_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Step 8"</span></span>

<span class="keyword1" id="InductiveUnwinding-ipurge_tr_rev_t_form_aux"><span class="command">lemma</span></span> ipurge_tr_rev_t_form_aux<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_form <span class="main">(</span>ipurge_tr_rev_t_aux <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_t_aux.induct<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_t_form_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Step 9"</span></span>

<span class="keyword1" id="InductiveUnwinding-ipurge_tr_rev_t_invariance_aux"><span class="command">lemma</span></span> ipurge_tr_rev_t_invariance_aux<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">∈</span> ipurge_tr_rev_t_set <span class="free">X</span> <span class="main">⟹</span>
  Pol <span class="free">Y</span> <span class="main">=</span> Pol <span class="free">X</span> <span class="main">∧</span> Map <span class="free">Y</span> <span class="main">=</span> Map <span class="free">X</span> <span class="main">∧</span> Dom <span class="free">Y</span> <span class="main">=</span> Dom <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> ipurge_tr_rev_t_set.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

The lemma just proven, stating the invariance of the first three record fields over inductive set
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_set <span class="free"><span class="free">X</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, is used in the following proofs of the invariance of predicates
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_inv_1 <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">u</span></span> <span class="free"><span class="free">xs</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_inv_2 <span class="free"><span class="free">P</span></span> <span class="free"><span class="free">I</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">xs</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

The equality between the free variables appearing in the predicates and the corresponding fields of
the record generating the set, which is required for such invariance properties to hold, is asserted
in the enunciation of the properties by means of record updates. In the subsequent proofs of lemmas
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_tr_rev_t_equiv›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_tr_rev_t_trace›</span></span></span></span>, the enforcement of this equality will
be ensured by the identification of both predicate variables and record fields with the related free
variables appearing in the lemmas.

\null
›</span></span>

<span class="keyword1" id="InductiveUnwinding-ipurge_tr_rev_t_invariance_1"><span class="command">lemma</span></span> ipurge_tr_rev_t_invariance_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Y</span> <span class="main">∈</span> ipurge_tr_rev_t_set <span class="main">(</span><span class="free">X</span><span class="main">⦇</span>Pol <span class="main">:=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">:=</span> <span class="free">D</span><span class="main">,</span> Dom <span class="main">:=</span> <span class="free">u</span><span class="main">⦈</span><span class="main">)</span><span class="main">;</span>
    ipurge_tr_rev_t_inv_1 <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">ws</span> <span class="main">(</span><span class="free">X</span><span class="main">⦇</span>Pol <span class="main">:=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">:=</span> <span class="free">D</span><span class="main">,</span> Dom <span class="main">:=</span> <span class="free">u</span><span class="main">⦈</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
  ipurge_tr_rev_t_inv_1 <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">ws</span> <span class="free">Y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> ipurge_tr_rev_t_set.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">drule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> ipurge_tr_rev_t_invariance_aux<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_t_inv_1_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> sources.simps<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">ys</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="skolem">x</span> <span class="main">∉</span> sources <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="skolem">xs</span> <span class="main">=</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="main">(</span><span class="main">[]</span> <span class="main">@</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="main">(</span><span class="main">[]</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_rev_ipurge_tr_sources_1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span>
   <span class="quoted"><span class="quoted">"ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="skolem">xs</span> <span class="main">=</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">@</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="skolem">xs</span> <span class="main">=</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">ws</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">@</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">ws</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="InductiveUnwinding-ipurge_tr_rev_t_invariance_2"><span class="command">lemma</span></span> ipurge_tr_rev_t_invariance_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Y</span> <span class="main">∈</span> ipurge_tr_rev_t_set <span class="main">(</span><span class="free">X</span><span class="main">⦇</span>Pol <span class="main">:=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">:=</span> <span class="free">D</span><span class="main">⦈</span><span class="main">)</span><span class="main">;</span>
    ipurge_tr_rev_t_inv_2 <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="free">ws</span> <span class="main">(</span><span class="free">X</span><span class="main">⦇</span>Pol <span class="main">:=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">:=</span> <span class="free">D</span><span class="main">⦈</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
  ipurge_tr_rev_t_inv_2 <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="free">ws</span> <span class="free">Y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> ipurge_tr_rev_t_set.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">drule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> ipurge_tr_rev_t_invariance_aux<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_t_inv_2_def<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">ys</span>
  <span class="keyword3"><span class="command">assume</span></span>
    S<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="main">⟶</span> <span class="free">ws</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">⟶</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">@</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ys</span> <span class="main">@</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> traces_failures<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> futures <span class="free">P</span> <span class="skolem">ys</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secure_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ys</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">,</span> ipurge_ref <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> failures <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> futures_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">@</span> ipurge_tr <span class="free">I</span> <span class="free">D</span> <span class="main">(</span><span class="free">D</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> failures_traces<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Step 10"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Here below are the proofs of lemmas <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_tr_rev_t_equiv›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ipurge_tr_rev_t_trace›</span></span></span></span>,
which are then applied to demonstrate the target closure lemma.

\null
›</span></span>

<span class="keyword1" id="InductiveUnwinding-ipurge_tr_rev_t_equiv"><span class="command">lemma</span></span> ipurge_tr_rev_t_equiv<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ipurge_tr_rev_t <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="main">=</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>Pol <span class="main">=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="free">D</span><span class="main">,</span> Dom <span class="main">=</span> <span class="free">u</span><span class="main">,</span> In <span class="main">=</span> <span class="free">xs</span><span class="main">,</span> Out <span class="main">=</span> <span class="main">[]</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_aux <span class="var">?X</span>
    <span class="main">∈</span> ipurge_tr_rev_t_set <span class="main">(</span><span class="var">?X</span><span class="main">⦇</span>Pol <span class="main">:=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">:=</span> <span class="free">D</span><span class="main">,</span> Dom <span class="main">:=</span> <span class="free">u</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_t_aux_set<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>
   <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_inv_1 <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="main">(</span><span class="var">?X</span><span class="main">⦇</span>Pol <span class="main">:=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">:=</span> <span class="free">D</span><span class="main">,</span> Dom <span class="main">:=</span> <span class="free">u</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_t_input_1<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_inv_1 <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="main">(</span>ipurge_tr_rev_t_aux <span class="var">?X</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_rev_t_invariance_1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_form <span class="main">(</span>ipurge_tr_rev_t_aux <span class="var">?X</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_rev_t_form_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
   <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_out <span class="main">(</span>ipurge_tr_rev_t_aux <span class="var">?X</span><span class="main">)</span> <span class="main">=</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_rev_t_intro_1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X</span> <span class="main">=</span> ipurge_tr_rev_t_in <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_t_in_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_t_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="InductiveUnwinding-ipurge_tr_rev_t_trace"><span class="command">lemma</span></span> ipurge_tr_rev_t_trace <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="main">⟶</span> <span class="free">xs</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">⟶</span> ipurge_tr_rev_t <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>Pol <span class="main">=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">=</span> <span class="free">D</span><span class="main">,</span> Dom <span class="main">=</span> <span class="free">u</span><span class="main">,</span> In <span class="main">=</span> <span class="free">xs</span><span class="main">,</span> Out <span class="main">=</span> <span class="main">[]</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_aux <span class="var">?X</span>
    <span class="main">∈</span> ipurge_tr_rev_t_set <span class="main">(</span><span class="var">?X</span><span class="main">⦇</span>Pol <span class="main">:=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">:=</span> <span class="free">D</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_t_aux_set<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_inv_2 <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="free">xs</span> <span class="main">(</span><span class="var">?X</span><span class="main">⦇</span>Pol <span class="main">:=</span> <span class="free">I</span><span class="main">,</span> Map <span class="main">:=</span> <span class="free">D</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_t_input_2<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_inv_2 <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="free">xs</span> <span class="main">(</span>ipurge_tr_rev_t_aux <span class="var">?X</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_rev_t_invariance_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev_t_form <span class="main">(</span>ipurge_tr_rev_t_aux <span class="var">?X</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_rev_t_form_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="main">⟶</span> <span class="free">xs</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">⟶</span>
    ipurge_tr_rev_t_out <span class="main">(</span>ipurge_tr_rev_t_aux <span class="var">?X</span><span class="main">)</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_rev_t_intro_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X</span> <span class="main">=</span> ipurge_tr_rev_t_in <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_t_in_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_tr_rev_t_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="InductiveUnwinding-ipurge_tr_rev_trace"><span class="command">lemma</span></span> ipurge_tr_rev_trace<span class="main">:</span>
 <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">⟹</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="free">u</span> <span class="free">xs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ipurge_tr_rev_t_equiv <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ipurge_tr_rev_t_trace<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"The Inductive Unwinding Theorem in its general form"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In what follows, the Inductive Unwinding Theorem is proven, in the form applying to a generic
process. The equivalence of the condition expressed by the theorem to CSP noninterference security,
as defined in \cite{R2}, is demonstrated by showing that it is necessary and sufficient for the
verification of the condition expressed by the Ipurge Unwinding Theorem, under the same assumption
that the sets of refusals of the process be closed under union (cf. \cite{R3}).

Particularly, the closure of the traces of a secure process under function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_tr_rev</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and
the idempotence of this function are used in the proof of condition necessity.

\null
›</span></span>

<span class="keyword1" id="InductiveUnwinding-inductive_unwinding_1"><span class="command">lemma</span></span> inductive_unwinding_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    R<span class="main">:</span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    S<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="main">∈</span> traces <span class="free">P</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span><span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span><span class="main">.</span>
    next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span> <span class="main">∧</span>
    ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">=</span> ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">u</span>
  <span class="keyword1"><span class="command">from</span></span> R <span class="keyword2"><span class="keyword">and</span></span> S <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> <span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span><span class="main">.</span> <span class="main">∀</span><span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span>
    <span class="bound">xs</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">∧</span> <span class="bound">ys</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">∧</span>
      ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span> <span class="main">=</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">ys</span> <span class="main">⟶</span>
    next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">ys</span> <span class="main">∧</span>
    ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span> <span class="main">=</span> ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">ys</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_unwinding weakly_future_consistent_def rel_ipurge_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> <span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span>
    <span class="bound">xs</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">∧</span> <span class="bound">ys</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">∧</span>
      ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="bound">xs</span> <span class="main">=</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="bound">ys</span> <span class="main">⟶</span>
    next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="bound">xs</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="bound">ys</span> <span class="main">∧</span>
    ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="bound">xs</span> <span class="main">=</span> ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="bound">ys</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span>
   <span class="quoted"><span class="quoted">"ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">∧</span>
      ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">⟶</span>
    next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">∧</span>
    ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> S <span class="keyword2"><span class="keyword">and</span></span> xs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_rev_trace<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>
   <span class="quoted"><span class="quoted">"ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_rev_idem<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">∧</span>
    ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="InductiveUnwinding-inductive_unwinding_2"><span class="command">lemma</span></span> inductive_unwinding_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    R<span class="main">:</span> <span class="quoted"><span class="quoted">"ref_union_closed <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="main">∈</span> traces <span class="free">P</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span><span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span><span class="main">.</span>
      next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">=</span>
        next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span> <span class="main">∧</span>
      ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">=</span>
        ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipurge_unwinding <span class="main"><span class="main">[</span></span><span class="operator">OF</span> R<span class="main"><span class="main">]</span></span> weakly_future_consistent_def rel_ipurge_def<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">rule</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="skolem">ys</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> S <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span><span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span><span class="main">.</span>
    next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="skolem">xs</span> <span class="main">∧</span>
    ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> <span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span>
   <span class="quoted"><span class="quoted">"next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">∧</span>
    ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> S <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span><span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span><span class="main">.</span>
    next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="skolem">ys</span> <span class="main">∧</span>
    ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span>
   <span class="quoted"><span class="quoted">"next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">ys</span> <span class="main">∧</span>
    ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">ys</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">=</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">ys</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">ys</span> <span class="main">∧</span>
    ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">=</span> ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">ys</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> inductive_unwinding<span class="main">:</span>
 <span class="quoted"><span class="quoted">"ref_union_closed <span class="free">P</span> <span class="main">⟹</span>
  secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">xs</span> <span class="main">∈</span> traces <span class="free">P</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span><span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span><span class="main">.</span>
    next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span> <span class="main">∧</span>
    ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">=</span> ref_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> inductive_unwinding_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> inductive_unwinding_2<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Interestingly, this necessary and sufficient condition for the noninterference security of a process
resembles the classical definition of noninterference security for a deterministic state machine
with outputs formulated in \cite{R5}, which is formalized in \cite{R2} as predicate
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>c_secure›</span></span></span></span>.

Denoting with (1) the former and with (2) the latter, the differences between them can be summarized
as follows:

\begin{itemize}

\item
The event list appearing in (1) is constrained to vary over process traces, whereas the action list
appearing in (2) is unconstrained.
\\This comes as no surprise, since the state machines used as model of computation in \cite{R5}
accept any action list as a trace.

\item
The definition of function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ipurge_tr_rev</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, used in (1), does not implicitly assume that the
noninterference policy be reflexive, even though any policy of practical significance will be such.
On the contrary, the definition of the intransitive purge function used in (2), which is formalized
in \cite{R2} as function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>c_ipurge›</span></span></span></span>, makes this implicit assumption, as shown by the
consideration that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>c_ipurge I D (D x) [x] = [x]›</span></span></span></span> regardless of whether
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">D</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">D</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">∈</span></span> <span class="free"><span class="free">I</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> or not.
\\This is the mathematical reason why the equivalence between CSP noninterference security and
classical noninterference security for deterministic state machines with outputs, proven in
\cite{R2}, is subordinated to the assumption that the noninterference policy be reflexive.

\item
The equality of action outputs appearing in (2) is replaced in (1) by the equality of accepted and
refused events.

\end{itemize}

The binding of the universal quantification over domains contained in (1) does not constitute an
actual difference, since in (2) the purge function is only applied to domains in the range of the
event-domain map, and its output matches the entire input action list, thus rendering the equation
trivial, for domains allowed to be affected by any event domain.
›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"The Inductive Unwinding Theorem for deterministic and trace set processes"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Here below are the proofs of specific variants of the Inductive Unwinding Theorem applying to
deterministic processes and trace set processes \cite{R3}. The variant for deterministic processes
is derived, following the above proof of the general form of the theorem, from the Ipurge Unwinding
Theorem for deterministic processes \cite{R3}. Then, the variant for trace set processes is inferred
from the variant for deterministic processes.

Similarly to what happens for the Ipurge Unwinding Theorem, the refusals union closure assumption
that characterizes the general form of the Inductive Unwinding Theorem is replaced by the assumption
that the process actually be deterministic in the variant for deterministic processes, and by the
assumption that the set of traces actually be such in the variant for trace set processes. Moreover,
these variants involve accepted events only, in accordance with the fact that in deterministic
processes, refused events are completely specified by accepted events (cf. \cite{R4}, \cite{R2}).

\null
›</span></span>

<span class="keyword1" id="InductiveUnwinding-d_inductive_unwinding_1"><span class="command">lemma</span></span> d_inductive_unwinding_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"deterministic <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    S<span class="main">:</span> <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="main">∈</span> traces <span class="free">P</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span><span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span><span class="main">.</span>
    next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">u</span>
  <span class="keyword1"><span class="command">from</span></span> D <span class="keyword2"><span class="keyword">and</span></span> S <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> <span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span><span class="main">.</span> <span class="main">∀</span><span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span>
    <span class="bound">xs</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">∧</span> <span class="bound">ys</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">∧</span>
      ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span> <span class="main">=</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">ys</span> <span class="main">⟶</span>
    next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">ys</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_ipurge_unwinding d_weakly_future_consistent_def rel_ipurge_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> <span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span>
    <span class="bound">xs</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">∧</span> <span class="bound">ys</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">∧</span>
      ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="bound">xs</span> <span class="main">=</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="bound">ys</span> <span class="main">⟶</span>
    next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="bound">xs</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="bound">ys</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span>
   <span class="quoted"><span class="quoted">"ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">∈</span> traces <span class="free">P</span> <span class="main">∧</span>
      ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">⟶</span>
    next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> S <span class="keyword2"><span class="keyword">and</span></span> xs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_rev_trace<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>
   <span class="quoted"><span class="quoted">"ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipurge_tr_rev_idem<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="InductiveUnwinding-d_inductive_unwinding_2"><span class="command">lemma</span></span> d_inductive_unwinding_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"deterministic <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="main">∈</span> traces <span class="free">P</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span><span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span><span class="main">.</span>
      next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_ipurge_unwinding <span class="main"><span class="main">[</span></span><span class="operator">OF</span> D<span class="main"><span class="main">]</span></span> d_weakly_future_consistent_def rel_ipurge_def<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">rule</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="skolem">ys</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> S <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span><span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span><span class="main">.</span>
    next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> <span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span>
   <span class="quoted"><span class="quoted">"next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">∈</span> traces <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> S <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span><span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span><span class="main">.</span>
    next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span>
   <span class="quoted"><span class="quoted">"next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">ys</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">=</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">ys</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">ys</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> d_inductive_unwinding<span class="main">:</span>
 <span class="quoted"><span class="quoted">"deterministic <span class="free">P</span> <span class="main">⟹</span>
  secure <span class="free">P</span> <span class="free">I</span> <span class="free">D</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">xs</span> <span class="main">∈</span> traces <span class="free">P</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span><span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span><span class="main">.</span>
    next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">=</span> next_dom_events <span class="free">P</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> d_inductive_unwinding_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> d_inductive_unwinding_2<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> ts_inductive_unwinding<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"trace_set <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"secure <span class="main">(</span>ts_process <span class="free">T</span><span class="main">)</span> <span class="free">I</span> <span class="free">D</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">xs</span> <span class="main">∈</span> <span class="free">T</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span><span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">D</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">u</span><span class="main">}</span><span class="main">.</span>
      <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span> <span class="main">@</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">xs</span> <span class="main">@</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"secure <span class="var">?P</span> <span class="free">I</span> <span class="free">D</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> d_inductive_unwinding<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ts_process_d <span class="main"><span class="main">[</span></span><span class="operator">OF</span> T<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> next_dom_events_def ts_process_next_events <span class="main"><span class="main">[</span></span><span class="operator">OF</span> T<span class="main"><span class="main">]</span></span> set_eq_iff<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> ballI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> allI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">u</span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="main">∈</span> traces <span class="var">?P</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> <span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span><span class="main">.</span>
    <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span> <span class="main">=</span> <span class="free">D</span> <span class="bound">x</span> <span class="main">∧</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span> <span class="main">@</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">u</span> <span class="main">=</span> <span class="free">D</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">xs</span> <span class="main">@</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"traces <span class="var">?P</span> <span class="main">=</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ts_process_traces<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> traces <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> <span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span><span class="main">.</span>
    <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span> <span class="main">=</span> <span class="free">D</span> <span class="bound">x</span> <span class="main">∧</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="bound">u</span> <span class="main">=</span> <span class="free">D</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> <span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="bound">x</span> <span class="main">∧</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">x</span> <span class="main">∧</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">D</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">u</span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="main">∈</span> <span class="free">T</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> <span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span><span class="main">.</span>
    <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">D</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">u</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="bound">xs</span> <span class="main">@</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">xs</span> <span class="main">@</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> traces <span class="var">?P</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"traces <span class="var">?P</span> <span class="main">=</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ts_process_traces<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> <span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span><span class="main">.</span>
    <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">D</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">u</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="bound">u</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> range <span class="free">D</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span> <span class="free">I</span><span class="main">)</span> <span class="main">``</span> range <span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">D</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">x</span> <span class="main">∧</span> ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="skolem">u</span> <span class="main">=</span> <span class="free">D</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">D</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">u</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> B <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipurge_tr_rev <span class="free">I</span> <span class="free">D</span> <span class="skolem">u</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> <span class="free">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>