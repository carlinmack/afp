<div id="Dual_Order">
<div class="head">
<h1>Theory Dual_Order</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Dual_Order.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Dual Order"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Dual_Order
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Interpretation of dual wellorder based on wellorder›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> wf_wellorderI2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>ord<span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lin<span class="main">:</span> <span class="quoted"><span class="quoted">"class.linorder <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"class.wellorder <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lin <span class="keyword1"><span class="command">unfolding</span></span> class.wellorder_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> class.wellorder_axioms.intro<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_induct_rule <span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf<span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> preorder<span class="main">)</span> tranclp_less'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(&gt;)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="main">(&gt;)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> less_trans <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> tranclp.induct<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> dual_wellorder<span class="main">:</span> wellorder <span class="quoted"><span class="quoted">"<span class="main">(≥)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>linorder<span class="main">,</span> finite<span class="main">}</span><span class="main">=&gt;</span><span class="tfree">'a</span><span class="main">=&gt;</span>bool<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&gt;)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wf_wellorderI2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">{</span><span class="main">(</span><span class="bound">x</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trancl_def tranclp_less' <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> finite_acyclic_wf acyclicI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"class.linorder <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> class.linorder_def <span class="keyword1"><span class="command">unfolding</span></span> class.linorder_axioms_def <span class="keyword1"><span class="command">unfolding</span></span> class.order_def 
    <span class="keyword1"><span class="command">unfolding</span></span> class.preorder_def <span class="keyword1"><span class="command">unfolding</span></span> class.order_axioms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Properties of the Greatest operator›</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> dual_wellorder_Least_eq_Greatest<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dual_wellorder.Least <span class="main">=</span> Greatest"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Greatest_def dual_wellorder.Least_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> GreatestI <span class="main">=</span> dual_wellorder.LeastI<span class="main">[</span><span class="operator">unfolded</span> dual_wellorder_Least_eq_Greatest<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> GreatestI2_ex <span class="main">=</span> dual_wellorder.LeastI2_ex<span class="main">[</span><span class="operator">unfolded</span> dual_wellorder_Least_eq_Greatest<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> GreatestI2_wellorder <span class="main">=</span> dual_wellorder.LeastI2_wellorder<span class="main">[</span><span class="operator">unfolded</span> dual_wellorder_Least_eq_Greatest<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> GreatestI_ex <span class="main">=</span> dual_wellorder.LeastI_ex<span class="main">[</span><span class="operator">unfolded</span> dual_wellorder_Least_eq_Greatest<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> not_greater_Greatest <span class="main">=</span> dual_wellorder.not_less_Least<span class="main">[</span><span class="operator">unfolded</span> dual_wellorder_Least_eq_Greatest<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> GreatestI2 <span class="main">=</span> dual_wellorder.LeastI2<span class="main">[</span><span class="operator">unfolded</span> dual_wellorder_Least_eq_Greatest<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> Greatest_ge <span class="main">=</span> dual_wellorder.Least_le<span class="main">[</span><span class="operator">unfolded</span> dual_wellorder_Least_eq_Greatest<span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Mod_Type">
<div class="head">
<h1>Theory Mod_Type</h1>
</div>
<pre class="source"><span class="comment1">(*
    Title:      Mod_Type.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Class for modular arithmetic›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Mod_Type
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Numeral_Type.html">HOL-Library.Numeral_Type</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Analysis/Cartesian_Euclidean_Space.html">HOL-Analysis.Cartesian_Euclidean_Space</a>"</span>
  <a href="Dual_Order.html">Dual_Order</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definition and properties›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Class for modular arithmetic. It is inspired by the locale mod\_type.›</span></span>

<span class="keyword1"><span class="command">class</span></span> mod_type <span class="main">=</span> times <span class="main">+</span> wellorder <span class="main">+</span> neg_numeral <span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">Rep</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">=&gt;</span> int"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free"><span class="free"><span class="free">Abs</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">=&gt;</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> type<span class="main">:</span> <span class="quoted"><span class="quoted">"type_definition <span class="free">Rep</span> <span class="free">Abs</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>int <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> size1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> int <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zero_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="free">Abs</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> one_def<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="free">Abs</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> add_def<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="free">Abs</span> <span class="main">(</span><span class="main">(</span><span class="free">Rep</span> <span class="free">x</span> <span class="main">+</span> <span class="free">Rep</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>int <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> mult_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">Abs</span> <span class="main">(</span><span class="main">(</span><span class="free">Rep</span> <span class="free">x</span> <span class="main">*</span> <span class="free">Rep</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>int <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> diff_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="main">=</span> <span class="free">Abs</span> <span class="main">(</span><span class="main">(</span><span class="free">Rep</span> <span class="free">x</span> <span class="main">-</span> <span class="free">Rep</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>int <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> minus_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">x</span> <span class="main">=</span> <span class="free">Abs</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="free">Rep</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>int <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> strict_mono_Rep<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono <span class="free">Rep</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> size0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> int <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> size1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemmas</span></span> definitions <span class="main">=</span>
  zero_def one_def add_def mult_def minus_def diff_def

<span class="keyword1"><span class="command">lemma</span></span> Rep_less_n<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep <span class="free">x</span> <span class="main">&lt;</span> int <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> type_definition.Rep <span class="main"><span class="main">[</span></span><span class="operator">OF</span> type<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct2<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_le_n<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep <span class="free">x</span> <span class="main">≤</span> int <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Rep_less_n <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> order_less_imp_le<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_inject_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟷</span> Rep <span class="free">x</span> <span class="main">=</span> Rep <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> type_definition.Rep_inject <span class="main"><span class="main">[</span></span><span class="operator">OF</span> type<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_inverse<span class="main">:</span> <span class="quoted"><span class="quoted">"Abs <span class="main">(</span>Rep <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> type_definition.Rep_inverse <span class="main"><span class="main">[</span></span><span class="operator">OF</span> type<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Abs_inverse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>int <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span> <span class="main">⟹</span> Rep <span class="main">(</span>Abs <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> type_definition.Abs_inverse <span class="main"><span class="main">[</span></span><span class="operator">OF</span> type<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_Abs_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep <span class="main">(</span>Abs <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> int <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="keyword1">mod</span> int <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_inverse pos_mod_conj <span class="main"><span class="main">[</span></span><span class="operator">OF</span> size0<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_Abs_0<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep <span class="main">(</span>Abs <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Abs_inverse <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> size0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_0<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_def Rep_Abs_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_Abs_1<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep <span class="main">(</span>Abs <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_inverse size1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_1<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_def Rep_Abs_1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep <span class="free">x</span> <span class="keyword1">mod</span> int <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> Rep <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> type_definition.Abs_cases <span class="main"><span class="main">[</span></span><span class="operator">OF</span> type<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> type_definition.Abs_inverse <span class="main"><span class="main">[</span></span><span class="operator">OF</span> type<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Rep_simps <span class="main">=</span>
  Rep_inject_sym Rep_inverse Rep_Abs_mod Rep_mod Rep_Abs_0 Rep_Abs_1

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Conversion between a modular class and the subset of natural numbers associated.›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Definitions to make transformations among elements of a modular class and naturals›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">to_nat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">=&gt;</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">to_nat</span> <span class="main">=</span> nat <span class="main">∘</span> Rep"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Abs'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">=&gt;</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Abs'</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Abs<span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">mod</span> int <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">from_nat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">from_nat</span> <span class="main">=</span> <span class="main">(</span>Abs' <span class="main">∘</span> int<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_Rep<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>Rep<span class="main">)</span> <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> bij_betw_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj Rep"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> strict_mono_imp_inj_on strict_mono_Rep<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range Rep <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Typedef.type_definition.Rep_range<span class="main">[</span><span class="operator">OF</span> type<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_Rep<span class="main">:</span> <span class="quoted"><span class="quoted">"mono Rep"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> strict_mono_Rep strict_mono_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_ge_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> Rep <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_Rep <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> bij_Abs<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>Abs<span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span> <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> bij_betw_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on Abs <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inj_on_inverseI type type_definition.Abs_inverse<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Abs <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> type type_definition.univ<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> bij_Abs'<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>Abs'<span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span> <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> bij_betw_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on Abs' <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def Abs'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Rep_Abs_mod mod_pos_pos_trivial<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Abs' <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> image_def Abs'_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xa</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> Abs <span class="bound">xa</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Rep <span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_less_n<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span> Rep_ge_0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Rep_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_from_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>from_nat<span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span> <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> bij_betw_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> set_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">::</span>int<span class="main">..&lt;</span>int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> int<span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">int</span>  <span class="keyword3"><span class="command">assume</span></span> x1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> int <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span>nat<span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"nat <span class="skolem"><span class="skolem">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">=</span> int <span class="main">(</span>nat <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nat <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span>nat<span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x1 x2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>from_nat<span class="main">::</span>nat<span class="main">⇒</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span>nat<span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> from_nat_def <span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> comp_inj_on<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on int <span class="main">{</span><span class="main">0</span><span class="main">::</span>nat<span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inj_of_nat subset_inj_on top_greatest<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>Abs'<span class="main">::</span>int<span class="main">=&gt;</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span>int <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span>nat<span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bij_Abs <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def set_eq
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> Abs'_def Abs_inverse Rep_inverse Rep_mod inj_on_def set_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat<span class="main">::</span>nat<span class="main">=&gt;</span><span class="tfree">'a</span><span class="main">)</span><span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span>nat<span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> from_nat_def <span class="keyword1"><span class="command">using</span></span> bij_Abs'
    <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def set_eq o_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> to_nat_is_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"the_inv_into <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span> <span class="main">(</span>from_nat<span class="main">::</span>nat<span class="main">=&gt;</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>to_nat<span class="main">::</span><span class="tfree">'a</span><span class="main">=&gt;</span>nat<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> the_inv_into_def fun_eq_iff from_nat_def to_nat_def o_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">y</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span>nat<span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span> Abs' <span class="main">(</span>int <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> nat <span class="main">(</span>Rep <span class="skolem">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" Abs' <span class="main">(</span>Rep <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Abs'_def Rep_inverse Rep_mod<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span>Rep <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Rep_less_n nat_int size0 zless_nat_conj<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≤</span> Rep <span class="skolem">x</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Abs' <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Rep_ge_0 x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Rep<span class="main">(</span>Abs'<span class="main">(</span>int <span class="skolem">y</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Rep<span class="main">(</span><span class="main">(</span>Abs<span class="main">(</span>int <span class="skolem">y</span> <span class="keyword1">mod</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Abs'_def <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span>Rep <span class="main">(</span>Abs <span class="main">(</span>int <span class="skolem">y</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zmod_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> y mod_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span>int <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Abs_inverse<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span>int<span class="main">..&lt;</span>int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> nat <span class="main">(</span>Rep <span class="main">(</span>Abs' <span class="main">(</span>int <span class="skolem">y</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nat_int<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_to_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>to_nat<span class="main">)</span> <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bij_betw_the_inv_into<span class="main">[</span><span class="operator">OF</span> bij_from_nat<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> to_nat_is_inv <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_mod_type<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finite_imageD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"to_nat"</span></span> <span class="quoted"><span class="quoted">"UNIV<span class="main">::</span><span class="tfree">'a</span> set"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> bij_to_nat <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subclass</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> mod_type<span class="main">)</span> finite <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> finite_mod_type<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> least_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">≤</span> Abs <span class="main">(</span>Rep <span class="skolem">y</span> <span class="keyword1">mod</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> strict_mono_Rep <span class="keyword1"><span class="command">unfolding</span></span> strict_mono_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> Rep_0 Rep_ge_0 strict_mono_Rep strict_mono_less_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_inverse Rep_mod<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> add_to_nat_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> from_nat <span class="main">(</span>to_nat <span class="free">x</span> <span class="main">+</span> to_nat <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> from_nat_def to_nat_def o_def <span class="keyword1"><span class="command">using</span></span> Rep_ge_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> Rep_ge_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> Rep_less_n<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> Rep_less_n<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> Abs'_def <span class="keyword1"><span class="command">unfolding</span></span> add_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> to_nat_1<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_nat_def Rep_1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> add_def'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> Abs' <span class="main">(</span>Rep <span class="free">x</span> <span class="main">+</span> Rep <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Abs'_def <span class="keyword1"><span class="command">using</span></span> add_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> Abs'_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Abs' <span class="main">(</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> Abs'_def mod_self zero_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_plus_one_le_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Rep <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep <span class="free">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> to_nat_eq_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep <span class="free">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Rep_less_n
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add1_zle_eq order_class.less_le<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">+</span><span class="main">1</span> <span class="main">=</span> Abs' <span class="main">(</span>Rep <span class="free">a</span> <span class="main">+</span> Rep <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> add_def' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs' <span class="main">(</span><span class="main">(</span>Rep <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Rep_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs' <span class="main">(</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_nat_eq_card <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Abs'_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> to_nat_plus_one_less_card<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">+</span><span class="main">1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">--&gt;</span> to_nat <span class="bound">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
<span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep <span class="skolem">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Rep_plus_one_le_card<span class="main">[</span><span class="operator">OF</span> a<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span>Rep <span class="skolem">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> nat <span class="main">(</span>int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> zless_nat_conj <span class="keyword1"><span class="command">using</span></span> size0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="skolem">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_nat_def o_def <span class="keyword1"><span class="command">using</span></span> nat_add_distrib<span class="main">[</span><span class="operator">OF</span> Rep_ge_0<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> to_nat_plus_one_less_card'<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">+</span><span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> to_nat_plus_one_less_card assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> strict_mono_to_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono to_nat"</span></span>
  <span class="keyword1"><span class="command">using</span></span> strict_mono_Rep
  <span class="keyword1"><span class="command">unfolding</span></span> strict_mono_def to_nat_def <span class="keyword1"><span class="command">using</span></span> Rep_ge_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_apply nat_less_eq_zless<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> to_nat_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="free">x</span> <span class="main">=</span> to_nat <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> injD <span class="main">[</span><span class="operator">OF</span> bij_betw_imp_inj_on<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bij_to_nat<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> mod_type_forall_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> <span class="main">(</span>to_nat <span class="bound">j</span><span class="main">)</span><span class="main">&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span>to_nat<span class="main">::</span><span class="tfree">'a</span><span class="main">=&gt;</span>nat<span class="main">)</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">j</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>to_nat<span class="main">::</span><span class="tfree">'a</span><span class="main">=&gt;</span>nat<span class="main">)</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_to_nat <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> to_nat_from_nat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> t<span class="main">:</span><span class="quoted"><span class="quoted">"to_nat <span class="free">j</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">k</span> <span class="main">=</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">k</span> <span class="main">=</span> from_nat <span class="main">(</span>to_nat <span class="free">j</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> t <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> from_nat <span class="main">(</span>the_inv_into <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span> <span class="main">(</span>from_nat<span class="main">)</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_nat_is_inv <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> f_the_inv_into_f<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on from_nat <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_imp_inj_on bij_from_nat<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> from_nat <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UNIV_I bij_betw_def bij_from_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">k</span> <span class="main">=</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> to_nat_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">&lt;</span> to_nat <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> strict_mono_to_nat <span class="keyword1"><span class="command">unfolding</span></span> strict_mono_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">lemma</span></span> to_nat_mono'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">≤</span> to_nat <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="free">b</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> to_nat_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> least_mod_type<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">n</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> least_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Least_le UNIV_I<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> to_nat_from_nat_id<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="main">(</span>from_nat <span class="free">x</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> to_nat_is_inv<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the_inv_into_f_f<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>from_nat<span class="main">::</span>nat<span class="main">=&gt;</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_from_nat <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> from_nat_to_nat_id<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="main">(</span>to_nat <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> to_nat_from_nat<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> from_nat_to_nat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> t<span class="main">:</span><span class="quoted"><span class="quoted">"from_nat <span class="free">j</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">k</span> <span class="main">=</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> j t to_nat_from_nat_id<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> from_nat_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i_le_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat <span class="free">i</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">&lt;</span> from_nat <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_le_j j <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">=</span>to_nat <span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bij_to_nat <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">using</span></span> i to_nat_from_nat_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">=</span>to_nat <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bij_to_nat <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">using</span></span> j to_nat_from_nat_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a b from_nat_to_nat_id i_le_j strict_mono_less strict_mono_to_nat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> from_nat_mono'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i_le_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span><span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat <span class="free">i</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">≤</span> from_nat <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">=</span><span class="free">j</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat <span class="free">i</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> from_nat <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_le_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> from_nat_mono less_imp_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> to_nat_suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">+</span><span class="main">1</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>to_nat <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> from_nat <span class="main">(</span>to_nat <span class="free">x</span> <span class="main">+</span> to_nat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> add_to_nat_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> to_nat <span class="main">(</span>from_nat <span class="main">(</span>to_nat <span class="free">x</span> <span class="main">+</span> to_nat <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> to_nat <span class="main">(</span>from_nat <span class="main">(</span>to_nat <span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_nat_1 <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>to_nat <span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms to_nat_from_nat_id<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> to_nat_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&lt;</span> from_nat <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"to_nat <span class="free">y</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> True assms to_nat_from_nat_id to_nat_mono<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">y</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_to_nat <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> le_Suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">b</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span>from_nat <span class="main">(</span>to_nat <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> from_nat_to_nat_id <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">,</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span>from_nat <span class="main">(</span>to_nat <span class="main">(</span><span class="free">b</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> from_nat_mono'<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">&lt;</span> to_nat <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> to_nat_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> to_nat <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">b</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_to_nat <span class="keyword1"><span class="command">unfolding</span></span>  bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹to_nat <span class="free">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> to_nat <span class="free">b</span>›</span></span> preorder_class.le_less_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> to_nat <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹to_nat <span class="free">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> to_nat <span class="free">b</span>›</span></span> to_nat_suc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_to_nat_id<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> le_Suc'<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> less_card<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>to_nat <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">(</span>from_nat <span class="main">(</span>to_nat <span class="free">a</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> from_nat_to_nat_id <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span><span class="main">,</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="main">(</span>from_nat <span class="main">(</span>to_nat <span class="free">b</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> from_nat_mono<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">b</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_to_nat <span class="keyword1"><span class="command">unfolding</span></span>  bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span>  to_nat <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> to_nat_mono'<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span>  to_nat <span class="free">b</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> to_nat_suc<span class="main">[</span><span class="operator">OF</span> less_card<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">&lt;</span> to_nat <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> to_nat_from_nat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Suc_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> less_card<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>to_nat <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>to_nat <span class="free">a</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>to_nat <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>to_nat <span class="free">a</span><span class="main">)</span> <span class="main">&lt;</span> to_nat <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_card to_nat_suc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>from_nat <span class="main">(</span>to_nat <span class="free">a</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">&lt;</span> from_nat <span class="main">(</span>to_nat <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> from_nat_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> less_card to_nat_suc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> to_nat_from_nat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Suc_le'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc_le to_nat_plus_one_less_card assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> from_nat_not_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a_eq_to_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> to_nat <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a_less_card<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> from_nat <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="main">(</span><span class="main">(</span>from_nat <span class="free">a</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> to_nat <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_eq_to_nat a_less_card to_nat_from_nat_id<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Suc_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">+</span><span class="main">1</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">&lt;</span><span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms le_Suc le_neq_trans<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> Greatest_is_minus_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> zero_ge_card_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> size1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> card_less<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">mod</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> Rep_Abs_1 Rep_mod zero_neq_one<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> int_card<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> of_nat_diff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> size1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> Abs' <span class="main">(</span>Rep <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> Rep_0 add_0_right add_def'
      monoid_add_class.add.right_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs' <span class="main">(</span>int <span class="main">(</span>nat <span class="main">(</span>Rep <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_ge_0 int_nat_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>  <span class="main">≤</span> Abs' <span class="main">(</span>int <span class="main">(</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> from_nat_mono'<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> from_nat_def o_def<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"nat <span class="main"><span class="main">(</span></span>Rep <span class="skolem"><span class="skolem">a</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">CARD</span></span><span class="main"><span class="main">(</span></span><span class="tfree"><span class="tfree">'a</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span>Rep <span class="skolem">a</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Rep_less_n
      <span class="keyword1"><span class="command">using</span></span> int_card nat_le_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_UNIV_card_ge_0 finite_mod_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Abs'_def <span class="keyword1"><span class="command">unfolding</span></span> minus_def zmod_zminus1_eq_if <span class="keyword1"><span class="command">unfolding</span></span> Rep_1
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cong <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">Abs</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> refl<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> if_not_P <span class="main">[</span><span class="operator">OF</span> not_zero<span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> int_card
  <span class="keyword1"><span class="command">unfolding</span></span> mod_pos_pos_trivial<span class="main">[</span><span class="operator">OF</span> zero_ge_card_1 card_less<span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> mod_pos_pos_trivial<span class="main">[</span><span class="operator">OF</span> _ size1<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> a_eq_minus_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> <span class="bound">a</span><span class="main">+</span><span class="main">1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_neg_iff_add_eq_0<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> forall_from_nat_rw<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>from_nat <span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>from_nat <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>from_nat <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x1<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span>from_nat <span class="skolem">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_from_nat <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> from_nat_to_nat_id rangeI the_inv_into_onto to_nat_is_inv<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>from_nat <span class="skolem">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x1 <span class="keyword1"><span class="command">using</span></span> * x2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> from_nat_eq_imp_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>from_nat <span class="free">xa</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xa</span><span class="main">&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="free">xa</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms from_nat_not_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> to_nat_less_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">j</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">j</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bij_to_nat <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> from_nat_0<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> from_nat_def o_def of_nat_0 Abs'_def mod_0 zero_def <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">lemma</span></span> to_nat_0<span class="main">:</span> <span class="quoted"><span class="quoted">"to_nat <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> to_nat_def o_def Rep_0 nat_0 <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">lemma</span></span> to_nat_eq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>to_nat <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_nat_0 from_nat_0 <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> to_nat_from_nat<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> suc_not_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">+</span><span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a_plus_one_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> rep_eq_card<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep <span class="free">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms to_nat_0 Suc_eq_plus1 Suc_lessI Zero_not_Suc to_nat_less_card to_nat_suc
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep <span class="free">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Abs'_0 Rep_1 Suc_eq_plus1 Suc_lessI Suc_neq_Zero add_def' assms
    rep_eq_card to_nat_0 to_nat_less_card to_nat_suc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> from_nat_suc<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> from_nat <span class="free">j</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> from_nat_def o_def Abs'_def add_def' Rep_1 Rep_Abs_mod
<span class="keyword1"><span class="command">unfolding</span></span> of_nat_add <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mod_add_left_eq<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> of_nat_1 <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> to_nat_plus_1_set<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"to_nat <span class="free">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> to_nat_less_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> from_nat_CARD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"from_nat <span class="main">(</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> from_nat_def o_def Abs'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Instantiations›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> bit0 <span class="keyword2"><span class="keyword">and</span></span> bit1<span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">finite</span></span><span class="main">)</span> <span class="quoted"><span class="quoted">mod_type</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Rep<span class="main">::</span><span class="tfree">'a</span> bit0 <span class="main">=&gt;</span> int<span class="main">)</span>  <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Rep_bit0 <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Abs<span class="main">::</span>int <span class="main">=&gt;</span> <span class="tfree">'a</span> bit0<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Abs_bit0' <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Rep<span class="main">::</span><span class="tfree">'a</span> bit1 <span class="main">=&gt;</span> int<span class="main">)</span>  <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Rep_bit1 <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Abs<span class="main">::</span>int <span class="main">=&gt;</span> <span class="tfree">'a</span> bit1<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Abs_bit1' <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> bit0<span class="main">)</span> <span class="main">=</span> Abs <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Abs_bit0_def Abs_bit0'_def zero_bit0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span> <span class="main">&lt;</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span> bit0<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bit0.size1<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"type_definition <span class="main">(</span>Rep<span class="main">::</span><span class="tfree">'a</span> bit0 <span class="main">=&gt;</span> int<span class="main">)</span> <span class="main">(</span>Abs<span class="main">::</span> int <span class="main">=&gt;</span> <span class="tfree">'a</span> bit0<span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span>int<span class="main">..&lt;</span>int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span> bit0<span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> type_definition_def Rep_bit0_def <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span>
      Abs_bit0_def <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> Abs_bit0'_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span> bit0<span class="main">.</span> Rep_bit0 <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span>int<span class="main">..&lt;</span>int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span> bit0<span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> card_bit0 <span class="keyword1"><span class="command">unfolding</span></span> of_nat_mult
      <span class="keyword1"><span class="command">using</span></span> Rep_bit0 <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span> bit0<span class="main">.</span> Abs_bit0 <span class="main">(</span>Rep_bit0 <span class="bound">x</span> <span class="keyword1">mod</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span> bit0<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_bit0_inverse bit0.Rep_mod<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span>int<span class="main">..&lt;</span>int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span> bit0<span class="main">)</span><span class="main">}</span>
      <span class="main">⟶</span> Rep_bit0 <span class="main">(</span><span class="main">(</span>Abs_bit0<span class="main">::</span>int <span class="main">=&gt;</span> <span class="tfree">'a</span> bit0<span class="main">)</span> <span class="main">(</span><span class="bound">y</span> <span class="keyword1">mod</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span> bit0<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bit0.Abs_inverse bit0.Rep_mod<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> bit0<span class="main">)</span> <span class="main">=</span> Abs <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Abs_bit0_def Abs_bit0'_def one_bit0_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bit0.of_nat_eq of_nat_1 one_bit0_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bit0"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> Abs <span class="main">(</span><span class="main">(</span>Rep <span class="skolem">x</span> <span class="main">+</span> Rep <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">mod</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span> bit0<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Abs_bit0_def Rep_bit0_def plus_bit0_def Abs_bit0'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">=</span> Abs <span class="main">(</span>Rep <span class="skolem">x</span> <span class="main">*</span> Rep <span class="skolem">y</span> <span class="keyword1">mod</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span> bit0<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Abs_bit0_def Rep_bit0_def times_bit0_def Abs_bit0'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span> <span class="main">=</span> Abs <span class="main">(</span><span class="main">(</span>Rep <span class="skolem">x</span> <span class="main">-</span> Rep <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">mod</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span> bit0<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Abs_bit0_def Rep_bit0_def minus_bit0_def Abs_bit0'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">x</span> <span class="main">=</span> Abs <span class="main">(</span><span class="main">-</span> Rep <span class="skolem">x</span> <span class="keyword1">mod</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span> bit0<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Abs_bit0_def Rep_bit0_def uminus_bit0_def Abs_bit0'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span> bit1<span class="main">)</span> <span class="main">=</span> Abs <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Abs_bit1_def Abs_bit1'_def zero_bit1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span> <span class="main">&lt;</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span> bit1<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bit1.size1<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span> bit1<span class="main">)</span> <span class="main">=</span> Abs <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Abs_bit1_def Abs_bit1'_def one_bit1_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bit1.of_nat_eq of_nat_1 one_bit1_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bit1"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> Abs <span class="main">(</span><span class="main">(</span>Rep <span class="skolem">x</span> <span class="main">+</span> Rep <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">mod</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span> bit1<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Abs_bit1_def Abs_bit1'_def Rep_bit1_def plus_bit1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">=</span> Abs <span class="main">(</span>Rep <span class="skolem">x</span> <span class="main">*</span> Rep <span class="skolem">y</span> <span class="keyword1">mod</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span> bit1<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Abs_bit1_def Rep_bit1_def times_bit1_def Abs_bit1'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span> <span class="main">=</span> Abs <span class="main">(</span><span class="main">(</span>Rep <span class="skolem">x</span> <span class="main">-</span> Rep <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">mod</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span> bit1<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Abs_bit1_def Rep_bit1_def minus_bit1_def Abs_bit1'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">x</span> <span class="main">=</span> Abs <span class="main">(</span><span class="main">-</span> Rep <span class="skolem">x</span> <span class="keyword1">mod</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span> bit1<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Abs_bit1_def Rep_bit1_def uminus_bit1_def Abs_bit1'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"type_definition <span class="main">(</span>Rep<span class="main">::</span><span class="tfree">'a</span> bit1 <span class="main">=&gt;</span> int<span class="main">)</span> <span class="main">(</span>Abs<span class="main">::</span> int <span class="main">=&gt;</span> <span class="tfree">'a</span> bit1<span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span>int<span class="main">..&lt;</span>int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span> bit1<span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> type_definition_def Rep_bit1_def <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span>
      Abs_bit1_def <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> Abs_bit1'_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> int_2<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="numeral">2</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span> bit1<span class="main">.</span> Rep_bit1 <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span>int<span class="main">..&lt;</span>int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span> bit1<span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> card_bit1
      <span class="keyword1"><span class="command">unfolding</span></span> of_nat_Suc of_nat_mult
      <span class="keyword1"><span class="command">using</span></span> Rep_bit1 <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> int_2 <span class="keyword1"><span class="command">..</span></span>
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span> bit1<span class="main">.</span> Abs_bit1 <span class="main">(</span>Rep_bit1 <span class="bound">x</span> <span class="keyword1">mod</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span> bit1<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_bit1_inverse bit1.Rep_mod<span class="main">)</span>
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span>int<span class="main">..&lt;</span>int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span> bit1<span class="main">)</span><span class="main">}</span>
    <span class="main">⟶</span> Rep_bit1 <span class="main">(</span><span class="main">(</span>Abs_bit1<span class="main">::</span>int <span class="main">=&gt;</span> <span class="tfree">'a</span> bit1<span class="main">)</span> <span class="main">(</span><span class="bound">y</span> <span class="keyword1">mod</span> int <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'a</span> bit1<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">y</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bit1.Abs_inverse bit1.Rep_mod<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strict_mono <span class="main">(</span>Rep<span class="main">::</span><span class="tfree">'a</span> bit0 <span class="main">=&gt;</span> int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> strict_mono_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_bit0_def less_bit0_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strict_mono <span class="main">(</span>Rep<span class="main">::</span><span class="tfree">'a</span> bit1 <span class="main">=&gt;</span> int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> strict_mono_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_bit1_def less_bit1_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


</pre>
</div><div id="Miscellaneous">
<div class="head">
<h1>Theory Miscellaneous</h1>
</div>
<pre class="source"><span class="comment1">(* 
    Title:      Miscellaneous.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Miscellaneous›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Miscellaneous
  <span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Analysis/Determinants.html">HOL-Analysis.Determinants</a>"</span>
  <a href="Mod_Type.html">Mod_Type</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Function_Algebras.html">HOL-Library.Function_Algebras</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> Vector_Spaces.linear <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> vector_space_pair <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span><span class="comment1">―‹TODO: (re)move?›</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> Real_Vector_Spaces.linear
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">linear</span> <span class="main">≡</span> Vector_Spaces.linear"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In this file, we present some basic definitions and lemmas about linear algebra and matrices.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definitions of number of rows and columns of a matrix›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nrows</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">^</span><span class="tfree">'rows</span> <span class="main">=&gt;</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">nrows</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ncols</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">^</span><span class="tfree">'rows</span> <span class="main">=&gt;</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ncols</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'columns</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matrix_scalar_mult</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ab_semigroup_mult <span class="main">=&gt;</span> <span class="tfree">'a</span> <span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> <span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">*k</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="keyword1"><span class="free">*k</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">$</span> <span class="bound">i</span> <span class="main">$</span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Basic properties about matrices›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nrows_not_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≠</span> nrows <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nrows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> ncols_not_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≠</span> ncols <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ncols_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> nrows_transpose<span class="main">:</span> <span class="quoted"><span class="quoted">"nrows <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="main">=</span> ncols <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nrows_def ncols_def <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ncols_transpose<span class="main">:</span> <span class="quoted"><span class="quoted">"ncols <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="main">=</span> nrows <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nrows_def ncols_def <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_rows<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>rows <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finite_Atleast_Atmost_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> row <span class="bound">i</span> <span class="free">A</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> rows_def <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_columns<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>columns <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finite_Atleast_Atmost_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> column <span class="bound">i</span> <span class="free">A</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> columns_def <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> transpose_vector<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">v*</span> <span class="free">A</span> <span class="main">=</span> transpose <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> transpose_zero<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>transpose <span class="free">A</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> transpose_def zero_vec_def vec_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Theorems obtained from the AFP›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following theorems and definitions have been obtained from the AFP 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">url</span></span> "http://isa-afp.org/browser_info/current/HOL/Tarskis_Geometry/Linear_Algebra2.html"<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
I have removed some restrictions over the type classes.›</span></span>


<span class="keyword1"><span class="command">lemma</span></span> vector_scalar_matrix_ac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">v*</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">*k</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="keyword1">*s</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">v*</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> scalar_vector_matrix_assoc 
  <span class="keyword1"><span class="command">unfolding</span></span> vector_matrix_mult_def matrix_scalar_mult_def vec_eq_iff
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left vector_space_over_itself.scale_scale<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> transpose_scalar<span class="main">:</span> <span class="quoted"><span class="quoted">"transpose <span class="main">(</span><span class="free">k</span> <span class="keyword1">*k</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="keyword1">*k</span> transpose <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> transpose_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">vector</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> matrix_scalar_mult_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> scalar_matrix_vector_assoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="keyword1">*s</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">*v</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="keyword1">*k</span> <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> transpose_scalar vector_scalar_matrix_ac vector_transpose_matrix<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> matrix_scalar_vector_ac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*v</span> <span class="main">(</span><span class="free">k</span> <span class="keyword1">*s</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="keyword1">*k</span> <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Miscellaneous.scalar_matrix_vector_assoc vec.scale<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">is_basis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">)</span> set <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_basis</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> vec.independent <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> vec.span <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> UNIV"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">::</span>finite<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">S</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> card_eq_0_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> independent_is_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">B</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="free">B</span> <span class="main">∧</span> card <span class="free">B</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span> <span class="main">⟷</span> is_basis <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="free">B</span> <span class="main">∧</span> card <span class="free">B</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">B</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> card_finite <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'n</span> <span class="main"><span class="main">=</span></span> <span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">B</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">B</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">B</span> <span class="main">=</span> vec.dim <span class="main">(</span>UNIV <span class="main">::</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">)</span> set<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> vec_dim_card <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> vec.card_eq_dim <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span> <span class="quoted">UNIV</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">B</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vec.independent <span class="free">B</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec.span <span class="free">B</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹vec.independent <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_basis <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_basis_def <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_basis <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_basis_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">B</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_basis <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"UNIV <span class="main">⊆</span> vec.span <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> is_basis_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">B</span> <span class="main">=</span> vec.dim <span class="main">(</span>UNIV<span class="main">::</span><span class="main">(</span><span class="main">(</span>real<span class="main">^</span><span class="tfree">'n</span><span class="main">)</span> set<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vec.basis_card_eq_dim <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span> <span class="quoted">UNIV</span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> vec_dim_card
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="free">B</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vec_dim_card<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="free">B</span> <span class="main">∧</span> card <span class="free">B</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basis_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">B</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_basis <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> independent_is_basis <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_basis <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">B</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> card_finite <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'n</span> <span class="main"><span class="main">=</span></span> <span class="tfree"><span class="quoted"><span class="tfree">'n</span></span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Here ends the statements obtained from AFP: 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">url</span></span> "http://isa-afp.org/browser_info/current/HOL/Tarskis_Geometry/Linear_Algebra2.html"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  which have been generalized.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Basic properties involving span, linearity and dimensions›</span></span>

<span class="keyword1"><span class="command">context</span></span> finite_dimensional_vector_space
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This theorem is the reciprocal theorem of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "indep_card_eq_dim_span"<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_eq_dim_span_indep<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dim <span class="main">(</span>span <span class="free">A</span><span class="main">)</span> <span class="main">=</span> card <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"independent <span class="free">A</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms card_le_dim_spanning dim_subset equalityE span_superset<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dim_zero_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dim_A<span class="main">:</span> <span class="quoted"><span class="quoted">"dim <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dim_A local.card_ge_dim_independent local.independent_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> dim_zero_eq'<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dim <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms local.dim_span local.indep_card_eq_dim_span local.independent_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> dim_zero_subspace_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subs_A<span class="main">:</span> <span class="quoted"><span class="quoted">"subspace <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dim <span class="free">A</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dim_zero_eq dim_zero_eq' subspace_0<span class="main"><span class="main">[</span></span><span class="operator">OF</span> subs_A<span class="main"><span class="main">]</span></span> empty_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> span_0_imp_set_empty_or_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"span <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms span_superset subset_singletonD<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> Vector_Spaces.linear
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> linear_injective_ker_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inj_iff_eq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> snd_if_conv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="keyword1">if</span> <span class="free">P</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">D</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="main">(</span><span class="keyword1">if</span> <span class="free">P</span> <span class="keyword1">then</span> <span class="free">B</span> <span class="keyword1">else</span> <span class="free">D</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Basic properties about matrix multiplication›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> row_matrix_matrix_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">v*</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vec_eq_iff
  <span class="keyword1"><span class="command">unfolding</span></span> vector_matrix_mult_def <span class="keyword1"><span class="command">unfolding</span></span> matrix_matrix_mult_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> row_matrix_matrix_mult'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>row <span class="free">i</span> <span class="free">P</span><span class="main">)</span> <span class="keyword1">v*</span> <span class="free">A</span> <span class="main">=</span> row <span class="free">i</span> <span class="main">(</span><span class="free">P</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> row_matrix_matrix_mult <span class="keyword1"><span class="command">unfolding</span></span> row_def vec_nth_inverse <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> column_matrix_matrix_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"column <span class="free">i</span> <span class="main">(</span><span class="free">P</span><span class="main">**</span><span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="keyword1">*v</span> <span class="main">(</span>column <span class="free">i</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> column_def matrix_vector_mult_def matrix_matrix_mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> matrix_matrix_mult_inner_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> row <span class="free">i</span> <span class="free">A</span> <span class="main">∙</span> column <span class="free">j</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inner_vec_def matrix_matrix_mult_def row_def column_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> matrix_vmult_column_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">x</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">y</span> <span class="keyword1">*s</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>columns <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">.</span></span> sum <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">i</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">x</span></span> <span class="main"><span class="main">$</span></span> <span class="bound"><span class="bound">i</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">{</span></span><span class="bound"><span class="bound">i</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">y</span></span> <span class="main"><span class="main">=</span></span> column <span class="bound"><span class="bound">i</span></span> <span class="free"><span class="free">A</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">y</span><span class="main">.</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">}</span>"</span></span>  
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">y</span><span class="main">=</span>column <span class="bound">i</span> <span class="main">(</span><span class="free">A</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?g</span> <span class="main">(</span>columns <span class="main">(</span><span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">unfolding</span></span> columns_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> union_univ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span><span class="var">?g</span><span class="main">`</span><span class="main">(</span>columns <span class="main">(</span><span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> columns_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*v</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="keyword1">*s</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> matrix_mult_sum <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span>  <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="keyword1">*s</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="var">?g</span><span class="main">`</span><span class="main">(</span>columns <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> union_univ <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span>sum <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span>  <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="keyword1">*s</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>  <span class="main">(</span><span class="var">?g</span><span class="main">`</span><span class="main">(</span>columns <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.Union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> o_def<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">(</span>sum <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span>  <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="keyword1">*s</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="var">?g</span><span class="main">)</span>  <span class="main">(</span>columns <span class="free">A</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  sum <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">y</span> <span class="keyword1">*s</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>columns <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> o_def<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xa</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="keyword1">*s</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">xa</span> <span class="main">=</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">}</span> 
      <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="keyword1">*s</span> <span class="skolem">xa</span><span class="main">)</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">xa</span> <span class="main">=</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">xa</span> <span class="main">=</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">}</span> <span class="keyword1">*s</span> <span class="skolem">xa</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> vec.scale_sum_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">xa</span> <span class="main">=</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">xa</span></span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="skolem">xa</span> <span class="main">=</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">.</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span> <span class="keyword1">*s</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="skolem">xa</span> <span class="main">=</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">.</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="skolem">xa</span>"</span></span> <span class="keyword1"><span class="command">.</span></span> 
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*v</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span>columns <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="bound">y</span> <span class="main">=</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">.</span> <span class="free">x</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">*s</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Properties about invertibility›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> matrix_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> matrix_inv_left<span class="main">:</span> <span class="quoted"><span class="quoted">"matrix_inv <span class="free">M</span> <span class="main">**</span> <span class="free">M</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> matrix_inv_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">**</span> matrix_inv <span class="free">M</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹invertible <span class="free">M</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> someI_ex <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">N</span><span class="main">.</span> <span class="free">M</span> <span class="main">**</span> <span class="bound">N</span> <span class="main">=</span> mat <span class="main">1</span> <span class="main">∧</span> <span class="bound">N</span> <span class="main">**</span> <span class="free">M</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> invertible_def <span class="keyword2"><span class="keyword">and</span></span> matrix_inv_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In the library, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "matrix_inv_def"<span class="antiquote"><span class="antiquote">}</span></span></span></span> allows the use of non squary matrices.
  The following lemma can be also proved fixing <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">A</span></span><span class="main"><span class="main">::</span></span><span class="tfree"><span class="tfree">'a</span></span><span class="main"><span class="main">::</span></span><span class="main"><span class="main">{</span></span>semiring_1<span class="main"><span class="main">}</span></span><span class="main"><span class="main">^</span></span><span class="tfree"><span class="tfree">'n</span></span><span class="main"><span class="main">^</span></span><span class="tfree"><span class="tfree">'m</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> matrix_inv_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> AB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">**</span> <span class="free">B</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> BA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">**</span> <span class="free">A</span> <span class="main">=</span> mat <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"matrix_inv <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AB BA invertible_def matrix_inv_right matrix_mul_assoc matrix_mul_lid<span class="main">)</span> 


<span class="keyword1"><span class="command">lemma</span></span> matrix_vector_mult_zero_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">**</span><span class="free">A</span><span class="main">)</span><span class="keyword1">*v</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">*v</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">**</span> <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"matrix_inv <span class="free">P</span> <span class="keyword1">*v</span> <span class="main">(</span><span class="free">P</span> <span class="main">**</span> <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> matrix_inv <span class="free">P</span> <span class="keyword1">*v</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"matrix_inv <span class="free">P</span> <span class="keyword1">*v</span> <span class="main">(</span><span class="free">P</span> <span class="main">**</span> <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span>  <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_vector_mult_0_right<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>matrix_inv <span class="free">P</span> <span class="main">**</span> <span class="free">P</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="free">x</span> <span class="main">=</span>  <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_vector_mul_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*v</span> <span class="free">x</span> <span class="main">=</span>  <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms matrix_inv_left matrix_mul_lid<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*v</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">**</span> <span class="free">A</span> <span class="keyword1">*v</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_vector_mul_assoc matrix_vector_mult_0_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> independent_image_matrix_vector_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ind_B<span class="main">:</span> <span class="quoted"><span class="quoted">"vec.independent <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> inv_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="main">(</span><span class="main">(</span><span class="keyword1">(*v)</span> <span class="free">P</span><span class="main">)</span><span class="main">`</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> vec.independent_injective_image<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ind_B <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="keyword1">(*v)</span> <span class="free">P</span><span class="main">)</span> <span class="main">(</span>vec.span <span class="free">B</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> inj_matrix_vector_mult<span class="main">[</span><span class="operator">OF</span> inv_P<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> independent_preimage_matrix_vector_mult<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> ind_B<span class="main">:</span> <span class="quoted"><span class="quoted">"vec.independent <span class="main">(</span><span class="main">(</span><span class="keyword1">(*v)</span> <span class="free">P</span><span class="main">)</span><span class="main">`</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> inv_P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">P</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="main">(</span><span class="main">(</span><span class="keyword1">(*v)</span> <span class="main">(</span>matrix_inv <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">(*v)</span> <span class="free">P</span><span class="main">)</span><span class="main">`</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> independent_image_matrix_vector_mult<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vec.independent <span class="main">(</span><span class="keyword1">(*v)</span> <span class="free">P</span> <span class="main">`</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ind_B <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invertible <span class="main">(</span>matrix_inv <span class="free">P</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_inv_left matrix_inv_right inv_P invertible_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">(*v)</span> <span class="main">(</span>matrix_inv <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">(*v)</span> <span class="free">P</span><span class="main">)</span><span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matrix_inv <span class="free">P</span> <span class="keyword1">*v</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">*v</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> x inv_P matrix_inv_left matrix_vector_mul_assoc matrix_vector_mul_lid<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="keyword1">(*v)</span> <span class="main">(</span>matrix_inv <span class="free">P</span><span class="main">)</span> <span class="main">`</span> <span class="keyword1">(*v)</span> <span class="free">P</span> <span class="main">`</span> <span class="free">B</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> image_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span>  inv_P matrix_inv_left matrix_vector_mul_assoc matrix_vector_mul_lid<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Properties about the dimension of vectors›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dimension_vector<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vec.dimension <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">)</span> <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span><span class="main">=</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> axis <span class="main">(</span>from_nat <span class="bound">x</span><span class="main">)</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec.dimension <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">)</span> <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>cart_basis<span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>mod_type<span class="main">}</span><span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vec.dimension_def <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card<span class="main">{..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cart_basis_def 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?f</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> bij_betw_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> inj_on_def axis_eq_axis<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
     <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"from_nat <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>from_nat <span class="skolem">y</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> from_nat_eq_imp_eq<span class="main">[</span><span class="operator">OF</span> eq x y<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
     <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"axis <span class="skolem">i</span> <span class="main">1</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> axis <span class="main">(</span>from_nat <span class="bound">x</span><span class="main">::</span><span class="tfree">'rows</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> image_def
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> lessThan_iff to_nat_from_nat to_nat_less_card<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'rows</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_lessThan<span class="main">)</span>
<span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Instantiations and interpretations›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Functions between two real vector spaces form a real vector›</span></span>
<span class="keyword1"><span class="command">instantiation</span></span> <span class="quoted">"fun"</span> <span class="main">::</span> <span class="main">(</span><span class="quoted">real_vector</span><span class="main">,</span> <span class="quoted">real_vector</span><span class="main">)</span> <span class="quoted">real_vector</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">scaleR_fun</span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">i</span> <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff scaleR_fun_def scaleR_left.add scaleR_right.add<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">instantiation</span></span> vec <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">,</span> <span class="quoted">finite</span><span class="main">)</span> <span class="quoted">equal</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">equal_vec</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">::</span>finite<span class="main">)</span> vec <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">::</span>finite<span class="main">)</span> vec <span class="main">=&gt;</span> bool"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">equal_vec</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">$</span><span class="bound">i</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">$</span><span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">::</span>finite<span class="main">)</span> vec"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"equal_class.equal <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> equal_vec_def <span class="keyword1"><span class="command">using</span></span> vec_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix<span class="main">:</span> vector_space <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">(*k)</span><span class="main">)</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">=&gt;</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">=&gt;</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">^</span><span class="tfree">'rows</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">^</span><span class="tfree">'rows</span>"</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">*k</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="keyword1">*k</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">a</span> <span class="keyword1">*k</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_scalar_mult_def vec_eq_iff
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_space_over_itself.scale_right_distrib<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">^</span><span class="tfree">'rows</span>"</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword1">*k</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span> <span class="keyword1">*k</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">b</span> <span class="keyword1">*k</span> <span class="skolem">x</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> matrix_scalar_mult_def vec_eq_iff
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comm_semiring_class.distrib<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">*k</span> <span class="main">(</span><span class="skolem">b</span> <span class="keyword1">*k</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="keyword1">*k</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> matrix_scalar_mult_def vec_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword3"><span class="command">show</span></span><span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">*k</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> matrix_scalar_mult_def vec_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Fundamental_Subspaces">
<div class="head">
<h1>Theory Fundamental_Subspaces</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Fundamental_Subspaces.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
    Maintainer: Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Fundamental Subspaces›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Fundamental_Subspaces
<span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="Miscellaneous.html">Miscellaneous</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The fundamental subspaces of a matrix›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">left_null_space</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">left_null_space</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">v*</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">null_space</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_1<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">null_space</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">*v</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">row_space</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">=&gt;</span><span class="main">(</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'n</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">row_space</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> vec.span <span class="main">(</span>rows <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">col_space</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span><span class="main">=&gt;</span><span class="main">(</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">col_space</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> vec.span <span class="main">(</span>columns <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Relationships among them›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> left_null_space_eq_null_space_transpose<span class="main">:</span> <span class="quoted"><span class="quoted">"left_null_space <span class="free">A</span> <span class="main">=</span> null_space <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> null_space_def left_null_space_def transpose_vector <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> null_space_eq_left_null_space_transpose<span class="main">:</span> <span class="quoted"><span class="quoted">"null_space <span class="free">A</span> <span class="main">=</span> left_null_space <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> left_null_space_eq_null_space_transpose<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"transpose <span class="free">A</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> transpose_transpose <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> row_space_eq_col_space_transpose<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'columns</span><span class="main">^</span><span class="tfree">'rows</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row_space <span class="free">A</span> <span class="main">=</span> col_space <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> col_space_def row_space_def columns_transpose<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> col_space_eq_row_space_transpose<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col_space <span class="free">A</span> <span class="main">=</span> row_space <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> col_space_def row_space_def <span class="keyword1"><span class="command">unfolding</span></span> rows_transpose<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Proving that they are subspaces›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subspace_null_space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.subspace <span class="main">(</span>null_space <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vec.subspace_def null_space_def vec.scale vec.add<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subspace_left_null_space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span><span class="main">^</span><span class="tfree">'m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.subspace <span class="main">(</span>left_null_space <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> left_null_space_eq_null_space_transpose <span class="keyword1"><span class="command">using</span></span> subspace_null_space <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subspace_row_space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.subspace <span class="main">(</span>row_space <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> row_space_def vec.subspace_span<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subspace_col_space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec.subspace <span class="main">(</span>col_space <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> col_space_def vec.subspace_span<span class="main">)</span>
  
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹More useful properties and equivalences›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> col_space_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> wellorder<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col_space <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">A</span> <span class="keyword1">*v</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> col_space_def vec.span_finite<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_columns<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">*v</span> <span class="skolem">x</span> <span class="main">∈</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">∑</span><span class="bound">v</span><span class="main">∈</span>columns <span class="free">A</span><span class="main">.</span> <span class="bound">u</span> <span class="bound">v</span> <span class="keyword1">*s</span> <span class="bound">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> matrix_vmult_column_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'n</span><span class="main">)</span> vec <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">y</span><span class="main">=</span>column <span class="bound">i</span> <span class="free">A</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="var">?g</span> <span class="main">(</span>column <span class="bound">i</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">u</span> <span class="main">(</span>column <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">A</span> <span class="keyword1">*v</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span>columns <span class="free">A</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">v</span> <span class="keyword1">*s</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> matrix_mult_sum<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?g</span> <span class="main">(</span>columns <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">unfolding</span></span> columns_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> union_univ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span><span class="var">?g</span><span class="main">`</span><span class="main">(</span>columns <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> columns_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>               
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">a</span><span class="main">.</span> column <span class="bound">i</span> <span class="free">A</span> <span class="main">=</span> column <span class="bound">a</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">u</span> <span class="main">(</span>column <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">*s</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> UNIV 
        <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">a</span><span class="main">.</span> column <span class="bound">i</span> <span class="free">A</span> <span class="main">=</span> column <span class="bound">a</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">u</span> <span class="main">(</span>column <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">*s</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="var">?g</span><span class="main">`</span><span class="main">(</span>columns <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> union_univ <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span>sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">a</span><span class="main">.</span> column <span class="bound">i</span> <span class="free">A</span> <span class="main">=</span> column <span class="bound">a</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">u</span> <span class="main">(</span>column <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">*s</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?g</span><span class="main">`</span><span class="main">(</span>columns <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.Union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> o_def<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">(</span>sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">a</span><span class="main">.</span> column <span class="bound">i</span> <span class="free">A</span> <span class="main">=</span> column <span class="bound">a</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">u</span> <span class="main">(</span>column <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">*s</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="var">?g</span><span class="main">)</span> 
        <span class="main">(</span>columns <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">y</span> <span class="keyword1">*s</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>columns <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> x_in_cols<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> columns <span class="free">A</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span>column <span class="skolem">b</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_in_cols <span class="keyword1"><span class="command">unfolding</span></span> columns_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">a</span><span class="main">.</span> column <span class="bound">i</span> <span class="free">A</span> <span class="main">=</span> column <span class="bound">a</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">u</span> <span class="main">(</span>column <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">*s</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">have</span></span> sum_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">(</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="keyword1">LEAST</span> <span class="bound">a</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> column <span class="bound">a</span> <span class="free">A</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">}</span> <span class="main">=</span> <span class="var">?f</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">a</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> column <span class="bound">a</span> <span class="free">A</span><span class="main">)</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="keyword1">LEAST</span> <span class="bound">a</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> column <span class="bound">a</span> <span class="free">A</span><span class="main">}</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.remove<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> LeastI_ex<span class="main">)</span> 
        <span class="keyword1"><span class="command">using</span></span> x_in_cols <span class="keyword1"><span class="command">unfolding</span></span> columns_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?f</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">a</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> column <span class="bound">a</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sum_rw <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">u</span> <span class="skolem">x</span> <span class="keyword1">*s</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> LeastI2<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> column <span class="skolem">b</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xa</span>
        <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> column <span class="skolem">xa</span> <span class="free">A</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">(</span>column <span class="skolem">xa</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">*s</span> column <span class="skolem">xa</span> <span class="free">A</span> <span class="main">=</span> <span class="skolem">u</span> <span class="skolem">x</span> <span class="keyword1">*s</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">a</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> column <span class="bound">a</span> <span class="free">A</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">a</span><span class="main">.</span> column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">c</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> column <span class="bound">c</span> <span class="free">A</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> column <span class="bound">a</span> <span class="free">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">a</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> column <span class="bound">a</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">a</span><span class="main">.</span> column <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">c</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> column <span class="bound">c</span> <span class="free">A</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> column <span class="bound">a</span> <span class="free">A</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_equality<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> LeastI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Least_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> full_types<span class="main"><span class="main">)</span></span> LeastI<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">i</span></span> <span class="main">|</span> <span class="skolem">x</span> <span class="main">=</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">a</span><span class="main">.</span> column <span class="bound">i</span> <span class="free">A</span> <span class="main">=</span> column <span class="bound">a</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">u</span> <span class="main">(</span>column <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">*s</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span> <span class="skolem">x</span> <span class="keyword1">*s</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">a</span><span class="main">.</span> column <span class="bound">i</span> <span class="free">A</span> <span class="main">=</span> column <span class="bound">a</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">u</span> <span class="main">(</span>column <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">*s</span> column <span class="bound">i</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span>columns <span class="free">A</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">y</span> <span class="keyword1">*s</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">corollary</span></span> col_space_eq'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> wellorder<span class="main">}</span><span class="main">^</span><span class="tfree">'n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col_space <span class="free">A</span> <span class="main">=</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">A</span> <span class="keyword1">*v</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> col_space_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> row_space_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'m</span><span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> wellorder<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row_space <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="bound">w</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">w</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> row_space_eq_col_space_transpose col_space_eq <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> null_space_eq_ker<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>field<span class="main">^</span><span class="tfree">'n</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lf<span class="main">:</span> <span class="quoted"><span class="quoted">"Vector_Spaces.linear <span class="keyword1">(*s)</span> <span class="keyword1">(*s)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"null_space <span class="main">(</span>matrix <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> null_space_def <span class="keyword1"><span class="command">using</span></span> matrix_works <span class="main">[</span><span class="operator">OF</span> lf<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> col_space_eq_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>field<span class="main">^</span><span class="tfree">'n</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> wellorder<span class="main">}</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">^</span><span class="tfree">'m</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lf<span class="main">:</span> <span class="quoted"><span class="quoted">"Vector_Spaces.linear <span class="keyword1">(*s)</span> <span class="keyword1">(*s)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col_space <span class="main">(</span>matrix <span class="free">f</span><span class="main">)</span> <span class="main">=</span> range <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> col_space_eq <span class="keyword1"><span class="command">unfolding</span></span> matrix_works<span class="main">[</span><span class="operator">OF</span> lf<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> null_space_is_preserved<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">^</span><span class="tfree">'rows</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"null_space <span class="main">(</span><span class="free">P</span><span class="main">**</span><span class="free">A</span><span class="main">)</span> <span class="main">=</span> null_space <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> null_space_def 
  <span class="keyword1"><span class="command">using</span></span> P matrix_inv_left matrix_left_invertible_ker matrix_vector_mul_assoc matrix_vector_mult_0_right
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> row_space_is_preserved<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> wellorder<span class="main">}</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> wellorder<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> wellorder<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row_space <span class="main">(</span><span class="free">P</span><span class="main">**</span><span class="free">A</span><span class="main">)</span> <span class="main">=</span> row_space <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
  <span class="keyword3"><span class="command">assume</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> row_space <span class="main">(</span><span class="free">P</span><span class="main">**</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> w_By<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">=</span><span class="main">(</span>transpose <span class="main">(</span><span class="free">P</span><span class="main">**</span><span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="skolem">y</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> row_space_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">**</span> <span class="free">A</span>"</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="main">(</span>transpose <span class="main">(</span><span class="free">P</span><span class="main">**</span><span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> w_By <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span>transpose <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> matrix_transpose_mul <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="main">(</span><span class="main">(</span>transpose <span class="free">P</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_mul_assoc <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> row_space <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_space_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
  <span class="keyword3"><span class="command">assume</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> row_space <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> w_Ay<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">=</span><span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> row_space_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="main">(</span>transpose <span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> w_Ay <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>transpose <span class="main">(</span><span class="main">(</span>matrix_inv <span class="free">P</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span><span class="free">P</span><span class="main">**</span><span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="skolem">y</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> P matrix_inv_left matrix_mul_assoc matrix_mul_lid<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>transpose <span class="main">(</span><span class="free">P</span><span class="main">**</span><span class="free">A</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span>transpose <span class="main">(</span>matrix_inv <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="skolem">y</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_transpose_mul <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> transpose <span class="main">(</span><span class="free">P</span><span class="main">**</span><span class="free">A</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="main">(</span>transpose <span class="main">(</span>matrix_inv <span class="free">P</span><span class="main">)</span> <span class="keyword1">*v</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> matrix_vector_mul_assoc <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> row_space <span class="main">(</span><span class="free">P</span><span class="main">**</span><span class="free">A</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> row_space_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Dim_Formula">
<div class="head">
<h1>Theory Dim_Formula</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Title:      Dim_Formula.thy
    Author:     Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
    Author:     Jesús Aransay &lt;jesus-maria.aransay at unirioja.es&gt;
    Maintainer: Jose Divasón &lt;jose.divasonm at unirioja.es&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Rank Nullity Theorem of Linear Algebra"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Dim_Formula
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Fundamental_Subspaces.html">Fundamental_Subspaces</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> vector_space
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Previous results›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Linear dependency is a monotone property, based on the 
  monotonocity of linear independence:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dependent_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> d<span class="main">:</span><span class="quoted"><span class="quoted">"dependent <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> A_in_B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"dependent <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> independent_mono <span class="main">[</span><span class="operator">OF</span> _ A_in_B<span class="main">]</span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Given a finite independent set, a linear combination of its 
  elements equal to zero is possible only if every coefficient is zero:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> scalars_zero_if_independent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin_A<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ind<span class="main">:</span> <span class="quoted"><span class="quoted">"independent <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fin_A ind local.dependent_finite sum <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> finite_dimensional_vector_space
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In an finite dimensional vector space, every independent set is finite, and 
  thus <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [display ]scalars_zero_if_independent <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> holds:›</span></span>

<span class="keyword1"><span class="command">corollary</span></span> scalars_zero_if_independent_euclidean<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ind<span class="main">:</span> <span class="quoted"><span class="quoted">"independent <span class="free">A</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finiteI_independent ind scalars_zero_if_independent sum <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following lemma states that every linear form is injective over the 
  elements which define the basis of the range of the linear form. 
  This property is applied later over the elements of an arbitrary 
  basis which are not in the basis of the nullifier or kernel set 
  (\emph{i.e.}, the candidates to be the basis of the range space 
  of the linear form).›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Thanks to this result, it can be concluded that the cardinal 
  of the elements of a basis which do not belong to the kernel 
  of a linear form <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span><span class="main"><span class="main">::</span></span><span class="tfree"><span class="tfree">'a</span></span> <span class="main"><span class="main">=&gt;</span></span> <span class="tfree"><span class="tfree">'b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is equal to the cardinal 
  of the set obtained when applying <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span><span class="main"><span class="main">::</span></span><span class="tfree"><span class="tfree">'a</span></span> <span class="main"><span class="main">=&gt;</span></span> <span class="tfree"><span class="tfree">'b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to such elements.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The application of this lemma is not usually found in the pencil and paper 
  proofs of the ``rank nullity theorem'', but will be crucial to know that,
  being <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span><span class="main"><span class="main">::</span></span><span class="tfree"><span class="tfree">'a</span></span> <span class="main"><span class="main">=&gt;</span></span> <span class="tfree"><span class="tfree">'b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> a linear form from a finite dimensional
  vector space <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">V</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to a vector space <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">V'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, 
  and given a basis <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">B</span></span><span class="main"><span class="main">::</span></span><span class="tfree"><span class="tfree">'a</span></span> set"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">ker</span></span> <span class="free"><span class="free">f</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, 
  when <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">B</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is completed up to a basis of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">V</span></span><span class="main"><span class="main">::</span></span><span class="tfree"><span class="tfree">'a</span></span> set"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  with a set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">W</span></span><span class="main"><span class="main">::</span></span><span class="tfree"><span class="tfree">'a</span></span> set"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, the cardinal of this set is
  equal to the cardinal of its range set:›</span></span>
  
<span class="keyword1"><span class="command">context</span></span> vector_space
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inj_on_extended<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lf<span class="main">:</span> <span class="quoted"><span class="quoted">"Vector_Spaces.linear <span class="free">scaleB</span> <span class="free">scaleC</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ind_C<span class="main">:</span> <span class="quoted"><span class="quoted">"independent <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> C_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="free">B</span> <span class="main">∪</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> disj_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∩</span> <span class="free">W</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> span_B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">⊆</span> span <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">W</span>"</span></span>
  <span class="comment1">― ‹The proof is carried out by reductio ad absurdum›</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> inj_on_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> lf<span class="main">:</span> Vector_Spaces.linear <span class="quoted"><span class="free">scaleB</span></span> <span class="quoted"><span class="free">scaleC</span></span> <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">using</span></span> lf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="comment1">― ‹Some previous consequences of the premises that are used later:›</span>
  <span class="keyword1"><span class="command">have</span></span> fin_B<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_subset <span class="main">[</span><span class="operator">OF</span> _ f<span class="main">]</span> C_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
  <span class="keyword1"><span class="command">have</span></span> ind_B<span class="main">:</span> <span class="quoted"><span class="quoted">"independent <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ind_W<span class="main">:</span> <span class="quoted"><span class="quoted">"independent <span class="free">W</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> independent_mono<span class="main">[</span><span class="operator">OF</span> ind_C<span class="main">]</span> C_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="comment1">― ‹The proof starts here; we assume that there exist two different elements›</span>
  <span class="comment1">― ‹with the same image:›</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_not_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> fin_yB<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>insert <span class="skolem">y</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_self f_eq lf.diff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="bound">g</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> span_B
    <span class="keyword1"><span class="command">unfolding</span></span> span_finite <span class="main">[</span><span class="operator">OF</span> fin_B<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="comment1">― ‹We define one of the elements as a linear combination of the second 
      element and the ones in $B$›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">y</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="skolem">g</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sum <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">scale</span> <span class="main">(</span><span class="skolem">h</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">y</span>  <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">scale</span> <span class="main">(</span><span class="skolem">h</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="skolem">h</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> add_left_cancel<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum.cong<span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> y h_def empty_iff disj_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="main">(</span>insert <span class="skolem">y</span> <span class="free">B</span><span class="main">)</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="skolem">h</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.insert<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fin_B<span class="main">)</span>
       <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> IntI disj_set empty_iff y<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> x_in_span_yB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> span <span class="main">(</span>insert <span class="skolem">y</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> span_finite<span class="main">[</span><span class="operator">OF</span> fin_yB<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="comment1">― ‹We have that a subset of elements of $C$ is linearly dependent›</span>
  <span class="keyword1"><span class="command">have</span></span> dep<span class="main">:</span> <span class="quoted"><span class="quoted">"dependent <span class="main">(</span>insert <span class="skolem">x</span> <span class="main">(</span>insert <span class="skolem">y</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> dependent_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> bexI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">metis</span> Diff_insert_absorb Int_iff disj_set empty_iff insert_iff 
         x x_in_span_yB x_not_y<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="comment1">― ‹Therefore, the set $C$ is also dependent:›</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dependent <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C_eq x y
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_commute Un_upper2 dependent_mono insert_absorb insert_subset<span class="main">)</span>
  <span class="comment1">― ‹This yields the contradiction, since $C$ is independent:›</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ind_C <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The proof›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Now the rank nullity theorem can be proved; given any linear form 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span><span class="main"><span class="main">::</span></span><span class="tfree"><span class="tfree">'a</span></span> <span class="main"><span class="main">=&gt;</span></span> <span class="tfree"><span class="tfree">'b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, the sum of the dimensions of its kernel and 
  range subspaces is equal to the dimension of the source vector space.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The statement of the ``rank nullity theorem for linear algebra'', as 
  well as its proof, follow the ones on~\cite{AX97}. The proof is the 
  traditional one found in the literature. The theorem is also named 
  ``fundamental theorem of linear algebra'' in some texts (for instance,
  in~\cite{GO10}).›</span></span>

<span class="keyword1"><span class="command">context</span></span> finite_dimensional_vector_space
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">theorem</span></span> rank_nullity_theorem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"Vector_Spaces.linear <span class="free">scale</span> <span class="free">scaleC</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dimension <span class="main">=</span> dim <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">+</span> vector_space.dim <span class="free">scaleC</span> <span class="main">(</span>range <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="comment1">― ‹For convenience we define abbreviations for the universe set, $V$, 
    and the kernel of $f$›</span>
  <span class="keyword1"><span class="command">interpret</span></span> l<span class="main">:</span> Vector_Spaces.linear <span class="quoted"><span class="free">scale</span></span> <span class="quoted"><span class="free">scaleC</span></span> <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> UNIV"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ker_f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ker_f</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="comment1">― ‹The kernel is a proper subspace:›</span>
  <span class="keyword1"><span class="command">have</span></span> sub_ker<span class="main">:</span> <span class="quoted"><span class="quoted">"subspace <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l.subspace_kernel <span class="keyword1"><span class="command">.</span></span>
  <span class="comment1">― ‹The kernel has its proper basis, $B$:›</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> B_in_ker<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> independent_B<span class="main">:</span> <span class="quoted"><span class="quoted">"independent <span class="skolem">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ker_in_span<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">⊆</span> span <span class="skolem">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> card_B<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">B</span> <span class="main">=</span> dim <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="comment1">― ‹The space $V$ has a (finite dimensional) basis, $C$:›</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> B_in_C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> C_in_V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">⊆</span> <span class="skolem">V</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> independent_C<span class="main">:</span> <span class="quoted"><span class="quoted">"independent <span class="skolem">C</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> span_C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> span <span class="skolem">C</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> V_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> independent_B extend_basis_superset independent_extend_basis span_extend_basis span_superset<span class="main">)</span>
  <span class="comment1">― ‹The basis of $V$, $C$, can be decomposed in the disjoint union of the 
      basis of the kernel, $B$, and its complementary set, $C - B$›</span>
  <span class="keyword1"><span class="command">have</span></span> C_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="skolem">B</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Diff_partition <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B_in_C<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eq_fC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="skolem">C</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">B</span> <span class="main">∪</span> <span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> C_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> image_Un<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 
  <span class="comment1">― ‹The basis $C$, and its image, are finite, since $V$ is finite-dimensional›</span>
  <span class="keyword1"><span class="command">have</span></span> finite_C<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">C</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finiteI_independent<span class="main">[</span><span class="operator">OF</span> independent_C<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> finite_fC<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI <span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_C<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="comment1">― ‹The basis $B$ of the kernel of $f$, and its image, are also finite›</span>
  <span class="keyword1"><span class="command">have</span></span> finite_B<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_finite_subset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_C B_in_C<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> finite_fB<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_B<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="comment1">― ‹The set $C - B$ is also finite›</span>
  <span class="keyword1"><span class="command">have</span></span> finite_CB<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">C</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_Diff <span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_C<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">B</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> dim_ker_le_dim_V<span class="main">:</span><span class="quoted"><span class="quoted">"dim <span class="main">(</span><span class="skolem">ker_f</span><span class="main">)</span> <span class="main">≤</span> dim <span class="skolem">V</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> dim_subset <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ker_f</span></span> <span class="quoted"><span class="skolem">V</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> V_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="comment1">― ‹Here it starts the proof of the theorem: the sets $B$ and 
      $C - B$ must be proven to be bases, respectively, of the kernel 
      of $f$ and its range›</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dimension <span class="main">=</span> dim <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> V_def dim_UNIV dimension_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> basis_card_eq_dim dimension_def independent_Basis span_Basis top_greatest<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dim <span class="skolem">V</span> <span class="main">=</span> dim <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> span_C dim_span <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="skolem">C</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> basis_card_eq_dim <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">C</span></span> <span class="quoted"><span class="skolem">C</span></span><span class="main">,</span> <span class="operator">OF</span> _ span_superset independent_C<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="main">(</span><span class="skolem">B</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">C</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> card <span class="skolem">B</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">C</span><span class="main">-</span><span class="skolem">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_Un_disjoint<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_B finite_CB<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> dim <span class="skolem">ker_f</span> <span class="main">+</span> card <span class="main">(</span><span class="skolem">C</span><span class="main">-</span><span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ker_f_def card_B <span class="keyword1"><span class="command">..</span></span>
    <span class="comment1">― ‹Now it has to be proved that the elements of $C - B$ are a basis of 
      the range of $f$›</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> dim <span class="skolem">ker_f</span> <span class="main">+</span> l.vs2.dim <span class="main">(</span>range <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> add_left_cancel<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">=</span> <span class="skolem">C</span> <span class="main">-</span> <span class="skolem">B</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> finite_W<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> W_def <span class="keyword1"><span class="command">using</span></span> finite_CB <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">have</span></span> finite_fW<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">W</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_imageI<span class="main">[</span><span class="operator">OF</span> finite_W<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">W</span> <span class="main">=</span> card <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">W</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_image <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> inj_on_extended<span class="main"><span class="main">[</span></span><span class="operator">OF</span> l<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">C</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">B</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> finite_C<span class="main">)</span>
          <span class="main">(</span><span class="operator">rule</span> independent_C<span class="main"><span class="keyword3">,</span></span><span class="operator">unfold</span> W_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> C_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ker_in_span<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> l.vs2.dim <span class="main">(</span>range <span class="free">f</span><span class="main">)</span>"</span></span>
        <span class="comment1">― ‹The image set of $W$ is independent and its span contains the range 
             of $f$, so it is a basis of the range:›</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> l.vs2.basis_card_eq_dim<span class="main">)</span>
        <span class="comment1">― ‹1. The image set of $W$ generates the range of $f$:›</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"range <span class="free">f</span> <span class="main">⊆</span> l.vs2.span <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">W</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> l.vs2.span_finite <span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_fW<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="comment1">― ‹Given any element $v$ in $V$, its image can be expressed as a 
            linear combination of elements of the image by $f$ of $C$:›</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span>
          <span class="keyword1"><span class="command">have</span></span> fV_span<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="skolem">V</span> <span class="main">⊆</span> l.vs2.span  <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">C</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> span_C l.span_image<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">f</span><span class="main">`</span><span class="skolem">C</span><span class="main">.</span> <span class="free">scaleC</span> <span class="main">(</span><span class="bound">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">v</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> fV_span <span class="keyword1"><span class="command">unfolding</span></span> V_def
            <span class="keyword1"><span class="command">using</span></span> l.vs2.span_finite<span class="main">[</span><span class="operator">OF</span> finite_fC<span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> V_def rangeE rangeI span_C l.span_image<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> fv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">C</span><span class="main">.</span> <span class="free">scaleC</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
              <span class="comment1">― ‹We recall that $C$ is equal to $B$ union $(C - B)$, and $B$ 
            is the basis of the kernel; thus, the image of the elements of 
            $B$ will be equal to zero:›</span>
          <span class="keyword1"><span class="command">have</span></span> zero_fB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">B</span><span class="main">.</span> <span class="free">scaleC</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> B_in_ker <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.neutral<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> zero_inter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">B</span> <span class="main">∩</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">W</span><span class="main">)</span><span class="main">.</span> <span class="free">scaleC</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> B_in_ker <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum.neutral<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">C</span><span class="main">.</span> <span class="free">scaleC</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fv <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">B</span> <span class="main">∪</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">W</span><span class="main">)</span><span class="main">.</span>  <span class="free">scaleC</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> eq_fC W_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> 
              <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">B</span><span class="main">.</span> <span class="free">scaleC</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">W</span><span class="main">.</span> <span class="free">scaleC</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> 
                <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">B</span> <span class="main">∩</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">W</span><span class="main">)</span><span class="main">.</span> <span class="free">scaleC</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> sum_Un <span class="main">[</span><span class="operator">OF</span> finite_fB finite_fW<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">W</span><span class="main">.</span> <span class="free">scaleC</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> zero_fB zero_inter <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="comment1">― ‹We have proved that the image set of $W$ is a generating set 
              of the range of $f$›</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">v</span> <span class="main">∈</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">W</span><span class="main">.</span> <span class="free">scaleC</span> <span class="main">(</span><span class="bound">u</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
          <span class="comment1">― ‹2. The image set of $W$ is linearly independent:›</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"l.vs2.independent <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">W</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> finite_fW
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> l.vs2.independent_if_scalars_zero<span class="main">)</span>
          <span class="comment1">― ‹Every linear combination (given by $g x$) of the elements of 
           the image set of $W$ equal to zero, requires every coefficient to 
           be zero:›</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> <span class="main">=&gt;</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">w</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'c</span></span></span>
          <span class="keyword3"><span class="command">assume</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">W</span><span class="main">.</span> <span class="free">scaleC</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">W</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">W</span><span class="main">.</span> <span class="free">scaleC</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sum <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">scaleC</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">W</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> inj_on_extended<span class="main"><span class="main">[</span></span><span class="operator">OF</span> l<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">C</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">B</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="main">(</span><span class="operator">unfold</span> W_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> finite_C<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> independent_C<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> C_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> 
                <span class="operator">rule</span> ker_in_span<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">W</span><span class="main">.</span> <span class="free">scaleC</span> <span class="main">(</span><span class="main">(</span><span class="skolem">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> o_def <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">W</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="main">(</span><span class="skolem">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> l.sum<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> l.scale<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> f_sum_zero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">W</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="main">(</span><span class="skolem">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">W</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="main">(</span><span class="skolem">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">ker_f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ker_f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">h</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="bound">h</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">W</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="main">(</span><span class="skolem">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> span_finite<span class="main">[</span><span class="operator">OF</span> finite_B<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> ker_in_span
            <span class="keyword1"><span class="command">unfolding</span></span> ker_f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
            sum_h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="skolem">h</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">W</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="main">(</span><span class="skolem">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="keyword1">then</span> <span class="skolem">h</span> <span class="skolem">a</span> <span class="keyword1">else</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="skolem">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="skolem">h</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">W</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="main">(</span><span class="skolem">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> sum_h <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="skolem">h</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">W</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="free">scale</span> <span class="main">(</span><span class="main">(</span><span class="skolem">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> sum_negf <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="skolem">t</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">W</span><span class="main">.</span> <span class="main">-</span><span class="main">(</span><span class="free">scale</span><span class="main">(</span><span class="main">(</span><span class="skolem">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> add_right_cancel <span class="keyword1"><span class="command">unfolding</span></span> t_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="skolem">t</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">W</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="skolem">t</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> add_left_cancel t_def W_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum.cong<span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="skolem">B</span> <span class="main">∪</span> <span class="skolem">W</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="skolem">t</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.union_inter_neutral <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> finite_B<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> finite_W<span class="main">)</span> 
              <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> W_def<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="skolem">B</span> <span class="main">∪</span> <span class="skolem">W</span><span class="main">.</span> <span class="free">scale</span> <span class="main">(</span><span class="skolem">t</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> coef_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">B</span> <span class="main">∪</span> <span class="skolem">W</span><span class="main">.</span> <span class="skolem">t</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> C_eq scalars_zero_if_independent <span class="main">[</span><span class="operator">OF</span> finite_C independent_C<span class="main">]</span>
            <span class="keyword1"><span class="command">unfolding</span></span> W_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> w_fy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">y</span> "</span></span> <span class="keyword2"><span class="keyword">and</span></span> y_in_W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> w <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">g</span> <span class="skolem">w</span> <span class="main">=</span> <span class="skolem">t</span> <span class="skolem">y</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> t_def w_fy <span class="keyword1"><span class="command">using</span></span> y_in_W <span class="keyword1"><span class="command">unfolding</span></span> W_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coef_zero y_in_W <span class="keyword1"><span class="command">unfolding</span></span> W_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">w</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">C</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> l.vs2.dim <span class="main">(</span>range <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> W_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> V_def ker_f_def <span class="keyword1"><span class="command">unfolding</span></span> dim_UNIV <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The rank nullity theorem for matrices›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The proof of the theorem for matrices
  is direct, as a consequence of the ``rank nullity theorem''.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rank_nullity_theorem_matrices<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">^</span><span class="tfree">'cols</span><span class="main">::</span><span class="main">{</span>finite<span class="main">,</span> wellorder<span class="main">}</span><span class="main">^</span><span class="tfree">'rows</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ncols <span class="free">A</span> <span class="main">=</span> vec.dim <span class="main">(</span>null_space <span class="free">A</span><span class="main">)</span> <span class="main">+</span> vec.dim <span class="main">(</span>col_space <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vec.rank_nullity_theorem<span class="main">[</span><span class="operator">OF</span> matrix_vector_mul_linear_gen<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2 3<span class="main"><span class="main">)</span></span> matrix_of_matrix_vector_mul <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> null_space_eq_ker<span class="main">[</span><span class="operator">OF</span> matrix_vector_mul_linear_gen<span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> col_space_eq_range <span class="main">[</span><span class="operator">OF</span> matrix_vector_mul_linear_gen<span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> vec.dimension_def ncols_def card_cart_basis
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>