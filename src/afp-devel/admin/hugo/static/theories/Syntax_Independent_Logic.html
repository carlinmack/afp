<div id="Prelim">
<div class="head">
<h1>Theory Prelim</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Prelim
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="../../HOL/HOL-Eisbach/Eisbach.html">HOL-Eisbach.Eisbach</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Trivia›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">any</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">any</span> <span class="main">≡</span> undefined"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Un_Diff2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∩</span> <span class="free">C</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">B</span> <span class="main">-</span> <span class="free">C</span> <span class="main">=</span> <span class="free">A</span> <span class="main">-</span> <span class="free">C</span> <span class="main">∪</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Diff_Diff_Un<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">-</span> <span class="free">B</span> <span class="main">-</span> <span class="free">C</span> <span class="main">=</span> <span class="free">A</span> <span class="main">-</span> <span class="main">(</span><span class="free">B</span> <span class="main">∪</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">first</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">first</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">first</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">#</span> <span class="free">first</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Facts about zipping lists:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fst_set_zip_map_fst<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span> <span class="main">⟹</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">xs</span><span class="main">)</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> snd_set_zip_map_snd<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span> <span class="main">⟹</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="main">(</span>zip <span class="free">xs</span> <span class="main">(</span>map snd <span class="free">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> snd_set_zip<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span> <span class="main">⟹</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="main">(</span>zip <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> set_zip_D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">∈</span> set <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_zip_leftD set_zip_rightD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> inj_on_set_zip_map<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="free">x1</span><span class="main">,</span> <span class="free">y1</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="free">ys</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x1</span><span class="main">,</span> <span class="free">y1</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">x1</span></span> <span class="quoted"><span class="free">y1</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">yys</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">yys</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> i<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_zip_map_fst_snd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="free">us</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">u</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="free">us</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">us</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">,</span>1-4<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">us</span></span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> set_zip_leftD set_zip_rightD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_zip_map_fst_snd2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="free">us</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">us</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="free">us</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">,</span>1-4<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">us</span></span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> set_zip_rightD <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_zip_length_map<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x1</span><span class="main">,</span> <span class="free">y1</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="free">x1</span><span class="main">,</span> <span class="free">y1</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x1</span></span> <span class="quoted"><span class="free">y1</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">asList</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">asList</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="keyword1">SOME</span> <span class="bound">as</span><span class="main">.</span> set <span class="bound">as</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> asList<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> set <span class="main">(</span>asList <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> asList_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite_list tfl_some<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> triv_Un_imp_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="free">φ</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟷</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">C</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">⟶</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">B</span> <span class="main">=</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">toN</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">toN</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_toN<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>toN <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> toN_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">declare</span></span> list.map_cong<span class="main">[</span><span class="operator">cong</span><span class="main">]</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Some Proof Infrastructure›</span></span>

<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
<span class="keyword1"><span class="keyword">exception</span></span> <span class="entity">TAC</span> <span class="keyword2"><span class="keyword">of</span></span> term

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">simped</span> <span class="main">=</span> Thm.rule_attribute <span class="main">[</span><span class="main">]</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">context</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">thm</span> <span class="main">=&gt;</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ctxt</span> <span class="main">=</span> Context.proof_of <span class="entity">context</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">thm'</span><span class="main">,</span> <span class="entity">ctxt'</span><span class="main">)</span> <span class="main">=</span> yield_singleton <span class="main">(</span>apfst snd oo Variable.import false<span class="main">)</span> <span class="entity">thm</span> <span class="entity">ctxt</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">full_goal</span> <span class="main">=</span> Thm.prop_of <span class="entity">thm'</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">goal</span> <span class="main">=</span> Goal.prove <span class="entity">ctxt'</span> <span class="main">[</span><span class="main">]</span> <span class="main">[</span><span class="main">]</span> <span class="entity">full_goal</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">{</span>context <span class="main">=</span> <span class="entity">ctxt</span><span class="main">,</span> prems <span class="main">=</span> <span class="main">_</span><span class="main">}</span> <span class="main">=&gt;</span>
      HEADGOAL <span class="main">(</span><span class="entity">asm_full_simp_tac</span> <span class="entity">ctxt</span> THEN' TRY o SUBGOAL <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">goal</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> <span class="main">(</span><span class="entity">TAC</span> <span class="entity">goal</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      |&gt; K <span class="main">(</span><span class="entity">HOLogic.mk_Trueprop</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">True</span><span class="antiquote">}</span></span><span class="main">)</span>
      <span class="keyword3"><span class="keyword">handle</span></span> <span class="entity">TAC</span> <span class="entity">goal</span> <span class="main">=&gt;</span> <span class="entity">goal</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thm</span> <span class="main">=</span> Goal.prove <span class="entity">ctxt'</span> <span class="main">[</span><span class="main">]</span> <span class="main">[</span><span class="main">]</span> <span class="entity">goal</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">{</span>context <span class="main">=</span> <span class="entity">ctxt</span><span class="main">,</span> prems <span class="main">=</span> <span class="main">_</span><span class="main">}</span> <span class="main">=&gt;</span>
      HEADGOAL <span class="main">(</span><span class="entity">Method.insert_tac</span> <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">thm'</span><span class="main">]</span> THEN' <span class="entity">asm_full_simp_tac</span> <span class="entity">ctxt</span><span class="main">)</span><span class="main">)</span>
      |&gt; singleton <span class="main">(</span>Variable.export <span class="entity">ctxt'</span> <span class="entity">ctxt</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">thm</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">)</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> Theory.setup
  <span class="main">(</span><span class="entity">Attrib.setup</span> <span class="antiquoted"><span class="entity"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span>‹simped›</span></span> <span class="main">(</span>pair <span class="entity">simped</span><span class="main">)</span> <span class="inner_quoted">"simped rule"</span><span class="main">)</span><span class="main">;</span>
›</span>

<span class="keyword1"><span class="command">method</span></span> RULE <span class="keyword2"><span class="keyword">methods</span></span> meth <span class="keyword2"><span class="keyword">uses</span></span> rule <span class="main">=</span>
  <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">rule</span></span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">solves</span> <span class="operator">meth</span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹TryUntilFail:›</span></span>
<span class="comment1">(* This is non-hazardous, since it does not touch the goal on which it fails. *)</span>
<span class="keyword1"><span class="command">method</span></span> TUF <span class="keyword2"><span class="keyword">methods</span></span> meth <span class="main">=</span>
  <span class="main">(</span><span class="main">(</span><span class="operator">meth</span><span class="main"><span class="keyword3">;</span></span><span class="operator">fail</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Helping a method, usually simp or auto, with specific substitutions inserted.
For auto, this is a bit like a "simp!" analogue of "intro!" and "dest!": It forces
the application of an indicated simplification rule, if this is possible.›</span></span>

<span class="keyword1"><span class="command">method</span></span> variousSubsts1 <span class="keyword2"><span class="keyword">methods</span></span> meth <span class="keyword2"><span class="keyword">uses</span></span> s1 <span class="main">=</span>
  <span class="main">(</span><span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">subst</span> <span class="dynamic"><span class="dynamic">s1</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">method</span></span> variousSubsts2 <span class="keyword2"><span class="keyword">methods</span></span> meth <span class="keyword2"><span class="keyword">uses</span></span> s1 s2 <span class="main">=</span>
  <span class="main">(</span><span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">subst</span> <span class="dynamic"><span class="dynamic">s1</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="dynamic"><span class="dynamic">s2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">method</span></span> variousSubsts3 <span class="keyword2"><span class="keyword">methods</span></span> meth <span class="keyword2"><span class="keyword">uses</span></span> s1 s2 s3 <span class="main">=</span>
  <span class="main">(</span><span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">subst</span> <span class="dynamic"><span class="dynamic">s1</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="dynamic"><span class="dynamic">s2</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="dynamic"><span class="dynamic">s3</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">method</span></span> variousSubsts4 <span class="keyword2"><span class="keyword">methods</span></span> meth <span class="keyword2"><span class="keyword">uses</span></span> s1 s2 s3 s4 <span class="main">=</span>
  <span class="main">(</span><span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">subst</span> <span class="dynamic"><span class="dynamic">s1</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="dynamic"><span class="dynamic">s2</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="dynamic"><span class="dynamic">s3</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="dynamic"><span class="dynamic">s4</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">method</span></span> variousSubsts5 <span class="keyword2"><span class="keyword">methods</span></span> meth <span class="keyword2"><span class="keyword">uses</span></span> s1 s2 s3 s4 s5 <span class="main">=</span>
  <span class="main">(</span><span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">subst</span> <span class="dynamic"><span class="dynamic">s1</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="dynamic"><span class="dynamic">s2</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="dynamic"><span class="dynamic">s3</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="dynamic"><span class="dynamic">s4</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="dynamic"><span class="dynamic">s5</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">method</span></span> variousSubsts6 <span class="keyword2"><span class="keyword">methods</span></span> meth <span class="keyword2"><span class="keyword">uses</span></span> s1 s2 s3 s4 s5 s6 <span class="main">=</span>
  <span class="main">(</span><span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">subst</span> <span class="dynamic"><span class="dynamic">s1</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="dynamic"><span class="dynamic">s2</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="dynamic"><span class="dynamic">s3</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span>
         <span class="main">(</span><span class="operator">subst</span> <span class="dynamic"><span class="dynamic">s4</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="dynamic"><span class="dynamic">s5</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="dynamic"><span class="dynamic">s6</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meth</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>

</pre>
</div><div id="Syntax">
<div class="head">
<h1>Theory Syntax</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Syntax›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Syntax
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Prelim.html">Prelim</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Generic Syntax›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We develop some generic (meta-)axioms for syntax and substitution.
We only assume that the syntax of our logic has notions of variable, term and formula,
which \emph{include} subsets of "numeric" variables, terms and formulas,
the latter being endowed with notions of free variables and substitution subject to
some natural properties.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Generic_Syntax <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> set"</span></span> <span class="comment1">― ‹numeric variables (i.e., variables ranging over numbers)›</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">trm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> set"</span></span> <span class="comment1">― ‹numeric trms, which include the numeric variables›</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set"</span></span> <span class="comment1">― ‹numeric formulas›</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> <span class="main">⇒</span> <span class="tfree">'trm</span>"</span></span> <span class="comment1">― ‹trms include at least the variables›</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">FvarsT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span> <span class="comment1">― ‹free variables for trms›</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">substT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> <span class="main">⇒</span> <span class="tfree">'trm</span> <span class="main">⇒</span> <span class="tfree">'var</span> <span class="main">⇒</span> <span class="tfree">'trm</span>"</span></span> <span class="comment1">― ‹substitution for trms›</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Fvars</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="tfree">'var</span> set"</span></span> <span class="comment1">― ‹free variables for formulas›</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">subst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="tfree">'trm</span> <span class="main">⇒</span> <span class="tfree">'var</span> <span class="main">⇒</span> <span class="tfree">'fmla</span>"</span></span> <span class="comment1">― ‹substitution for formulas›</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    infinite_var<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="free">var</span>"</span></span> <span class="comment1">― ‹the variables are assumed infinite›</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="comment1">― ‹Assumptions about the infrastructure (free vars, substitution and the embedding of variables into trms.
      NB: We need fewer assumptions for trm substitution than for formula substitution!›</span>
    Var<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">Var</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    inj_Var<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">Var</span> <span class="bound">y</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    finite_FvarsT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="free">FvarsT</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    FvarsT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    substT<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t1</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">substT</span> <span class="bound">t1</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    FvarsT_Var<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">FvarsT</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    substT_Var<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">t</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span>
      <span class="free">substT</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">t</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span>  <span class="main">=</span> <span class="bound">y</span> <span class="keyword1">then</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="free">Var</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    substT_notIn<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t1</span> <span class="bound">t2</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">t2</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="bound">t1</span> <span class="main">⟹</span> <span class="free">substT</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">t1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    <span class="comment1">― ‹Assumptions about the infrastructure (free vars and substitution) on formulas›</span>
    finite_Fvars<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">φ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="free">Fvars</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    Fvars<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    subst<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    Fvars_subst_in<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">φ</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">⟹</span>
      <span class="free">Fvars</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">∪</span> <span class="free">FvarsT</span> <span class="bound">t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    subst_compose_eq_or<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">φ</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">t2</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x1</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">x2</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
      <span class="bound">x1</span> <span class="main">=</span> <span class="bound">x2</span> <span class="main">∨</span> <span class="bound">x2</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="bound">t1</span> <span class="bound">x1</span><span class="main">)</span> <span class="bound">t2</span> <span class="bound">x2</span> <span class="main">=</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="main">(</span><span class="free">substT</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="bound">x2</span><span class="main">)</span> <span class="bound">x1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    subst_compose_diff<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">φ</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">t2</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x1</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">x2</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
      <span class="bound">x1</span> <span class="main">≠</span> <span class="bound">x2</span> <span class="main">⟹</span> <span class="bound">x1</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="bound">t2</span> <span class="main">⟹</span>
      <span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="bound">t1</span> <span class="bound">x1</span><span class="main">)</span> <span class="bound">t2</span> <span class="bound">x2</span> <span class="main">=</span> <span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="bound">t2</span> <span class="bound">x2</span><span class="main">)</span> <span class="main">(</span><span class="free">substT</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="bound">x2</span><span class="main">)</span> <span class="bound">x1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    subst_same_Var<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">φ</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">φ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    subst_notIn<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">φ</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">φ</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> var_NE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> infinite_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Var_injD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">x</span> <span class="main">=</span> <span class="free">Var</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> FvarsT_VarD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> FvarsT'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> FvarsT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> Fvars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_subst<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
  <span class="free">Fvars</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Fvars</span> <span class="free">φ</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="free">t</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fvars_subst_in<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> in_Fvars_substD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>
   <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="main">(</span><span class="free">Fvars</span> <span class="free">φ</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="free">t</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Fvars_subst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> inj_on_Var<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="free">Var</span> <span class="free">var</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inj_Var <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_compose_same<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">φ</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">t2</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
  <span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="bound">t1</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">t2</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="main">(</span><span class="free">substT</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> subst_compose_eq_or <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_subst<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> yy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="free">t</span> <span class="free">y</span> <span class="main">=</span> <span class="free">subst</span> <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> subst_compose_eq_or<span class="main">[</span><span class="operator">OF</span> φ _ t x y<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">y</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> subst_notIn yy <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_comp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">φ</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
  <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="main">⟹</span>
  <span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">t</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_compose_diff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> exists_nat_var<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">f</span><span class="main">::</span>nat<span class="main">⇒</span><span class="tfree">'var</span><span class="main">.</span> inj <span class="bound">f</span> <span class="main">∧</span> range <span class="bound">f</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infinite_countable_subset infinite_var<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Variable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'var</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Variable</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">f</span><span class="main">.</span> inj <span class="bound">f</span> <span class="main">∧</span> range <span class="bound">f</span> <span class="main">⊆</span> <span class="free">var</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Variable_inj_var<span class="main">:</span>
  <span class="quoted"><span class="quoted">"inj Variable <span class="main">∧</span> range Variable <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Variable_def <span class="keyword1"><span class="command">using</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> exists_nat_var<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inj_Variable<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> Variable <span class="bound">i</span> <span class="main">=</span> Variable <span class="bound">j</span> <span class="main">⟷</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Variable<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> Variable <span class="bound">i</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Variable_inj_var image_def <span class="keyword1"><span class="command">unfolding</span></span> inj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Convenient notations for some variables
We reserve the first 10 indexes for any special variables we
may wish to consider later.›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">xx</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">xx</span> <span class="main">≡</span> Variable <span class="numeral">10</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">yy</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">yy</span> <span class="main">≡</span> Variable <span class="numeral">11</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">zz</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">zz</span> <span class="main">≡</span> Variable <span class="numeral">12</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">xx'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">xx'</span> <span class="main">≡</span> Variable <span class="numeral">13</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">yy'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">yy'</span> <span class="main">≡</span> Variable <span class="numeral">14</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">zz'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">zz'</span> <span class="main">≡</span> Variable <span class="numeral">15</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> xx<span class="main">:</span> <span class="quoted"><span class="quoted">"xx <span class="main">∈</span> <span class="free">var</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> yy<span class="main">:</span> <span class="quoted"><span class="quoted">"yy <span class="main">∈</span> <span class="free">var</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zz<span class="main">:</span> <span class="quoted"><span class="quoted">"zz <span class="main">∈</span> <span class="free">var</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> xx'<span class="main">:</span> <span class="quoted"><span class="quoted">"xx' <span class="main">∈</span> <span class="free">var</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> yy'<span class="main">:</span> <span class="quoted"><span class="quoted">"yy' <span class="main">∈</span> <span class="free">var</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zz'<span class="main">:</span> <span class="quoted"><span class="quoted">"zz' <span class="main">∈</span> <span class="free">var</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> vars_distinct<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"xx <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"yy <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"xx <span class="main">≠</span> zz"</span></span> <span class="quoted"><span class="quoted">"zz <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"xx <span class="main">≠</span> xx'"</span></span> <span class="quoted"><span class="quoted">"xx' <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"xx <span class="main">≠</span> yy'"</span></span> <span class="quoted"><span class="quoted">"yy' <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"xx <span class="main">≠</span> zz'"</span></span> <span class="quoted"><span class="quoted">"zz' <span class="main">≠</span> xx"</span></span>
  <span class="quoted"><span class="quoted">"yy <span class="main">≠</span> zz"</span></span> <span class="quoted"><span class="quoted">"zz <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"yy <span class="main">≠</span> xx'"</span></span> <span class="quoted"><span class="quoted">"xx' <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"yy <span class="main">≠</span> yy'"</span></span> <span class="quoted"><span class="quoted">"yy' <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"yy <span class="main">≠</span> zz'"</span></span> <span class="quoted"><span class="quoted">"zz' <span class="main">≠</span> yy"</span></span>
  <span class="quoted"><span class="quoted">"zz <span class="main">≠</span> xx'"</span></span> <span class="quoted"><span class="quoted">"xx' <span class="main">≠</span> zz"</span></span> <span class="quoted"><span class="quoted">"zz <span class="main">≠</span> yy'"</span></span> <span class="quoted"><span class="quoted">"yy' <span class="main">≠</span> zz"</span></span> <span class="quoted"><span class="quoted">"zz <span class="main">≠</span> zz'"</span></span> <span class="quoted"><span class="quoted">"zz' <span class="main">≠</span> zz"</span></span>
  <span class="quoted"><span class="quoted">"xx' <span class="main">≠</span> yy'"</span></span> <span class="quoted"><span class="quoted">"yy' <span class="main">≠</span> xx'"</span></span> <span class="quoted"><span class="quoted">"xx' <span class="main">≠</span> zz'"</span></span> <span class="quoted"><span class="quoted">"zz' <span class="main">≠</span> xx'"</span></span>
  <span class="quoted"><span class="quoted">"yy' <span class="main">≠</span> zz'"</span></span> <span class="quoted"><span class="quoted">"zz' <span class="main">≠</span> yy'"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Instance Operator›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="tfree">'trm</span> <span class="main">⇒</span> <span class="tfree">'fmla</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inst</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> xx"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inst<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> inst <span class="free">φ</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">getFresh</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> set <span class="main">⇒</span> <span class="tfree">'var</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">getFresh</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> getFresh<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">V</span> <span class="main">⟹</span>  getFresh <span class="free">V</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">∧</span> getFresh <span class="free">V</span> <span class="main">∉</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> finite_subset getFresh_def infinite_var someI_ex subsetI<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">getFr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> list <span class="main">⇒</span> <span class="tfree">'trm</span> list <span class="main">⇒</span> <span class="tfree">'fmla</span> list <span class="main">⇒</span> <span class="tfree">'var</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">getFr</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">φs</span></span></span> <span class="main">=</span>
 getFresh <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> set <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="free">Fvars</span> <span class="main">`</span> set <span class="free"><span class="bound"><span class="entity">φs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> getFr_FvarsT_Fvars<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ts</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"getFr <span class="free">xs</span> <span class="free">ts</span> <span class="free">φs</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">∧</span>
       getFr <span class="free">xs</span> <span class="free">ts</span> <span class="free">φs</span> <span class="main">∉</span> set <span class="free">xs</span> <span class="main">∧</span>
       <span class="main">(</span><span class="free">t</span> <span class="main">∈</span> set <span class="free">ts</span> <span class="main">⟶</span> getFr <span class="free">xs</span> <span class="free">ts</span> <span class="free">φs</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">(</span><span class="free">φ</span> <span class="main">∈</span> set <span class="free">φs</span> <span class="main">⟶</span> getFr <span class="free">xs</span> <span class="free">ts</span> <span class="free">φs</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>set <span class="free">xs</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> set <span class="free">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="free">Fvars</span> <span class="main">`</span> set <span class="free">φs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms finite_FvarsT finite_Fvars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> getFresh<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> getFr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> getFr<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ts</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"getFr <span class="free">xs</span> <span class="free">ts</span> <span class="free">φs</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms getFr_FvarsT_Fvars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> getFr_var<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ts</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> set <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"getFr <span class="free">xs</span> <span class="free">ts</span> <span class="free">φs</span> <span class="main">∉</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms getFr_FvarsT_Fvars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> getFr_FvarsT<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ts</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> set <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"getFr <span class="free">xs</span> <span class="free">ts</span> <span class="free">φs</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms getFr_FvarsT_Fvars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> getFr_Fvars<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ts</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> set <span class="free">φs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"getFr <span class="free">xs</span> <span class="free">ts</span> <span class="free">φs</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms getFr_FvarsT_Fvars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Fresh Variables›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">getFreshN</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> set <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'var</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">getFreshN</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">getFreshN</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">u</span> <span class="main">=</span> getFresh <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="keyword1">in</span> <span class="bound">u</span> <span class="main">#</span> <span class="free">getFreshN</span> <span class="main">(</span>insert <span class="bound">u</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> getFreshN<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">V</span> <span class="main">⟹</span>
  set <span class="main">(</span>getFreshN <span class="free">V</span> <span class="free">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span> <span class="main">∧</span> set <span class="main">(</span>getFreshN <span class="free">V</span> <span class="free">n</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> length <span class="main">(</span>getFreshN <span class="free">V</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> distinct <span class="main">(</span>getFreshN <span class="free">V</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">V</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> getFresh Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">getFrN</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> list <span class="main">⇒</span> <span class="tfree">'trm</span> list <span class="main">⇒</span> <span class="tfree">'fmla</span> list <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'var</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">getFrN</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">φs</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span>
 getFreshN <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> set <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="free">Fvars</span> <span class="main">`</span> set <span class="free"><span class="bound"><span class="entity">φs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> getFrN_FvarsT_Fvars<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ts</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>getFrN <span class="free">xs</span> <span class="free">ts</span> <span class="free">φs</span> <span class="free">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span> <span class="main">∧</span>
       set <span class="main">(</span>getFrN <span class="free">xs</span> <span class="free">ts</span> <span class="free">φs</span> <span class="free">n</span><span class="main">)</span> <span class="main">∩</span> set <span class="free">xs</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span>
       <span class="main">(</span><span class="free">t</span> <span class="main">∈</span> set <span class="free">ts</span> <span class="main">⟶</span> set <span class="main">(</span>getFrN <span class="free">xs</span> <span class="free">ts</span> <span class="free">φs</span> <span class="free">n</span><span class="main">)</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">(</span><span class="free">φ</span> <span class="main">∈</span> set <span class="free">φs</span> <span class="main">⟶</span> set <span class="main">(</span>getFrN <span class="free">xs</span> <span class="free">ts</span> <span class="free">φs</span> <span class="free">n</span><span class="main">)</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span>
       length <span class="main">(</span>getFrN <span class="free">xs</span> <span class="free">ts</span> <span class="free">φs</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span>
       distinct <span class="main">(</span>getFrN <span class="free">xs</span> <span class="free">ts</span> <span class="free">φs</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>set <span class="free">xs</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> set <span class="free">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="free">Fvars</span> <span class="main">`</span> set <span class="free">φs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms finite_FvarsT finite_Fvars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> getFreshN<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> getFrN_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> getFrN<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ts</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>getFrN <span class="free">xs</span> <span class="free">ts</span> <span class="free">φs</span> <span class="free">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms getFrN_FvarsT_Fvars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> getFrN_var<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ts</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> set <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>getFrN <span class="free">xs</span> <span class="free">ts</span> <span class="free">φs</span> <span class="free">n</span><span class="main">)</span> <span class="main">∩</span> set <span class="free">xs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms getFrN_FvarsT_Fvars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> getFrN_FvarsT<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ts</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> set <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>getFrN <span class="free">xs</span> <span class="free">ts</span> <span class="free">φs</span> <span class="free">n</span><span class="main">)</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms getFrN_FvarsT_Fvars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> getFrN_Fvars<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ts</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> set <span class="free">φs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>getFrN <span class="free">xs</span> <span class="free">ts</span> <span class="free">φs</span> <span class="free">n</span><span class="main">)</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms getFrN_FvarsT_Fvars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> getFrN_length<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ts</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>getFrN <span class="free">xs</span> <span class="free">ts</span> <span class="free">φs</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms getFrN_FvarsT_Fvars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> getFrN_distinct<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ts</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>getFrN <span class="free">xs</span> <span class="free">ts</span> <span class="free">φs</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms getFrN_FvarsT_Fvars <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Parallel Term Substitution›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rawpsubstT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'trm</span> <span class="main">×</span> <span class="tfree">'var</span><span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'trm</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rawpsubstT</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rawpsubstT</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">x1</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">txs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">rawpsubstT</span> <span class="main">(</span><span class="free">substT</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">x1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">txs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubstT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="free">t</span> <span class="free">txs</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">psubstT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'trm</span> <span class="main">×</span> <span class="tfree">'var</span><span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'trm</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">psubstT</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">txs</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">xs</span> <span class="main">=</span> map snd <span class="free"><span class="bound"><span class="entity">txs</span></span></span><span class="main">;</span> <span class="bound">ts</span> <span class="main">=</span> map fst <span class="free"><span class="bound"><span class="entity">txs</span></span></span><span class="main">;</span> <span class="bound">us</span> <span class="main">=</span> getFrN <span class="bound">xs</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">#</span> <span class="bound">ts</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>length <span class="bound">xs</span><span class="main">)</span> <span class="keyword1">in</span>
      rawpsubstT <span class="main">(</span>rawpsubstT <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="bound">us</span><span class="main">)</span> <span class="bound">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="bound">ts</span> <span class="bound">us</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The psubstT versions of the subst axioms.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubstT<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubstT <span class="free">t</span> <span class="free">txs</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">#</span> map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> us
    <span class="keyword1"><span class="command">using</span></span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_distinct<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> IntI empty_iff image_iff old.prod.inject surjective_pairing<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command">unfolding</span></span> psubstT_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> set_zip_leftD set_zip_rightD <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubstT_Var_not<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">Var</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">txs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> psubstT_Var_not<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubstT <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">Var</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="free">x</span> <span class="main">#</span> map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> set <span class="skolem">us</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> us
    <span class="keyword1"><span class="command">using</span></span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">x</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">x</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">x</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">x</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">Var</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms us_facts
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> rawpsubstT_Var_not<span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> set_zip_rightD set_zip_leftD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span> <span class="free">Var</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms us_facts
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> rawpsubstT_Var_not<span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> set_zip_rightD set_zip_leftD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command">unfolding</span></span> psubstT_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubstT_notIn<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="free">t</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="free">t</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">txs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> psubstT_notIn<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="free">t</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubstT <span class="free">t</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">#</span> map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> us
    <span class="keyword1"><span class="command">using</span></span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="free">t</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms us_facts
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> rawpsubstT_notIn<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> set_zip_rightD set_zip_leftD<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="free">t</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms us_facts
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> rawpsubstT_notIn<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> set_zip_rightD set_zip_leftD<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command">unfolding</span></span> psubstT_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Parallel Formula Substitution›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rawpsubst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'trm</span> <span class="main">×</span> <span class="tfree">'var</span><span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'fmla</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rawpsubst</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rawpsubst</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">x1</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">txs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">rawpsubst</span> <span class="main">(</span><span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">x1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">txs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubst<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="free">φ</span> <span class="free">txs</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">psubst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'trm</span> <span class="main">×</span> <span class="tfree">'var</span><span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'fmla</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">psubst</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">txs</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">xs</span> <span class="main">=</span> map snd <span class="free"><span class="bound"><span class="entity">txs</span></span></span><span class="main">;</span> <span class="bound">ts</span> <span class="main">=</span> map fst <span class="free"><span class="bound"><span class="entity">txs</span></span></span><span class="main">;</span> <span class="bound">us</span> <span class="main">=</span> getFrN <span class="bound">xs</span> <span class="bound">ts</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">]</span> <span class="main">(</span>length <span class="bound">xs</span><span class="main">)</span> <span class="keyword1">in</span>
      rawpsubst <span class="main">(</span>rawpsubst <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="bound">us</span><span class="main">)</span> <span class="bound">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="bound">ts</span> <span class="bound">us</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The psubst versions of the subst axioms.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubst<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubst <span class="free">φ</span> <span class="free">txs</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> us
    <span class="keyword1"><span class="command">using</span></span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="free">φ</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_distinct<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 8 0 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff image_iff Bex_def Ball_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command">unfolding</span></span> psubst_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> set_zip_rightD set_zip_leftD <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_rawpsubst_su<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span>
       <span class="main">(</span><span class="free">Fvars</span> <span class="free">φ</span> <span class="main">-</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="free">FvarsT</span> <span class="bound">t</span> <span class="main">|</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">tx</span> <span class="skolem">txs</span> <span class="skolem">φ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> tx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tx</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">unfolding</span></span> tx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">χ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">χ</span> <span class="main">=</span> <span class="free">subst</span> <span class="skolem">φ</span> <span class="skolem">t</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="skolem">χ</span> <span class="main">=</span>  <span class="free">Fvars</span> <span class="skolem">φ</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="skolem">φ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="skolem">t</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">unfolding</span></span> χ_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tx t<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> χ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> χ_def <span class="keyword1"><span class="command">using</span></span> Cons.prems t x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="main">(</span>rawpsubst <span class="skolem">χ</span> <span class="skolem">txs</span><span class="main">)</span> <span class="main">⊆</span>
       <span class="main">(</span><span class="free">Fvars</span> <span class="skolem">χ</span> <span class="main">-</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="skolem">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span>
       <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="free">FvarsT</span> <span class="bound">t</span> <span class="main">|</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">txs</span><span class="main">}</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> Cons.prems χ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Cons.IH<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="free">Fvars</span> <span class="skolem">φ</span> <span class="main">-</span> insert <span class="skolem">x</span> <span class="main">(</span>snd <span class="main">`</span> set <span class="skolem">txs</span><span class="main">)</span> <span class="main">∪</span> <span class="main">⋃</span><span class="main">{</span><span class="free">FvarsT</span> <span class="bound">ta</span> <span class="main">|</span><span class="bound">ta</span><span class="main">.</span> <span class="main">∃</span><span class="bound">xa</span><span class="main">.</span> <span class="bound">ta</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="bound">xa</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">txs</span><span class="main">}</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⊆</span> <span class="var">?R</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 0 tx Cons.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="main">(</span>rawpsubst <span class="skolem">χ</span> <span class="skolem">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="skolem">χ</span> <span class="main">=</span> <span class="free">Fvars</span> <span class="skolem">φ</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="skolem">φ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="skolem">t</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems t x <span class="keyword1"><span class="command">unfolding</span></span> χ_def <span class="keyword1"><span class="command">using</span></span> Fvars_subst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tx χ_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> in_Fvars_rawpsubst_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">-</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
     <span class="main">(</span><span class="free">y</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">{</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="main">|</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Fvars_rawpsubst_su<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2-4<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_rawpsubst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="bound">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="free">txs</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">(</span><span class="free">Fvars</span> <span class="free">φ</span> <span class="main">-</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span>
       <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">txs</span> <span class="skolem">φ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> x_txs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ta</span> <span class="bound">xa</span><span class="main">.</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">txs</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="bound">xa</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="main">(</span>map snd <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span><span class="main">)</span>›</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> xt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="skolem">t</span> <span class="main">∧</span> snd <span class="main">`</span> set <span class="skolem">txs</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="skolem">φ</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> <span class="free">FvarsT</span> <span class="skolem">t</span> <span class="main">-</span> snd <span class="main">`</span> set <span class="skolem">txs</span> <span class="main">=</span>
            <span class="free">Fvars</span> <span class="skolem">φ</span> <span class="main">-</span> insert <span class="skolem">x</span> <span class="main">(</span>snd <span class="main">`</span> set <span class="skolem">txs</span><span class="main">)</span> <span class="main">∪</span> <span class="free">FvarsT</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">χ</span></span> <span class="keyword2"><span class="keyword">where</span></span> χ_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">χ</span> <span class="main">=</span> <span class="free">subst</span> <span class="skolem">φ</span> <span class="skolem">t</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> χ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> χ_def <span class="keyword1"><span class="command">using</span></span> Cons.prems t x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="main">(</span>rawpsubst <span class="skolem">χ</span> <span class="skolem">txs</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">(</span><span class="free">Fvars</span> <span class="skolem">χ</span> <span class="main">-</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="skolem">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span>
       <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="skolem">χ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">txs</span><span class="main">}</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> Cons.prems χ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Cons.IH<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="skolem">χ</span> <span class="main">=</span> <span class="free">Fvars</span> <span class="skolem">φ</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="skolem">φ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="skolem">t</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems t x <span class="keyword1"><span class="command">unfolding</span></span> χ_def <span class="keyword1"><span class="command">using</span></span> Fvars_subst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">ta</span> <span class="bound">xa</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">xa</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="skolem">φ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">ta</span> <span class="keyword1">else</span> <span class="main">{}</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">{</span><span class="skolem">f</span> <span class="bound">ta</span> <span class="bound">xa</span>  <span class="main">|</span><span class="bound">ta</span> <span class="bound">xa</span><span class="main">.</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
        <span class="skolem">f</span> <span class="skolem">t</span> <span class="skolem">x</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="skolem">f</span> <span class="bound">ta</span> <span class="bound">xa</span>  <span class="main">|</span><span class="bound">ta</span> <span class="bound">xa</span><span class="main">.</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">txs</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> snd <span class="main">`</span> set <span class="skolem">txs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">t</span> <span class="skolem">x</span> <span class="main">∩</span> snd <span class="main">`</span> set <span class="skolem">txs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> xt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">{</span><span class="keyword1">if</span> <span class="bound">xa</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="skolem">φ</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">f</span> <span class="skolem">t</span> <span class="skolem">x</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">ta</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span> <span class="bound">ta</span> <span class="bound">xa</span><span class="main">.</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">txs</span><span class="main">}</span>
     <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="skolem">f</span> <span class="bound">ta</span> <span class="bound">xa</span> <span class="main">|</span> <span class="bound">ta</span> <span class="bound">xa</span><span class="main">.</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">txs</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> xt x_txs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="skolem">φ</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">f</span> <span class="skolem">t</span> <span class="skolem">x</span>  <span class="main">-</span> snd <span class="main">`</span> set <span class="skolem">txs</span> <span class="main">∪</span>
    <span class="main">⋃</span> <span class="main">{</span><span class="keyword1">if</span> <span class="bound">xa</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="skolem">φ</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">f</span> <span class="skolem">t</span> <span class="skolem">x</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">ta</span> <span class="keyword1">else</span> <span class="main">{}</span>
         <span class="main">|</span> <span class="bound">ta</span> <span class="bound">xa</span><span class="main">.</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">txs</span><span class="main">}</span> <span class="main">=</span>
        <span class="free">Fvars</span> <span class="skolem">φ</span> <span class="main">-</span> snd <span class="main">`</span> set <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span> <span class="main">∪</span>
    <span class="main">⋃</span> <span class="main">{</span><span class="skolem">f</span> <span class="bound">ta</span> <span class="bound">xa</span>  <span class="main">|</span><span class="bound">ta</span> <span class="bound">xa</span><span class="main">.</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> 3 4 6 <span class="keyword1"><span class="command">unfolding</span></span> Un_Diff2<span class="main">[</span><span class="operator">OF</span> 5<span class="main">]</span> Un_assoc <span class="keyword1"><span class="command">unfolding</span></span> Diff_Diff_Un <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a rawpsubst.simps 1 2 χ_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> in_Fvars_rawpsubstD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="bound">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">-</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
     <span class="main">(</span><span class="free">y</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">{</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Fvars_rawpsubst assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_psubst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="main">(</span>psubst <span class="free">φ</span> <span class="free">txs</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">(</span><span class="free">Fvars</span> <span class="free">φ</span> <span class="main">-</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span>
       <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> us
    <span class="keyword1"><span class="command">using</span></span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 9 0 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff image_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">χ</span></span> <span class="keyword2"><span class="keyword">where</span></span> χ_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">χ</span> <span class="main">=</span> rawpsubst <span class="free">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> χ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> χ_def <span class="keyword1"><span class="command">using</span></span> assms us_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> set_us<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">=</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> us_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> snd_set_zip<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> set_txs<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">txs</span> <span class="main">=</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> us_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> snd_set_zip_map_snd<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> <span class="free">Var</span> <span class="bound">u</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> us_facts set_zip_leftD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> 00<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span>
     <span class="main">⟷</span>  <span class="main">(</span><span class="main">∃</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">var</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> <span class="free">Var</span> <span class="bound">u</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> us_facts set_zip_leftD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="skolem">χ</span> <span class="main">=</span>
        <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">-</span> snd <span class="main">`</span> set <span class="free">txs</span> <span class="main">∪</span>
        <span class="main">⋃</span><span class="main">{</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span><span class="bound">t</span> <span class="bound">x</span><span class="main">.</span>
             <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> χ_def set_txs <span class="keyword1"><span class="command">using</span></span> assms us_facts
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> Fvars_rawpsubst<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_rightD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_leftD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 6 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_txs<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> set_eq_iff subset_eq image_iff in_set_zip
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> spec<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="skolem">us</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> set <span class="free">txs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> snd <span class="bound">y</span><span class="main">)</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> mp<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> _ nth_mem<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
    <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">-</span> snd <span class="main">`</span> set <span class="free">txs</span> <span class="main">∪</span>
    <span class="main">⋃</span><span class="main">{</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="keyword1">then</span> <span class="main">{</span><span class="bound">u</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span><span class="bound">u</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> FvarsT_Var <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> 00<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="skolem">χ</span> <span class="main">=</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="main">(</span>rawpsubst <span class="skolem">χ</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span><span class="free">Fvars</span> <span class="skolem">χ</span> <span class="main">-</span> set <span class="skolem">us</span><span class="main">)</span> <span class="main">∪</span>
        <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="keyword1">if</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="skolem">χ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span> <span class="bound">t</span> <span class="bound">u</span> <span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_us <span class="keyword1"><span class="command">using</span></span> us_facts assms χ
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> Fvars_rawpsubst<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> set_zip_rightD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> set_zip_rightD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_leftD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_leftD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntI Union_iff empty_iff fst_set_zip_map_fst image_eqI set_us<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="skolem">χ</span> <span class="main">-</span> set <span class="skolem">us</span> <span class="main">=</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">-</span> snd <span class="main">`</span> set <span class="free">txs</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command">using</span></span> us_facts<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_leftD <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="keyword1">if</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="skolem">χ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span> <span class="bound">t</span> <span class="bound">u</span> <span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span>
   <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xx</span> <span class="skolem">tt</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> xx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="skolem">χ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="skolem">tt</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">tt</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> ttin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="free">txs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ty <span class="keyword1"><span class="command">using</span></span> set_zip_leftD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> yin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="skolem">us</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ty <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> set_zip_D<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> yvar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> us_facts yin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ynotin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> snd <span class="main">`</span> set <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> yin us_facts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">{</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span><span class="bound">t</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="skolem">χ</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> y <span class="main">=</span> True
      <span class="keyword1"><span class="command">hence</span></span> xx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="skolem">tt</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xx <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> xφ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> yx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Var</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> y ynotin <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> empty_iff insert_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> yx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="skolem">us</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> yvar us_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> inj_on_set_zip_map<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inj_on_Var yx<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">tt</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> set_zip_map_fst_snd<span class="main"><span class="main">[</span></span><span class="operator">OF</span> yx ty<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>›</span></span> us_facts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> xx xφ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">insert</span> xx<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="skolem">tt</span> <span class="skolem">xx</span>
    <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">xx</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="skolem">tt</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> tx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">tt</span><span class="main">,</span> <span class="skolem">xx</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> xxsnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">∈</span> snd <span class="main">`</span> set <span class="free">txs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> uin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> set <span class="skolem">us</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> uxx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">xx</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="skolem">us</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> xxsnd in_set_impl_in_set_zip2 length_map set_map set_zip_leftD us_facts<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> uvar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> us_facts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">{</span><span class="keyword1">if</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="skolem">χ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span><span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> xx <span class="main">=</span> True
      <span class="keyword1"><span class="command">hence</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="skolem">tt</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">xx</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> us_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_zip_length_map<span class="main"><span class="main">[</span></span><span class="operator">OF</span> uxx<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> uχ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="skolem">χ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> uin xx uvar <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ttu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">tt</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_zip_map_fst_snd2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> uxx tx<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> uχ ttu y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">insert</span> y<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> psubst_def Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> χ_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 1 2 3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> in_Fvars_psubstD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="main">(</span>psubst <span class="free">φ</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="main">(</span><span class="free">Fvars</span> <span class="free">φ</span> <span class="main">-</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span>
           <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Fvars_psubst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subst2_fresh_switch<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">s</span> <span class="free">y</span><span class="main">)</span> <span class="free">t</span> <span class="free">x</span> <span class="main">=</span> <span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="free">s</span> <span class="free">y</span>"</span></span>   <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_compose_diff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">φ</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubst2_fresh_switch<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="free">φ</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">y</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> rawpsubst <span class="free">φ</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">y</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst2_fresh_switch<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubst_compose<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs1</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs1</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs2</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs2</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="free">txs1</span><span class="main">)</span> <span class="free">txs2</span> <span class="main">=</span> rawpsubst <span class="free">φ</span> <span class="main">(</span><span class="free">txs1</span> <span class="main">@</span> <span class="free">txs2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">txs1</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">txs2</span></span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubst_subst_fresh_switch<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">.</span> <span class="free">y</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="bound">t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">s</span> <span class="free">y</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> rawpsubst <span class="free">φ</span> <span class="main">(</span><span class="free">txs</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">y</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">φ</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">tx</span> <span class="skolem">txs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> tx<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tx</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">unfolding</span></span> tx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="skolem">φ</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span> <span class="main">=</span> rawpsubst <span class="skolem">φ</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">txs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubst <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="main">[</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="skolem">txs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="skolem">φ</span> <span class="main">[</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> rawpsubst <span class="skolem">φ</span> <span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst2_fresh_switch<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="skolem">txs</span> <span class="main">=</span> rawpsubst <span class="skolem">φ</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">txs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="skolem">φ</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">txs</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubst <span class="skolem">φ</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> tx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_rawpsubst_fresh_switch<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">.</span> <span class="free">y</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="bound">t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="free">txs</span><span class="main">)</span> <span class="free">s</span> <span class="free">y</span> <span class="main">=</span> rawpsubst <span class="free">φ</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">#</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">φ</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">tx</span> <span class="skolem">txs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> tx<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tx</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">unfolding</span></span> tx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="skolem">φ</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">txs</span><span class="main">)</span> <span class="skolem">s</span> <span class="skolem">y</span> <span class="main">=</span> rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="skolem">φ</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Cons.IH<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubst <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubst <span class="skolem">φ</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubst <span class="skolem">φ</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">txs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubst <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="skolem">txs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="skolem">φ</span> <span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> rawpsubst <span class="skolem">φ</span> <span class="main">[</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst2_fresh_switch<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="main">[</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="skolem">txs</span> <span class="main">=</span> rawpsubst <span class="skolem">φ</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">txs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubst_compose_freshVar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="free">txs</span> <span class="main">⟹</span> snd <span class="main">(</span><span class="free">txs</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">txs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="free">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="free">us</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="free">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="free">us</span><span class="main">)</span> <span class="main">=</span> rawpsubst <span class="free">φ</span> <span class="free">txs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">us</span></span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">tx</span> <span class="skolem">txs</span> <span class="skolem">uus</span> <span class="skolem">φ</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> tx<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tx</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> uus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">uus</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">#</span> <span class="skolem">us</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">uus</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="skolem">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="skolem">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="skolem">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="skolem">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> u_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="skolem">φ</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="skolem">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="skolem">txs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> set <span class="skolem">us</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?uxs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="skolem">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="var">?uxs</span> <span class="main">=</span> rawpsubst <span class="skolem">φ</span> <span class="main">(</span><span class="var">?uxs</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> u_facts Cons.prems
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_subst_fresh_switch<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subsetD <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?uuxs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">uus</span><span class="main">)</span> <span class="main">(</span>map snd <span class="main">(</span><span class="skolem">tx</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tus</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map fst <span class="skolem">txs</span><span class="main">)</span> <span class="skolem">us</span>"</span></span>  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ttxs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map fst <span class="main">(</span><span class="skolem">tx</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">uus</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> in_Fvars_rawpsubstD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">premises</span></span> prems <span class="keyword1"><span class="command">using</span></span> us_facts<span class="main">(</span>1<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_set_zip subset_eq set_eq_iff image_iff
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> spec<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="skolem">us</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> set <span class="skolem">txs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> snd <span class="bound">y</span><span class="main">)</span>"</span></span><span class="main"><span class="main">,</span></span>
        <span class="operator">THEN</span> mp<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> _ nth_mem<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> bspec<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> _ nth_mem<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_set_zip subset_eq <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">xx</span> <span class="bound">tt</span><span class="main">.</span> <span class="bound">xx</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="skolem">t</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">tt</span><span class="main">,</span> <span class="bound">xx</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">txs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Cons.prems<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span> tx <span class="keyword1"><span class="command">unfolding</span></span> set_conv_nth
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_leI diff_Suc_1 fst_conv le_imp_less_Suc
            nth_Cons_0 snd_conv zero_less_Suc<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> 00<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="var">?uuxs</span><span class="main">)</span> <span class="var">?ttxs</span> <span class="main">=</span> rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="main">(</span><span class="var">?uxs</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span> <span class="var">?tus</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="skolem">φ</span> <span class="main">(</span><span class="var">?uxs</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> rawpsubst <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">[</span><span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_compose<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">[</span><span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="main">(</span><span class="var">?uxs</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="main">=</span>
                <span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="var">?uxs</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subst_subst<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubst <span class="skolem">φ</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">#</span> <span class="var">?uxs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Cons.prems 3 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> subst_rawpsubst_fresh_switch<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>  rawpsubst <span class="skolem">φ</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="var">?uxs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubst <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="var">?uxs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_compose<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="main">(</span><span class="var">?uxs</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span> <span class="var">?tus</span> <span class="main">=</span>
                rawpsubst <span class="main">(</span>rawpsubst <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="var">?uuxs</span><span class="main">)</span> <span class="var">?ttxs</span> <span class="main">=</span> rawpsubst <span class="main">(</span>rawpsubst <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 00 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubst <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="skolem">txs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> Cons.IH rawpsubst<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D in_Fvars_substD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D in_Fvars_substD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D in_Fvars_substD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D in_Fvars_substD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D in_Fvars_substD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D in_Fvars_substD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_mono diff_Suc_1 length_Cons nat.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> nth_Cons'<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D in_Fvars_substD<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubst <span class="skolem">φ</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">txs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_compose<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubst_compose_freshVar2_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ts</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>  <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>  <span class="quoted"><span class="quoted">"distinct <span class="free">us</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>set <span class="free">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">∩</span> set <span class="free">xs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> vs_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>  <span class="quoted"><span class="quoted">"distinct <span class="free">vs</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>set <span class="free">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">∩</span> set <span class="free">xs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">us</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">vs</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ts</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="comment1">(* Extra hypothesis, only to get induction through: *)</span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">∩</span> set <span class="free">vs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="free">us</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">ts</span> <span class="free">us</span><span class="main">)</span> <span class="main">=</span>
       rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="free">vs</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">ts</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">φ</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">us</span></span> <span class="quoted"><span class="free">vs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">φ</span> <span class="skolem">tts</span> <span class="skolem">uus</span> <span class="skolem">vvs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">ts</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> tts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tts</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">#</span> <span class="skolem">ts</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ts</span> <span class="main">=</span> length <span class="skolem">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> uus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">uus</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">#</span> <span class="skolem">us</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="skolem">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> vvs<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vvs</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lvs<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">vs</span> <span class="main">=</span> length <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">uus</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">vvs</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">tts</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tts</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">uus</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">vvs</span></span><span class="main">)</span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?φux</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="skolem">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>   <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?φvx</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="skolem">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>rawpsubst <span class="var">?φux</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="skolem">ts</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span>
           rawpsubst <span class="main">(</span>rawpsubst <span class="var">?φux</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="skolem">ts</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Cons.IH<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="var">?φux</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span>
           <span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subst_rawpsubst_fresh_switch<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_eq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> 11<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="var">?φvx</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span>
           <span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subst_rawpsubst_fresh_switch<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="main">=</span>
        <span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Cons.prems
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subst_subst<span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D in_Fvars_rawpsubst_imp <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Fvars_rawpsubst<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Cons.prems
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subst_subst<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D in_Fvars_rawpsubst_imp <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Fvars_rawpsubst<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span>
    2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="main">=</span>
      <span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">v</span>"</span></span>  <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="var">?φux</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>zip <span class="skolem">ts</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span>
        <span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="main">(</span>rawpsubst <span class="var">?φux</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="skolem">ts</span> <span class="skolem">us</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subst_rawpsubst_fresh_switch<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="main">(</span>rawpsubst <span class="var">?φux</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="skolem">ts</span> <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="var">?φux</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>zip <span class="skolem">ts</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subst_rawpsubst_fresh_switch<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>zip <span class="skolem">ts</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> 1 <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="skolem">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>zip <span class="skolem">ts</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> 2 <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="var">?φvx</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>zip <span class="skolem">ts</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> 11 <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="var">?φux</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>zip <span class="skolem">ts</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span>
        rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="var">?φvx</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>zip <span class="skolem">ts</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹... now getting rid of the disjointness hypothesis:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubst_compose_freshVar2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ts</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>  <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>  <span class="quoted"><span class="quoted">"distinct <span class="free">us</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>set <span class="free">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">∩</span> set <span class="free">xs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> vs_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>  <span class="quoted"><span class="quoted">"distinct <span class="free">vs</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>set <span class="free">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">∩</span> set <span class="free">xs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">us</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">vs</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ts</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="free">us</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">ts</span> <span class="free">us</span><span class="main">)</span> <span class="main">=</span>
       rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="free">vs</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">ts</span> <span class="free">vs</span><span class="main">)</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ws</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">=</span> getFrN <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">us</span> <span class="main">@</span> <span class="free">vs</span><span class="main">)</span> <span class="free">ts</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span> <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> fv <span class="main">=</span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">us</span> <span class="main">@</span> <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span>"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> fvt <span class="main">=</span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">us</span> <span class="main">@</span> <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span>"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> var <span class="main">=</span> getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">us</span> <span class="main">@</span> <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span>"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> l <span class="main">=</span> getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">us</span> <span class="main">@</span> <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> ws_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>  <span class="quoted"><span class="quoted">"distinct <span class="skolem">ws</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>set <span class="free">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">∩</span> set <span class="free">xs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">∩</span> set <span class="free">us</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">∩</span> set <span class="free">vs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">ws</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> ws_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> fv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> fvt IntI empty_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> var IntI empty_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> var IntI empty_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> var IntI empty_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">ws</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">ts</span> <span class="skolem">ws</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rawpsubst_compose_freshVar2_aux<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms ws_facts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?R</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rawpsubst_compose_freshVar2_aux<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms ws_facts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_subst_fresh_switch<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>snd <span class="main">`</span> set <span class="free">txs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span>fst <span class="main">`</span> set <span class="free">txs</span><span class="main">.</span> <span class="free">y</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="bound">t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> snd <span class="main">`</span> set <span class="free">txs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubst <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">s</span> <span class="free">y</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">subst</span> <span class="main">(</span>psubst <span class="free">φ</span> <span class="free">txs</span><span class="main">)</span> <span class="free">s</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> fvt <span class="main">=</span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> fv <span class="main">=</span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> var <span class="main">=</span> getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> l <span class="main">=</span> getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>

  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> us <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> fv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">txs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> fvt <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">txs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> var <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">txs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">s</span> <span class="free">y</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> fvt <span class="main">=</span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">s</span> <span class="free">y</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> fv <span class="main">=</span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">s</span> <span class="free">y</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> var <span class="main">=</span> getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">s</span> <span class="free">y</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> l <span class="main">=</span> getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">s</span> <span class="free">y</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>

  <span class="keyword1"><span class="command">have</span></span> vs_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">s</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">vs</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">vs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> vs <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> fv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">txs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> fvt <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">txs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> var <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">txs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ws</span></span> <span class="keyword2"><span class="keyword">where</span></span> ws<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">=</span> getFrN <span class="main">(</span><span class="free">y</span> <span class="main">#</span> map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="free">s</span> <span class="main">#</span> map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> fvt <span class="main">=</span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">#</span> map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> fv <span class="main">=</span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">#</span> map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> var <span class="main">=</span> getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">#</span> map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> l <span class="main">=</span> getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">#</span> map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>

  <span class="keyword1"><span class="command">have</span></span> ws_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> set <span class="skolem">ws</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">s</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">ws</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">ws</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> ws <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> fv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">txs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> var <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">txs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> fvt  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">txs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> fvt <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">txs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> var <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">txs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">txs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?vxs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tvs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?uxs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tus</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?wxs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tws</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">ws</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">s</span> <span class="free">y</span><span class="main">)</span> <span class="var">?wxs</span> <span class="main">=</span> <span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="var">?wxs</span><span class="main">)</span> <span class="free">s</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> rawpsubst_compose<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">φ</span></span> <span class="var"><span class="quoted"><span class="var">?wxs</span></span></span>  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">y</span><span class="main">)</span><span class="main">]</span>"</span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms ws_facts <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> rawpsubst_subst_fresh_switch<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_eq rawpsubst_subst_fresh_switch<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="var">?wxs</span><span class="main">)</span> <span class="var">?tws</span> <span class="main">=</span> rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ws_facts us_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_compose_freshVar2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">s</span> <span class="free">y</span><span class="main">)</span> <span class="var">?vxs</span><span class="main">)</span> <span class="var">?tvs</span> <span class="main">=</span>
        rawpsubst <span class="main">(</span>rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">s</span> <span class="free">y</span><span class="main">)</span> <span class="var">?wxs</span><span class="main">)</span> <span class="var">?tws</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ws_facts vs_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_compose_freshVar2<span class="main">)</span>  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="var">?wxs</span><span class="main">)</span> <span class="free">s</span> <span class="free">y</span><span class="main">)</span> <span class="var">?tws</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="var">?wxs</span><span class="main">)</span> <span class="var">?tws</span><span class="main">)</span> <span class="free">s</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> rawpsubst_compose<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="free">φ</span> <span class="var">?wxs</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?tws</span></span></span>  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">y</span><span class="main">)</span><span class="main">]</span>"</span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms ws_facts <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> rawpsubst_subst_fresh_switch<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_eq rawpsubst_subst_fresh_switch
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">subst</span> <span class="main">(</span>rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span><span class="main">)</span> <span class="free">s</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> 1 <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> psubst_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def vs<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For many cases, the simpler rawpsubst can replace psubst:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_eq_rawpsubst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
    <span class="comment1">(* ... namely, when the substituted variables do not belong to trms substituted for previous variables: *)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="free">txs</span> <span class="main">⟹</span> snd <span class="main">(</span><span class="free">txs</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">txs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubst <span class="free">φ</span> <span class="free">txs</span> <span class="main">=</span> rawpsubst <span class="free">φ</span> <span class="free">txs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> fvt <span class="main">=</span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> fv <span class="main">=</span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> var <span class="main">=</span> getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> l <span class="main">=</span> getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> us
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> fv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> fvt <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> var <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> rawpsubst_compose_freshVar assms us_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> psubst_def Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some particular cases:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_eq_subst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubst <span class="free">φ</span> <span class="main">[</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="free">subst</span> <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"psubst <span class="free">φ</span> <span class="main">[</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> rawpsubst <span class="free">φ</span> <span class="main">[</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> psubst_eq_rawpsubst<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_eq_rawpsubst2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">≠</span> <span class="free">x2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubst <span class="free">φ</span> <span class="main">[</span><span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="free">x1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t2</span><span class="main">,</span><span class="free">x2</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> rawpsubst <span class="free">φ</span> <span class="main">[</span><span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="free">x1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t2</span><span class="main">,</span><span class="free">x2</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> psubst_eq_rawpsubst<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">using</span></span> less_SucE <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_eq_rawpsubst3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x3</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t3</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">≠</span> <span class="free">x2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">≠</span> <span class="free">x3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">≠</span> <span class="free">x3</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x3</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x3</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubst <span class="free">φ</span> <span class="main">[</span><span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="free">x1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t2</span><span class="main">,</span><span class="free">x2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t3</span><span class="main">,</span><span class="free">x3</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> rawpsubst <span class="free">φ</span> <span class="main">[</span><span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="free">x1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t2</span><span class="main">,</span><span class="free">x2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t3</span><span class="main">,</span><span class="free">x3</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">using</span></span> less_SucE <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> psubst_eq_rawpsubst<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> i j
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_Cons'<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_eq_rawpsubst4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x3</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x4</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t3</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t4</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">≠</span> <span class="free">x2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">≠</span> <span class="free">x3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">≠</span> <span class="free">x3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">≠</span> <span class="free">x4</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">≠</span> <span class="free">x4</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x3</span> <span class="main">≠</span> <span class="free">x4</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x3</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x3</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x4</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x4</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x4</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t3</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubst <span class="free">φ</span> <span class="main">[</span><span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="free">x1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t2</span><span class="main">,</span><span class="free">x2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t3</span><span class="main">,</span><span class="free">x3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t4</span><span class="main">,</span><span class="free">x4</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> rawpsubst <span class="free">φ</span> <span class="main">[</span><span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="free">x1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t2</span><span class="main">,</span><span class="free">x2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t3</span><span class="main">,</span><span class="free">x3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t4</span><span class="main">,</span><span class="free">x4</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">using</span></span> less_SucE <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> psubst_eq_rawpsubst<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> i j
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_Cons'<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubst_same_Var<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="free">φ</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_same_Var<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubst <span class="free">φ</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"psubst <span class="free">φ</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> rawpsubst <span class="free">φ</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> psubst_eq_rawpsubst<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_eq_iff_index_eq subsetD<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubst_notIn<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">φ</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="free">φ</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">txs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_notIn<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">φ</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubst <span class="free">φ</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> us <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="comment1">(* *)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="free">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> rawpsubst_notIn<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_rightD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_leftD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_rightD<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="free">φ</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span> <span class="free">φ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> rawpsubst_notIn<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_rightD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_leftD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_rightD<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command">unfolding</span></span> psubst_def
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span> Generic_Syntax<span class="antiquote">}</span></span>›</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Adding Numerals to the Generic Syntax›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Syntax_with_Numerals <span class="main">=</span>
  Generic_Syntax <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">trm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Var</span> <span class="free">FvarsT</span> <span class="free">substT</span> <span class="free">Fvars</span> <span class="free">subst</span>
    <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="comment1">― ‹Abstract notion of numerals, as a subset of the ground terms:›</span>
    <span class="free">num</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    numNE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">num</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    num<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">num</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    FvarsT_num<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">num</span> <span class="main">⟹</span> <span class="free">FvarsT</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> substT_num1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">num</span> <span class="main">⟹</span> <span class="free">substT</span> <span class="free">n</span> <span class="free">t</span> <span class="free">y</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> num <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> in_num<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">num</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> num <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_comp_num<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">num</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span> <span class="free">n</span> <span class="free">x</span> <span class="main">=</span> <span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">n</span> <span class="free">x</span><span class="main">)</span> <span class="free">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_comp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubstT_num<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">num</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="free">n</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">txs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> psubstT_num<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">num</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubstT <span class="free">n</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="main">#</span> map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">n</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> us
    <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 7 0 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_eq_iff image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="free">n</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> rawpsubstT_num<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_rightD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_leftD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="var">?t</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> t <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> rawpsubstT_num<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_rightD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_leftD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> psubstT_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span> Syntax_with_Numerals<span class="antiquote">}</span></span>›</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Adding Connectives and Quantifiers›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Syntax_with_Connectives <span class="main">=</span>
  Generic_Syntax <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">trm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Var</span> <span class="free">FvarsT</span> <span class="free">substT</span> <span class="free">Fvars</span> <span class="free">subst</span>
    <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="comment1">― ‹Logical connectives›</span>
    <span class="free">eql</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> <span class="main">⇒</span> <span class="tfree">'trm</span> <span class="main">⇒</span> <span class="tfree">'fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">cnj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="tfree">'fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">imp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="tfree">'fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">all</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> <span class="main">⇒</span> <span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="tfree">'fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">exi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> <span class="main">⇒</span> <span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="tfree">'fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    eql<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">t2</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">eql</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    cnj<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">φ1</span> <span class="bound">φ2</span><span class="main">.</span> <span class="bound">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">cnj</span> <span class="bound">φ1</span> <span class="bound">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    imp<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">φ1</span> <span class="bound">φ2</span><span class="main">.</span> <span class="bound">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">imp</span> <span class="bound">φ1</span> <span class="bound">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    all<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">φ</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">all</span> <span class="bound">x</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    exi<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">φ</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">exi</span> <span class="bound">x</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    Fvars_eql<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">t2</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">Fvars</span> <span class="main">(</span><span class="free">eql</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="free">FvarsT</span> <span class="bound">t1</span> <span class="main">∪</span> <span class="free">FvarsT</span> <span class="bound">t2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    Fvars_cnj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">Fvars</span> <span class="main">(</span><span class="free">cnj</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">)</span> <span class="main">=</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">∪</span> <span class="free">Fvars</span> <span class="bound">χ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    Fvars_imp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">Fvars</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">)</span> <span class="main">=</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">∪</span> <span class="free">Fvars</span> <span class="bound">χ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    Fvars_all<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">φ</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">Fvars</span> <span class="main">(</span><span class="free">all</span> <span class="bound">x</span> <span class="bound">φ</span><span class="main">)</span> <span class="main">=</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    Fvars_exi<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">φ</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">Fvars</span> <span class="main">(</span><span class="free">exi</span> <span class="bound">x</span> <span class="bound">φ</span><span class="main">)</span> <span class="main">=</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    <span class="comment1">― ‹Assumed properties of substitution›</span>
    subst_cnj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">φ</span> <span class="bound">χ</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
      <span class="free">subst</span> <span class="main">(</span><span class="free">cnj</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">)</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">cnj</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">χ</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    subst_imp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">φ</span> <span class="bound">χ</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
      <span class="free">subst</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">)</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">imp</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">χ</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    subst_all<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">φ</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
      <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="main">⟹</span> <span class="free">subst</span> <span class="main">(</span><span class="free">all</span> <span class="bound">x</span> <span class="bound">φ</span><span class="main">)</span> <span class="bound">t</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">all</span> <span class="bound">x</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="bound">t</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    subst_exi<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">φ</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
      <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="main">⟹</span> <span class="free">subst</span> <span class="main">(</span><span class="free">exi</span> <span class="bound">x</span> <span class="bound">φ</span><span class="main">)</span> <span class="bound">t</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">exi</span> <span class="bound">x</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="bound">t</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    subst_eql<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">t2</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
      <span class="free">subst</span> <span class="main">(</span><span class="free">eql</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">eql</span> <span class="main">(</span><span class="free">substT</span> <span class="bound">t1</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">substT</span> <span class="bound">t2</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*
(* "is the unique": isTU t x φ is the formula "t is the unique x such that phi(x)"
 *)
definition isTU :: "'trm ⇒ 'var ⇒ 'fmla  ⇒ 'fmla" where
"isTU t x φ ≡
 cnj (subst φ t x)
     (all x (imp φ (subst φ t x)))"

(* TODO: properties: works well when x is not free in t,
in particular, when t is num n *)
*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Formula equivalence, $\longleftrightarrow$, a derived connective›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">eqv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="tfree">'fmla</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eqv</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span> <span class="main">=</span> <span class="free">cnj</span> <span class="main">(</span><span class="free">imp</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free"><span class="bound"><span class="entity">χ</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  eqv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span> <span class="bound">χ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> eqv <span class="bound">φ</span> <span class="bound">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
  Fvars_eqv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span> <span class="bound">χ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
  <span class="free">Fvars</span> <span class="main">(</span>eqv <span class="bound">φ</span> <span class="bound">χ</span><span class="main">)</span>  <span class="main">=</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">∪</span> <span class="free">Fvars</span> <span class="bound">χ</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
  subst_eqv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span> <span class="bound">χ</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
  <span class="free">subst</span> <span class="main">(</span>eqv <span class="bound">φ</span> <span class="bound">χ</span><span class="main">)</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">=</span> eqv <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">χ</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eqv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_all_idle<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="free">t</span> <span class="free">x</span> <span class="main">=</span> <span class="free">all</span> <span class="free">x</span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subst_notIn<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_exi_idle<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="free">t</span> <span class="free">x</span> <span class="main">=</span> <span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subst_notIn<span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Parallel substitution versus connectives and quantifiers.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubst_cnj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">cnj</span> <span class="main">(</span>rawpsubst <span class="free">φ1</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>rawpsubst <span class="free">φ2</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">φ1</span></span> <span class="quoted"><span class="free">φ2</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_cnj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubst <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">cnj</span> <span class="main">(</span>psubst <span class="free">φ1</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>psubst <span class="free">φ2</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> us
    <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vs1</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs1</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">φ1</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> vs1_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span>  <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">vs1</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">vs1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> vs1
    <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ1</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ1</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ1</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs2</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">φ2</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> vs2_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span>  <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">vs2</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">vs2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> vs2
    <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tus</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?uxs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tvs1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">vs1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?vxs1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs1</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tvs2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">vs2</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?vxs2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs2</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="var">?uxs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">=</span> <span class="free">cnj</span> <span class="main">(</span>rawpsubst <span class="free">φ1</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">(</span>rawpsubst <span class="free">φ2</span> <span class="var">?uxs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms us_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_cnj<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="var">?c</span> <span class="var">?tus</span> <span class="main">=</span>
    <span class="free">cnj</span> <span class="main">(</span>rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ1</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span><span class="main">)</span> <span class="main">(</span>rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ2</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> c <span class="keyword1"><span class="command">using</span></span> assms us_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_cnj<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ1</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span> <span class="main">=</span> rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ1</span> <span class="var">?vxs1</span><span class="main">)</span> <span class="var">?tvs1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms vs1_facts us_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_compose_freshVar2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ2</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span> <span class="main">=</span> rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ2</span> <span class="var">?vxs2</span><span class="main">)</span> <span class="var">?tvs2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms vs2_facts us_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_compose_freshVar2<span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> psubst_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> vs1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> vs2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 0 1 2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubst_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">imp</span> <span class="main">(</span>rawpsubst <span class="free">φ1</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>rawpsubst <span class="free">φ2</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">φ1</span></span> <span class="quoted"><span class="free">φ2</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> tx txs φ1 φ2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tx</span></span><span class="main">)</span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_imp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubst <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">imp</span> <span class="main">(</span>psubst <span class="free">φ1</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>psubst <span class="free">φ2</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> us
    <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vs1</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs1</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">φ1</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> vs1_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span>  <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">vs1</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">vs1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> vs1
    <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ1</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ1</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ1</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs2</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">φ2</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> vs2_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span>  <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">vs2</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">vs2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> vs2
    <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tus</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?uxs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tvs1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">vs1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?vxs1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs1</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tvs2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">vs2</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?vxs2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs2</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="var">?uxs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">=</span> <span class="free">imp</span> <span class="main">(</span>rawpsubst <span class="free">φ1</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">(</span>rawpsubst <span class="free">φ2</span> <span class="var">?uxs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rawpsubst_imp<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> set_zip_rightD<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> set_zip_leftD<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="var">?c</span> <span class="var">?tus</span> <span class="main">=</span>
    <span class="free">imp</span> <span class="main">(</span>rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ1</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span><span class="main">)</span> <span class="main">(</span>rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ2</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> c
    <span class="keyword1"><span class="command">using</span></span> assms us_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_imp<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ1</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span> <span class="main">=</span> rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ1</span> <span class="var">?vxs1</span><span class="main">)</span> <span class="var">?tvs1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms vs1_facts us_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_compose_freshVar2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ2</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span> <span class="main">=</span> rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ2</span> <span class="var">?vxs2</span><span class="main">)</span> <span class="var">?tvs2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms vs2_facts us_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_compose_freshVar2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> psubst_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> vs1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> vs2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 0 1 2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubst_eqv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> eqv <span class="main">(</span>rawpsubst <span class="free">φ1</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>rawpsubst <span class="free">φ2</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">φ1</span></span> <span class="quoted"><span class="free">φ2</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> tx txs φ1 φ2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tx</span></span><span class="main">)</span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_eqv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubst <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> eqv <span class="main">(</span>psubst <span class="free">φ1</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>psubst <span class="free">φ2</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> us
    <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vs1</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs1</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">φ1</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> vs1_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span>  <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">vs1</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">vs1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> vs1
    <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ1</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ1</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ1</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs2</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">φ2</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> vs2_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span>  <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">vs2</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">vs2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> vs2
    <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tus</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?uxs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tvs1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">vs1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?vxs1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs1</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tvs2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">vs2</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?vxs2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs2</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="var">?uxs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">=</span> eqv <span class="main">(</span>rawpsubst <span class="free">φ1</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">(</span>rawpsubst <span class="free">φ2</span> <span class="var">?uxs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms us_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_eqv<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="var">?c</span> <span class="var">?tus</span> <span class="main">=</span>
    eqv <span class="main">(</span>rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ1</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span><span class="main">)</span> <span class="main">(</span>rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ2</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> c <span class="keyword1"><span class="command">using</span></span> assms us_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_eqv<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ1</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span> <span class="main">=</span> rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ1</span> <span class="var">?vxs1</span><span class="main">)</span> <span class="var">?tvs1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms vs1_facts us_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_compose_freshVar2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ2</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span> <span class="main">=</span> rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ2</span> <span class="var">?vxs2</span><span class="main">)</span> <span class="var">?tvs2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms vs2_facts us_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_compose_freshVar2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> psubst_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> vs1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> vs2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 0 1 2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubst_all<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span><span class="free">all</span> <span class="free">y</span> <span class="free">φ</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">all</span> <span class="free">y</span> <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> tx txs φ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tx</span></span><span class="main">)</span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_all<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubst <span class="main">(</span><span class="free">all</span> <span class="free">y</span> <span class="free">φ</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">all</span> <span class="free">y</span> <span class="main">(</span>psubst <span class="free">φ</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">all</span> <span class="free">y</span> <span class="free">φ</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">(</span><span class="free">Fvars</span> <span class="free">φ</span> <span class="main">-</span> <span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> us
    <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">all</span> <span class="free">y</span> <span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">all</span> <span class="free">y</span> <span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">all</span> <span class="free">y</span> <span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">all</span> <span class="free">y</span> <span class="free">φ</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> vs_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span>  <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">vs</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">vs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> vs
    <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ws</span></span> <span class="keyword2"><span class="keyword">where</span></span> ws<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">=</span> getFrN <span class="main">(</span><span class="free">y</span> <span class="main">#</span> map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ws_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span>  <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> set <span class="skolem">ws</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">ws</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">ws</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> ws
    <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">#</span> map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">#</span> map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">#</span> map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">#</span> map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span><span class="free">all</span> <span class="free">y</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
           <span class="free">all</span> <span class="free">y</span> <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ws_facts  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> rawpsubst_all<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span><span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">=</span>
           rawpsubst <span class="main">(</span><span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rawpsubst_compose_freshVar2<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms ws_facts vs_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>rawpsubst <span class="main">(</span><span class="free">all</span> <span class="free">y</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span>
        rawpsubst <span class="main">(</span>rawpsubst <span class="main">(</span><span class="free">all</span> <span class="free">y</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">ws</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ws_facts us_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_compose_freshVar2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">all</span> <span class="free">y</span> <span class="main">(</span>rawpsubst <span class="main">(</span><span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command">using</span></span> assms ws_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_all<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">all</span> <span class="free">y</span> <span class="main">(</span>rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> 1 <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> psubst_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> vs<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubst_exi<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span><span class="free">exi</span> <span class="free">y</span> <span class="free">φ</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">exi</span> <span class="free">y</span> <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> tx txs φ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tx</span></span><span class="main">)</span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_exi<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubst <span class="main">(</span><span class="free">exi</span> <span class="free">y</span> <span class="free">φ</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">exi</span> <span class="free">y</span> <span class="main">(</span>psubst <span class="free">φ</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">exi</span> <span class="free">y</span> <span class="free">φ</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">(</span><span class="free">Fvars</span> <span class="free">φ</span> <span class="main">-</span> <span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> us
    <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">exi</span> <span class="free">y</span> <span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">exi</span> <span class="free">y</span> <span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">exi</span> <span class="free">y</span> <span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">exi</span> <span class="free">y</span> <span class="free">φ</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> vs_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span>  <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">vs</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">vs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> vs
    <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ws</span></span> <span class="keyword2"><span class="keyword">where</span></span> ws<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">=</span> getFrN <span class="main">(</span><span class="free">y</span> <span class="main">#</span> map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ws_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span>  <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> set <span class="skolem">ws</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">ws</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">ws</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> ws
    <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">#</span> map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">#</span> map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">#</span> map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">#</span> map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span><span class="free">exi</span> <span class="free">y</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
           <span class="free">exi</span> <span class="free">y</span> <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ws_facts <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> rawpsubst_exi<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span><span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">=</span>
           rawpsubst <span class="main">(</span><span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ws_facts vs_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_compose_freshVar2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>rawpsubst <span class="main">(</span><span class="free">exi</span> <span class="free">y</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span>
        rawpsubst <span class="main">(</span>rawpsubst <span class="main">(</span><span class="free">exi</span> <span class="free">y</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">ws</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ws_facts us_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_compose_freshVar2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">exi</span> <span class="free">y</span> <span class="main">(</span>rawpsubst <span class="main">(</span><span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ws_facts <span class="keyword1"><span class="command">unfolding</span></span> 0
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_exi<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">exi</span> <span class="free">y</span> <span class="main">(</span>rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> 1 <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> psubst_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> vs<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span> Syntax_with_Connectives<span class="antiquote">}</span></span>›</span>


<span class="keyword1"><span class="command">locale</span></span> Syntax_with_Numerals_and_Connectives <span class="main">=</span>
  Syntax_with_Numerals
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">num</span></span>
  <span class="main">+</span>
  Syntax_with_Connectives
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">trm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Var</span> <span class="free">FvarsT</span> <span class="free">substT</span> <span class="free">Fvars</span> <span class="free">subst</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">num</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eql</span> <span class="free">cnj</span> <span class="free">imp</span> <span class="free">all</span> <span class="free">exi</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subst_all_num<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">num</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">subst</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="free">n</span> <span class="free">y</span> <span class="main">=</span> <span class="free">all</span> <span class="free">x</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">n</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_exi_num<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">num</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">subst</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="free">n</span> <span class="free">y</span> <span class="main">=</span> <span class="free">exi</span> <span class="free">x</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">n</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The "soft substitution" function:›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">softSubst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="tfree">'trm</span> <span class="main">⇒</span> <span class="tfree">'var</span> <span class="main">⇒</span> <span class="tfree">'fmla</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">softSubst</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free">exi</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> softSubst<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> softSubst <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> softSubst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_softSubst<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
 <span class="free">Fvars</span> <span class="main">(</span>softSubst <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Fvars</span> <span class="free">φ</span> <span class="main">∪</span> <span class="free">FvarsT</span> <span class="free">t</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> softSubst_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_softSubst_subst_in<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">⟹</span>
 <span class="free">Fvars</span> <span class="main">(</span>softSubst <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">Fvars</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_softSubst_subst_notIn<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">⟹</span>
 <span class="free">Fvars</span> <span class="main">(</span>softSubst <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">Fvars</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">∪</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span> Syntax_with_Connectives<span class="antiquote">}</span></span>›</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The addition of False among logical connectives›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Syntax_with_Connectives_False <span class="main">=</span>
  Syntax_with_Connectives
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">trm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Var</span> <span class="free">FvarsT</span> <span class="free">substT</span> <span class="free">Fvars</span> <span class="free">subst</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eql</span> <span class="free">cnj</span> <span class="free">imp</span> <span class="free">all</span> <span class="free">exi</span>
    <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">fls</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'fmla</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    fls<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fls</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    Fvars_fls<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">fls</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    subst_fls<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">subst</span> <span class="free">fls</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">fls</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Negation as a derrived connective:›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">neg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="tfree">'fmla</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">neg</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="free">imp</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free">fls</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  neg<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> neg <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
  Fvars_neg<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">Fvars</span> <span class="main">(</span>neg <span class="bound">φ</span><span class="main">)</span> <span class="main">=</span> <span class="free">Fvars</span> <span class="bound">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
  subst_neg<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
  <span class="free">subst</span> <span class="main">(</span>neg <span class="bound">φ</span><span class="main">)</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">=</span> neg <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> neg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹True as a derived connective:›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tru</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tru</span> <span class="main">=</span> neg <span class="free">fls</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  tru<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"tru <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
  Fvars_tru<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> tru <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
  subst_tru<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">subst</span> tru <span class="bound">t</span> <span class="bound">x</span> <span class="main">=</span> tru"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> tru_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Iterated conjunction›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First we define list-based conjunction:›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">lcnj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> list <span class="main">⇒</span> <span class="tfree">'fmla</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lcnj</span> <span class="main">[]</span> <span class="main">=</span> tru"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">lcnj</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">φs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">cnj</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">(</span><span class="free">lcnj</span> <span class="free"><span class="bound"><span class="entity">φs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lcnj<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> lcnj <span class="free">φs</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_lcnj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">Fvars</span> <span class="main">(</span>lcnj <span class="free">φs</span><span class="main">)</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span>set <span class="main">(</span>map <span class="free">Fvars</span> <span class="free">φs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_lcnj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
 <span class="free">subst</span> <span class="main">(</span>lcnj <span class="free">φs</span><span class="main">)</span> <span class="free">t</span> <span class="free">x</span> <span class="main">=</span> lcnj <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="free">φs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Then we define (finite-)set-based conjunction:›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">scnj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set <span class="main">⇒</span> <span class="tfree">'fmla</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">scnj</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span> lcnj <span class="main">(</span>asList <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> scnj<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> scnj <span class="free">F</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> scnj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_scnj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span><span class="free">Fvars</span> <span class="main">(</span>scnj <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">Fvars</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> scnj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Parallel substitution versus the new connectives›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubst_fls<span class="main">:</span>
  <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span> <span class="main">⟹</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span> <span class="main">⟹</span> rawpsubst <span class="free">fls</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">fls</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">txs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_fls<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubst <span class="free">fls</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">fls</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">fls</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> us
    <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">fls</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">fls</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">fls</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">fls</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="free">fls</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">fls</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> us_facts assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_fls<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms us_facts
    <span class="keyword1"><span class="command">unfolding</span></span> psubst_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst_fls <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_neg<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubst <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> neg <span class="main">(</span>psubst <span class="free">φ</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> neg_def <span class="keyword1"><span class="command">using</span></span> assms psubst_imp psubst_fls <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_tru<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubst tru <span class="free">txs</span> <span class="main">=</span> tru"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> tru_def <span class="keyword1"><span class="command">using</span></span> assms psubst_neg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">fls</span></span> <span class="quoted"><span class="free">txs</span></span><span class="main">]</span> psubst_fls <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_lcnj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span> <span class="main">⟹</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span> <span class="main">⟹</span>
 distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">⟹</span>
 psubst <span class="main">(</span>lcnj <span class="free">φs</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> lcnj <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> psubst <span class="bound">φ</span> <span class="free">txs</span><span class="main">)</span> <span class="free">φs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span>  <span class="quoted"><span class="free">φs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span> Syntax_with_Connectives_False<span class="antiquote">}</span></span>›</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Adding Disjunction›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹NB: In intuitionistic logic, disjunction is not definable from the other connectives.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Syntax_with_Connectives_False_Disj <span class="main">=</span>
  Syntax_with_Connectives_False
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
  <span class="quoted"><span class="free">fls</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">trm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Var</span> <span class="free">FvarsT</span> <span class="free">substT</span> <span class="free">Fvars</span> <span class="free">subst</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eql</span> <span class="free">cnj</span> <span class="free">imp</span> <span class="free">all</span> <span class="free">exi</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fls</span>
    <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">dsj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="tfree">'fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    dsj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span> <span class="bound">χ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">dsj</span> <span class="bound">φ</span> <span class="bound">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    Fvars_dsj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span> <span class="bound">χ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
  <span class="free">Fvars</span> <span class="main">(</span><span class="free">dsj</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">)</span> <span class="main">=</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">∪</span> <span class="free">Fvars</span> <span class="bound">χ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    subst_dsj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">φ</span> <span class="bound">χ</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
   <span class="free">subst</span> <span class="main">(</span><span class="free">dsj</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">)</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">dsj</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">χ</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Iterated disjunction›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First we define list-based disjunction:›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ldsj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> list <span class="main">⇒</span> <span class="tfree">'fmla</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ldsj</span> <span class="main">[]</span> <span class="main">=</span> <span class="free">fls</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ldsj</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">φs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">dsj</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">(</span><span class="free">ldsj</span> <span class="free"><span class="bound"><span class="entity">φs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ldsj<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> ldsj <span class="free">φs</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_ldsj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">Fvars</span> <span class="main">(</span>ldsj <span class="free">φs</span><span class="main">)</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span>set <span class="main">(</span>map <span class="free">Fvars</span> <span class="free">φs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_ldsj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
 <span class="free">subst</span> <span class="main">(</span>ldsj <span class="free">φs</span><span class="main">)</span> <span class="free">t</span> <span class="free">x</span> <span class="main">=</span> ldsj <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="free">φs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Then we define (finite-)set-based disjunction:›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sdsj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set <span class="main">⇒</span> <span class="tfree">'fmla</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sdsj</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span> ldsj <span class="main">(</span>asList <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sdsj<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> sdsj <span class="free">F</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sdsj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_sdsj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">Fvars</span> <span class="main">(</span>sdsj <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">Fvars</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sdsj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Parallel substitution versus the new connectives›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubst_dsj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span><span class="free">dsj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">dsj</span> <span class="main">(</span>rawpsubst <span class="free">φ1</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>rawpsubst <span class="free">φ2</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">φ1</span></span> <span class="quoted"><span class="free">φ2</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> tx txs φ1 φ2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tx</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_dsj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubst <span class="main">(</span><span class="free">dsj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">dsj</span> <span class="main">(</span>psubst <span class="free">φ1</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>psubst <span class="free">φ2</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">dsj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> us
    <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">dsj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">dsj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">dsj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">dsj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vs1</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs1</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">φ1</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> vs1_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span>  <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">vs1</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">vs1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> vs1
    <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ1</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ1</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ1</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs2</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">φ2</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> vs2_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span>  <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">vs2</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">vs2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> vs2
    <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ2</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tus</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?uxs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tvs1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">vs1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?vxs1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs1</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tvs2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">vs2</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?vxs2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs2</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span><span class="free">dsj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="var">?uxs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">=</span> <span class="free">dsj</span> <span class="main">(</span>rawpsubst <span class="free">φ1</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">(</span>rawpsubst <span class="free">φ2</span> <span class="var">?uxs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rawpsubst_dsj<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> set_zip_rightD<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> set_zip_leftD<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="var">?c</span> <span class="var">?tus</span> <span class="main">=</span>
    <span class="free">dsj</span> <span class="main">(</span>rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ1</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span><span class="main">)</span> <span class="main">(</span>rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ2</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> c <span class="keyword1"><span class="command">using</span></span> assms us_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_dsj<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ1</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span> <span class="main">=</span> rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ1</span> <span class="var">?vxs1</span><span class="main">)</span> <span class="var">?tvs1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms vs1_facts us_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_compose_freshVar2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ2</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span> <span class="main">=</span> rawpsubst <span class="main">(</span>rawpsubst <span class="free">φ2</span> <span class="var">?vxs2</span><span class="main">)</span> <span class="var">?tvs2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms vs2_facts us_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst_compose_freshVar2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> psubst_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> vs1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> vs2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 0 1 2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_ldsj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span> <span class="main">⟹</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span> <span class="main">⟹</span>
 distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">⟹</span>
 psubst <span class="main">(</span>ldsj <span class="free">φs</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> ldsj <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> psubst <span class="bound">φ</span> <span class="free">txs</span><span class="main">)</span> <span class="free">φs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span>  <span class="quoted"><span class="free">φs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span> Syntax_with_Connectives_False_Disj<span class="antiquote">}</span></span>›</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Adding an Ordering-Like Formula›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Syntax_with_Numerals_and_Connectives_False_Disj <span class="main">=</span>
  Syntax_with_Connectives_False_Disj
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
  <span class="quoted"><span class="free">fls</span></span>
  <span class="quoted"><span class="free">dsj</span></span>
  <span class="main">+</span>
  Syntax_with_Numerals_and_Connectives
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">num</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">trm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Var</span> <span class="free">FvarsT</span> <span class="free">substT</span> <span class="free">Fvars</span> <span class="free">subst</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eql</span> <span class="free">cnj</span> <span class="free">imp</span> <span class="free">all</span> <span class="free">exi</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fls</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">dsj</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">num</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹... and in addition a formula expressing order (think: less than or equal to)›</span></span>
<span class="keyword1"><span class="command">locale</span></span> Syntax_PseudoOrder <span class="main">=</span>
  Syntax_with_Numerals_and_Connectives_False_Disj
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
  <span class="quoted"><span class="free">fls</span></span>
  <span class="quoted"><span class="free">dsj</span></span>
  <span class="quoted"><span class="free">num</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">trm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Var</span> <span class="free">FvarsT</span> <span class="free">substT</span> <span class="free">Fvars</span> <span class="free">subst</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eql</span> <span class="free">cnj</span> <span class="free">imp</span> <span class="free">all</span> <span class="free">exi</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fls</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">dsj</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">num</span>
    <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="comment1">― ‹Lq is a formula with free variables xx yy:›</span>
    <span class="free">Lq</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'fmla</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    Lq<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Lq</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    Fvars_Lq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">Lq</span> <span class="main">=</span> <span class="main">{</span>zz<span class="main">,</span>yy<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">LLq</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">LLq</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">=</span> psubst <span class="free">Lq</span> <span class="main">[</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1</span></span></span><span class="main">,</span>zz<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">,</span>yy<span class="main">)</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> LLq_def2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> yy <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span> <span class="main">⟹</span>
 LLq <span class="free">t1</span> <span class="free">t2</span> <span class="main">=</span> <span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="free">Lq</span> <span class="free">t1</span> zz<span class="main">)</span> <span class="free">t2</span> yy"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> LLq_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> psubst_eq_rawpsubst2<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> LLq<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"LLq <span class="free">t1</span> <span class="free">t2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> LLq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> LLq2<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">num</span> <span class="main">⟹</span> LLq <span class="free">n</span> <span class="main">(</span><span class="free">Var</span> yy'<span class="main">)</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_LLq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> yy <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span> <span class="main">⟹</span>
<span class="free">Fvars</span> <span class="main">(</span>LLq <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">=</span> <span class="free">FvarsT</span> <span class="free">t1</span> <span class="main">∪</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LLq_def2 subst2_fresh_switch<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> LLq_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">num</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">num</span> <span class="main">⟹</span> <span class="free">subst</span> <span class="main">(</span>LLq <span class="free">m</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span><span class="main">)</span> <span class="free">n</span> yy <span class="main">=</span> LLq <span class="free">m</span> <span class="free">n</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">num</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">num</span> <span class="main">⟹</span> <span class="free">subst</span> <span class="main">(</span>LLq <span class="free">m</span> <span class="main">(</span><span class="free">Var</span> yy'<span class="main">)</span><span class="main">)</span> <span class="free">n</span> yy <span class="main">=</span> LLq <span class="free">m</span> <span class="main">(</span><span class="free">Var</span> yy'<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">num</span> <span class="main">⟹</span> <span class="free">subst</span> <span class="main">(</span>LLq <span class="free">m</span> <span class="main">(</span><span class="free">Var</span> yy'<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span> yy' <span class="main">=</span> LLq <span class="free">m</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">num</span> <span class="main">⟹</span> <span class="free">subst</span> <span class="main">(</span>LLq <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span><span class="main">)</span> <span class="free">n</span> xx <span class="main">=</span> LLq <span class="free">n</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">num</span> <span class="main">⟹</span> <span class="free">subst</span> <span class="main">(</span>LLq <span class="main">(</span><span class="free">Var</span> zz<span class="main">)</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span><span class="main">)</span> <span class="free">n</span> yy <span class="main">=</span> LLq <span class="main">(</span><span class="free">Var</span> zz<span class="main">)</span> <span class="free">n</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">num</span> <span class="main">⟹</span> <span class="free">subst</span> <span class="main">(</span>LLq <span class="main">(</span><span class="free">Var</span> zz<span class="main">)</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span><span class="main">)</span> <span class="free">m</span> zz <span class="main">=</span> LLq <span class="free">m</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> <span class="free">num</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">num</span> <span class="main">⟹</span> <span class="free">subst</span> <span class="main">(</span>LLq <span class="main">(</span><span class="free">Var</span> zz<span class="main">)</span> <span class="free">n</span><span class="main">)</span> <span class="free">m</span> xx <span class="main">=</span> LLq <span class="main">(</span><span class="free">Var</span> zz<span class="main">)</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> LLq_def2 subst2_fresh_switch<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span> Syntax_PseudoOrder<span class="antiquote">}</span></span>›</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Allowing the Renaming of Quantified Variables›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹So far, we did not need any renaming axiom for the quantifiers. However,
our axioms for substitution implicitly assume the irrelevance of the bound names;
in other words, their usual instances would have this property; and since this assumption
greatly simplifies the formal development, we make it at this point.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Syntax_with_Connectives_Rename <span class="main">=</span>
Syntax_with_Connectives
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
<span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">trm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">Var</span> <span class="free">FvarsT</span> <span class="free">substT</span> <span class="free">Fvars</span> <span class="free">subst</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">eql</span> <span class="free">cnj</span> <span class="free">imp</span> <span class="free">all</span> <span class="free">exi</span>
<span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> all_rename<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">⟹</span>
  <span class="free">all</span> <span class="bound">x</span> <span class="bound">φ</span> <span class="main">=</span> <span class="free">all</span> <span class="bound">y</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> exi_rename<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">⟹</span>
  <span class="free">exi</span> <span class="bound">x</span> <span class="bound">φ</span> <span class="main">=</span> <span class="free">exi</span> <span class="bound">y</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> all_rename2<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="free">all</span> <span class="free">x</span> <span class="free">φ</span> <span class="main">=</span> <span class="free">all</span> <span class="free">y</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> all_rename <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Fvars_subst<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> exi_rename2<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span> <span class="main">=</span> <span class="free">exi</span> <span class="free">y</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> exi_rename <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Fvars_subst<span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Exists-Unique Quantifier›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹It is phrased in such a way as to avoid substitution:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">exu</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> <span class="main">⇒</span> <span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="tfree">'fmla</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">exu</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="keyword1">let</span> <span class="bound">y</span> <span class="main">=</span> getFr <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span> <span class="main">[]</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">]</span> <span class="keyword1">in</span>
 <span class="free">cnj</span> <span class="main">(</span><span class="free">exi</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">exi</span> <span class="bound">y</span> <span class="main">(</span><span class="free">all</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free">imp</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> exu<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> exu <span class="free">x</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> exu_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_exu<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">Fvars</span> <span class="main">(</span>exu <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> exu_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def getFr_Fvars<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> exu_def_var<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
<span class="quoted"><span class="quoted">"exu <span class="free">x</span> <span class="free">φ</span> <span class="main">=</span> <span class="free">cnj</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span><span class="free">exi</span> <span class="free">y</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">[]</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> z <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≡</span> getFr <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">]</span> <span class="main">[]</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> u_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> u <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exu <span class="free">x</span> <span class="free">φ</span> <span class="main">=</span>  <span class="free">cnj</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span><span class="free">exi</span> <span class="skolem">u</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> exu_def Let_def z<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> exi_rename<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">all</span> <span class="free">x</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">cnj</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span><span class="free">exi</span> <span class="free">y</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> exi_rename<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">all</span> <span class="free">x</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="main">]</span></span>
     <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subst_exu<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="main">(</span>exu <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="free">t</span> <span class="free">y</span> <span class="main">=</span> exu <span class="free">x</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≡</span> getFr <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">]</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> u_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> u <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def exu_def_var<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main"><span class="main">]</span></span> subst_compose_diff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subst_exu_idle<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="main">(</span>exu <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="free">t</span> <span class="free">x</span> <span class="main">=</span> exu <span class="free">x</span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subst_notIn<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> exu_rename<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exu <span class="free">x</span> <span class="free">φ</span> <span class="main">=</span> exu <span class="free">y</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> getFr <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">[]</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> z <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≡</span> getFr <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">]</span> <span class="main">[]</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> u_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span>
     <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> u <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> exu_def_var<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main"><span class="main">]</span></span> exi_rename<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="main">]</span></span> all_rename<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> exu_rename2<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span>
  exu <span class="free">x</span> <span class="free">φ</span> <span class="main">=</span> exu <span class="free">y</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> exu_rename <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Fvars_subst<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span> Syntax_with_Connectives_Rename<span class="antiquote">}</span></span>›</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span></pre>
</div><div id="Deduction">
<div class="head">
<h1>Theory Deduction</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Deduction›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Deduction <span class="keyword2"><span class="keyword">imports</span></span> <a href="Syntax.html">Syntax</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We formalize deduction in a logical system that (shallowly) embeds
intuitionistic logic connectives and quantifiers over a signature containing
the numerals.›</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Positive Logic Deduction›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Deduct <span class="main">=</span>
Syntax_with_Numerals_and_Connectives
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">num</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
<span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">trm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">Var</span> <span class="free">FvarsT</span> <span class="free">substT</span> <span class="free">Fvars</span> <span class="free">subst</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">num</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">eql</span> <span class="free">cnj</span> <span class="free">imp</span> <span class="free">all</span> <span class="free">exi</span>
<span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
<span class="comment1">― ‹Provability of numeric formulas:›</span>
<span class="free">prv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> <span class="main">⇒</span> bool"</span></span>
<span class="comment1">― ‹Hilbert-style system for intuitionistic logic over $\longrightarrow$,$\land$,$\forall$,$\exists$.
($\bot$, $\lnot$ and $\lor$ will be included later.)
Hilbert-style is preferred since it requires the least amount of infrastructure.
(Later, natural deduction rules will also be defined.)›</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
<span class="comment1">― ‹Propositional rules and axioms. There is a single propositional rule, modus ponens.›</span>
<span class="comment1">― ‹The modus ponens rule:›</span>
prv_imp_mp<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
   <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="bound">χ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
<span class="comment1">― ‹The propositional intuitionitic axioms:›</span>
prv_imp_imp_triv<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span> <span class="bound">χ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
   <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">χ</span> <span class="bound">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
prv_imp_trans<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">φ</span> <span class="bound">χ</span> <span class="bound">ψ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
  <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">χ</span> <span class="bound">ψ</span><span class="main">)</span><span class="main">)</span>
           <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">φ</span> <span class="bound">ψ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
prv_imp_cnjL<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
  <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">)</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
prv_imp_cnjR<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
  <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">)</span> <span class="bound">χ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
prv_imp_cnjI<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
  <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">χ</span> <span class="main">(</span><span class="free">cnj</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
<span class="comment1">(*   *)</span>
<span class="comment1">― ‹Predicate calculus (quantifier) rules and axioms›</span>
<span class="comment1">― ‹The rules of universal and existential generalization:›</span>
prv_all_imp_gen<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">φ</span> <span class="main">(</span><span class="free">all</span> <span class="bound">x</span> <span class="bound">χ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
prv_exi_imp_gen<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
  <span class="bound">x</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="bound">χ</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">exi</span> <span class="bound">x</span> <span class="bound">φ</span><span class="main">)</span> <span class="bound">χ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
<span class="comment1">― ‹Two quantifier instantiation axioms:›</span>
prv_all_inst<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">φ</span> <span class="bound">t</span><span class="main">.</span>
  <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span>
  <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">all</span> <span class="bound">x</span> <span class="bound">φ</span><span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
prv_exi_inst<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">φ</span> <span class="bound">t</span><span class="main">.</span>
  <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span>
  <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">exi</span> <span class="bound">x</span> <span class="bound">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
<span class="comment1">― ‹The equality axioms:›</span>
prv_eql_refl<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
  <span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
prv_eql_subst<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">φ</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span>
   <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
   <span class="free">prv</span> <span class="main">(</span><span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>
             <span class="main">(</span><span class="free">imp</span> <span class="bound">φ</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of the propositional fragment›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_triv<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> phi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> psi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> prv_imp_imp_triv prv_imp_mp imp phi psi<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_refl<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> phi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prv_imp_imp_triv prv_imp_mp prv_imp_trans imp phi<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_refl2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">=</span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> prv_imp_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnjI<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> phi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> chi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">φ</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="free">χ</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> cnj prv_imp_cnjI prv_imp_mp imp phi chi<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnjEL<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> phi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> chi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> chi phi prv_imp_cnjL prv_imp_mp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnjER<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> phi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> chi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="free">χ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> chi phi prv_imp_cnjR prv_imp_mp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_prv_imp_trans<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> phi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> chi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> psi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 2 chi prv_imp_triv phi psi<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 1 chi prv_imp_mp prv_imp_trans imp phi psi<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_trans1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> phi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> chi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> psi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> chi prv_prv_imp_trans prv_imp_imp_triv prv_imp_trans imp phi psi<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_com<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> phi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> chi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> psi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms prv_prv_imp_trans prv_imp_imp_triv prv_imp_mp prv_imp_trans imp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_trans2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> phi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> chi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> psi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> prv_imp_mp prv_imp_trans prv_imp_trans1 prv_imp_imp_triv
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> chi prv_imp_com imp phi psi<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_cnj<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">ψ</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">ψ</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms imp prv_imp_imp_triv prv_prv_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">ψ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> imp prv_imp_com prv_prv_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms cnj imp prv_imp_cnjI prv_imp_com prv_imp_mp prv_imp_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_imp_com<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
<span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms
   prv_prv_imp_trans prv_imp_com prv_imp_imp_triv prv_imp_trans imp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnj_imp_monoR2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prv_imp_refl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> cnj imp assms<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span> prv_imp_com prv_imp_mp prv_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> imp cnj assms prv_imp_cnjL prv_imp_cnjR prv_imp_com prv_imp_mp prv_prv_imp_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_imp_imp_cnj<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
<span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms prv_imp_com prv_imp_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms prv_prv_imp_trans prv_imp_imp_com imp<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span>
                    <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms prv_cnj_imp_monoR2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms prv_imp_com prv_imp_mp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> cnj imp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_cnj_imp<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
<span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span>
          <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms cnj prv_prv_imp_trans prv_imp_cnjI prv_imp_com prv_imp_trans2 imp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnj_imp<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_imp_cnj_imp prv_imp_mp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> cnj imp<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Monotonicy of conjunction w.r.t. implication:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnj_imp_monoR<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms cnj imp prv_cnj_imp prv_cnj_imp_monoR2 prv_imp_cnj prv_imp_cnjL prv_imp_cnjR<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_cnj3L<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_imp_cnjL prv_imp_mp prv_imp_trans2
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cnj imp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_cnj3R<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prv_imp_cnjR prv_imp_mp prv_imp_trans2
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms cnj imp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnj_imp_mono<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ2</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="free">χ2</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prv_cnj_imp_monoR<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span>"</span></span> <span class="quoted"><span class="free">χ1</span></span> <span class="quoted"><span class="free">χ2</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="free">χ2</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> imp cnj assms prv_imp_cnj3L prv_prv_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="free">χ2</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prv_imp_com assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> cnj imp<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ2</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prv_imp_cnj3R prv_imp_mp prv_imp_trans1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms cnj prv_prv_imp_trans imp<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> prv_imp_com assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> cnj imp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnj_mono<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ2</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_cnj_imp_mono prv_imp_mp
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> cnj prv_prv_imp_trans prv_imp_cnj prv_imp_cnjL prv_imp_cnjR<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnj_imp_monoR4<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
<span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">ψ1</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">ψ2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">ψ1</span> <span class="free">ψ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms prv_cnj_imp prv_imp_cnj prv_imp_cnjL prv_imp_cnjR prv_cnj_imp_monoR2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_cnj4<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">ψ1</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">ψ2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">ψ1</span> <span class="free">ψ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms prv_cnj_imp prv_imp_cnj prv_cnj_imp_monoR2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnj_imp_monoR5<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ2</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ2</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prv_cnj_imp_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">φ1</span></span> <span class="quoted"><span class="free">φ2</span></span>  <span class="quoted"><span class="free">χ1</span></span> <span class="quoted"><span class="free">χ2</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ2</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms cnj imp prv_imp_imp_com prv_prv_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ2</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prv_imp_cnj_imp prv_imp_mp prv_imp_trans2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> assms cnj prv_prv_imp_trans imp<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ2</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span>  <span class="main">(</span><span class="free">cnj</span> <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prv_cnj_imp prv_imp_cnjR prv_imp_mp prv_imp_trans1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms cnj prv_cnj_imp_monoR prv_prv_imp_trans prv_imp_imp_triv imp<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms cnj imp prv_prv_imp_trans prv_imp_imp_com<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_cnj5<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ2</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms prv_cnj_imp prv_cnj_mono<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Properties of formula equivalence:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eqv_imp<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span>eqv <span class="free">χ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms prv_imp_cnj prv_imp_cnjL prv_imp_cnjR eqv_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eqv_eqv<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span>eqv <span class="free">χ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_cnjI prv_eqv_imp eqv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_eqvEL<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eqv_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> cnj imp prv_imp_cnjL prv_imp_mp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_eqvER<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">φ1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> eqv_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> cnj imp prv_imp_cnjR prv_imp_mp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eqv_imp_trans<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_imp_cnjL prv_imp_mp prv_imp_trans2 eqv_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prv_imp_cnj3L eqv imp<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prv_imp_cnjL prv_imp_mp prv_imp_trans2 eqv_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms prv_imp_cnj3L prv_imp_com eqv imp<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span>eqv <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prv_cnj_imp_monoR2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">ψ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">ψ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prv_imp_cnjR prv_imp_mp prv_imp_trans1 eqv_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms prv_cnj_imp_monoR2 prv_imp_triv imp<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">ψ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms cnj eqv_def imp prv_imp_cnj3R prv_prv_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span>eqv <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">ψ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prv_cnj_imp_monoR2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms eqv imp<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span>eqv <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> 1 2  <span class="keyword1"><span class="command">using</span></span> assms prv_imp_cnj <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eqv_def<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">φ</span></span> <span class="quoted"><span class="free">ψ</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms prv_cnj_imp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eqv_cnj_trans<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span>eqv <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms prv_eqv_imp_trans prv_cnj_imp_monoR2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eqvI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms eqv_def prv_cnjI<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Formula equivalence is a congruence (i.e., an equivalence that
is compatible with the other connectives):›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eqv_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_cnjI prv_imp_refl eqv_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eqv_sym<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>eqv <span class="free">χ</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_cnjI prv_imp_cnjL prv_imp_cnjR prv_imp_mp eqv_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> prv_eqv_imp eqv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eqv_trans<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>eqv <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_cnjI prv_cnj_imp_monoR2 prv_imp_mp prv_imp_trans1 prv_imp_imp_triv eqv_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prv_prv_imp_trans prv_imp_cnjL prv_imp_cnjR eqv imp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> imp_imp_compat_eqvL<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms that prv_imp_cnj <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eqv_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">φ1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms eqv_def prv_imp_cnjL prv_imp_cnjR<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms eqv imp prv_imp_trans2 prv_prv_imp_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> imp_imp_compat_eqvR<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms prv_cnj_mono prv_imp_trans1 eqv_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> imp_imp_compat_eqv<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ1</span><span class="main">)</span><span class="main">)</span>
                                                    <span class="main">(</span>eqv <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prv_imp_cnj5
    <span class="main">[</span><span class="operator">OF</span> _ _ _ _ imp_imp_compat_eqvL<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">φ1</span></span> <span class="quoted"><span class="free">φ2</span></span> <span class="quoted"><span class="free">χ1</span></span><span class="main"><span class="main">]</span></span> imp_imp_compat_eqvR<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">φ2</span></span> <span class="quoted"><span class="free">χ1</span></span> <span class="quoted"><span class="free">χ2</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span>eqv <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ1</span><span class="main">)</span><span class="main">)</span>
                                                      <span class="main">(</span>eqv <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms prv_cnj_imp_monoR2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span>eqv <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms prv_eqv_cnj_trans<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ2</span>"</span></span><span class="main">]</span>
   <span class="keyword1"><span class="command">using</span></span> prv_imp_mp prv_imp_trans2
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> cnj prv_prv_imp_trans eqv imp<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms prv_cnj_imp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> imp_compat_eqvL<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_imp_mp imp_imp_compat_eqvL <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> eqv imp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> imp_compat_eqvR<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms prv_imp_mp imp_imp_compat_eqvR <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> eqv imp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> imp_compat_eqv<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_imp_mp imp_imp_compat_eqv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eqv imp<span class="main">)</span>

<span class="comment1">(*  *)</span>

<span class="keyword1"><span class="command">lemma</span></span> imp_cnj_compat_eqvL<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ2</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">φ1</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ2</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">φ1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ2</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ2</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> imp cnj assms prv_imp_mp assms prv_cnj_imp_mono prv_imp_com prv_imp_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> imp cnj assms prv_imp_mp assms eqv_def prv_cnj_imp_mono prv_imp_com prv_imp_refl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> imp_cnj_compat_eqvR<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms prv_cnj_mono prv_imp_cnj3R prv_imp_cnj4 prv_imp_cnjL prv_imp_triv eqv_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> imp_cnj_compat_eqv<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ2</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>eqv <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ2</span> <span class="free">χ1</span><span class="main">)</span><span class="main">)</span>
                                                    <span class="main">(</span>eqv <span class="main">(</span><span class="free">cnj</span> <span class="free">φ2</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ2</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prv_imp_cnj5
    <span class="main">[</span><span class="operator">OF</span> _ _ _ _ imp_cnj_compat_eqvL<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">φ1</span></span> <span class="quoted"><span class="free">φ2</span></span> <span class="quoted"><span class="free">χ1</span></span><span class="main"><span class="main">]</span></span> imp_cnj_compat_eqvR<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">φ2</span></span> <span class="quoted"><span class="free">χ1</span></span> <span class="quoted"><span class="free">χ2</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span>eqv <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ2</span> <span class="free">χ1</span><span class="main">)</span><span class="main">)</span>
                                                      <span class="main">(</span>eqv <span class="main">(</span><span class="free">cnj</span> <span class="free">φ2</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ2</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms prv_cnj_imp_monoR2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span>eqv <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ2</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms prv_eqv_cnj_trans<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">cnj</span> <span class="free">φ1</span> <span class="free">χ1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">cnj</span> <span class="free">φ2</span> <span class="free">χ1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">cnj</span> <span class="free">φ2</span> <span class="free">χ2</span>"</span></span><span class="main">]</span>
   <span class="keyword1"><span class="command">using</span></span> prv_imp_mp prv_imp_trans2
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> cnj prv_prv_imp_trans eqv<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms prv_cnj_imp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cnj_compat_eqvL<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ2</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_imp_mp imp_cnj_compat_eqvL <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> eqv cnj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cnj_compat_eqvR<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms prv_imp_mp imp_cnj_compat_eqvR <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> eqv cnj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cnj_compat_eqv<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ2</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_imp_mp imp_cnj_compat_eqv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eqv imp cnj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eqv_prv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">χ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms prv_imp_cnjL prv_imp_mp eqv eqv_def imp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eqv_prv_rev<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="free">χ</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">χ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_eqv_prv prv_eqv_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_eqv_transi<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms imp imp_compat_eqvR prv_eqv_prv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_eqv_transi_rev<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms prv_eqv_sym prv_imp_eqv_transi<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eqv_imp_transi<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms prv_imp_eqv_transi prv_imp_refl prv_prv_imp_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eqv_imp_transi_rev<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms prv_eqv_imp_transi prv_eqv_sym<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_monoL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> imp prv_imp_mp prv_imp_trans1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_monoR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">ψ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">ψ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> imp prv_imp_mp prv_imp_trans2<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹More properties involving conjunction:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnj_com_imp<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">χ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_imp_cnj prv_imp_cnjL prv_imp_cnjR<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnj_com<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">χ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_cnj_com_imp prv_eqvI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnj_assoc_imp1<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ψ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_cnj_imp_monoR2 prv_imp_cnj prv_imp_cnjL prv_imp_cnjR prv_imp_triv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnj_assoc_imp2<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ψ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">ψ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">cnj</span> <span class="free">χ</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">∧</span> <span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> χ φ ψ cnj imp prv_cnj_imp_monoR2 prv_imp_imp_triv prv_prv_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> χ φ ψ cnj imp prv_cnj_imp_monoR2 prv_imp_cnj4 prv_imp_cnjI prv_imp_triv <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnj_assoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ψ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_cnj_assoc_imp1 prv_cnj_assoc_imp2 prv_eqvI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnj_com_imp3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ3</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ2</span> <span class="free">φ3</span><span class="main">)</span><span class="main">)</span>
                <span class="main">(</span><span class="free">cnj</span> <span class="free">φ2</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms prv_cnj_imp_monoR2 prv_imp_cnj prv_imp_cnjL prv_imp_refl prv_imp_triv<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties involving quantifiers›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Fundamental properties:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_allE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_all_inst prv_imp_mp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> subst all<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_exiI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_exi_inst prv_imp_mp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> subst exi<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_imp_exi<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms imp exi Fvars_exi Fvars_imp Un_iff assms prv_exi_imp_gen prv_exi_inst prv_imp_mp
    prv_imp_trans1 member_remove remove_def subst_same_Var <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Var<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_exi<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_imp_imp_exi prv_imp_mp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> exi imp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_exi_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">χ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prv_allE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">x</span>"</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms prv_exi_imp_gen <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_all_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prv_allE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">x</span>"</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms prv_all_imp_gen <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_exi_inst_same<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">=</span> <span class="free">subst</span> <span class="free">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> 0<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_exi_inst<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_exi_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms prv_exi_inst_same <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> prv_exi_imp_gen<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"0"</span> exi prv_prv_imp_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_exi_congW<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> exi assms prv_exi_cong prv_imp_mp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_all_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="free">χ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Var all prv_all_inst prv_prv_imp_trans subst_same_Var<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"0"</span> assms prv_all_imp_gen<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_all_congW<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> all assms prv_all_cong prv_imp_mp<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Quantifiers versus free variables and substitution:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> exists_no_Fvars<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">φ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">∧</span> <span class="free">prv</span> <span class="bound">φ</span> <span class="main">∧</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="free">num</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> numNE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="skolem">n</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">eql</span> <span class="skolem">n</span> <span class="skolem">n</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_imp_refl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_all_gen<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_all_imp_gen prv_imp_mp prv_imp_triv exists_no_Fvars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> all_subst_rename_prv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
   <span class="free">y</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">all</span> <span class="free">y</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_allE prv_all_gen<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> allE_id<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">all</span> <span class="free">y</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_allE <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Var subst_same_Var<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_subst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">φ</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms prv_allE prv_all_gen<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_rawpsubst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> tx txs φ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tx</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prv_subst<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_psubst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>psubst <span class="free">φ</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">≡</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> us
    <span class="keyword1"><span class="command">using</span></span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command">unfolding</span></span> psubst_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prv_rawpsubst rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eqv_rawpsubst<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> snd <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">var</span> <span class="main">⟹</span> fst <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟹</span>
 <span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>rawpsubst <span class="free">φ</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>rawpsubst <span class="free">ψ</span> <span class="free">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eqv prv_rawpsubst rawpsubst_eqv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eqv_psubst<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> snd <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">var</span> <span class="main">⟹</span> fst <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟹</span>
 distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">⟹</span>
 <span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>psubst <span class="free">φ</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>psubst <span class="free">ψ</span> <span class="free">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eqv prv_psubst psubst_eqv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_all_imp_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Var assms prv_allE prv_all_gen prv_prv_imp_trans imp subst_same_Var<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_all_imp_cnj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">ψ</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">ψ</span> <span class="free">φ</span><span class="main">)</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Var assms cnj prv_allE prv_all_gen prv_imp_com prv_cnj_imp_monoR2 imp subst_same_Var<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_all_imp_cnj_rev<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">ψ</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Var assms cnj prv_allE prv_all_gen prv_cnj_imp imp subst_same_Var<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties concerning equality›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eql_reflT<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> var_NE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> prv_subst<span class="main">[</span><span class="operator">OF</span> x _ t prv_eql_refl<span class="main"><span class="main">[</span></span><span class="operator">OF</span> x<span class="main"><span class="main">]</span></span><span class="main">]</span> x t <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eql_subst_trm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> φ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>
                 <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t1</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t2</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">∪</span> <span class="free">FvarsT</span> <span class="free">t1</span> <span class="main">∪</span> <span class="free">FvarsT</span> <span class="free">t2</span> <span class="main">∪</span> <span class="free">Fvars</span> <span class="free">φ</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?A</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms finite_FvarsT finite_Fvars<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite_subset infinite_var subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yt1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yt2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yφ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xy y assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t1</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xy y assms prv_subst<span class="main">[</span><span class="operator">OF</span> xx _ _ prv_eql_subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> xx y φ<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> yy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t1</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> yt1 yφ assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> prv_subst<span class="main">[</span><span class="operator">OF</span> y _ _ 1<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">t2</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> xy yt1 yt2 yφ x xx y yy assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eql_subst_trm2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t1</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t2</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms eql imp local.subst prv_eql_subst_trm prv_imp_mp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eql_sym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t2</span> <span class="free">t1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms finite_FvarsT finite_subset infinite_var subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> prv_eql_subst_trm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="free">t1</span></span> <span class="quoted"><span class="free">t2</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms eql imp prv_eql_reflT prv_imp_com prv_imp_mp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_prv_eql_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t2</span> <span class="free">t1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> eql prv_eql_sym prv_imp_mp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_all_eql<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="main">(</span><span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>
                   <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t2</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t1</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> subst assms prv_all_gen prv_prv_imp_trans prv_eql_subst_trm prv_eql_sym eql imp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eql_subst_trm_rev<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>
           <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t2</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t1</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_all_eql prv_all_inst prv_imp_mp subst_same_Var
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> subst prv_prv_imp_trans prv_eql_subst_trm prv_eql_sym eql imp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eql_subst_trm_rev2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t2</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t1</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms eql imp local.subst prv_eql_subst_trm_rev prv_imp_mp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eql_subst_trm_eqv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t1</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t2</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_eql_subst_trm2<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> prv_eql_subst_trm_rev2<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    prv_eqvI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eql_subst_trm_id<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">num</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">n</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_eql_subst_trm
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Var in_num subst_same_Var<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eql_subst_trm_id_back<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">num</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">n</span> <span class="free">y</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Var assms in_num prv_eql_subst_trm_rev subst_same_Var<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eql_subst_trm_id_rev<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">num</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="free">n</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">n</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_eql_subst_trm_rev <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Var in_num subst_same_Var<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eql_subst_trm_id_back_rev<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">num</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="free">n</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">n</span> <span class="free">y</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Var assms in_num prv_eql_subst_trm subst_same_Var<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eql_imp_trans_rev<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> t1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t3<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t3</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t3</span><span class="main">)</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t2</span> <span class="free">t3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="keyword2"><span class="keyword">where</span></span> y1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span> <span class="main">∪</span> <span class="free">FvarsT</span> <span class="free">t2</span> <span class="main">∪</span> <span class="free">FvarsT</span> <span class="free">t3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_FvarsT finite_subset infinite_var subsetI t1 t2 t3
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> infinite_Un<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span> <span class="main">∉</span>  <span class="free">FvarsT</span> <span class="free">t3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> y2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y2</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y2</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span> <span class="main">∪</span> <span class="free">FvarsT</span> <span class="free">t2</span> <span class="main">∪</span> <span class="free">FvarsT</span> <span class="free">t3</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">y1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_FvarsT finite_subset infinite_var subsetI t1 t2 t3
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> finite_insert infinite_Un insert_is_Un<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y2</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y2</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y2</span> <span class="main">∉</span>  <span class="free">FvarsT</span> <span class="free">t3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span> <span class="main">≠</span> <span class="skolem">y2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">y1</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">y2</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">y1</span><span class="main">)</span> <span class="free">t3</span><span class="main">)</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">y2</span><span class="main">)</span> <span class="free">t3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prv_eql_subst<span class="main">[</span><span class="operator">OF</span> y1 y2<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">y1</span><span class="main">)</span> <span class="free">t3</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">note</span></span> 1 <span class="main">=</span> prv_subst<span class="main">[</span><span class="operator">OF</span> y1 _ t1 0<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> prv_subst<span class="main">[</span><span class="operator">OF</span> y2 _ t2 1<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eql_imp_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> t1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t3<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t3</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t2</span> <span class="free">t3</span><span class="main">)</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> eql imp prv_eql_sym prv_eql_imp_trans_rev prv_prv_imp_trans t1 t2 t3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eql_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> t1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t3<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t3</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t2</span> <span class="free">t3</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t3</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms cnj eql prv_cnjI prv_cnj_imp_monoR2 prv_eql_imp_trans prv_imp_mp<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The equivalence between soft substitution and substitution›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_subst_imp_softSubst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>softSubst <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> softSubst_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prv_imp_exi<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prv_eql_reflT prv_imp_cnj prv_imp_refl prv_imp_triv subst_compose_same
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prv_exiI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_subst_implies_softSubst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>softSubst <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_subst_imp_softSubst
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Var cnj eql exi subst prv_imp_mp softSubst_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_softSubst_imp_subst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>softSubst <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> softSubst_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> prv_exi_imp_gen<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Var assms<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span> eql subst prv_cnj_imp_monoR2 prv_eql_subst_trm subst_same_Var<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_softSubst_implies_subst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>softSubst <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Var assms cnj eql exi local.subst prv_imp_mp prv_softSubst_imp_subst softSubst_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_softSubst_eqv_subst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>softSubst <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Var assms cnj eql exi local.subst prv_eqvI prv_softSubst_imp_subst prv_subst_imp_softSubst softSubst_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span> Deduct<span class="antiquote">}</span></span>›</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Deduction Considering False›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Deduct_with_False <span class="main">=</span>
  Syntax_with_Connectives_False
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
  <span class="quoted"><span class="free">fls</span></span>
  <span class="main">+</span>
  Deduct
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">num</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
  <span class="quoted"><span class="free">prv</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">trm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Var</span> <span class="free">FvarsT</span> <span class="free">substT</span> <span class="free">Fvars</span> <span class="free">subst</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eql</span> <span class="free">cnj</span> <span class="free">imp</span> <span class="free">all</span> <span class="free">exi</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fls</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">num</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">prv</span>
    <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    prv_fls<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">fls</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic properties of False (fls)›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_expl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">fls</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_imp_mp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnjR_fls<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">cnj</span> <span class="free">fls</span> <span class="free">φ</span><span class="main">)</span> <span class="free">fls</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_eqvI prv_imp_cnjL<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnjL_fls<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">fls</span><span class="main">)</span> <span class="free">fls</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_eqvI prv_imp_cnjR<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties involving negation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Recall that negation has been defined from implication and False.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_neg_fls<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span> <span class="free">fls</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_imp_com prv_imp_refl neg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_neg_fls<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">fls</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms prv_imp_mp fls neg_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_neg_neg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span>neg <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_imp_neg_fls neg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_neg_neg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms prv_imp_mp prv_imp_neg_fls neg neg_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_imp_neg_rev<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span>
                <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>neg <span class="free">χ</span><span class="main">)</span> <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> neg_def <span class="keyword1"><span class="command">using</span></span> prv_imp_trans2<span class="main">[</span><span class="operator">OF</span> assms fls<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_neg_rev<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>neg <span class="free">χ</span><span class="main">)</span> <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms imp neg prv_imp_imp_neg_rev prv_imp_mp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eqv_neg_prv_fls<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
<span class="free">prv</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="free">fls</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cnj fls neg neg_def prv_cnj_imp_monoR2 prv_eqv_imp_transi prv_imp_cnj prv_imp_eqvER prv_imp_mp prv_imp_neg_rev<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eqv_eqv_neg_prv_fls<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
<span class="free">prv</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="main">(</span>neg <span class="free">χ</span><span class="main">)</span><span class="main">)</span><span class="main">⟹</span> <span class="free">prv</span> <span class="free">fls</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> neg prv_eqv_neg_prv_fls prv_eqv_sym prv_eqv_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eqv_eqv_neg_prv_fls2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
<span class="free">prv</span> <span class="main">(</span>eqv <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>eqv <span class="free">χ</span> <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">⟹</span> <span class="free">prv</span> <span class="free">fls</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_eqv_eqv_neg_prv_fls prv_eqv_sym<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_neg_imp_imp_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">ψ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="main">(</span>neg <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> neg_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms cnj fls neg_def prv_cnj_imp prv_cnj_imp_monoR2 prv_prv_imp_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_neg_imp_neg_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms fls imp neg_def prv_imp_com prv_imp_monoL<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_prv_neg_imp_neg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">χ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span>neg <span class="free">χ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms imp neg prv_imp_mp prv_imp_neg_imp_neg_imp prv_neg_neg<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_neg_imp_cnjL<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span>neg <span class="free">φ1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> neg_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms cnj fls neg neg_def prv_imp_cnj3L prv_prv_imp_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_neg_imp_cnjR<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span>neg <span class="free">φ2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> neg_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms cnj fls neg neg_def prv_imp_cnj3R prv_prv_imp_trans<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Negation versus quantifiers:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_all_neg_imp_neg_exi<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> φ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">fls</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prv_all_inst<span class="main">[</span><span class="operator">OF</span> x<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"neg <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">x</span>"</span></span><span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> neg_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="free">fls</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms  prv_imp_com<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="free">fls</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_exi_imp_gen<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms  neg_def prv_imp_com<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_neg_exi_imp_all_neg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> φ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_all_imp_gen<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"neg <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prv_exi_inst_same prv_imp_neg_rev<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_neg_exi_eqv_all_neg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> φ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>neg <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> φ prv_all_neg_imp_neg_exi prv_eqvI prv_neg_exi_imp_all_neg x<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_neg_exi_implies_all_neg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> φ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> φ all assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> exi neg prv_imp_mp prv_neg_exi_imp_all_neg x<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_neg_neg_exi<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms neg_def prv_exi_imp_gen <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_exi_imp_exiI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span><span class="free">exi</span> <span class="free">y</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> False <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> prv_exi_imp_gen<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">using</span></span> yx
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prv_imp_exi prv_exiI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">x</span>"</span></span><span class="main"><span class="main">]</span></span>
        <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prv_imp_refl2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> yx prv_imp_refl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_neg_allI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">subst</span> <span class="free">χ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> all assms subst neg prv_all_inst prv_imp_neg_rev prv_prv_imp_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_neg_allWI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">subst</span> <span class="free">χ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all assms fls subst neg_def prv_all_inst prv_prv_imp_trans<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties involving True (tru)›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_tru<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> tru<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neg_def prv_imp_triv tru_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_tru_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">imp</span> tru <span class="free">φ</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> imp neg_def prv_eqvI prv_fls prv_imp_com prv_imp_imp_triv prv_imp_mp prv_imp_refl tru tru_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_fls_neg_tru<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>eqv <span class="free">fls</span> <span class="main">(</span>neg tru<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> neg_def prv_eqvI prv_neg_neg tru_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_tru_neg_fls<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>eqv tru <span class="main">(</span>neg <span class="free">fls</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_eqv_refl tru_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnjR_tru<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">cnj</span> tru <span class="free">φ</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_eqvI prv_imp_cnj prv_imp_cnjR prv_imp_refl prv_imp_tru<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnjL_tru<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> tru<span class="main">)</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_eqvI prv_imp_cnj prv_imp_cnjL prv_imp_refl prv_imp_tru<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Property of set-based conjunctions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹These are based on properties of the auxiliary list conjunctions.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_lcnj_imp_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> set <span class="free">φs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>lcnj <span class="free">φs</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="main"><span class="main">:</span></span> prv_imp_cnjL prv_cnj_imp_monoR2 prv_imp_triv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_lcnj_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> set <span class="free">φs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>lcnj <span class="free">φs</span><span class="main">)</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms lcnj prv_lcnj_imp_in prv_prv_imp_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_lcnj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> set <span class="free">φs</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="main">(</span>lcnj <span class="free">φs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">χ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prv_imp_tru prv_imp_com prv_imp_cnj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_lcnj_imp_inner<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φ1s</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φ2s</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="main">(</span>lcnj <span class="main">(</span><span class="free">φ1s</span> <span class="main">@</span> <span class="free">φ2s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lcnj <span class="main">(</span><span class="free">φ1s</span> <span class="main">@</span> <span class="free">φ</span> <span class="main">#</span> <span class="free">φ2s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ1s</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">φ1</span> <span class="skolem">φ1s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">φ1s</span> <span class="main">@</span> <span class="free">φ2s</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">φ1s</span> <span class="main">@</span> <span class="free">φ</span> <span class="main">#</span> <span class="free">φ2s</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="main">(</span><span class="free">cnj</span> <span class="skolem">φ1</span> <span class="main">(</span>lcnj <span class="main">(</span><span class="skolem">φ1s</span> <span class="main">@</span> <span class="free">φ2s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">(</span><span class="free">cnj</span> <span class="skolem">φ1</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="main">(</span>lcnj <span class="main">(</span><span class="skolem">φ1s</span> <span class="main">@</span> <span class="free">φ2s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_cnj_com_imp3<span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="skolem">φ1</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="main">(</span>lcnj <span class="main">(</span><span class="skolem">φ1s</span> <span class="main">@</span> <span class="free">φ2s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">(</span><span class="free">cnj</span> <span class="skolem">φ1</span> <span class="main">(</span>lcnj <span class="main">(</span><span class="skolem">φ1s</span> <span class="main">@</span> <span class="free">φ</span> <span class="main">#</span> <span class="free">φ2s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_cnj_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_imp_refl<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> prv_prv_imp_trans<span class="main">[</span><span class="operator">OF</span> _ _ _ 0 1<span class="main">]</span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_imp_refl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_lcnj_imp_remdups<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>lcnj <span class="main">(</span>remdups <span class="free">φs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lcnj <span class="free">φs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prv_imp_cnj prv_lcnj_imp_in prv_cnj_mono prv_imp_refl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_lcnj_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> φ1s<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">φ1s</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φ2s</span> <span class="main">⊆</span> set <span class="free">φ1s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>lcnj <span class="free">φ1s</span><span class="main">)</span> <span class="main">(</span>lcnj <span class="free">φ2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">φ2s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> φ2s'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ2s'</span> <span class="main">=</span> remdups <span class="free">φ2s</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">φ2s'</span> <span class="main">⊆</span> set <span class="free">φ1s</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">φ2s'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span>  φ2s' <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>lcnj <span class="free">φ1s</span><span class="main">)</span> <span class="main">(</span>lcnj <span class="skolem">φ2s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> φ1s A <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ1s</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">φ2s'</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">φ1</span> <span class="skolem">φ1s</span> <span class="skolem">φ2ss</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ1</span> <span class="main">∈</span> set <span class="skolem">φ2ss</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">φ2ss1</span></span> <span class="skolem"><span class="skolem">φ2ss2</span></span> <span class="keyword2"><span class="keyword">where</span></span> φ2ss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ2ss</span> <span class="main">=</span> <span class="skolem">φ2ss1</span> <span class="main">@</span> <span class="skolem">φ1</span> <span class="main">#</span> <span class="skolem">φ2ss2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> split_list<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">φ2s</span></span> <span class="keyword2"><span class="keyword">where</span></span> φ2s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ2s</span> <span class="main">≡</span> <span class="skolem">φ2ss1</span> <span class="main">@</span> <span class="skolem">φ2ss2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> nin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ1</span> <span class="main">∉</span> set <span class="skolem">φ2s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> φ2ss <span class="quoted"><span class="quoted">‹distinct <span class="skolem">φ2ss</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> φ2s <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">φ2s</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> φ2s <span class="keyword1"><span class="command">using</span></span> φ2ss Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="skolem">φ1</span> <span class="main">(</span>lcnj <span class="skolem">φ2s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lcnj <span class="skolem">φ2ss</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> φ2s φ2ss <span class="keyword1"><span class="command">using</span></span> Cons φ2ss
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_lcnj_imp_inner<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>lcnj <span class="skolem">φ1s</span><span class="main">)</span> <span class="main">(</span>lcnj <span class="skolem">φ2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> nin Cons.prems True φ2s φ2ss <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Cons.IH<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="skolem">φ1</span> <span class="main">(</span>lcnj <span class="skolem">φ1s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="skolem">φ1</span> <span class="main">(</span>lcnj <span class="skolem">φ2s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Cons φ2ss φ2s 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_cnj_mono<span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_imp_refl<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prv_prv_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ 2 0<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Cons lcnj prv_imp_lcnj prv_lcnj_imp_in subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_imp_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>lcnj <span class="skolem">φ2s'</span><span class="main">)</span> <span class="main">(</span>lcnj <span class="free">φ2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> φ2s' <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_lcnj_imp_remdups<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_prv_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ B C<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_lcnj_eqv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φ1s</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φ2s</span> <span class="main">=</span> set <span class="free">φ1s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>lcnj <span class="free">φ1s</span><span class="main">)</span> <span class="main">(</span>lcnj <span class="free">φ2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_lcnj_mono  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_eqvI<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_lcnj_mono_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φ1s</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φ2s</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">φ2</span> <span class="main">∈</span> set <span class="free">φ2s</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">φ1</span> <span class="main">∈</span> set <span class="free">φ1s</span><span class="main">.</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">φ1</span> <span class="bound">φ2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>lcnj <span class="free">φ1s</span><span class="main">)</span> <span class="main">(</span>lcnj <span class="free">φ2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> prv_imp_lcnj<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> prv_lcnj_imp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Set-based conjunction commutes with substitution only up to provably equivalence:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> prv_subst_scnj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>scnj <span class="free">F</span><span class="main">)</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>scnj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> scnj_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prv_lcnj_eqv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_subst_scnj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>scnj <span class="free">F</span><span class="main">)</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>scnj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prv_subst_scnj<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_imp_eqvEL<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_subst_scnj_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>scnj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>scnj <span class="free">F</span><span class="main">)</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prv_subst_scnj<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_imp_eqvER<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_scnj_imp_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>scnj <span class="free">F</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> scnj_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_lcnj_imp_in<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_scnj_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>scnj <span class="free">F</span><span class="main">)</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> scnj_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_lcnj_imp<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_scnj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="main">(</span>scnj <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> scnj_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_imp_lcnj<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_scnj_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F1</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F2</span> <span class="main">⊆</span> <span class="free">F1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>scnj <span class="free">F1</span><span class="main">)</span> <span class="main">(</span>scnj <span class="free">F2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> scnj_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> prv_lcnj_mono<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> asList infinite_super<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_scnj_mono_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F1</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F2</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F1</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">φ2</span> <span class="main">∈</span> <span class="free">F2</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">φ1</span> <span class="main">∈</span> <span class="free">F1</span><span class="main">.</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">φ1</span> <span class="bound">φ2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>scnj <span class="free">F1</span><span class="main">)</span> <span class="main">(</span>scnj <span class="free">F2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> scnj_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_lcnj_mono_imp<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Commutation with parallel substitution:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_scnj_insert<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>scnj <span class="main">(</span>insert <span class="free">φ</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="main">(</span>scnj <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> prv_imp_cnj<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prv_imp_refl prv_scnj_imp<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prv_scnj_mono<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_implies_scnj_insert<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>scnj <span class="main">(</span>insert <span class="free">φ</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="main">(</span>scnj <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms  cnj finite.insertI insert_subset prv_imp_mp prv_imp_scnj_insert scnj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_cnj_scnj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="main">(</span>scnj <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>scnj <span class="main">(</span>insert <span class="free">φ</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prv_imp_scnj prv_imp_cnjL
      <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prv_cnj_imp_monoR2 prv_imp_triv prv_scnj_imp_in subset_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_implies_cnj_scnj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="main">(</span>scnj <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>scnj <span class="main">(</span>insert <span class="free">φ</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms  cnj finite.insertI insert_subset prv_imp_cnj_scnj prv_imp_mp scnj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eqv_scnj_insert<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>scnj <span class="main">(</span>insert <span class="free">φ</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="main">(</span>scnj <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms prv_eqvI prv_imp_cnj_scnj prv_imp_scnj_insert<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_scnj1_imp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>scnj <span class="main">{</span><span class="free">φ</span><span class="main">}</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prv_scnj_imp_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_scnj1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span>scnj <span class="main">{</span><span class="free">φ</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prv_imp_refl prv_imp_scnj <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_scnj2_imp_cnj<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>scnj <span class="main">{</span><span class="free">φ</span><span class="main">,</span><span class="free">ψ</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prv_imp_cnj prv_scnj_imp_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnj_imp_scnj2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">(</span>scnj <span class="main">{</span><span class="free">φ</span><span class="main">,</span><span class="free">ψ</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prv_imp_cnjL prv_imp_cnjR prv_imp_scnj <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_imp_scnj2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">imp</span> <span class="free">ψ</span> <span class="main">(</span>scnj <span class="main">{</span><span class="free">φ</span><span class="main">,</span><span class="free">ψ</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prv_cnj_imp_scnj2 prv_cnj_imp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* *)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_rawpsubst_scnj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>rawpsubst <span class="main">(</span>scnj <span class="free">F</span><span class="main">)</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>scnj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="bound">φ</span> <span class="free">txs</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">F</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">tx</span> <span class="skolem">txs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> tx<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tx</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tx</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">txs</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">F</span> <span class="main">=</span>
           <span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="bound">φ</span> <span class="skolem">txs</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>scnj <span class="skolem">F</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span>
                 <span class="main">(</span>scnj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_subst_scnj<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>scnj <span class="skolem">F</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">txs</span><span class="main">)</span>
                  <span class="main">(</span>rawpsubst <span class="main">(</span>scnj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="skolem">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_eqv_rawpsubst<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>rawpsubst <span class="main">(</span>scnj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="skolem">txs</span><span class="main">)</span>
                 <span class="main">(</span>scnj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">txs</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Cons.IH<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prv_eqv_trans<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def prv_eqv_refl<span class="main">)</span><span class="main"><span class="keyword3">[</span></span><span class="main"><span class="keyword3">]</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_psubst_scnj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>psubst <span class="main">(</span>scnj <span class="free">F</span><span class="main">)</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>scnj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> psubst <span class="bound">φ</span> <span class="free">txs</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">≡</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span>scnj <span class="free">F</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">Fvars</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> us
    <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>scnj <span class="free">F</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>scnj <span class="free">F</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>scnj <span class="free">F</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>scnj <span class="free">F</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">φ</span><span class="main">.</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="bound">φ</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> vss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> <span class="skolem">vs</span> <span class="bound">φ</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="bound">φ</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">φ</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">vs</span> <span class="skolem">φ</span><span class="main">)</span>  <span class="main">⊆</span> <span class="free">var</span> <span class="main">∧</span>
    set <span class="main">(</span><span class="skolem">vs</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="skolem">φ</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span>
    set <span class="main">(</span><span class="skolem">vs</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span>
    set <span class="main">(</span><span class="skolem">vs</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span>
    length <span class="main">(</span><span class="skolem">vs</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">=</span> length <span class="free">txs</span> <span class="main">∧</span>
    distinct <span class="main">(</span><span class="skolem">vs</span> <span class="skolem">φ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> vs
      <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">φ</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> vs_facts <span class="main">=</span> this

  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">vs</span> <span class="bound">f</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vs_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> subsetD<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tus</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?uxs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tvs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">φ</span><span class="main">.</span> zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?vxs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">φ</span><span class="main">.</span> zip <span class="main">(</span>map <span class="free">Var</span> <span class="main">(</span><span class="skolem">vs</span> <span class="bound">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>scnj <span class="free">F</span><span class="main">)</span> <span class="var">?uxs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="var">?c</span>
                   <span class="main">(</span>scnj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="bound">φ</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_rawpsubst_scnj<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>rawpsubst <span class="var">?c</span> <span class="var">?tus</span><span class="main">)</span>
                  <span class="main">(</span>rawpsubst <span class="main">(</span>scnj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="bound">φ</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="var">?tus</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms us_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_eqv_rawpsubst<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>rawpsubst <span class="main">(</span>scnj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="bound">φ</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="var">?tus</span><span class="main">)</span>
                 <span class="main">(</span>scnj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="bound">φ</span> <span class="var">?tus</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="bound">φ</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms us_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_rawpsubst_scnj<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>rawpsubst <span class="var">?c</span> <span class="var">?tus</span><span class="main">)</span>
                    <span class="main">(</span>scnj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="bound">φ</span> <span class="var">?tus</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="bound">φ</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prv_eqv_trans<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>scnj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="bound">φ</span> <span class="var">?tus</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="bound">φ</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">(</span>scnj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="main">(</span>rawpsubst <span class="bound">φ</span> <span class="main">(</span><span class="var">?vxs</span> <span class="bound">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?tvs</span> <span class="bound">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms us_facts vs_facts <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> prv_eqvI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> prv_scnj_mono_imp<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> φ <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">φ</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> prv_imp_refl2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rawpsubst_compose_freshVar2<span class="main">)</span>
              <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>  <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> prv_scnj_mono_imp<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> φ <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">φ</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> prv_imp_refl2<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rawpsubst_compose_freshVar2<span class="main">)</span>
                          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>rawpsubst <span class="main">(</span>rawpsubst <span class="main">(</span>scnj <span class="free">F</span><span class="main">)</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span><span class="main">)</span>
           <span class="main">(</span>scnj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="main">(</span>rawpsubst <span class="bound">φ</span> <span class="main">(</span><span class="var">?vxs</span> <span class="bound">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?tvs</span> <span class="bound">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms us_facts
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prv_eqv_trans<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> psubst_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> vss<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_psubst_scnj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>psubst <span class="main">(</span>scnj <span class="free">F</span><span class="main">)</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>scnj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> psubst <span class="bound">φ</span> <span class="free">txs</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prv_psubst_scnj<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> prv_imp_eqvEL<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_psubst_scnj_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>scnj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> psubst <span class="bound">φ</span> <span class="free">txs</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>psubst <span class="main">(</span>scnj <span class="free">F</span><span class="main">)</span> <span class="free">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prv_psubst_scnj<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> prv_imp_eqvER<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Consistency and $\omega$-consistency›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">consistent</span> <span class="main">::</span> <span class="quoted">bool</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">consistent</span> <span class="main">≡</span> <span class="main">¬</span> <span class="free">prv</span> <span class="free">fls</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> consistent_def2<span class="main">:</span> <span class="quoted"><span class="quoted">"consistent <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span><span class="main">.</span> <span class="main">¬</span> <span class="free">prv</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">using</span></span> prv_expl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> consistent_def3<span class="main">:</span> <span class="quoted"><span class="quoted">"consistent <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="free">prv</span> <span class="bound">φ</span> <span class="main">∧</span> <span class="free">prv</span> <span class="main">(</span>neg <span class="bound">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">using</span></span> prv_neg_fls neg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* Omega-consistency: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ωconsistent</span> <span class="main">::</span> <span class="quoted">bool</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ωconsistent</span> <span class="main">≡</span>
 <span class="main">∀</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span><span class="main">.</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">⟶</span>
   <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">num</span><span class="main">.</span> <span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
   <span class="main">⟶</span>
   <span class="main">¬</span> <span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span>neg <span class="main">(</span><span class="free">exi</span> <span class="bound">x</span> <span class="bound">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The above particularly strong version of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ωconsistent</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is used for the sake of working without
assuming classical logic. It of course implies the more standard formulations for classical logic:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ωconsistentStd1</span> <span class="main">::</span> <span class="quoted">bool</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ωconsistentStd1</span> <span class="main">≡</span>
 <span class="main">∀</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span><span class="main">.</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">num</span><span class="main">.</span> <span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">prv</span> <span class="main">(</span><span class="free">exi</span> <span class="bound">x</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ωconsistentStd2</span> <span class="main">::</span> <span class="quoted">bool</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ωconsistentStd2</span> <span class="main">≡</span>
 <span class="main">∀</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span><span class="main">.</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">⟶</span>
   <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">num</span><span class="main">.</span> <span class="free">prv</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">prv</span> <span class="main">(</span><span class="free">exi</span> <span class="bound">x</span> <span class="main">(</span>neg <span class="bound">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ωconsistent_impliesStd1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ωconsistent <span class="main">⟹</span>
 ωconsistentStd1"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ωconsistent_def ωconsistentStd1_def <span class="keyword1"><span class="command">using</span></span> prv_neg_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> ωconsistent_impliesStd2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ωconsistent <span class="main">⟹</span>
 ωconsistentStd2"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ωconsistent_impliesStd1 bspec<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"neg <span class="main">_</span>"</span></span><span class="main"><span class="main">]</span></span>
      <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ωconsistentStd1_def ωconsistentStd2_def prv_neg_neg<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the presence of classical logic deduction, the stronger condition is
equivalent to the standard ones:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ωconsistent_iffStd1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">φ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>neg <span class="main">(</span>neg <span class="bound">φ</span><span class="main">)</span><span class="main">)</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ωconsistent <span class="main">⟷</span> ωconsistentStd1"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> ωconsistent_impliesStd1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ωconsistentStd1_def ωconsistent_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms exi neg prv_imp_mp<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ωconsistent_iffStd2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">φ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>neg <span class="main">(</span>neg <span class="bound">φ</span><span class="main">)</span><span class="main">)</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ωconsistent <span class="main">⟷</span> ωconsistentStd2"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ωconsistent_iffStd1<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
    ωconsistentStd1_def ωconsistentStd2_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> φ x
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prv_neg_neg <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> bspec<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"neg <span class="main">_</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> φ x
    <span class="keyword1"><span class="command">using</span></span>  prv_exi_congW prv_imp_neg_fls
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> neg_def prv_neg_neg <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bspec<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"neg <span class="main">_</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹$\omega$-consistency implies consistency:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ωconsistentStd1_implies_consistent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ωconsistentStd1"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"consistent"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> consistent_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">assume</span></span> pf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">fls</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">fls</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_Fvars getFresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fls</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">cnj</span> <span class="main">(</span><span class="free">fls</span><span class="main">)</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">num</span><span class="main">.</span> <span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">subst</span> <span class="var">?fls</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">exi</span> <span class="skolem">x</span> <span class="free">fls</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x fls <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pf prv_expl<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">prv</span> <span class="main">(</span><span class="free">exi</span> <span class="skolem">x</span> <span class="var">?fls</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 0 fls x assms
    <span class="keyword1"><span class="command">unfolding</span></span> ωconsistentStd1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> 1 2 consistent_def consistent_def2 pf x<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ωconsistentStd2_implies_consistent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ωconsistentStd2"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"consistent"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> consistent_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">assume</span></span> pf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">fls</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">fls</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_Fvars getFresh <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fls</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">cnj</span> <span class="main">(</span><span class="free">fls</span><span class="main">)</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">num</span><span class="main">.</span> <span class="free">prv</span> <span class="main">(</span><span class="free">subst</span> <span class="var">?fls</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">exi</span> <span class="skolem">x</span> <span class="main">(</span>neg <span class="var">?fls</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x fls  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pf prv_expl<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">prv</span> <span class="main">(</span><span class="free">exi</span> <span class="skolem">x</span> <span class="main">(</span>neg <span class="var">?fls</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 0 fls x assms
    <span class="keyword1"><span class="command">unfolding</span></span> ωconsistentStd2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> ωconsistent_implies_consistent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ωconsistent"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"consistent"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ωconsistentStd2_implies_consistent ωconsistent_impliesStd2 assms<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span> Deduct_with_False<span class="antiquote">}</span></span>›</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Deduction Considering False and Disjunction›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Deduct_with_False_Disj <span class="main">=</span>
  Syntax_with_Connectives_False_Disj
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
  <span class="quoted"><span class="free">fls</span></span>
  <span class="quoted"><span class="free">dsj</span></span>
  <span class="main">+</span>
  Deduct_with_False
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
  <span class="quoted"><span class="free">fls</span></span>
  <span class="quoted"><span class="free">num</span></span>
  <span class="quoted"><span class="free">prv</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">trm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Var</span> <span class="free">FvarsT</span> <span class="free">substT</span> <span class="free">Fvars</span> <span class="free">subst</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eql</span> <span class="free">cnj</span> <span class="free">imp</span> <span class="free">all</span> <span class="free">exi</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fls</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">dsj</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">num</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">prv</span>
    <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    prv_dsj_impL<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
  <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">φ</span> <span class="main">(</span><span class="free">dsj</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    prv_dsj_impR<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
  <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">χ</span> <span class="main">(</span><span class="free">dsj</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    prv_imp_dsjE<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">φ</span> <span class="bound">χ</span> <span class="bound">ψ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
  <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">φ</span> <span class="bound">ψ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">χ</span> <span class="bound">ψ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">dsj</span> <span class="bound">φ</span> <span class="bound">χ</span><span class="main">)</span> <span class="bound">ψ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_dsjEE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ψ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">" <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms dsj imp prv_imp_dsjE prv_imp_mp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_dsj_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">χ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms  dsj prv_imp_dsjEE prv_imp_mp<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Disjunction vs. disjunction›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_dsj_com_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">χ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> χ φ dsj imp prv_dsj_impL prv_dsj_impR prv_imp_dsjE prv_imp_mp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_dsj_com<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">χ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_dsj_com_imp prv_eqvI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_dsj_assoc_imp1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ψ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">dsj</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span> <span class="bound">fa</span> <span class="bound">fb</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∉</span> <span class="free">fmla</span> <span class="main">∨</span> <span class="main">¬</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">fa</span> <span class="bound">fb</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">fb</span> <span class="main">∉</span> <span class="free">fmla</span> <span class="main">∨</span> <span class="bound">fa</span> <span class="main">∉</span> <span class="free">fmla</span> <span class="main">∨</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">fa</span> <span class="main">(</span><span class="free">dsj</span> <span class="bound">fb</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dsj prv_dsj_impL prv_prv_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_dsj_impL<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 χ φ ψ dsj prv_dsj_impR prv_imp_dsjEE <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_dsj_assoc_imp2<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ψ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">dsj</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="bound">fa</span> <span class="bound">fb</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">f</span> <span class="main">(</span><span class="free">dsj</span> <span class="bound">fa</span> <span class="bound">fb</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">f</span> <span class="main">(</span><span class="free">dsj</span> <span class="bound">fb</span> <span class="bound">fa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">f</span> <span class="main">∉</span> <span class="free">fmla</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">fa</span> <span class="main">∉</span> <span class="free">fmla</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">fb</span> <span class="main">∉</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dsj prv_dsj_com_imp prv_prv_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="bound">fa</span> <span class="bound">fb</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">f</span> <span class="main">(</span><span class="free">dsj</span> <span class="bound">fa</span> <span class="bound">fb</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">f</span> <span class="bound">fa</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">fa</span> <span class="main">∉</span> <span class="free">fmla</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">f</span> <span class="main">∉</span> <span class="free">fmla</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">fb</span> <span class="main">∉</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dsj prv_dsj_impL prv_prv_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> χ φ ψ dsj prv_dsj_impR prv_imp_dsjEE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_dsj_assoc<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ψ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">χ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">dsj</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_dsj_assoc_imp1 prv_dsj_assoc_imp2 prv_eqvI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_dsj_com_imp3<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ3</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ1</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ2</span> <span class="free">φ3</span><span class="main">)</span><span class="main">)</span>
                <span class="main">(</span><span class="free">dsj</span> <span class="free">φ2</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ1</span> <span class="free">φ3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="bound">fa</span> <span class="bound">fb</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">f</span> <span class="main">(</span><span class="free">dsj</span> <span class="bound">fb</span> <span class="bound">fa</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">f</span> <span class="bound">fa</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">fa</span> <span class="main">∉</span> <span class="free">fmla</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">f</span> <span class="main">∉</span> <span class="free">fmla</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">fb</span> <span class="main">∉</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dsj prv_dsj_impR prv_prv_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> dsj prv_dsj_impL prv_dsj_impR prv_imp_dsjEE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_dsj_mono<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">χ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">χ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">χ2</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dsj prv_dsj_impL prv_dsj_impR prv_imp_dsjEE prv_prv_imp_trans<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Disjunction vs. conjunction›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnj_dsj_distrib1<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">dsj</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_cnj_imp prv_cnj_imp_monoR2 prv_dsj_impL prv_dsj_impR prv_imp_com prv_imp_dsjEE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnj_dsj_distrib2<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">dsj</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_cnj_mono prv_dsj_impL prv_dsj_impR prv_imp_dsjEE prv_imp_refl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_cnj_dsj_distrib<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">dsj</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_cnj_dsj_distrib1 prv_cnj_dsj_distrib2 prv_eqvI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_dsj_cnj_distrib1<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_cnj_mono prv_dsj_impL prv_dsj_impR prv_imp_cnj prv_imp_dsjEE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_dsj_cnj_distrib2<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="bound">fa</span> <span class="bound">fb</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">f</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">fb</span> <span class="bound">fa</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">f</span> <span class="bound">fa</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">fa</span> <span class="main">∉</span> <span class="free">fmla</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">f</span> <span class="main">∉</span> <span class="free">fmla</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">fb</span> <span class="main">∉</span> <span class="free">fmla</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> imp prv_imp_imp_triv prv_prv_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> χ1 χ2 φ cnj dsj imp prv_cnj_imp prv_cnj_imp_monoR2 prv_dsj_impL prv_dsj_impR
        prv_imp_com prv_imp_dsjEE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_dsj_cnj_distrib<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> χ2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">χ1</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="free">χ1</span><span class="main">)</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="free">χ2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_dsj_cnj_distrib1 prv_dsj_cnj_distrib2 prv_eqvI<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Disjunction vs. True and False›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_dsjR_fls<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">dsj</span> <span class="free">fls</span> <span class="free">φ</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_dsj_impR prv_eqvI prv_imp_dsjEE prv_imp_refl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_dsjL_fls<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="free">fls</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_dsj_impL prv_eqvI prv_imp_dsjEE prv_imp_refl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_dsjR_tru<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">dsj</span> tru <span class="free">φ</span><span class="main">)</span> tru<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_dsj_impL prv_eqvI prv_imp_tru<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_dsjL_tru<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> tru<span class="main">)</span> tru<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_dsj_impR prv_eqvI prv_imp_tru<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Set-based disjunctions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Just like for conjunctions, these are based on properties of the auxiliary
list disjunctions.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_ldsj_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> set <span class="free">φs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span>ldsj <span class="free">φs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_dsj_impL<span class="main">)</span>
    <span class="main">(</span><span class="operator">meson</span> dsj ldsj prv_dsj_impL prv_dsj_impR prv_prv_imp_trans<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_ldsj<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> set <span class="free">φs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="main">(</span>ldsj <span class="free">φs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ldsj prv_imp_ldsj_in prv_prv_imp_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_ldsj_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> set <span class="free">φs</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">φ</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>ldsj <span class="free">φs</span><span class="main">)</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">χ</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_imp_tru prv_imp_com prv_imp_dsjEE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_ldsj_imp_inner<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φ1s</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φ2s</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>ldsj <span class="main">(</span><span class="free">φ1s</span> <span class="main">@</span> <span class="free">φ</span> <span class="main">#</span> <span class="free">φ2s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="main">(</span>ldsj <span class="main">(</span><span class="free">φ1s</span> <span class="main">@</span> <span class="free">φ2s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ1s</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">φ1</span> <span class="skolem">φ1s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">φ1s</span> <span class="main">@</span> <span class="free">φ2s</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">φ1s</span> <span class="main">@</span> <span class="free">φ</span> <span class="main">#</span> <span class="free">φ2s</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">dsj</span> <span class="skolem">φ1</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="main">(</span>ldsj <span class="main">(</span><span class="skolem">φ1s</span> <span class="main">@</span> <span class="free">φ2s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="main">(</span><span class="free">dsj</span> <span class="skolem">φ1</span> <span class="main">(</span>ldsj <span class="main">(</span><span class="skolem">φ1s</span> <span class="main">@</span> <span class="free">φ2s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_dsj_com_imp3<span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">dsj</span> <span class="skolem">φ1</span> <span class="main">(</span>ldsj <span class="main">(</span><span class="skolem">φ1s</span> <span class="main">@</span> <span class="free">φ</span> <span class="main">#</span> <span class="free">φ2s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">(</span><span class="free">dsj</span> <span class="skolem">φ1</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="main">(</span>ldsj <span class="main">(</span><span class="skolem">φ1s</span> <span class="main">@</span> <span class="free">φ2s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_dsj_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_imp_refl<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> prv_prv_imp_trans<span class="main">[</span><span class="operator">OF</span> _ _ _ 1 0<span class="main">]</span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_imp_refl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_ldsj_imp_remdups<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span>  <span class="main">(</span>ldsj <span class="free">φs</span><span class="main">)</span> <span class="main">(</span>ldsj <span class="main">(</span>remdups <span class="free">φs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ldsj prv_imp_ldsj_in prv_ldsj_imp set_remdups<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_ldsj_mono<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> φ2s<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">φ2s</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φ1s</span> <span class="main">⊆</span> set <span class="free">φ2s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>ldsj <span class="free">φ1s</span><span class="main">)</span> <span class="main">(</span>ldsj <span class="free">φ2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">φ1s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> φ1s'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ1s'</span> <span class="main">=</span> remdups <span class="free">φ1s</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">φ1s'</span> <span class="main">⊆</span> set <span class="free">φ2s</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">φ1s'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> φ1s' <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>ldsj <span class="skolem">φ1s'</span><span class="main">)</span> <span class="main">(</span>ldsj <span class="free">φ2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> φ2s A <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ2s</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">φ1s'</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">φ2</span> <span class="skolem">φ2s</span> <span class="skolem">φ1ss</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ2</span> <span class="main">∈</span> set <span class="skolem">φ1ss</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">φ1ss1</span></span> <span class="skolem"><span class="skolem">φ1ss2</span></span> <span class="keyword2"><span class="keyword">where</span></span> φ1ss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ1ss</span> <span class="main">=</span> <span class="skolem">φ1ss1</span> <span class="main">@</span> <span class="skolem">φ2</span> <span class="main">#</span> <span class="skolem">φ1ss2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> split_list<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">φ1s</span></span> <span class="keyword2"><span class="keyword">where</span></span> φ1s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ1s</span> <span class="main">≡</span> <span class="skolem">φ1ss1</span> <span class="main">@</span> <span class="skolem">φ1ss2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> nin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ2</span> <span class="main">∉</span> set <span class="skolem">φ1s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> φ1ss <span class="quoted"><span class="quoted">‹distinct <span class="skolem">φ1ss</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> φ1s <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">φ1s</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> φ1s <span class="keyword1"><span class="command">using</span></span> φ1ss Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>ldsj <span class="skolem">φ1ss</span><span class="main">)</span> <span class="main">(</span><span class="free">dsj</span> <span class="skolem">φ2</span> <span class="main">(</span>ldsj <span class="skolem">φ1s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> φ1s φ1ss
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> prv_ldsj_imp_inner<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Cons φ1ss <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>ldsj <span class="skolem">φ1s</span><span class="main">)</span> <span class="main">(</span>ldsj <span class="skolem">φ2s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Cons.IH<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> nin Cons.prems True
      <span class="keyword1"><span class="command">using</span></span> φ1s φ1ss <span class="keyword1"><span class="command">by</span></span>  <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">dsj</span> <span class="skolem">φ2</span> <span class="main">(</span>ldsj <span class="skolem">φ1s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">dsj</span> <span class="skolem">φ2</span> <span class="main">(</span>ldsj <span class="skolem">φ2s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons φ1ss φ1s 1  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> prv_dsj_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> prv_imp_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prv_prv_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ 0 2<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ldsj order.trans prv_imp_ldsj_in prv_ldsj_imp subset_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_imp_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>ldsj <span class="free">φ1s</span><span class="main">)</span> <span class="main">(</span>ldsj <span class="skolem">φ1s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> φ1s' <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_ldsj_imp_remdups<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> A assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_prv_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ C B<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_ldsj_eqv<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φ1s</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φ2s</span> <span class="main">=</span> set <span class="free">φ1s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>ldsj <span class="free">φ1s</span><span class="main">)</span> <span class="main">(</span>ldsj <span class="free">φ2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prv_ldsj_mono <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_eqvI<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_ldsj_mono_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φ1s</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φ2s</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">φ1</span> <span class="main">∈</span> set <span class="free">φ1s</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">φ2</span> <span class="main">∈</span> set <span class="free">φ2s</span><span class="main">.</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">φ1</span> <span class="bound">φ2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>ldsj <span class="free">φ1s</span><span class="main">)</span> <span class="main">(</span>ldsj <span class="free">φ2s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> prv_ldsj_imp<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> prv_imp_ldsj <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Just like set-based conjunction, set-based disjunction commutes with substitution
only up to provably equivalence:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_subst_sdsj<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
 <span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>sdsj <span class="free">F</span><span class="main">)</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>sdsj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> sdsj_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prv_ldsj_eqv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_sdsj_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span>sdsj <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sdsj_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_imp_ldsj_in<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_sdsj<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">χ</span> <span class="main">(</span>sdsj <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sdsj_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_imp_ldsj<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_sdsj_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">φ</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>sdsj <span class="free">F</span><span class="main">)</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sdsj_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_ldsj_imp<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_sdsj_mono<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F2</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F1</span> <span class="main">⊆</span> <span class="free">F2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>sdsj <span class="free">F1</span><span class="main">)</span> <span class="main">(</span>sdsj <span class="free">F2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sdsj_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> prv_ldsj_mono<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> asList infinite_super<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_sdsj_mono_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F1</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F2</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F1</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">φ1</span> <span class="main">∈</span> <span class="free">F1</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">φ2</span> <span class="main">∈</span> <span class="free">F2</span><span class="main">.</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">φ1</span> <span class="bound">φ2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>sdsj <span class="free">F1</span><span class="main">)</span> <span class="main">(</span>sdsj <span class="free">F2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sdsj_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_ldsj_mono_imp<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_sdsj_cases<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>sdsj <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">φ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">φ</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms prv_imp_mp prv_sdsj_imp sdsj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_sdsj1_imp<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>sdsj <span class="main">{</span><span class="free">φ</span><span class="main">}</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prv_imp_refl prv_sdsj_imp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_sdsj1<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span>sdsj <span class="main">{</span><span class="free">φ</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> prv_imp_refl prv_imp_sdsj <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_sdsj2_imp_dsj<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>sdsj <span class="main">{</span><span class="free">φ</span><span class="main">,</span><span class="free">ψ</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prv_dsj_impL prv_dsj_impR prv_sdsj_imp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_dsj_imp_sdsj2<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">(</span>sdsj <span class="main">{</span><span class="free">φ</span><span class="main">,</span><span class="free">ψ</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_imp_dsjEE prv_imp_sdsj_in<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Commutation with parallel substitution:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_rawpsubst_sdsj<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>rawpsubst <span class="main">(</span>sdsj <span class="free">F</span><span class="main">)</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>sdsj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="bound">φ</span> <span class="free">txs</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">F</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">tx</span> <span class="skolem">txs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> tx<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tx</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tx</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">txs</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">F</span> <span class="main">=</span>
           <span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="bound">φ</span> <span class="skolem">txs</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>sdsj <span class="skolem">F</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span>
                 <span class="main">(</span>sdsj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_subst_sdsj<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="main">(</span>sdsj <span class="skolem">F</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">txs</span><span class="main">)</span>
                  <span class="main">(</span>rawpsubst <span class="main">(</span>sdsj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="skolem">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_eqv_rawpsubst<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>rawpsubst <span class="main">(</span>sdsj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="skolem">txs</span><span class="main">)</span>
                 <span class="main">(</span>sdsj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">txs</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Cons.IH<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prv_eqv_trans<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def prv_eqv_refl<span class="main">)</span><span class="main"><span class="keyword3">[</span></span><span class="main"><span class="keyword3">]</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_psubst_sdsj<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>psubst <span class="main">(</span>sdsj <span class="free">F</span><span class="main">)</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>sdsj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> psubst <span class="bound">φ</span> <span class="free">txs</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">≡</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span>sdsj <span class="free">F</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">Fvars</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
  <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> us
  <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>sdsj <span class="free">F</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>sdsj <span class="free">F</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>sdsj <span class="free">F</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>sdsj <span class="free">F</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">φ</span><span class="main">.</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="bound">φ</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> vss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> <span class="skolem">vs</span> <span class="bound">φ</span> <span class="main">=</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="bound">φ</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">φ</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">vs</span> <span class="skolem">φ</span><span class="main">)</span>  <span class="main">⊆</span> <span class="free">var</span> <span class="main">∧</span>
    set <span class="main">(</span><span class="skolem">vs</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">∩</span> <span class="free">Fvars</span> <span class="skolem">φ</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span>
    set <span class="main">(</span><span class="skolem">vs</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span>
    set <span class="main">(</span><span class="skolem">vs</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span>
    length <span class="main">(</span><span class="skolem">vs</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">=</span> length <span class="free">txs</span> <span class="main">∧</span>
    distinct <span class="main">(</span><span class="skolem">vs</span> <span class="skolem">φ</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> vs
   <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
         getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
         getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">φ</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
         getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">φ</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> vs_facts <span class="main">=</span> this

  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">vs</span> <span class="bound">f</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vs_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> subsetD<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tus</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?uxs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tvs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">φ</span><span class="main">.</span> zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?vxs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">φ</span><span class="main">.</span> zip <span class="main">(</span>map <span class="free">Var</span> <span class="main">(</span><span class="skolem">vs</span> <span class="bound">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span>sdsj <span class="free">F</span><span class="main">)</span> <span class="var">?uxs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="var">?c</span>
                   <span class="main">(</span>sdsj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="bound">φ</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms us_facts
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_rawpsubst_sdsj<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>rawpsubst <span class="var">?c</span> <span class="var">?tus</span><span class="main">)</span>
                  <span class="main">(</span>rawpsubst <span class="main">(</span>sdsj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="bound">φ</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="var">?tus</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_eqv_rawpsubst<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>rawpsubst <span class="main">(</span>sdsj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="bound">φ</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="var">?tus</span><span class="main">)</span>
                 <span class="main">(</span>sdsj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="bound">φ</span> <span class="var">?tus</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="bound">φ</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_rawpsubst_sdsj<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>rawpsubst <span class="var">?c</span> <span class="var">?tus</span><span class="main">)</span>
                    <span class="main">(</span>sdsj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="bound">φ</span> <span class="var">?tus</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="bound">φ</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="operator">-</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prv_eqv_trans<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>sdsj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="bound">φ</span> <span class="var">?tus</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="bound">φ</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">(</span>sdsj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="main">(</span>rawpsubst <span class="bound">φ</span> <span class="main">(</span><span class="var">?vxs</span> <span class="bound">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?tvs</span> <span class="bound">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms us_facts vs_facts <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> prv_eqvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> prv_sdsj_mono_imp<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> φ <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">φ</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> prv_imp_refl2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rawpsubst_compose_freshVar2<span class="main">)</span>
                 <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>  <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> prv_sdsj_mono_imp<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> φ <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">φ</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> prv_imp_refl2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rawpsubst_compose_freshVar2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>rawpsubst <span class="main">(</span>rawpsubst <span class="main">(</span>sdsj <span class="free">F</span><span class="main">)</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span><span class="main">)</span>
           <span class="main">(</span>sdsj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> rawpsubst <span class="main">(</span>rawpsubst <span class="bound">φ</span> <span class="main">(</span><span class="var">?vxs</span> <span class="bound">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?tvs</span> <span class="bound">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms us_facts
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="operator">-</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prv_eqv_trans<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubst <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> psubst_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> vss<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span> Deduct_with_False_Disj<span class="antiquote">}</span></span>›</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Deduction with Quantified Variable Renaming Included›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Deduct_with_False_Disj_Rename <span class="main">=</span>
Deduct_with_False_Disj
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
  <span class="quoted"><span class="free">fls</span></span>
  <span class="quoted"><span class="free">dsj</span></span>
  <span class="quoted"><span class="free">num</span></span>
  <span class="quoted"><span class="free">prv</span></span>
<span class="main">+</span>
Syntax_with_Connectives_Rename
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
<span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">trm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">Var</span> <span class="free">FvarsT</span> <span class="free">substT</span> <span class="free">Fvars</span> <span class="free">subst</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">eql</span> <span class="free">cnj</span> <span class="free">imp</span> <span class="free">all</span> <span class="free">exi</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">fls</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">dsj</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">num</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">prv</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Deduction with PseudoOrder Axioms Included›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We assume a two-variable formula Lq that satisfies two axioms
resembling the properties of the strict or nonstrict ordering on naturals.
The choice of these axioms is motivated by an abstract account of Rosser's trick
to improve on Gödel's First Incompleteness Theorem, reported in our
CADE 2019 paper~\cite{DBLP:conf/cade/0001T19}.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Deduct_with_PseudoOrder <span class="main">=</span>
Deduct_with_False_Disj
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
  <span class="quoted"><span class="free">fls</span></span>
  <span class="quoted"><span class="free">dsj</span></span>
  <span class="quoted"><span class="free">num</span></span>
  <span class="quoted"><span class="free">prv</span></span>
<span class="main">+</span>
Syntax_PseudoOrder
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
  <span class="quoted"><span class="free">fls</span></span>
  <span class="quoted"><span class="free">dsj</span></span>
  <span class="quoted"><span class="free">num</span></span>
  <span class="quoted"><span class="free">Lq</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
<span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">trm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">Var</span> <span class="free">FvarsT</span> <span class="free">substT</span> <span class="free">Fvars</span> <span class="free">subst</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">eql</span> <span class="free">cnj</span> <span class="free">imp</span> <span class="free">all</span> <span class="free">exi</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">fls</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">dsj</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">num</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">prv</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">Lq</span>
<span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
Lq_num<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">LLq</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> psubst <span class="free">Lq</span> <span class="main">[</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span>zz<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="bound">t2</span><span class="main">,</span>yy<span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">in</span>
 <span class="main">∀</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">q</span> <span class="main">∈</span> <span class="free">num</span><span class="main">.</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">=</span> <span class="main">{</span>zz<span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">num</span><span class="main">.</span> <span class="free">prv</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="bound">p</span> zz<span class="main">)</span><span class="main">)</span>
    <span class="main">⟶</span> <span class="free">prv</span> <span class="main">(</span><span class="free">all</span> zz <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="bound">LLq</span> <span class="main">(</span><span class="free">Var</span> zz<span class="main">)</span> <span class="bound">q</span><span class="main">)</span> <span class="bound">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
Lq_num2<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">LLq</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> psubst <span class="free">Lq</span> <span class="main">[</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span>zz<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="bound">t2</span><span class="main">,</span>yy<span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">in</span>
 <span class="main">∀</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">num</span><span class="main">.</span> <span class="main">∃</span> <span class="bound"><span class="bound">P</span></span> <span class="main">⊆</span> <span class="free">num</span><span class="main">.</span> finite <span class="bound">P</span> <span class="main">∧</span> <span class="free">prv</span> <span class="main">(</span><span class="free">dsj</span> <span class="main">(</span>sdsj <span class="main">{</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span> <span class="bound">r</span> <span class="main">|</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="bound">P</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="bound">LLq</span> <span class="bound">p</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> LLq_num<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="free">num</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{</span>zz<span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">num</span><span class="main">.</span> <span class="free">prv</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="bound">p</span> zz<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">all</span> zz <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>LLq <span class="main">(</span><span class="free">Var</span> zz<span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms Lq_num <span class="keyword1"><span class="command">unfolding</span></span> LLq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> LLq_num2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="free">num</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">P</span></span> <span class="main">⊆</span> <span class="free">num</span><span class="main">.</span> finite <span class="bound">P</span> <span class="main">∧</span> <span class="free">prv</span> <span class="main">(</span><span class="free">dsj</span> <span class="main">(</span>sdsj <span class="main">{</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span> <span class="bound">r</span> <span class="main">|</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="bound">P</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>LLq <span class="free">p</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms Lq_num2 <span class="keyword1"><span class="command">unfolding</span></span> LLq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span> Deduct_with_PseudoOrder<span class="antiquote">}</span></span>›</span>



<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span></pre>
</div><div id="Natural_Deduction">
<div class="head">
<h1>Theory Natural_Deduction</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Natural Deduction›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Natural_Deduction <span class="keyword2"><span class="keyword">imports</span></span> <a href="Deduction.html">Deduction</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We develop a natural deduction system based on the Hilbert system.›</span></span>

<span class="keyword1"><span class="command">context</span></span> Deduct_with_False_Disj
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Natural Deduction from the Hilbert System›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nprv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set <span class="main">⇒</span> <span class="tfree">'fmla</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">nprv</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>scnj <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_hyp<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> nprv_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_scnj_imp_in subset_iff<span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Structural Rules for the Natural Deduction Relation›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_nprv0I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">φ</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> nprv <span class="main">{}</span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> nprv_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_imp_triv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_nprv_emp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="free">φ</span> <span class="main">⟷</span> nprv <span class="main">{}</span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> prv_nprv0I <span class="keyword1"><span class="command">unfolding</span></span> nprv_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> asList eqv finite.simps insert_not_empty lcnj.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ldsj.cases
  list.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span> prv_eqvI prv_imp_mp prv_imp_tru scnj_def tru<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_mono<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">G</span> <span class="free">φ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> nprv_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> order_trans prv_prv_imp_trans prv_scnj_mono rev_finite_subset scnj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_cut<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="free">φ</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> nprv_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> cnj finite.insertI
  insert_subset prv_imp_cnj prv_imp_cnj_scnj prv_imp_refl prv_prv_imp_trans scnj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_strong_cut2<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ1</span> <span class="main">⟹</span> nprv <span class="main">(</span>insert <span class="free">φ1</span> <span class="free">F</span><span class="main">)</span> <span class="free">φ2</span> <span class="main">⟹</span> nprv <span class="main">(</span>insert <span class="free">φ2</span> <span class="main">(</span>insert <span class="free">φ1</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="free">ψ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite.insertI insert_subsetI nprv_cut<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_cut2<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ1</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="free">φ2</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="main">(</span>insert <span class="free">φ2</span> <span class="main">(</span>insert <span class="free">φ1</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="free">ψ</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite.insertI insert_subsetI nprv_mono nprv_strong_cut2 subset_insertI<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Useful for fine control of the eigenformula:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_insertShiftI<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="free">φ1</span> <span class="main">(</span>insert <span class="free">φ2</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="free">ψ</span> <span class="main">⟹</span> nprv <span class="main">(</span>insert <span class="free">φ2</span> <span class="main">(</span>insert <span class="free">φ1</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_insertShift2I<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="free">φ3</span> <span class="main">(</span>insert <span class="free">φ1</span> <span class="main">(</span>insert <span class="free">φ2</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">ψ</span> <span class="main">⟹</span> nprv <span class="main">(</span>insert <span class="free">φ1</span> <span class="main">(</span>insert <span class="free">φ2</span> <span class="main">(</span>insert <span class="free">φ3</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute<span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Back and Forth between Hilbert and Natural Deduction›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This is now easy, thanks to the large number of facts we have
proved for Hilbert-style deduction›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_nprvI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">φ</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> prv_nprv0I
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nprv_def prv_imp_triv<span class="main">)</span>

<span class="keyword1"><span class="command">thm</span></span> prv_nprv0I

<span class="keyword1"><span class="command">lemma</span></span> prv_nprv1I<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">{</span><span class="free">φ</span><span class="main">}</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> nprv_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_scnj_imp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_nprv2I<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ2</span><span class="main">}</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> nprv_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> cnj empty_subsetI finite.simps insert_subsetI prv_cnj_imp_monoR2 prv_prv_imp_trans prv_scnj2_imp_cnj scnj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_prvI<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="main">{}</span> <span class="free">φ</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> prv_nprv_emp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹More Structural Properties›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_clear<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="main">{}</span> <span class="free">φ</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nprv_mono<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_cut_set<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> F<span class="main">:</span>  <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">ψ</span><span class="main">.</span> <span class="bound">ψ</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="bound">ψ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n2<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span><span class="free">G</span> <span class="main">∪</span> <span class="free">F</span><span class="main">)</span> <span class="free">χ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">χ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> G F n1 n2 <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">χ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">ψ</span> <span class="skolem">G</span> <span class="skolem">F</span> <span class="skolem">χ</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="skolem">F</span> <span class="skolem">ψ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="skolem">ψ</span> <span class="skolem">F</span><span class="main">)</span> <span class="skolem">χ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> insert.prems  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> insert.IH<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite.simps insert_subset nprv_mono subsetD subset_insertI<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> insert.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nprv_cut<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 0 1<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">insert</span> nprv_clear<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_clear2_1<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="main">{</span><span class="free">φ2</span><span class="main">}</span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ2</span><span class="main">}</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nprv_mono<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_clear2_2<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="main">{</span><span class="free">φ1</span><span class="main">}</span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ2</span><span class="main">}</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nprv_mono<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_clear3_1<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="main">{</span><span class="free">φ2</span><span class="main">,</span><span class="free">φ3</span><span class="main">}</span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ3</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ2</span><span class="main">,</span><span class="free">φ3</span><span class="main">}</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nprv_mono<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_clear3_2<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ3</span><span class="main">}</span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ3</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ2</span><span class="main">,</span><span class="free">φ3</span><span class="main">}</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nprv_mono<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_clear3_3<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ2</span><span class="main">}</span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ3</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ2</span><span class="main">,</span><span class="free">φ3</span><span class="main">}</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nprv_mono<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_clear4_1<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="main">{</span><span class="free">φ2</span><span class="main">,</span><span class="free">φ3</span><span class="main">,</span><span class="free">φ4</span><span class="main">}</span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ3</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ4</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span><span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ2</span><span class="main">,</span><span class="free">φ3</span><span class="main">,</span><span class="free">φ4</span><span class="main">}</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nprv_mono<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_clear4_2<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ3</span><span class="main">,</span><span class="free">φ4</span><span class="main">}</span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ3</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ4</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ2</span><span class="main">,</span><span class="free">φ3</span><span class="main">,</span><span class="free">φ4</span><span class="main">}</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nprv_mono<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_clear4_3<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ2</span><span class="main">,</span><span class="free">φ4</span><span class="main">}</span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ3</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ4</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span><span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ2</span><span class="main">,</span><span class="free">φ3</span><span class="main">,</span><span class="free">φ4</span><span class="main">}</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nprv_mono<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_clear4_4<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ2</span><span class="main">,</span><span class="free">φ3</span><span class="main">}</span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ3</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ4</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span><span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ2</span><span class="main">,</span><span class="free">φ3</span><span class="main">,</span><span class="free">φ4</span><span class="main">}</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nprv_mono<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_clear5_1<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="main">{</span><span class="free">φ2</span><span class="main">,</span><span class="free">φ3</span><span class="main">,</span><span class="free">φ4</span><span class="main">,</span><span class="free">φ5</span><span class="main">}</span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ3</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ4</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ5</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ2</span><span class="main">,</span><span class="free">φ3</span><span class="main">,</span><span class="free">φ4</span><span class="main">,</span><span class="free">φ5</span><span class="main">}</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nprv_mono<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_clear5_2<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ3</span><span class="main">,</span><span class="free">φ4</span><span class="main">,</span><span class="free">φ5</span><span class="main">}</span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ3</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ4</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ5</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ2</span><span class="main">,</span><span class="free">φ3</span><span class="main">,</span><span class="free">φ4</span><span class="main">,</span><span class="free">φ5</span><span class="main">}</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nprv_mono<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_clear5_3<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ2</span><span class="main">,</span><span class="free">φ4</span><span class="main">,</span><span class="free">φ5</span><span class="main">}</span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ3</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ4</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ5</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ2</span><span class="main">,</span><span class="free">φ3</span><span class="main">,</span><span class="free">φ4</span><span class="main">,</span><span class="free">φ5</span><span class="main">}</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nprv_mono<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_clear5_4<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ2</span><span class="main">,</span><span class="free">φ3</span><span class="main">,</span><span class="free">φ5</span><span class="main">}</span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ3</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ4</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ5</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ2</span><span class="main">,</span><span class="free">φ3</span><span class="main">,</span><span class="free">φ4</span><span class="main">,</span><span class="free">φ5</span><span class="main">}</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nprv_mono<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_clear5_5<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ2</span><span class="main">,</span><span class="free">φ3</span><span class="main">,</span><span class="free">φ4</span><span class="main">}</span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ3</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ4</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ5</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="main">{</span><span class="free">φ1</span><span class="main">,</span><span class="free">φ2</span><span class="main">,</span><span class="free">φ3</span><span class="main">,</span><span class="free">φ4</span><span class="main">,</span><span class="free">φ5</span><span class="main">}</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nprv_mono<span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Properties Involving Substitution›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_subst<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="free">ψ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">using</span></span> prv_subst<span class="main">[</span><span class="operator">OF</span> _ _ _ 1<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nprv_def<span class="main"><span class="main">]</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">unfolding</span></span> nprv_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_prv_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ prv_subst_scnj_imp<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_subst_fresh<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">Fvars</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">subst</span> <span class="free">ψ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span> <span class="main">=</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> image_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> nprv_subst<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> 2 <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_subst_rev<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∨</span> <span class="main">(</span><span class="free">y</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">ψ</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">Fvars</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="free">ψ</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="free">ψ</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subst_compose_eq_or<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> 0<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nprv_subst<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>scnj <span class="free">F</span><span class="main">)</span>
                 <span class="main">(</span>scnj <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="free">subst</span> <span class="bound">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> prv_scnj_mono_imp<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> _ _ φ
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subst_compose_eq_or <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">φ</span></span><span class="main"><span class="main">]</span></span> prv_imp_refl2<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nprv_def <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="operator">-</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> prv_prv_imp_trans<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_psubst<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>
<span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> psubst <span class="bound">φ</span> <span class="free">txs</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span>psubst <span class="free">ψ</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">unfolding</span></span> nprv_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> prv_prv_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ prv_psubst_scnj_imp<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> prv_psubst<span class="main">[</span><span class="operator">OF</span> _ _ _ 1<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nprv_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
	<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> imp psubst_imp scnj<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Introduction and Elimination Rules›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We systematically leave the side-conditions at the end, to simplify reasoning.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_impI<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="free">φ</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> nprv_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cnj finite.insertI insert_subset prv_cnj_imp prv_imp_cnj_scnj prv_imp_com prv_prv_imp_trans scnj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_impI_rev<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="free">φ</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> nprv_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cnj finite.insertI insert_subset prv_cnj_imp_monoR2 prv_eqv_imp_transi
    prv_eqv_scnj_insert prv_imp_com scnj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_impI_rev2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="free">φ</span> <span class="free">F</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">G</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"insert <span class="free">φ</span> <span class="free">F</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> nprv_impI_rev order_trans rev_finite_subset subset_insertI<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_mp<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="free">φ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> nprv_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> cnj prv_cnj_imp_monoR2 prv_imp_cnj prv_imp_refl prv_prv_imp_trans scnj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_impE<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="free">φ</span> <span class="main">⟹</span>  nprv <span class="main">(</span>insert <span class="free">ψ</span> <span class="free">F</span><span class="main">)</span> <span class="free">χ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="free">χ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> nprv_cut nprv_mp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_impE0 <span class="main">=</span> nprv_impE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _ _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_impE1 <span class="main">=</span> nprv_impE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_impE2 <span class="main">=</span> nprv_impE<span class="main">[</span><span class="operator">OF</span> _ _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_impE01 <span class="main">=</span> nprv_impE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_impE02 <span class="main">=</span> nprv_impE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_impE12 <span class="main">=</span> nprv_impE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_impE012 <span class="main">=</span> nprv_impE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_cnjI<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="free">ψ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> nprv_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_imp_cnj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_cnjE<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="main">⟹</span> nprv <span class="main">(</span>insert <span class="free">φ1</span> <span class="main">(</span>insert <span class="free">φ2</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="free">ψ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> nprv_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cnj nprv_cut2 nprv_def prv_imp_cnjL prv_imp_cnjR prv_prv_imp_trans scnj<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_cnjE0 <span class="main">=</span> nprv_cnjE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_cnjE1 <span class="main">=</span> nprv_cnjE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_cnjE01 <span class="main">=</span> nprv_cnjE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_dsjIL<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> nprv_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dsj prv_dsj_impL prv_prv_imp_trans scnj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_dsjIR<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">ψ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> nprv_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dsj prv_dsj_impR prv_prv_imp_trans scnj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_dsjE<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="free">φ</span> <span class="free">F</span><span class="main">)</span> <span class="free">χ</span>"</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="free">ψ</span> <span class="free">F</span><span class="main">)</span> <span class="free">χ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">χ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms dsj imp nprv_def nprv_impI prv_imp_com prv_imp_dsjEE scnj<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="main">(</span><span class="free">dsj</span> <span class="free">φ</span> <span class="free">ψ</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">χ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nprv_impI_rev<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dsj nprv_cut<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_dsjE0 <span class="main">=</span> nprv_dsjE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _ _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_dsjE1 <span class="main">=</span> nprv_dsjE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_dsjE2 <span class="main">=</span> nprv_dsjE<span class="main">[</span><span class="operator">OF</span> _ _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_dsjE01 <span class="main">=</span> nprv_dsjE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_dsjE02 <span class="main">=</span> nprv_dsjE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_dsjE12 <span class="main">=</span> nprv_dsjE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_dsjE012 <span class="main">=</span> nprv_dsjE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_flsE<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">fls</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>  nprv <span class="free">F</span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> nprv_def <span class="keyword1"><span class="command">using</span></span> prv_prv_imp_trans scnj <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_flsE0 <span class="main">=</span> nprv_flsE<span class="main">[</span><span class="operator">OF</span> nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_truI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> nprv <span class="free">F</span> tru"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> nprv_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_imp_tru<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_negI<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="free">φ</span> <span class="free">F</span><span class="main">)</span> <span class="free">fls</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> neg_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_neg_fls<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="free">φ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="free">fls</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> neg_def <span class="keyword1"><span class="command">using</span></span> nprv_mp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_negE<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="free">φ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> nprv_flsE nprv_neg_fls <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_negE0 <span class="main">=</span> nprv_negE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_negE1 <span class="main">=</span> nprv_negE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_negE01 <span class="main">=</span> nprv_negE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_scnjI<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">ψ</span><span class="main">.</span> <span class="bound">ψ</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="bound">ψ</span><span class="main">)</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">G</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">G</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="main">(</span>scnj <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> nprv_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_imp_scnj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_scnjE<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span>scnj <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> nprv <span class="main">(</span><span class="free">G</span> <span class="main">∪</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">G</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">G</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_cut_set<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">G</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> in_mono nprv_def prv_prv_imp_trans prv_scnj_imp_in scnj<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_scnjE0 <span class="main">=</span> nprv_scnjE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_scnjE1 <span class="main">=</span> nprv_scnjE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_scnjE01 <span class="main">=</span> nprv_scnjE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_lcnjI<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">ψ</span><span class="main">.</span> <span class="bound">ψ</span> <span class="main">∈</span> set <span class="free">ψs</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="bound">ψ</span><span class="main">)</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> set <span class="free">ψs</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="main">(</span>lcnj <span class="free">ψs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> nprv_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_imp_lcnj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_lcnjE<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span>lcnj <span class="free">φs</span><span class="main">)</span> <span class="main">⟹</span> nprv <span class="main">(</span>set <span class="free">φs</span> <span class="main">∪</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_cut_set<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"set <span class="free">φs</span> <span class="main">∪</span> <span class="free">F</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> UnE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> lcnj nprv_def prv_lcnj_imp_in prv_prv_imp_trans scnj subset_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_lcnjE0 <span class="main">=</span> nprv_lcnjE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_lcnjE1 <span class="main">=</span> nprv_lcnjE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_lcnjE01 <span class="main">=</span> nprv_lcnjE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_sdsjI<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">G</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">G</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="main">(</span>sdsj <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> nprv_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_imp_sdsj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_sdsjE<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span>sdsj <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">ψ</span><span class="main">.</span> <span class="bound">ψ</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> nprv <span class="main">(</span>insert <span class="bound">ψ</span> <span class="free">F</span><span class="main">)</span> <span class="free">χ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">χ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>sdsj <span class="free">G</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>scnj <span class="free">F</span><span class="main">)</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> prv_sdsj_imp<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> nprv_def nprv_impI prv_imp_com scnj set_rev_mp<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>sdsj <span class="free">G</span><span class="main">)</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 0 assms nprv_def prv_imp_com<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms nprv_mp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_sdsjE0 <span class="main">=</span> nprv_sdsjE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_sdsjE1 <span class="main">=</span> nprv_sdsjE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_sdsjE01 <span class="main">=</span> nprv_sdsjE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_ldsjI<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> set <span class="free">φs</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span>  <span class="free">φ</span> <span class="main">∈</span> set <span class="free">φs</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="main">(</span>ldsj <span class="free">φs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> nprv_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_imp_ldsj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_ldsjE<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span>ldsj <span class="free">ψs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">ψ</span><span class="main">.</span> <span class="bound">ψ</span> <span class="main">∈</span> set <span class="free">ψs</span> <span class="main">⟹</span> nprv <span class="main">(</span>insert <span class="bound">ψ</span> <span class="free">F</span><span class="main">)</span> <span class="free">χ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ψs</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">χ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>ldsj <span class="free">ψs</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>scnj <span class="free">F</span><span class="main">)</span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> prv_ldsj_imp<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> nprv_def nprv_impI prv_imp_com scnj set_rev_mp<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>ldsj <span class="free">ψs</span><span class="main">)</span> <span class="free">χ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 0 assms nprv_def prv_imp_com<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms nprv_mp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_ldsjE0 <span class="main">=</span> nprv_ldsjE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_ldsjE1 <span class="main">=</span> nprv_ldsjE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_ldsjE01 <span class="main">=</span> nprv_ldsjE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_allI<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">Fvars</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> nprv_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prv_all_imp_gen<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_allE<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> nprv_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> all subst prv_all_inst prv_prv_imp_trans scnj<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms local.subst nprv_cut<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_allE0 <span class="main">=</span> nprv_allE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_allE1 <span class="main">=</span> nprv_allE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_allE01 <span class="main">=</span> nprv_allE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_exiI<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> nprv_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> exi local.subst prv_exi_inst prv_prv_imp_trans scnj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_exiE<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> nn<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="free">φ</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">Fvars</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">ψ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="free">ψ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> nprv_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> prv_imp_com<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> prv_exi_imp_gen<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> prv_imp_com<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3-5<span class="main">)</span> assms<span class="main">(</span>7<span class="main">)</span> nn nprv_def nprv_impI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> n assms nprv_mp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_exiE0 <span class="main">=</span> nprv_exiE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_exiE1 <span class="main">=</span> nprv_exiE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_exiE01 <span class="main">=</span> nprv_exiE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Adding Lemmas of Various Shapes into the Proof Context›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_addLemmaE<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="free">φ</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms nprv_cut prv_nprvI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_addLemmaE1 <span class="main">=</span> nprv_addLemmaE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_addImpLemmaI<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ2</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms nprv_def prv_prv_imp_trans scnj<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_addImpLemmaE<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span><span class="main">(</span>insert <span class="free">φ2</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms nprv_addImpLemmaI nprv_cut <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImpLemmaE1 <span class="main">=</span> nprv_addImpLemmaE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImpLemmaE2 <span class="main">=</span> nprv_addImpLemmaE<span class="main">[</span><span class="operator">OF</span> _ _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImpLemmaE12 <span class="main">=</span> nprv_addImpLemmaE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_addImp2LemmaI<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">φ3</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ3</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ1</span>"</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ3</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms imp nprv_addImpLemmaI nprv_mp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_addImp2LemmaE<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="free">φ3</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span><span class="main">(</span>insert <span class="free">φ3</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">φ3</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms nprv_addImp2LemmaI nprv_cut<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImp2LemmaE1 <span class="main">=</span> nprv_addImp2LemmaE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp _ _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImp2LemmaE2 <span class="main">=</span> nprv_addImp2LemmaE<span class="main">[</span><span class="operator">OF</span> _ _ nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImp2LemmaE3 <span class="main">=</span> nprv_addImp2LemmaE<span class="main">[</span><span class="operator">OF</span> _ _ _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImp2LemmaE12 <span class="main">=</span> nprv_addImp2LemmaE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImp2LemmaE13 <span class="main">=</span> nprv_addImp2LemmaE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImp2LemmaE23 <span class="main">=</span> nprv_addImp2LemmaE<span class="main">[</span><span class="operator">OF</span> _ _ nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImp2LemmaE123 <span class="main">=</span> nprv_addImp2LemmaE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_addImp3LemmaI<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ3</span> <span class="free">φ4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ3</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ4</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ1</span>"</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ2</span>"</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ3</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ4</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms imp nprv_addImpLemmaI nprv_mp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_addImp3LemmaE<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ1</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ2</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ3</span> <span class="free">φ4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">φ3</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span><span class="main">(</span>insert <span class="free">φ4</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ3</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ4</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms nprv_addImp3LemmaI nprv_cut<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImp3LemmaE1 <span class="main">=</span> nprv_addImp3LemmaE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp _ _ _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImp3LemmaE2 <span class="main">=</span> nprv_addImp3LemmaE<span class="main">[</span><span class="operator">OF</span> _ _ nprv_hyp _ _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImp3LemmaE3 <span class="main">=</span> nprv_addImp3LemmaE<span class="main">[</span><span class="operator">OF</span> _ _ _ nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImp3LemmaE4 <span class="main">=</span> nprv_addImp3LemmaE<span class="main">[</span><span class="operator">OF</span> _ _ _ _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImp3LemmaE12 <span class="main">=</span> nprv_addImp3LemmaE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp nprv_hyp _ _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImp3LemmaE13 <span class="main">=</span> nprv_addImp3LemmaE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp _ nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImp3LemmaE14 <span class="main">=</span> nprv_addImp3LemmaE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp _ _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImp3LemmaE23 <span class="main">=</span> nprv_addImp3LemmaE<span class="main">[</span><span class="operator">OF</span> _ _ nprv_hyp nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImp3LemmaE24 <span class="main">=</span> nprv_addImp3LemmaE<span class="main">[</span><span class="operator">OF</span> _ _ nprv_hyp _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImp3LemmaE34 <span class="main">=</span> nprv_addImp3LemmaE<span class="main">[</span><span class="operator">OF</span> _ _ _ nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImp3LemmaE123 <span class="main">=</span> nprv_addImp3LemmaE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp nprv_hyp nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImp3LemmaE124 <span class="main">=</span> nprv_addImp3LemmaE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp nprv_hyp _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImp3LemmaE134 <span class="main">=</span> nprv_addImp3LemmaE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp _ nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImp3LemmaE234 <span class="main">=</span> nprv_addImp3LemmaE<span class="main">[</span><span class="operator">OF</span> _ _ nprv_hyp nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addImp3LemmaE1234 <span class="main">=</span> nprv_addImp3LemmaE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp nprv_hyp nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_addDsjLemmaE<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">dsj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="free">φ1</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span><span class="main">(</span>insert <span class="free">φ2</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms dsj nprv_clear nprv_dsjE prv_nprv0I<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_addDsjLemmaE1 <span class="main">=</span> nprv_addDsjLemmaE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addDsjLemmaE2 <span class="main">=</span> nprv_addDsjLemmaE<span class="main">[</span><span class="operator">OF</span> _ _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_addDsjLemmaE12 <span class="main">=</span> nprv_addDsjLemmaE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Rules for Equality›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Reflexivity:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> nprv_eql_reflI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_eql_reflT prv_nprvI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_eq_eqlI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">=</span> <span class="free">t2</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_eql_reflT prv_nprvI<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Symmetry:›</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_symI <span class="main">=</span>  nprv_addImpLemmaI<span class="main">[</span><span class="operator">OF</span> prv_eql_sym<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 4<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_symE <span class="main">=</span>  nprv_addImpLemmaE<span class="main">[</span><span class="operator">OF</span> prv_eql_sym<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 2<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_symE0 <span class="main">=</span>  nprv_eql_symE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_symE1 <span class="main">=</span>  nprv_eql_symE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_symE01 <span class="main">=</span>  nprv_eql_symE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Transitivity:›</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_transI <span class="main">=</span> nprv_addImp2LemmaI<span class="main">[</span><span class="operator">OF</span> prv_eql_imp_trans<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 5<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_transE <span class="main">=</span> nprv_addImp2LemmaE<span class="main">[</span><span class="operator">OF</span> prv_eql_imp_trans<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 3<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_transE0 <span class="main">=</span> nprv_eql_transE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _ _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_transE1 <span class="main">=</span> nprv_eql_transE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_transE2 <span class="main">=</span> nprv_eql_transE<span class="main">[</span><span class="operator">OF</span> _ _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_transE01 <span class="main">=</span> nprv_eql_transE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_transE02 <span class="main">=</span> nprv_eql_transE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_transE12 <span class="main">=</span> nprv_eql_transE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_transE012 <span class="main">=</span> nprv_eql_transE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Substitutivity:›</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_substI <span class="main">=</span>
nprv_addImp2LemmaI<span class="main">[</span><span class="operator">OF</span> prv_eql_subst_trm_rev<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 6<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_substE <span class="main">=</span> nprv_addImp2LemmaE<span class="main">[</span><span class="operator">OF</span> prv_eql_subst_trm_rev<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 4<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_substE0 <span class="main">=</span> nprv_eql_substE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _ _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_substE1 <span class="main">=</span> nprv_eql_substE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_substE2 <span class="main">=</span> nprv_eql_substE<span class="main">[</span><span class="operator">OF</span> _ _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_substE01 <span class="main">=</span> nprv_eql_substE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_substE02 <span class="main">=</span> nprv_eql_substE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_substE12 <span class="main">=</span> nprv_eql_substE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_substE012 <span class="main">=</span> nprv_eql_substE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Other Rules›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_cnjH<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="free">φ1</span> <span class="main">(</span>insert <span class="free">φ2</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="free">ψ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">φ1</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ2</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="main">(</span>insert <span class="main">(</span><span class="free">cnj</span> <span class="free">φ1</span> <span class="free">φ2</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_cut2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">φ1</span></span> <span class="quoted"><span class="free">φ2</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nprv_impI_rev prv_imp_cnjL prv_imp_cnjR prv_nprvI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nprv_impI_rev prv_imp_cnjL prv_imp_cnjR prv_nprvI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nprv_impI_rev prv_imp_cnjL prv_imp_cnjR prv_nprvI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nprv_impI_rev prv_imp_cnjL prv_imp_cnjR prv_nprvI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nprv_impI_rev prv_imp_cnjL prv_imp_cnjR prv_nprvI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nprv_impI_rev prv_imp_cnjL prv_imp_cnjR prv_nprvI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nprv_impI_rev prv_imp_cnjL prv_imp_cnjR prv_nprvI<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> cnj finite.insertI insert_iff insert_subset nprv_mono subset_insertI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_exi_commute<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">{</span><span class="free">exi</span> <span class="free">x</span> <span class="main">(</span><span class="free">exi</span> <span class="free">y</span> <span class="free">φ</span><span class="main">)</span><span class="main">}</span> <span class="main">(</span><span class="free">exi</span> <span class="free">y</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_exiE0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="free">exi</span> <span class="free">y</span> <span class="free">φ</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_clear2_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_exiE0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">φ</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_clear2_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_exiI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">y</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nprv_exiI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">x</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_exi_commute<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="main">(</span><span class="free">exi</span> <span class="free">y</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">exi</span> <span class="free">y</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_prvI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nprv_exi_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context Deduct_with_False_Disj *)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Natural Deduction for the Exists-Unique Quantifier›</span></span>

<span class="keyword1"><span class="command">context</span></span> Deduct_with_False_Disj_Rename
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_exuI<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n2<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="free">φ</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> i<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">φ</span> <span class="main">∈</span> <span class="free">F</span><span class="main">.</span> <span class="free">Fvars</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span>exu <span class="free">x</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="skolem">z</span>"</span></span>   <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"exu <span class="free">x</span> <span class="free">φ</span> <span class="main">=</span> <span class="free">cnj</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span><span class="free">exi</span> <span class="skolem">z</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exu_def_var<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> 0
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_cnjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_exiI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> n1<span class="main">)</span>
    <span class="comment1">(**)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_exiI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> u<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> n2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_exuI_var<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n2<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> i<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">φ</span> <span class="main">∈</span> <span class="free">F</span><span class="main">.</span> <span class="free">Fvars</span> <span class="bound">φ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span>exu <span class="free">x</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> exu_rename2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> yx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> nprv_exuI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> i<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> i<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> i<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> n1 subst_same_Var subst_subst yx<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> n2 u <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This turned out to be the most useful introduction rule for arithmetic:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> nprv_exuI_exi<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n2<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>insert <span class="free">φ</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> i<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">φ</span> <span class="main">∈</span> <span class="free">F</span><span class="main">.</span> <span class="free">Fvars</span> <span class="bound">φ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">φ</span> <span class="main">∈</span> <span class="free">F</span><span class="main">.</span> <span class="free">Fvars</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span>exu <span class="free">x</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="free">φ</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span>exu <span class="free">x</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_exuI_var<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">x</span>"</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> n2 u <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_cut<span class="main"><span class="main">[</span></span><span class="operator">OF</span> n1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_exiE0<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> u<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_exu_imp_exi<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>exu <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">[]</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> exu_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def z<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> prv_imp_cnjL<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_exu_exi<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>exu <span class="free">x</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms exi exu prv_exu_imp_exi prv_imp_mp<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This is just exu behaving for elimination and forward like exi:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> nprv_exuE_exi<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span>exu <span class="free">x</span> <span class="free">φ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n2<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="free">φ</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> i<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">ψ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">φ</span> <span class="main">∈</span> <span class="free">F</span><span class="main">.</span> <span class="free">Fvars</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_exiE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">φ</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nprv_addImpLemmaI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_exu_imp_exi<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">φ</span></span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_exuF_exi<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"exu <span class="free">x</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n2<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="free">φ</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> i<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">ψ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">φ</span> <span class="main">∈</span> <span class="free">F</span><span class="main">.</span> <span class="free">Fvars</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  nprv_exuE_exi nprv_hyp <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_exu_uni<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>exu <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t1</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t2</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_prvI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exu_def_var<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_cnjE0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_clear3_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_clear2_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_exiE0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_clear2_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_allE0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">t1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_allE0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">t2</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_clear3_3<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_impE01<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_clear5_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_clear4_3<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_impE01<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_clear4_3<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_clear3_3<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_eql_symE0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t2</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">z</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_eql_transE012<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_exuE_uni <span class="main">=</span> nprv_addImp3LemmaE<span class="main">[</span><span class="operator">OF</span> prv_exu_uni<span class="main">,</span><span class="operator">simped</span><span class="main">,</span><span class="operator">rotated</span> 4<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_exuF_uni <span class="main">=</span> nprv_exuE_uni<span class="main">[</span><span class="operator">OF</span> nprv_hyp<span class="main">,</span><span class="operator">simped</span><span class="main">]</span>


<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span> Deduct_with_False_Disj<span class="antiquote">}</span></span>›</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Eisbach Notation for Natural Deduction Proofs›</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The proof pattern will be: On a goal of the form <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">nprv</span></span> <span class="free"><span class="free">F</span></span> <span class="free"><span class="free">φ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
we apply a rule (usually an introduction, elimination, or cut/lemma-addition
rule), then discharge the side-conditions with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">method</span></span> auto<span class="antiquote"><span class="antiquote">}</span></span></span></span>, ending up with zero,
one or two goals of the same nprv-shape. This process is abstracted away in the
Eisbach nrule method:›</span></span>

<span class="keyword1"><span class="command">method</span></span> nrule <span class="keyword2"><span class="keyword">uses</span></span> r <span class="main">=</span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">r</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
<span class="comment1">(* For future developments, in case we refine what we do
(and also for documentation): This is supposed to create two main nprv-subgoals: *)</span>
<span class="keyword1"><span class="command">method</span></span> nrule2 <span class="keyword2"><span class="keyword">uses</span></span> r <span class="main">=</span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">r</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Methods for chaining several nrule applications:›</span></span>

<span class="keyword1"><span class="command">method</span></span> nprover2 <span class="keyword2"><span class="keyword">uses</span></span> r1 r2 <span class="main">=</span>
  <span class="main">(</span><span class="operator">-</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">r1</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">r2</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span> <span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span><span class="main">)</span>
<span class="keyword1"><span class="command">method</span></span> nprover3 <span class="keyword2"><span class="keyword">uses</span></span> r1 r2 r3 <span class="main">=</span>
  <span class="main">(</span><span class="operator">-</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">r1</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">r2</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">r3</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span> <span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span><span class="main">)</span>
<span class="keyword1"><span class="command">method</span></span> nprover4 <span class="keyword2"><span class="keyword">uses</span></span> r1 r2 r3 r4 <span class="main">=</span>
  <span class="main">(</span><span class="operator">-</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">r1</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">r2</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">r3</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">r4</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span> <span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span><span class="main">)</span>
<span class="keyword1"><span class="command">method</span></span> nprover5 <span class="keyword2"><span class="keyword">uses</span></span> r1 r2 r3 r4 r5 <span class="main">=</span>
  <span class="main">(</span><span class="operator">-</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">r1</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">r2</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">r3</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">r4</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">r5</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span> <span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
<span class="keyword1"><span class="command">method</span></span> nprover6 <span class="keyword2"><span class="keyword">uses</span></span> r1 r2 r3 r4 r5 r6 <span class="main">=</span>
  <span class="main">(</span><span class="operator">-</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">r1</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">r2</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">r3</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">r4</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">r5</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">r6</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span> <span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span></pre>
</div><div id="Pseudo_Term">
<div class="head">
<h1>Theory Pseudo_Term</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Pseudo-Terms›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Pseudo_Term
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Natural_Deduction.html">Natural_Deduction</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Pseudo-terms are formulas that satisfy the exists-unique property
on one of their variables.›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Basic Setting›</span></span>

<span class="keyword1"><span class="command">context</span></span> Generic_Syntax
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We choose a specific variable, out, that will represent the
"output" of pseudo-terms, i.e., the variable on which the exists-unique property holds:›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">out</span> <span class="main">≡</span> Variable <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Many facts will involve pseudo-terms with only one additional "input" variable, inp:›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">inp</span> <span class="main">≡</span> Variable <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="comment1">(* These facts can speed up simplification: *)</span>
<span class="keyword1"><span class="command">lemma</span></span> out_inp_distinct<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"out <span class="main">≠</span> inp"</span></span> <span class="quoted"><span class="quoted">"inp <span class="main">≠</span> out"</span></span>
<span class="quoted"><span class="quoted">"out <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"out <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"yy <span class="main">≠</span> out"</span></span> <span class="quoted"><span class="quoted">"out <span class="main">≠</span> zz"</span></span> <span class="quoted"><span class="quoted">"zz <span class="main">≠</span> out"</span></span> <span class="quoted"><span class="quoted">"out <span class="main">≠</span> xx'"</span></span> <span class="quoted"><span class="quoted">"xx' <span class="main">≠</span> out"</span></span>
   <span class="quoted"><span class="quoted">"out <span class="main">≠</span> yy'"</span></span> <span class="quoted"><span class="quoted">"yy' <span class="main">≠</span> out"</span></span> <span class="quoted"><span class="quoted">"out <span class="main">≠</span> zz'"</span></span> <span class="quoted"><span class="quoted">"zz' <span class="main">≠</span> out"</span></span>
<span class="quoted"><span class="quoted">"inp <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"inp <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"yy <span class="main">≠</span> inp"</span></span> <span class="quoted"><span class="quoted">"inp <span class="main">≠</span> zz"</span></span> <span class="quoted"><span class="quoted">"zz <span class="main">≠</span> inp"</span></span> <span class="quoted"><span class="quoted">"inp <span class="main">≠</span> xx'"</span></span> <span class="quoted"><span class="quoted">"xx' <span class="main">≠</span> inp"</span></span>
   <span class="quoted"><span class="quoted">"inp <span class="main">≠</span> yy'"</span></span> <span class="quoted"><span class="quoted">"yy' <span class="main">≠</span> inp"</span></span> <span class="quoted"><span class="quoted">"inp <span class="main">≠</span> zz'"</span></span> <span class="quoted"><span class="quoted">"zz' <span class="main">≠</span> inp"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context Generic_Syntax *)</span>


<span class="keyword1"><span class="command">context</span></span> Deduct_with_False_Disj_Rename
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Pseudo-terms over the first $n+1$ variables, i.e.,
having $n$ input variables (Variable $1$ to Variable $n$), and an output variable, out (which is
an abbreviation for Variable $0$).›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ptrm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'fmla</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ptrm</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">σ</span></span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">.</span> <span class="free">Fvars</span> <span class="bound">σ</span> <span class="main">=</span> Variable <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span> <span class="main">∧</span> <span class="free">prv</span> <span class="main">(</span>exu out <span class="bound">σ</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ptrm<span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> ptrm <span class="free">n</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ptrm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ptrm_1_Fvars<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> ptrm <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Fvars</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">{</span>out<span class="main">,</span>inp<span class="main">}</span>"</span></span>
	<span class="keyword1"><span class="command">unfolding</span></span> ptrm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ptrm_prv_exu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> ptrm <span class="free">n</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>exu out <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ptrm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ptrm_prv_exi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> ptrm <span class="free">n</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">exi</span> out <span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ptrm_prv_exu prv_exu_exi<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_ptrmE_exi<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> ptrm <span class="free">n</span> <span class="main">⟹</span> nprv <span class="main">(</span>insert <span class="free">σ</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span>
 <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> out <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">ψ</span> <span class="main">⟹</span> out <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">Fvars</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ptrm_prv_exu<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> ptrm<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_exuE_exi<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">out</span> <span class="quoted"><span class="free">σ</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prv_nprvI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_ptrmE_uni<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> ptrm <span class="free">n</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="main">(</span><span class="free">subst</span> <span class="free">σ</span> <span class="free">t1</span> out<span class="main">)</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="main">(</span><span class="free">subst</span> <span class="free">σ</span> <span class="free">t2</span> out<span class="main">)</span> <span class="main">⟹</span>
 nprv <span class="main">(</span>insert <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>
 <span class="main">⟹</span> nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> ptrm_prv_exu<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> ptrm<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nprv_exuE_uni<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">out</span> <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="free">t1</span></span> <span class="quoted"><span class="free">t2</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prv_nprvI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_ptrmE_uni0<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> ptrm <span class="free">n</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="free">σ</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="main">(</span><span class="free">subst</span> <span class="free">σ</span> <span class="free">t</span> out<span class="main">)</span> <span class="main">⟹</span>
 nprv <span class="main">(</span>insert <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> out<span class="main">)</span> <span class="free">t</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>
 <span class="main">⟹</span> nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nprv_ptrmE_uni<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">σ</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> out"</span></span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_ptrmE0_uni0<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> ptrm <span class="free">n</span> <span class="main">⟹</span> <span class="free">σ</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="main">(</span><span class="free">subst</span> <span class="free">σ</span> <span class="free">t</span> out<span class="main">)</span> <span class="main">⟹</span>
 nprv <span class="main">(</span>insert <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> out<span class="main">)</span> <span class="free">t</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>
 <span class="main">⟹</span> nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nprv_ptrmE_uni0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">σ</span></span> <span class="quoted"><span class="free">n</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The $\forall$-$\exists$ Equivalence›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹There are two natural ways to state that (unique) "output" of a pseudo-term <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">σ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
satisfies a property <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">φ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>:
(1) using $\exists$: there exists an "out" such that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">σ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">φ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> hold for it;
(2) using $\forall$: for all "out" such that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">σ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> holds for it, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">φ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> holds for it as well.

We prove the well-known fact that these two ways are equivalent. (Intuitionistic
logic suffice to prove that.)›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ptrm_nprv_exi<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> ptrm <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">{</span><span class="free">σ</span><span class="main">,</span> <span class="free">exi</span> out <span class="main">(</span><span class="free">cnj</span> <span class="free">σ</span> <span class="free">φ</span><span class="main">)</span><span class="main">}</span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> σ <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span>out<span class="main">]</span> <span class="main">[]</span> <span class="main">[</span><span class="free">σ</span><span class="main">,</span><span class="free">φ</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> out"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>out<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">σ</span><span class="main">,</span><span class="free">φ</span><span class="main">]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">exi</span> out <span class="main">(</span><span class="free">cnj</span> <span class="free">σ</span> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> <span class="free">exi</span> <span class="skolem">z</span> <span class="main">(</span><span class="free">subst</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">σ</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> out<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> exi_rename<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> 0
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiE0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="main">(</span><span class="free">cnj</span> <span class="free">σ</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> out"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule2</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_ptrmE0_uni0<span class="main"><span class="main">[</span></span><span class="operator">OF</span> σ<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">z</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_cnjE0<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear4_4<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear3_3<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_cnjE0<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear4_4<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear3_1<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE012<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> out"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">z</span>"</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">φ</span></span> <span class="quoted">out</span> <span class="quoted"><span class="free">φ</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ptrm_nprv_exi_all<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> ptrm <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">{</span><span class="free">exi</span> out <span class="main">(</span><span class="free">cnj</span> <span class="free">σ</span> <span class="free">φ</span><span class="main">)</span><span class="main">}</span> <span class="main">(</span><span class="free">all</span> out <span class="main">(</span><span class="free">imp</span> <span class="free">σ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> σ <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> ptrm_nprv_exi<span class="main"><span class="main">[</span></span><span class="operator">OF</span> σ<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ptrm_prv_exi_imp_all<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> ptrm <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">exi</span> out <span class="main">(</span><span class="free">cnj</span> <span class="free">σ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">all</span> out <span class="main">(</span><span class="free">imp</span> <span class="free">σ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> σ <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> ptrm_nprv_exi_all<span class="main"><span class="main">[</span></span><span class="operator">OF</span> σ<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ptrm_nprv_all_imp_exi<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> ptrm <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">{</span><span class="free">all</span> out <span class="main">(</span><span class="free">imp</span> <span class="free">σ</span> <span class="free">φ</span><span class="main">)</span><span class="main">}</span> <span class="main">(</span><span class="free">exi</span> out <span class="main">(</span><span class="free">cnj</span> <span class="free">σ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> σ <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span>out<span class="main">]</span> <span class="main">[]</span> <span class="main">[</span><span class="free">σ</span><span class="main">,</span><span class="free">φ</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> out"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>out<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">σ</span><span class="main">,</span><span class="free">φ</span><span class="main">]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_ptrmE_exi<span class="main"><span class="main">[</span></span><span class="operator">OF</span> σ<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">cnj</span> <span class="free">σ</span> <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> out"</span></span> <span class="quoted">out</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_allE0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">out</span> <span class="quoted"><span class="quoted">"<span class="free">imp</span> <span class="free">σ</span> <span class="free">φ</span>"</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> out"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear3_3<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_cnjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impE01<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ptrm_prv_all_imp_exi<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> ptrm <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">all</span> out <span class="main">(</span><span class="free">imp</span> <span class="free">σ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">exi</span> out <span class="main">(</span><span class="free">cnj</span> <span class="free">σ</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> σ <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span>out<span class="main">]</span> <span class="main">[]</span> <span class="main">[</span><span class="free">σ</span><span class="main">,</span><span class="free">φ</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> out"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>out<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">σ</span><span class="main">,</span><span class="free">φ</span><span class="main">]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> ptrm_nprv_all_imp_exi<span class="main"><span class="main">[</span></span><span class="operator">OF</span> σ<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span> Deduct_with_False_Disj_Rename <span class="antiquote">}</span></span>›</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Instantiation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define the notion of instantiating the "inp" variable of a formula
(in particular, of a pseudo-term):
-- first with a term);
-- then with a pseudo-term.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Instantiation with terms›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Instantiation with terms is straightforward using substitution.
In the name of the operator, the suffix "Inp" is a reminder that we instantiate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">φ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
on its variable "inp".›</span></span>


<span class="keyword1"><span class="command">context</span></span> Generic_Syntax
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">instInp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="tfree">'trm</span> <span class="main">⇒</span> <span class="tfree">'fmla</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">instInp</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≡</span> <span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> inp"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> instInp_fmla<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"instInp <span class="free">φ</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms instInp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_instInp<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{</span>inp<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="main">(</span>instInp <span class="free">φ</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms instInp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span> Generic_Syntax <span class="antiquote">}</span></span>›</span>


<span class="keyword1"><span class="command">context</span></span> Deduct_with_False_Disj_Rename
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_instInp_ptrm_1<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> τ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> ptrm <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="main">(</span>instInp <span class="free">τ</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> insert out <span class="main">(</span><span class="free">FvarsT</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms instInp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> instInp<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> τ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> ptrm <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="free">t</span> <span class="main">=</span> Variable <span class="main">`</span> <span class="main">{</span><span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"instInp <span class="free">τ</span> <span class="free">t</span> <span class="main">∈</span> ptrm <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> Let_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">τ</span> <span class="main">=</span> <span class="main">{</span>out<span class="main">,</span>inp<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> ptrm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="main">(</span>instInp <span class="free">τ</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> insert out <span class="main">(</span><span class="free">FvarsT</span> <span class="free">t</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> τ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Fvars_instInp_ptrm_1<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"exu out <span class="main">(</span>instInp <span class="free">τ</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">subst</span> <span class="main">(</span>exu out <span class="free">τ</span><span class="main">)</span> <span class="free">t</span> inp"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> instInp_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> subst_exu<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>exu out <span class="free">τ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> τ <span class="keyword1"><span class="command">unfolding</span></span> ptrm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>exu out <span class="main">(</span>instInp <span class="free">τ</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prv_subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ 1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> ptrm_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> instInp_0<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> τ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> ptrm <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"instInp <span class="free">τ</span> <span class="free">t</span> <span class="main">∈</span> ptrm <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> instInp<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> instInp_1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> τ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> ptrm <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="free">t</span> <span class="main">=</span> <span class="main">{</span>inp<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"instInp <span class="free">τ</span> <span class="free">t</span> <span class="main">∈</span> ptrm <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> instInp<span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Instantiation with pseudo-terms›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Instantiation of a formula <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">φ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with a pseudo-term <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">τ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> yields a formula that
could be casually written <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> [source] <span class="quoted"><span class="quoted">"<span class="free"><span class="free">φ</span></span><span class="main"><span class="main">(</span></span><span class="free"><span class="free">τ</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. It states the existence of an output <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">zz</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">τ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> on which <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">φ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> holds.
Instead of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> [source] <span class="quoted"><span class="quoted">"<span class="free"><span class="free">φ</span></span><span class="main"><span class="main">(</span></span><span class="free"><span class="free">τ</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, we write <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">instInpP</span></span> <span class="free"><span class="free">φ</span></span> <span class="free"><span class="free">n</span></span> <span class="free"><span class="free">τ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> where <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the number of input variables of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">τ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
In the name <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">instInpP</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Inp</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is as before a reminder that we instantiate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">φ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> on its variable
"inp" and the suffix "P" stands for "Pseudo".›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">instInpP</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="tfree">'fmla</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">instInpP</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">≡</span> <span class="keyword1">let</span> <span class="bound">zz</span> <span class="main">=</span> Variable <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">in</span>
   <span class="free">exi</span> <span class="bound">zz</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span><span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">(</span><span class="free">Var</span> <span class="bound">zz</span><span class="main">)</span> out<span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">(</span><span class="free">Var</span> <span class="bound">zz</span><span class="main">)</span> inp<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> instInpP_fmla<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
	<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
	<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"instInpP <span class="free">φ</span> <span class="free">n</span> <span class="free">τ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
	<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> instInpP_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_instInpP<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> τ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> ptrm <span class="free">n</span>"</span></span>  <span class="quoted"><span class="quoted">"Variable <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="main">(</span>instInpP <span class="free">φ</span> <span class="free">n</span> <span class="free">τ</span><span class="main">)</span> <span class="main">=</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">-</span> <span class="main">{</span>inp<span class="main">}</span> <span class="main">∪</span> Variable <span class="main">`</span> <span class="main">{</span><span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> instInpP_def Let_def ptrm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_instInpP2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> τ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> ptrm <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">φ</span> <span class="main">⊆</span> <span class="main">{</span>inp<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="main">(</span>instInpP <span class="free">φ</span> <span class="free">n</span> <span class="free">τ</span><span class="main">)</span> <span class="main">=</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">-</span> <span class="main">{</span>inp<span class="main">}</span> <span class="main">∪</span> Variable <span class="main">`</span> <span class="main">{</span><span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Fvars_instInpP<span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Closure and compositionality properties of instantiation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Instantiating a 1-pseudo-term with an n-pseudo-term yields an n pseudo-term:›</span></span>
<span class="comment1">(* This could be generalized, of course. *)</span>
<span class="keyword1"><span class="command">lemma</span></span> instInpP1<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> ptrm <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> τ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> ptrm <span class="free">n</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"instInpP <span class="free">σ</span> <span class="free">n</span> <span class="free">τ</span> <span class="main">∈</span> ptrm <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> Let_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">{</span>out<span class="main">,</span>inp<span class="main">}</span>"</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">τ</span> <span class="main">=</span> Variable <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> ptrm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">zz</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span> <span class="main">≡</span> Variable <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> zz_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> Variable <span class="bound">i</span> <span class="main">≠</span> <span class="skolem">zz</span> <span class="main">∧</span> <span class="skolem">zz</span> <span class="main">≠</span> Variable <span class="bound">i</span>"</span></span>
    <span class="quoted"><span class="quoted">"out <span class="main">≠</span> <span class="skolem">zz</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span> <span class="main">≠</span> out"</span></span> <span class="quoted"><span class="quoted">"inp <span class="main">≠</span> <span class="skolem">zz</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span> <span class="main">≠</span> inp"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> zz_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≡</span> getFr <span class="main">[</span>out<span class="main">,</span>inp<span class="main">,</span><span class="skolem">zz</span><span class="main">]</span> <span class="main">[]</span> <span class="main">[</span><span class="free">σ</span><span class="main">,</span><span class="free">τ</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> x_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> out"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> inp"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">zz</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">τ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>out<span class="main">,</span>inp<span class="main">,</span><span class="skolem">zz</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">σ</span><span class="main">,</span><span class="free">τ</span><span class="main">]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> x_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> Variable <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  	<span class="keyword1"><span class="command">using</span></span> x_facts<span class="main">(</span>4<span class="main">)</span> zz_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span>out<span class="main">,</span>inp<span class="main">,</span><span class="skolem">zz</span><span class="main">,</span><span class="skolem">x</span><span class="main">]</span> <span class="main">[]</span> <span class="main">[</span><span class="free">σ</span><span class="main">,</span><span class="free">τ</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> out"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> inp"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="skolem">zz</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">τ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>out<span class="main">,</span>inp<span class="main">,</span><span class="skolem">zz</span><span class="main">,</span><span class="skolem">x</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">σ</span><span class="main">,</span><span class="free">τ</span><span class="main">]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">z</span> <span class="main">=</span> Variable <span class="bound">i</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> Variable <span class="bound">i</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Fvars</span> <span class="free">τ</span> <span class="main">=</span> Variable <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>›</span></span> atLeastAtMost_iff z_facts<span class="main">(</span>7<span class="main">)</span> x_facts<span class="main">(</span>7<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="main">(</span>instInpP <span class="free">σ</span> <span class="free">n</span> <span class="free">τ</span><span class="main">)</span> <span class="main">=</span> Variable <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> instInpP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> tt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">exi</span> out <span class="free">τ</span> <span class="main">=</span> <span class="free">exi</span> <span class="skolem">zz</span> <span class="main">(</span><span class="free">subst</span> <span class="free">τ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">zz</span><span class="main">)</span> out<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exi_rename<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> exi_σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">exi</span> out <span class="free">σ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> exi_τ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">exi</span> <span class="skolem">zz</span> <span class="main">(</span><span class="free">subst</span> <span class="free">τ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">zz</span><span class="main">)</span> out<span class="main">)</span><span class="main">)</span>"</span></span>
  	<span class="keyword1"><span class="command">using</span></span> σ τ ptrm_prv_exi tt <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span> 	
  <span class="keyword1"><span class="command">have</span></span> exi_σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">exi</span> out <span class="main">(</span><span class="free">subst</span> <span class="free">σ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">zz</span><span class="main">)</span> inp<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prv_subst<span class="main">[</span><span class="operator">OF</span> _ _ _ exi_σ<span class="main">,</span> <span class="operator">of</span> <span class="quoted">inp</span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">zz</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> exu_σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>exu out <span class="free">σ</span><span class="main">)</span>"</span></span>
  	<span class="keyword1"><span class="command">using</span></span> σ ptrm_prv_exu <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> exu_σ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>exu out <span class="main">(</span><span class="free">subst</span> <span class="free">σ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">zz</span><span class="main">)</span> inp<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prv_subst<span class="main">[</span><span class="operator">OF</span> _ _ _ exu_σ<span class="main">,</span> <span class="operator">of</span> <span class="quoted">inp</span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">zz</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> zz_z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">exi</span> <span class="skolem">zz</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span><span class="free">subst</span> <span class="free">τ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">zz</span><span class="main">)</span> out<span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="free">σ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">zz</span><span class="main">)</span> inp<span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="free">exi</span> <span class="skolem">z</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span><span class="free">subst</span> <span class="free">τ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> out<span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="free">σ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> inp<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">variousSubsts2</span> <span class="operator">auto</span> <span class="quasi_keyword">s1</span><span class="main"><span class="main">:</span></span> exi_rename<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">zz</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">s2</span><span class="main"><span class="main">:</span></span> subst_subst<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>exu out <span class="main">(</span>instInpP <span class="free">σ</span> <span class="free">n</span> <span class="free">τ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule2</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exuI_exi<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> instInpP_def Let_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addImpLemmaI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_exi_commute<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> exi_τ<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">zz</span></span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free">τ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">zz</span><span class="main">)</span> out"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear2_2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">zz</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> exi_σ<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">out</span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free">σ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">zz</span><span class="main">)</span> inp"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear3_2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> out"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">variousSubsts1</span> <span class="operator">auto</span> <span class="quasi_keyword">s1</span><span class="main"><span class="main">:</span></span> subst_subst<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_cnjI<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> instInpP_def Let_def zz_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiE0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">zz</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear3_2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_cnjE0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear4_3<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> zz_z
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiE0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear4_4<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_cnjE0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear5_3<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_cut<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">zz</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover3</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> nprv_clear4_2 <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> nprv_clear3_3
                  <span class="quasi_keyword">r3</span><span class="main"><span class="main">:</span></span> nprv_ptrmE_uni<span class="main"><span class="main">[</span></span><span class="operator">OF</span> τ<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">zz</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear5_2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear4_3<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule2</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">zz</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="free">σ</span></span> <span class="quoted">inp</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_symE01<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear4_2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear3_2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> exu_σ<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exuE_uni<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">out</span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free">σ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">zz</span><span class="main">)</span> inp"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> out"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">x</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_symE01<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span>
	<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">unfolding</span></span> ptrm_def instInpP_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>		

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Term and pseudo-term instantiation compose smoothly:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> instInp_instInpP<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">φ</span> <span class="main">⊆</span> <span class="main">{</span>inp<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> τ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> ptrm <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"instInp <span class="main">(</span>instInpP <span class="free">φ</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">τ</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> instInpP <span class="free">φ</span> <span class="main">0</span> <span class="main">(</span>instInp <span class="free">τ</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   x12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">≡</span> Variable <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">≡</span> Variable <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> x_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">≠</span> inp"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">≠</span> inp"</span></span>
   <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">≠</span> out"</span></span> <span class="quoted"><span class="quoted">"out <span class="main">≠</span> <span class="skolem">x1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">≠</span> out"</span></span> <span class="quoted"><span class="quoted">"out <span class="main">≠</span> <span class="skolem">x2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">≠</span> <span class="skolem">x2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">≠</span> <span class="skolem">x1</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> x12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> instInp_def instInpP_def Let_def x12<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> subst_exi<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">TUF</span> <span class="operator">simp</span><span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">variousSubsts5</span> <span class="operator">auto</span>
   <span class="quasi_keyword">s1</span><span class="main"><span class="main">:</span></span> subst_compose_same
   <span class="quasi_keyword">s2</span><span class="main"><span class="main">:</span></span> subst_compose_diff
   <span class="quasi_keyword">s3</span><span class="main"><span class="main">:</span></span> exi_rename<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">x1</span></span> <span class="quoted"><span class="skolem">x2</span></span><span class="main"><span class="main">]</span></span>
   <span class="quasi_keyword">s4</span><span class="main"><span class="main">:</span></span> subst_comp
   <span class="quasi_keyword">s5</span><span class="main"><span class="main">:</span></span> subst_notIn<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">φ</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">x1</span></span><span class="main"><span class="main">]</span></span>
  <span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Pseudo-term instantiation also composes smoothly with itself:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> nprv_instInpP_compose<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">χ</span> <span class="main">=</span> <span class="main">{</span>inp<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> σ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> ptrm <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> τ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> ptrm <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">{</span>instInpP <span class="main">(</span>instInpP <span class="free">χ</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">0</span> <span class="free">τ</span><span class="main">}</span>
            <span class="main">(</span>instInpP <span class="free">χ</span> <span class="main">0</span> <span class="main">(</span>instInpP <span class="free">σ</span> <span class="main">0</span> <span class="free">τ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"nprv <span class="main">{</span>instInpP <span class="free">χ</span> <span class="main">0</span> <span class="main">(</span>instInpP <span class="free">σ</span> <span class="main">0</span> <span class="free">τ</span><span class="main">)</span><span class="main">}</span>
            <span class="main">(</span>instInpP <span class="main">(</span>instInpP <span class="free">χ</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">0</span> <span class="free">τ</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">χσ</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">στ</span></span> <span class="keyword2"><span class="keyword">where</span></span> χσ_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">χσ</span> <span class="main">≡</span> instInpP <span class="free">χ</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">σ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> στ_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">στ</span> <span class="main">≡</span> instInpP <span class="free">σ</span> <span class="main">0</span> <span class="free">τ</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">{</span>out<span class="main">,</span>inp<span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">τ</span> <span class="main">=</span> <span class="main">{</span>out<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> σ τ <span class="keyword1"><span class="command">unfolding</span></span> ptrm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> χσ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">χσ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="skolem">χσ</span> <span class="main">=</span> <span class="main">{</span>inp<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> χσ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> στ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">στ</span> <span class="main">∈</span> ptrm <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">στ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="skolem">στ</span> <span class="main">=</span> <span class="main">{</span>out<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> στ_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> Variable <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"out <span class="main">≠</span> <span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="main">≠</span> out"</span></span> <span class="quoted"><span class="quoted">"inp <span class="main">≠</span> <span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="main">≠</span> inp"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">χ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">τ</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> z_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">zz</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span> <span class="main">≡</span> Variable <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> zz_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"out <span class="main">≠</span> <span class="skolem">zz</span> <span class="main">∧</span> <span class="skolem">zz</span> <span class="main">≠</span> out"</span></span> <span class="quoted"><span class="quoted">"inp <span class="main">≠</span> <span class="skolem">zz</span> <span class="main">∧</span> <span class="skolem">zz</span> <span class="main">≠</span> inp"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="skolem">zz</span> <span class="main">∧</span> <span class="skolem">zz</span> <span class="main">≠</span> <span class="skolem">z</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">zz</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">χ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">τ</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> zz_def z_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">≡</span> getFr <span class="main">[</span>out<span class="main">,</span>inp<span class="main">,</span><span class="skolem">z</span><span class="main">,</span><span class="skolem">zz</span><span class="main">]</span> <span class="main">[]</span> <span class="main">[</span><span class="free">χ</span><span class="main">,</span><span class="free">σ</span><span class="main">,</span><span class="free">τ</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z'_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">≠</span> out"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">≠</span> inp"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="skolem">z'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">≠</span> <span class="skolem">zz</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span> <span class="main">≠</span> <span class="skolem">z'</span>"</span></span>
   <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">χ</span>"</span></span><span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">σ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">τ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>out<span class="main">,</span>inp<span class="main">,</span><span class="skolem">z</span><span class="main">,</span><span class="skolem">zz</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">χ</span><span class="main">,</span><span class="free">σ</span><span class="main">,</span><span class="free">τ</span><span class="main">]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z'_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> χσ'<span class="main">:</span> <span class="quoted"><span class="quoted">"instInpP <span class="skolem">χσ</span> <span class="main">0</span> <span class="free">τ</span> <span class="main">=</span> <span class="free">exi</span> <span class="skolem">z'</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span><span class="free">subst</span> <span class="free">τ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z'</span><span class="main">)</span> out<span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="skolem">χσ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z'</span><span class="main">)</span> inp<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> instInpP_def Let_def z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> exi_rename<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="skolem">z'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> χσz'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="skolem">χσ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z'</span><span class="main">)</span> inp <span class="main">=</span>
    <span class="free">exi</span> <span class="skolem">zz</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span><span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="free">σ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">zz</span><span class="main">)</span> out<span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z'</span><span class="main">)</span> inp<span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="free">χ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">zz</span><span class="main">)</span> inp<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> χσ_def instInpP_def Let_def zz_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subst_compose_same<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> στzz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="skolem">στ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">zz</span><span class="main">)</span> out <span class="main">=</span>
     <span class="free">exi</span> <span class="skolem">z</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span><span class="free">subst</span> <span class="free">τ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> out<span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="free">σ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">zz</span><span class="main">)</span> out<span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> inp<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> στ_def instInpP_def Let_def z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">variousSubsts2</span> <span class="operator">auto</span> <span class="quasi_keyword">s1</span><span class="main"><span class="main">:</span></span> subst_compose_same <span class="quasi_keyword">s2</span><span class="main"><span class="main">:</span></span> subst_compose_diff<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">{</span>instInpP <span class="skolem">χσ</span> <span class="main">0</span> <span class="free">τ</span><span class="main">}</span> <span class="main">(</span>instInpP <span class="free">χ</span> <span class="main">0</span> <span class="skolem">στ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> χσ'
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiE0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear2_2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_cnjE0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear3_3<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> χσz'
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiE0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear3_3<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_cnjE0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear4_3<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> instInpP_def Let_def z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">zz</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_cnjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear3_2<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> στzz
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">z'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_cnjI<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> χσ_def στ_def <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> χστ<span class="main">:</span> <span class="quoted"><span class="quoted">"instInpP <span class="free">χ</span> <span class="main">0</span> <span class="skolem">στ</span> <span class="main">=</span> <span class="free">exi</span> <span class="skolem">z'</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span><span class="free">subst</span> <span class="skolem">στ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z'</span><span class="main">)</span> out<span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="free">χ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z'</span><span class="main">)</span> inp<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> instInpP_def Let_def z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> exi_rename<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="skolem">z'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> στz'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="skolem">στ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z'</span><span class="main">)</span> out <span class="main">=</span>
   <span class="free">exi</span> <span class="skolem">z</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span><span class="free">subst</span> <span class="free">τ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> out<span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="free">σ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> inp<span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z'</span><span class="main">)</span> out<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> στ_def instInpP_def Let_def z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subst_compose_same<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> χσz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="skolem">χσ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> inp <span class="main">=</span>
    <span class="free">exi</span> <span class="skolem">zz</span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span><span class="free">subst</span> <span class="main">(</span><span class="free">subst</span> <span class="free">σ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> inp<span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">zz</span><span class="main">)</span> out<span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="free">χ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">zz</span><span class="main">)</span> inp<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> χσ_def instInpP_def Let_def zz_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">variousSubsts2</span> <span class="operator">auto</span> <span class="quasi_keyword">s1</span><span class="main"><span class="main">:</span></span> subst_compose_same <span class="quasi_keyword">s2</span><span class="main"><span class="main">:</span></span> subst_compose_diff<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">{</span>instInpP <span class="free">χ</span> <span class="main">0</span> <span class="skolem">στ</span><span class="main">}</span> <span class="main">(</span>instInpP <span class="skolem">χσ</span> <span class="main">0</span> <span class="free">τ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> χστ
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiE0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear2_2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_cnjE0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear3_3<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> στz'
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiE0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear3_2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_cnjE0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear4_3<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> instInpP_def Let_def z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">z</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_cnjI<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> χσz
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">z'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_cnjI<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> χσ_def στ_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_instInpP_compose<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">χ</span> <span class="main">=</span> <span class="main">{</span>inp<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> σ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> ptrm <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> τ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> ptrm <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>instInpP <span class="main">(</span>instInpP <span class="free">χ</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">0</span> <span class="free">τ</span><span class="main">)</span>
                <span class="main">(</span>instInpP <span class="free">χ</span> <span class="main">0</span> <span class="main">(</span>instInpP <span class="free">σ</span> <span class="main">0</span> <span class="free">τ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>instInpP <span class="free">χ</span> <span class="main">0</span> <span class="main">(</span>instInpP <span class="free">σ</span> <span class="main">0</span> <span class="free">τ</span><span class="main">)</span><span class="main">)</span>
                <span class="main">(</span>instInpP <span class="main">(</span>instInpP <span class="free">χ</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">0</span> <span class="free">τ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>instInpP <span class="main">(</span>instInpP <span class="free">χ</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">σ</span><span class="main">)</span> <span class="main">0</span> <span class="free">τ</span><span class="main">)</span>
                <span class="main">(</span>instInpP <span class="free">χ</span> <span class="main">0</span> <span class="main">(</span>instInpP <span class="free">σ</span> <span class="main">0</span> <span class="free">τ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">σ</span> <span class="main">=</span> <span class="main">{</span>out<span class="main">,</span>inp<span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">τ</span> <span class="main">=</span> <span class="main">{</span>out<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> σ τ <span class="keyword1"><span class="command">unfolding</span></span> ptrm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nprv_prvI nprv_impI nprv_instInpP_compose<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_eqvI<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Equality between Pseudo-Terms and Terms›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Casually, the equality between a pseudo-term <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">τ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and a term <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> can
be written as $\vdash\tau = t$. This is in fact the (provability of)
the instantiation of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">τ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">τ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>'s output variable out. Indeed, this
formula says that the unique entity denoted by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">τ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is exactly <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prveqlPT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="tfree">'trm</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">prveqlPT</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≡</span> <span class="free">prv</span> <span class="main">(</span><span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> out<span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We prove that term--pseudo-term equality indeed acts like an equality,
in that it satisfies the substitutivity principle (shown only in the
particular case of formula-input instantiation).›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prveqlPT_nprv_instInp_instInpP<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">φ</span> <span class="main">⊆</span> <span class="main">{</span>inp<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> τ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> ptrm <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> τt<span class="main">:</span> <span class="quoted"><span class="quoted">"prveqlPT <span class="free">τ</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">{</span>instInpP <span class="free">φ</span> <span class="main">0</span> <span class="free">τ</span><span class="main">}</span> <span class="main">(</span>instInp <span class="free">φ</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">τ</span> <span class="main">=</span> <span class="main">{</span>out<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> τ <span class="keyword1"><span class="command">unfolding</span></span> ptrm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">zz</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span> <span class="main">≡</span> Variable <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> zz_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"out <span class="main">≠</span> <span class="skolem">zz</span> <span class="main">∧</span> <span class="skolem">zz</span> <span class="main">≠</span> out"</span></span> <span class="quoted"><span class="quoted">"inp <span class="main">≠</span> <span class="skolem">zz</span> <span class="main">∧</span> <span class="skolem">zz</span> <span class="main">≠</span> inp"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">τ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> zz_def <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">note</span></span> lemma1 <span class="main">=</span> nprv_addLemmaE<span class="main">[</span><span class="operator">OF</span> τt<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> prveqlPT_def<span class="main"><span class="main">]</span></span><span class="main">]</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> instInpP_def Let_def zz_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> instInp_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> lemma1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiE0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">zz</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear3_3<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_cnjE0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear4_3<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_ptrmE_uni<span class="main"><span class="main">[</span></span><span class="operator">OF</span> τ<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">zz</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear4_2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear3_3<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE012<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">zz</span>"</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">φ</span></span> <span class="quoted">inp</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prveqlPT_prv_instInp_instInpP<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span><span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">φ</span> <span class="main">⊆</span> <span class="main">{</span>inp<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> τ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> ptrm <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> τt<span class="main">:</span> <span class="quoted"><span class="quoted">"prveqlPT <span class="free">τ</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>instInpP <span class="free">φ</span> <span class="main">0</span> <span class="free">τ</span><span class="main">)</span> <span class="main">(</span>instInp <span class="free">φ</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nprv_prvI nprv_impI prveqlPT_nprv_instInp_instInpP<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prveqlPT_nprv_instInpP_instInp<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">φ</span> <span class="main">⊆</span> <span class="main">{</span>inp<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> τ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> ptrm <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> τt<span class="main">:</span> <span class="quoted"><span class="quoted">"prveqlPT <span class="free">τ</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">{</span>instInp <span class="free">φ</span> <span class="free">t</span><span class="main">}</span> <span class="main">(</span>instInpP <span class="free">φ</span> <span class="main">0</span> <span class="free">τ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">τ</span> <span class="main">=</span> <span class="main">{</span>out<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> τ <span class="keyword1"><span class="command">unfolding</span></span> ptrm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">zz</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span> <span class="main">≡</span> Variable <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> zz_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
    <span class="quoted"><span class="quoted">"out <span class="main">≠</span> <span class="skolem">zz</span> <span class="main">∧</span> <span class="skolem">zz</span> <span class="main">≠</span> out"</span></span> <span class="quoted"><span class="quoted">"inp <span class="main">≠</span> <span class="skolem">zz</span> <span class="main">∧</span> <span class="skolem">zz</span> <span class="main">≠</span> inp"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">τ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> zz_def <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">note</span></span> lemma1 <span class="main">=</span> nprv_addLemmaE<span class="main">[</span><span class="operator">OF</span> τt<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> prveqlPT_def<span class="main"><span class="main">]</span></span><span class="main">]</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> instInpP_def Let_def zz_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> instInp_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover3</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> lemma1 <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> nprv_exiI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">r3</span><span class="main"><span class="main">:</span></span> nprv_cnjI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prveqlPT_prv_instInpP_instInp<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span><span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">φ</span> <span class="main">⊆</span> <span class="main">{</span>inp<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> τ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> ptrm <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> τt<span class="main">:</span> <span class="quoted"><span class="quoted">"prveqlPT <span class="free">τ</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>instInp <span class="free">φ</span> <span class="free">t</span><span class="main">)</span> <span class="main">(</span>instInpP <span class="free">φ</span> <span class="main">0</span> <span class="free">τ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nprv_prvI nprv_impI prveqlPT_nprv_instInpP_instInp<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prveqlPT_prv_instInp_eqv_instInpP<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span><span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">φ</span> <span class="main">⊆</span> <span class="main">{</span>inp<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> τ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> ptrm <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> τt<span class="main">:</span> <span class="quoted"><span class="quoted">"prveqlPT <span class="free">τ</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>eqv <span class="main">(</span>instInpP <span class="free">φ</span> <span class="main">0</span> <span class="free">τ</span><span class="main">)</span> <span class="main">(</span>instInp <span class="free">φ</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms prveqlPT_prv_instInp_instInpP prveqlPT_prv_instInpP_instInp
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prv_eqvI<span class="main">)</span> <span class="operator">auto</span>


<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span> Deduct_with_False_Disj_Rename<span class="antiquote">}</span></span>›</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span></pre>
</div><div id="Standard_Model">
<div class="head">
<h1>Theory Standard_Model</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Truth in a Standard Model›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Abstract notion of standard model and truth.›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Standard_Model <span class="keyword2"><span class="keyword">imports</span></span> <a href="Deduction.html">Deduction</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First some minimal assumptions, involving
implication, negation and (universal and existential) quantification:›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Minimal_Truth <span class="main">=</span>
Syntax_with_Numerals_and_Connectives_False_Disj
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
  <span class="quoted"><span class="free">fls</span></span>
  <span class="quoted"><span class="free">dsj</span></span>
  <span class="quoted"><span class="free">num</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
<span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">trm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">Var</span> <span class="free">FvarsT</span> <span class="free">substT</span> <span class="free">Fvars</span> <span class="free">subst</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">eql</span> <span class="free">cnj</span> <span class="free">imp</span> <span class="free">all</span> <span class="free">exi</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">fls</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">dsj</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">num</span>
<span class="main">+</span>
<span class="comment1">― ‹The notion of truth for sentences:›</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">isTrue</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
not_isTrue_fls<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">isTrue</span> <span class="free">fls</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
isTrue_imp<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span> <span class="bound">ψ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="bound">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">Fvars</span> <span class="bound">ψ</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span>
  <span class="free">isTrue</span> <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">isTrue</span> <span class="main">(</span><span class="free">imp</span> <span class="bound">φ</span> <span class="bound">ψ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">isTrue</span> <span class="bound">ψ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
isTrue_all<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">φ</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">num</span><span class="main">.</span> <span class="free">isTrue</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">isTrue</span> <span class="main">(</span><span class="free">all</span> <span class="bound">x</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
isTrue_exi<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">φ</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">⟹</span>
  <span class="free">isTrue</span> <span class="main">(</span><span class="free">exi</span> <span class="bound">x</span> <span class="bound">φ</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">num</span><span class="main">.</span> <span class="free">isTrue</span> <span class="main">(</span><span class="free">subst</span> <span class="bound">φ</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
isTrue_neg<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span>
  <span class="free">isTrue</span> <span class="bound">φ</span> <span class="main">∨</span> <span class="free">isTrue</span> <span class="main">(</span>neg <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> isTrue_neg_excl<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span>
 <span class="free">isTrue</span> <span class="free">φ</span> <span class="main">⟹</span> <span class="free">isTrue</span> <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">using</span></span> isTrue_imp not_isTrue_fls <span class="keyword1"><span class="command">unfolding</span></span> neg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> isTrue_neg_neg<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">isTrue</span> <span class="main">(</span>neg <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">isTrue</span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms isTrue_neg isTrue_neg_excl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span>  Minimal_Truth<span class="antiquote">}</span></span>›</span>


<span class="keyword1"><span class="command">locale</span></span> Minimal_Truth_Soundness <span class="main">=</span>
Minimal_Truth
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
  <span class="quoted"><span class="free">fls</span></span>
  <span class="quoted"><span class="free">dsj</span></span>
  <span class="quoted"><span class="free">num</span></span>
  <span class="quoted"><span class="free">isTrue</span></span>
<span class="main">+</span>
Deduct_with_False_Disj
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
  <span class="quoted"><span class="free">fls</span></span>
  <span class="quoted"><span class="free">dsj</span></span>
  <span class="quoted"><span class="free">num</span></span>
  <span class="quoted"><span class="free">prv</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
<span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">trm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">Var</span> <span class="free">FvarsT</span> <span class="free">substT</span> <span class="free">Fvars</span> <span class="free">subst</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">eql</span> <span class="free">cnj</span> <span class="free">imp</span> <span class="free">all</span> <span class="free">exi</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">fls</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">dsj</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">num</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">prv</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">isTrue</span>
<span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
<span class="comment1">― ‹We assume soundness of the provability for sentences (w.r.t. truth):›</span>
sound_isTrue<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">Fvars</span> <span class="bound">φ</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="bound">φ</span> <span class="main">⟹</span> <span class="free">isTrue</span> <span class="bound">φ</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For sound theories, consistency is a fact rather than a hypothesis:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> consistent<span class="main">:</span> <span class="quoted">consistent</span>
  <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">using</span></span> not_isTrue_fls sound_isTrue <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_neg_excl<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="free">φ</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span> False"</span></span>
<span class="keyword1"><span class="command">using</span></span> isTrue_neg_excl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">φ</span></span><span class="main">]</span> sound_isTrue <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_implies_isTrue<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">χ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">χ</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">isTrue</span> <span class="free">φ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">isTrue</span> <span class="free">χ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">isTrue</span> <span class="main">(</span><span class="free">imp</span> <span class="free">φ</span> <span class="free">χ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sound_isTrue<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms isTrue_imp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sound theories are not only consistent, but also $\omega$-consistent
(in the strong, intuitionistic sense):›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ωconsistent<span class="main">:</span> <span class="quoted">ωconsistent</span>
<span class="keyword1"><span class="command">unfolding</span></span> ωconsistent_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> notI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">φ</span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="skolem">φ</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> 00<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span><span class="free">num</span><span class="main">.</span> <span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">subst</span> <span class="skolem">φ</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span><span class="free">num</span><span class="main">.</span> <span class="free">isTrue</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">subst</span> <span class="skolem">φ</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 00 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sound_isTrue<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">isTrue</span> <span class="main">(</span><span class="free">all</span> <span class="skolem">x</span> <span class="main">(</span>neg <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"1"</span> isTrue_all<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">all</span> <span class="skolem">x</span> <span class="main">(</span>neg <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">exi</span> <span class="skolem">x</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prv_all_neg_imp_neg_exi <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">isTrue</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">all</span> <span class="skolem">x</span> <span class="main">(</span>neg <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">exi</span> <span class="skolem">x</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"1"</span> sound_isTrue<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">isTrue</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">exi</span> <span class="skolem">x</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 0 1 Diff_insert_absorb Fvars_all Fvars_exi Fvars_neg all
      exi insert_absorb insert_not_empty isTrue_imp neg<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">isTrue</span> <span class="main">(</span>neg <span class="main">(</span>neg <span class="main">(</span><span class="free">exi</span> <span class="skolem">x</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 isTrue_neg_excl <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span>neg <span class="main">(</span><span class="free">exi</span> <span class="skolem">x</span> <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span> sound_isTrue <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ωconsistentStd1<span class="main">:</span> <span class="quoted">ωconsistentStd1</span>
  <span class="keyword1"><span class="command">using</span></span> ωconsistent ωconsistent_impliesStd1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> ωconsistentStd2<span class="main">:</span> <span class="quoted">ωconsistentStd2</span>
  <span class="keyword1"><span class="command">using</span></span> ωconsistent ωconsistent_impliesStd2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span> Minimal_Truth_Soundness<span class="antiquote">}</span></span>›</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
</pre>
</div><div id="Syntax_Arith">
<div class="head">
<h1>Theory Syntax_Arith</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Arithmetic Constructs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Less genereric syntax, more committed towards embedding arithmetics›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Syntax_Arith <span class="keyword2"><span class="keyword">imports</span></span> <a href="Syntax.html">Syntax</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹(An embedding of) the syntax of arithmetic, obtained by adding plus and times›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Syntax_Arith_aux <span class="main">=</span>
Syntax_with_Connectives_Rename
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
<span class="main">+</span>
Syntax_with_Numerals_and_Connectives_False_Disj
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
  <span class="quoted"><span class="free">fls</span></span>
  <span class="quoted"><span class="free">dsj</span></span>
  <span class="quoted"><span class="free">num</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
<span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">trm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">Var</span> <span class="free">FvarsT</span> <span class="free">substT</span> <span class="free">Fvars</span> <span class="free">subst</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">eql</span> <span class="free">cnj</span> <span class="free">imp</span> <span class="free">all</span> <span class="free">exi</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">fls</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">dsj</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">num</span>
<span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
<span class="free">zer</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
<span class="free">suc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> <span class="main">⇒</span> <span class="tfree">'trm</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
<span class="free">pls</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> <span class="main">⇒</span> <span class="tfree">'trm</span> <span class="main">⇒</span> <span class="tfree">'trm</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
<span class="free">tms</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> <span class="main">⇒</span> <span class="tfree">'trm</span> <span class="main">⇒</span> <span class="tfree">'trm</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span>
Fvars_zero<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="free">zer</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
substT_zer<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
  <span class="free">substT</span> <span class="free">zer</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">zer</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
suc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">suc</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
FvarsT_suc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span>
  <span class="free">FvarsT</span> <span class="main">(</span><span class="free">suc</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">FvarsT</span> <span class="bound">t</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
substT_suc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t1</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
  <span class="free">substT</span> <span class="main">(</span><span class="free">suc</span> <span class="bound">t1</span><span class="main">)</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">suc</span> <span class="main">(</span><span class="free">substT</span> <span class="bound">t1</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
pls<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">t2</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">pls</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
Fvars_pls<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">t2</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span>
  <span class="free">FvarsT</span> <span class="main">(</span><span class="free">pls</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="free">FvarsT</span> <span class="bound">t1</span> <span class="main">∪</span> <span class="free">FvarsT</span> <span class="bound">t2</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
substT_pls<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">t2</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
  <span class="free">substT</span> <span class="main">(</span><span class="free">pls</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">pls</span> <span class="main">(</span><span class="free">substT</span> <span class="bound">t1</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">substT</span> <span class="bound">t2</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
tms<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">t2</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">tms</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
Fvars_tms<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">t2</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span>
  <span class="free">FvarsT</span> <span class="main">(</span><span class="free">tms</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">=</span> <span class="free">FvarsT</span> <span class="bound">t1</span> <span class="main">∪</span> <span class="free">FvarsT</span> <span class="bound">t2</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
substT_tms<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">t2</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
  <span class="free">substT</span> <span class="main">(</span><span class="free">tms</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">tms</span> <span class="main">(</span><span class="free">substT</span> <span class="bound">t1</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">substT</span> <span class="bound">t2</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The embedding of numbers into our abstract notion of numerals
(not required to be surjective)›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Num</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'trm</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Num</span> <span class="main">0</span> <span class="main">=</span> <span class="free">zer</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">Num</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">suc</span> <span class="main">(</span><span class="free">Num</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span> Syntax_Arith_aux<span class="antiquote">}</span></span>›</span>


<span class="keyword1"><span class="command">locale</span></span> Syntax_Arith <span class="main">=</span>
Syntax_Arith_aux
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
  <span class="quoted"><span class="free">fls</span></span>
  <span class="quoted"><span class="free">dsj</span></span>
  <span class="quoted"><span class="free">num</span></span>
  <span class="quoted"><span class="free">zer</span></span> <span class="quoted"><span class="free">suc</span></span> <span class="quoted"><span class="free">pls</span></span> <span class="quoted"><span class="free">tms</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
<span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">trm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">Var</span> <span class="free">FvarsT</span> <span class="free">substT</span> <span class="free">Fvars</span> <span class="free">subst</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">eql</span> <span class="free">cnj</span> <span class="free">imp</span> <span class="free">all</span> <span class="free">exi</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">fls</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">dsj</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">num</span>
<span class="free">zer</span> <span class="free">suc</span> <span class="free">pls</span> <span class="free">tms</span>
<span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
<span class="comment1">― ‹We assume that numbers are the only numerals:›</span>
num_Num<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">num</span> <span class="main">=</span> range Num"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Num<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Num <span class="free">n</span> <span class="main">∈</span> <span class="free">num</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> num_Num <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> FvarsT_Num<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> substT_Num<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">substT</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span> <span class="free">t</span> <span class="free">x</span> <span class="main">=</span> Num <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> zer<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">zer</span> <span class="main">∈</span> <span class="free">num</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> suc_num<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">num</span> <span class="main">⟹</span> <span class="free">suc</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">num</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Num Num.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Num Num.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> imageE num_Num<span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Arithmetic Terms›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Arithmetic terms are inductively defined to contain the numerals and the variables
and be closed under the arithmetic operators:›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">atrm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 atrm_num<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∈</span> <span class="free">num</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∈</span> <span class="free">atrm</span>"</span></span>
<span class="main">|</span>atrm_Var<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">Var</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free">atrm</span>"</span></span>
<span class="main">|</span>atrm_suc<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∈</span> <span class="free">atrm</span> <span class="main">⟹</span> <span class="free">suc</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∈</span> <span class="free">atrm</span>"</span></span>
<span class="main">|</span>atrm_pls<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∈</span> <span class="free">atrm</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">∈</span> <span class="free">atrm</span> <span class="main">⟹</span> <span class="free">pls</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">∈</span> <span class="free">atrm</span>"</span></span>
<span class="main">|</span>atrm_tms<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∈</span> <span class="free">atrm</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">∈</span> <span class="free">atrm</span> <span class="main">⟹</span> <span class="free">tms</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">t'</span></span></span> <span class="main">∈</span> <span class="free">atrm</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> atrm_imp_trm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> atrm_trm<span class="main">:</span> <span class="quoted"><span class="quoted">"atrm <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> atrm_imp_trm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> zer_atrm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">zer</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Num_atrm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Num <span class="free">n</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> substT_atrm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">substT</span> <span class="free">r</span> <span class="free">t</span> <span class="free">x</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Whereas we did not assume the rich set of formula-substitution properties to hold
for all terms, we can prove that these properties hold for arithmetic terms.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Properties for arithmetic terms corresponding to the axioms for formulas:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> FvarsT_substT<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="main">(</span><span class="free">substT</span> <span class="free">s</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="free">s</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="free">s</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="free">t</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> substT_compose_eq_or<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">=</span> <span class="free">x2</span> <span class="main">∨</span> <span class="free">x2</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">substT</span> <span class="main">(</span><span class="free">substT</span> <span class="free">s</span> <span class="free">t1</span> <span class="free">x1</span><span class="main">)</span> <span class="free">t2</span> <span class="free">x2</span> <span class="main">=</span> <span class="free">substT</span> <span class="free">s</span> <span class="main">(</span><span class="free">substT</span> <span class="free">t1</span> <span class="free">t2</span> <span class="free">x2</span><span class="main">)</span> <span class="free">x1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">induct</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FvarsT_suc atrm_imp_trm substT substT_suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Fvars_pls UnCI atrm_imp_trm substT substT_pls<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Fvars_tms UnCI atrm_imp_trm substT substT_tms<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> substT_compose_diff<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">≠</span> <span class="free">x2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">substT</span> <span class="main">(</span><span class="free">substT</span> <span class="free">s</span> <span class="free">t1</span> <span class="free">x1</span><span class="main">)</span> <span class="free">t2</span> <span class="free">x2</span> <span class="main">=</span> <span class="free">substT</span> <span class="main">(</span><span class="free">substT</span> <span class="free">s</span> <span class="free">t2</span> <span class="free">x2</span><span class="main">)</span> <span class="main">(</span><span class="free">substT</span> <span class="free">t1</span> <span class="free">t2</span> <span class="free">x2</span><span class="main">)</span> <span class="free">x1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">induct</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atrm_imp_trm substT substT_suc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atrm_imp_trm substT substT_pls<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atrm_imp_trm substT substT_tms<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> substT_same_Var<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">substT</span> <span class="free">s</span> <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹... and corresponding to some corollaries we proved for formulas
(with essentially the same proofs):›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> in_FvarsT_substTD<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="main">(</span><span class="free">substT</span> <span class="free">r</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>
   <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="free">r</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="free">t</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> FvarsT_substT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> substT_compose_same<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="bound">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">t2</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
  <span class="free">substT</span> <span class="main">(</span><span class="free">substT</span> <span class="bound">s</span> <span class="bound">t1</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">t2</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">substT</span> <span class="bound">s</span> <span class="main">(</span><span class="free">substT</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> substT_compose_eq_or <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> substT_substT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> yy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">substT</span> <span class="main">(</span><span class="free">substT</span> <span class="free">s</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="free">t</span> <span class="free">y</span> <span class="main">=</span> <span class="free">substT</span> <span class="free">s</span> <span class="free">t</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> substT_compose_eq_or<span class="main">[</span><span class="operator">OF</span> s _ t x y<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">y</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> subst_notIn yy <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> substT_comp<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
  <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="main">⟹</span>
  <span class="free">substT</span> <span class="main">(</span><span class="free">substT</span> <span class="bound">s</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">substT</span> <span class="main">(</span><span class="free">substT</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">t</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> substT_compose_diff<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now the corresponding development of parallel substitution for arithmetic terms:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubstT_atrm<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="free">r</span> <span class="free">txs</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> psubstT_atrm<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubstT <span class="free">r</span> <span class="free">txs</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> txs_trm<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms atrm_trm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">≡</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
  <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> txs_trm <span class="keyword1"><span class="command">unfolding</span></span> us
  <span class="keyword1"><span class="command">using</span></span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_distinct<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="comment1">(* *)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command">unfolding</span></span> psubstT_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT_atrm<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_rawpsubst_su<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="main">(</span>rawpsubstT <span class="free">r</span> <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span>
       <span class="main">(</span><span class="free">FvarsT</span> <span class="free">r</span> <span class="main">-</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="free">FvarsT</span> <span class="bound">t</span> <span class="main">|</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">tx</span> <span class="skolem">txs</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> tx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tx</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">unfolding</span></span> tx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">χ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">χ</span> <span class="main">≡</span> <span class="free">substT</span> <span class="skolem">r</span> <span class="skolem">t</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="skolem">χ</span> <span class="main">=</span>  <span class="free">FvarsT</span> <span class="skolem">r</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="skolem">r</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="skolem">t</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">unfolding</span></span> χ_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tx t FvarsT_substT<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> χ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">χ</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">χ</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> χ_def <span class="keyword1"><span class="command">using</span></span> Cons.prems t x  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tx<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="main">(</span>rawpsubstT <span class="skolem">χ</span> <span class="skolem">txs</span><span class="main">)</span> <span class="main">⊆</span>
       <span class="main">(</span><span class="free">FvarsT</span> <span class="skolem">χ</span> <span class="main">-</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="skolem">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span>
       <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="free">FvarsT</span> <span class="bound">t</span> <span class="main">|</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">txs</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems χ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Cons.IH<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="free">FvarsT</span> <span class="skolem">r</span> <span class="main">-</span> insert <span class="skolem">x</span> <span class="main">(</span>snd <span class="main">`</span> set <span class="skolem">txs</span><span class="main">)</span> <span class="main">∪</span> <span class="main">⋃</span><span class="main">{</span><span class="free">FvarsT</span> <span class="bound">ta</span> <span class="main">|</span><span class="bound">ta</span><span class="main">.</span> <span class="main">∃</span><span class="bound">xa</span><span class="main">.</span> <span class="bound">ta</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="bound">xa</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">txs</span><span class="main">}</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⊆</span> <span class="var">?R</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 0 tx Cons.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="main">(</span>rawpsubstT <span class="skolem">χ</span> <span class="skolem">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="skolem">χ</span> <span class="main">=</span> <span class="free">FvarsT</span> <span class="skolem">r</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="skolem">r</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="skolem">t</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems t x <span class="keyword1"><span class="command">unfolding</span></span> χ_def <span class="keyword1"><span class="command">using</span></span> FvarsT_substT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tx χ_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> in_FvarsT_rawpsubstT_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="main">(</span>rawpsubstT <span class="free">r</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="main">-</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
     <span class="main">(</span><span class="free">y</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">{</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="main">|</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> Fvars_rawpsubst_su<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2-4<span class="main"><span class="main">)</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> FvarsT_rawpsubstT<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="bound">t</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="main">(</span>rawpsubstT <span class="free">r</span> <span class="free">txs</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">(</span><span class="free">FvarsT</span> <span class="free">r</span> <span class="main">-</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span>
       <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">txs</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> xt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="skolem">t</span> <span class="main">∧</span> snd <span class="main">`</span> set <span class="skolem">txs</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="skolem">r</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> <span class="free">FvarsT</span> <span class="skolem">t</span> <span class="main">-</span> snd <span class="main">`</span> set <span class="skolem">txs</span> <span class="main">=</span> <span class="free">FvarsT</span> <span class="skolem">r</span> <span class="main">-</span> insert <span class="skolem">x</span> <span class="main">(</span>snd <span class="main">`</span> set <span class="skolem">txs</span><span class="main">)</span> <span class="main">∪</span> <span class="free">FvarsT</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> x_txs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ta</span> <span class="bound">xa</span><span class="main">.</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">txs</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="bound">xa</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="main">(</span>map snd <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">χ</span></span> <span class="keyword2"><span class="keyword">where</span></span> χ_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">χ</span> <span class="main">≡</span> <span class="free">substT</span> <span class="skolem">r</span> <span class="skolem">t</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> χ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">χ</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">χ</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> χ_def <span class="keyword1"><span class="command">using</span></span> Cons.prems t x  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="main">(</span>rawpsubstT <span class="skolem">χ</span> <span class="skolem">txs</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">(</span><span class="free">FvarsT</span> <span class="skolem">χ</span> <span class="main">-</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="skolem">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span>
       <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="skolem">χ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">txs</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems χ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Cons.IH<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="skolem">χ</span> <span class="main">=</span> <span class="free">FvarsT</span> <span class="skolem">r</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="skolem">r</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="skolem">t</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems t x <span class="keyword1"><span class="command">unfolding</span></span> χ_def <span class="keyword1"><span class="command">using</span></span> FvarsT_substT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">ta</span> <span class="bound">xa</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">xa</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="skolem">r</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">ta</span> <span class="keyword1">else</span> <span class="main">{}</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">{</span><span class="skolem">f</span> <span class="bound">ta</span> <span class="bound">xa</span>  <span class="main">|</span><span class="bound">ta</span> <span class="bound">xa</span><span class="main">.</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
        <span class="skolem">f</span> <span class="skolem">t</span> <span class="skolem">x</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="skolem">f</span> <span class="bound">ta</span> <span class="bound">xa</span>  <span class="main">|</span><span class="bound">ta</span> <span class="bound">xa</span><span class="main">.</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">txs</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> snd <span class="main">`</span> set <span class="skolem">txs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">t</span> <span class="skolem">x</span> <span class="main">∩</span> snd <span class="main">`</span> set <span class="skolem">txs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> xt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">{</span><span class="keyword1">if</span> <span class="bound">xa</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="skolem">r</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">f</span> <span class="skolem">t</span> <span class="skolem">x</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">ta</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span> <span class="bound">ta</span> <span class="bound">xa</span><span class="main">.</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">txs</span><span class="main">}</span>
     <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="skolem">f</span> <span class="bound">ta</span> <span class="bound">xa</span> <span class="main">|</span> <span class="bound">ta</span> <span class="bound">xa</span><span class="main">.</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">txs</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> xt x_txs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="skolem">r</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">f</span> <span class="skolem">t</span> <span class="skolem">x</span>  <span class="main">-</span> snd <span class="main">`</span> set <span class="skolem">txs</span> <span class="main">∪</span>
    <span class="main">⋃</span> <span class="main">{</span><span class="keyword1">if</span> <span class="bound">xa</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="skolem">r</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">f</span> <span class="skolem">t</span> <span class="skolem">x</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">ta</span> <span class="keyword1">else</span> <span class="main">{}</span>
         <span class="main">|</span> <span class="bound">ta</span> <span class="bound">xa</span><span class="main">.</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">txs</span><span class="main">}</span> <span class="main">=</span>
        <span class="free">FvarsT</span> <span class="skolem">r</span> <span class="main">-</span> snd <span class="main">`</span> set <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span> <span class="main">∪</span>
    <span class="main">⋃</span> <span class="main">{</span><span class="skolem">f</span> <span class="bound">ta</span> <span class="bound">xa</span>  <span class="main">|</span><span class="bound">ta</span> <span class="bound">xa</span><span class="main">.</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> 3 4 6 <span class="keyword1"><span class="command">unfolding</span></span> Un_Diff2<span class="main">[</span><span class="operator">OF</span> 5<span class="main">]</span> Un_assoc <span class="keyword1"><span class="command">unfolding</span></span> Diff_Diff_Un <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a rawpsubstT.simps 1 2 χ_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> in_FvarsT_rawpsubstTD<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="main">(</span>rawpsubstT <span class="free">r</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="bound">t</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="main">-</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
     <span class="main">(</span><span class="free">y</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">{</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> FvarsT_rawpsubstT assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> FvarsT_psubstT<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="main">(</span>psubstT <span class="free">r</span> <span class="free">txs</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">(</span><span class="free">FvarsT</span> <span class="free">r</span> <span class="main">-</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span>
       <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> txs_trm<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">≡</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
  <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> txs_trm <span class="keyword1"><span class="command">unfolding</span></span> us
  <span class="keyword1"><span class="command">using</span></span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">aa</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> set <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">⟹</span>
     <span class="bound">aa</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="bound">aa</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> us_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def Int_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span> <span class="bound">ac</span> <span class="bound">bc</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> set <span class="skolem">us</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="bound">ac</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">ac</span><span class="main">,</span> <span class="bound">bc</span><span class="main">)</span> <span class="main">∉</span> set <span class="free">txs</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> us_facts<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def Int_def<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">χ</span></span> <span class="keyword2"><span class="keyword">where</span></span> χ_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">χ</span> <span class="main">≡</span> rawpsubstT <span class="free">r</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> χ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">χ</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> χ_def
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">using</span></span> us_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubstT_atrm<span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">χ</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> χ <span class="main">=</span> χ this
  <span class="keyword1"><span class="command">have</span></span> set_us<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">=</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> us_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> snd_set_zip<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> set_txs<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">txs</span> <span class="main">=</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> us_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> snd_set_zip_map_snd<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> <span class="free">Var</span> <span class="bound">u</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> us_facts set_zip_leftD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> 00<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span>
     <span class="main">⟷</span>  <span class="main">(</span><span class="main">∃</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">var</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> <span class="free">Var</span> <span class="bound">u</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> us_facts set_zip_leftD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="skolem">χ</span> <span class="main">=</span>
        <span class="free">FvarsT</span> <span class="free">r</span> <span class="main">-</span> snd <span class="main">`</span> set <span class="free">txs</span> <span class="main">∪</span>
        <span class="main">⋃</span><span class="main">{</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span><span class="bound">t</span> <span class="bound">x</span><span class="main">.</span>
             <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> χ_def set_txs <span class="keyword1"><span class="command">using</span></span> assms us_facts set_txs
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> FvarsT_rawpsubstT<span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
    <span class="free">FvarsT</span> <span class="free">r</span> <span class="main">-</span> snd <span class="main">`</span> set <span class="free">txs</span> <span class="main">∪</span>
    <span class="main">⋃</span><span class="main">{</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="main">{</span><span class="bound">u</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span><span class="bound">u</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> 00<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> FvarsT_Var<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="skolem">χ</span> <span class="main">=</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="main">(</span>rawpsubstT <span class="skolem">χ</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span><span class="free">FvarsT</span> <span class="skolem">χ</span> <span class="main">-</span> set <span class="skolem">us</span><span class="main">)</span> <span class="main">∪</span>
        <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="keyword1">if</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="skolem">χ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span> <span class="bound">t</span> <span class="bound">u</span> <span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> us_facts set_us <span class="keyword1"><span class="command">using</span></span> assms χ <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> FvarsT_rawpsubstT<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> us_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> us_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> us_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="skolem">χ</span> <span class="main">-</span> set <span class="skolem">us</span> <span class="main">=</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="main">-</span> snd <span class="main">`</span> set <span class="free">txs</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">using</span></span> set_zip_leftD us_facts<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">using</span></span> set_zip_leftD us_facts<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">using</span></span> us_facts<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="keyword1">if</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="skolem">χ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span> <span class="bound">t</span> <span class="bound">u</span> <span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span>
   <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xx</span> <span class="skolem">tt</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> xx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="skolem">χ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="skolem">tt</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">tt</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> ttin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="free">txs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ty <span class="keyword1"><span class="command">using</span></span> set_zip_leftD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> yin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="skolem">us</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ty <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> set_zip_D<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> yvar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> us_facts yin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ynotin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> snd <span class="main">`</span> set <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> yin us_facts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">{</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span><span class="bound">t</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="skolem">χ</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> y <span class="main">=</span> True
      <span class="keyword1"><span class="command">hence</span></span> xx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="skolem">tt</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xx <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> xr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> yx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Var</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> y ynotin <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> yx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="skolem">us</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> yvar us_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> inj_on_set_zip_map<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inj_on_Var yx<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">tt</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> set_zip_map_fst_snd<span class="main"><span class="main">[</span></span><span class="operator">OF</span> yx ty<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>›</span></span> us_facts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> xx xr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">insert</span> xx<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="skolem">tt</span> <span class="skolem">xx</span>
    <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">xx</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="skolem">tt</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> tx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">tt</span><span class="main">,</span> <span class="skolem">xx</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> xxsnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">∈</span> snd <span class="main">`</span> set <span class="free">txs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> uin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> set <span class="skolem">us</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> uxx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">xx</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="skolem">us</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> xxsnd in_set_impl_in_set_zip2 length_map set_map set_zip_leftD us_facts<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> uvar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> us_facts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">{</span><span class="keyword1">if</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="skolem">χ</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span><span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="free">r</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> xx <span class="main">=</span> True
      <span class="keyword1"><span class="command">hence</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="skolem">tt</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">xx</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> set_zip_length_map<span class="main"><span class="main">[</span></span><span class="operator">OF</span> uxx<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> us_facts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> uχ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="skolem">χ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> uin xx uvar <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ttu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">tt</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> set_zip_map_fst_snd2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> uxx tx<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> uχ ttu y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">insert</span> y<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> psubstT_def Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> χ_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 1 2 3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> in_FvarsT_psubstTD<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="main">(</span>psubstT <span class="free">r</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="free">r</span> <span class="main">-</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span>
           <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="keyword1">then</span> <span class="free">FvarsT</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="main">{}</span> <span class="main">|</span> <span class="bound">t</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms FvarsT_psubstT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> substT2_fresh_switch<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">substT</span> <span class="main">(</span><span class="free">substT</span> <span class="free">r</span> <span class="free">s</span> <span class="free">y</span><span class="main">)</span> <span class="free">t</span> <span class="free">x</span> <span class="main">=</span> <span class="free">substT</span> <span class="main">(</span><span class="free">substT</span> <span class="free">r</span> <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="free">s</span> <span class="free">y</span>"</span></span>   <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> substT_compose_diff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubst2_fresh_switch<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="free">r</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">y</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> rawpsubstT <span class="free">r</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">y</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> substT2_fresh_switch<span class="main">)</span>

<span class="comment1">(* this actually works for any trms, does not need atrms: *)</span>
<span class="keyword1"><span class="command">lemma</span></span> rawpsubstT_compose<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs1</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs1</span><span class="main">)</span> <span class="main">⊆</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs2</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs2</span><span class="main">)</span> <span class="main">⊆</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">t</span> <span class="free">txs1</span><span class="main">)</span> <span class="free">txs2</span> <span class="main">=</span> rawpsubstT <span class="free">t</span> <span class="main">(</span><span class="free">txs1</span> <span class="main">@</span> <span class="free">txs2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">txs1</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">txs2</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> tx1 txs1 txs2 t <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tx1</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubstT_subst_fresh_switch<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">.</span> <span class="free">y</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="bound">t</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span><span class="free">substT</span> <span class="free">r</span> <span class="free">s</span> <span class="free">y</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> rawpsubstT <span class="free">r</span> <span class="main">(</span><span class="free">txs</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">y</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">tx</span> <span class="skolem">txs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> tx<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tx</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">unfolding</span></span> tx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="skolem">r</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span> <span class="main">=</span> rawpsubstT <span class="skolem">r</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">txs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubstT <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="main">[</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="skolem">txs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="skolem">r</span> <span class="main">[</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> rawpsubstT <span class="skolem">r</span> <span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst2_fresh_switch<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="skolem">txs</span> <span class="main">=</span> rawpsubstT <span class="skolem">r</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">txs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubstT_compose<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubstT <span class="main">(</span><span class="free">substT</span> <span class="skolem">r</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">txs</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubstT <span class="skolem">r</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> tx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> substT_rawpsubstT_fresh_switch<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">.</span> <span class="free">y</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="bound">t</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="free">r</span> <span class="free">txs</span><span class="main">)</span> <span class="free">s</span> <span class="free">y</span> <span class="main">=</span> rawpsubstT <span class="free">r</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">#</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">tx</span> <span class="skolem">txs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> tx<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tx</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">unfolding</span></span> tx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="main">(</span><span class="free">substT</span> <span class="skolem">r</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">txs</span><span class="main">)</span> <span class="skolem">s</span> <span class="skolem">y</span> <span class="main">=</span> rawpsubstT <span class="main">(</span><span class="free">substT</span> <span class="skolem">r</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Cons.IH<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubstT <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubstT <span class="skolem">r</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubstT_compose<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubstT <span class="skolem">r</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">txs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubstT <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="skolem">txs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubstT_compose<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="skolem">r</span> <span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> rawpsubstT <span class="skolem">r</span> <span class="main">[</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubst2_fresh_switch<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="main">[</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="skolem">txs</span> <span class="main">=</span> rawpsubstT <span class="skolem">r</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">txs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubstT_compose<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubstT_compose_freshVar<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="free">txs</span> <span class="main">⟹</span> snd <span class="main">(</span><span class="free">txs</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">txs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"length <span class="free">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
  <span class="quoted"><span class="quoted">"distinct <span class="free">us</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">r</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="free">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="free">us</span><span class="main">)</span> <span class="main">=</span> rawpsubstT <span class="free">r</span> <span class="free">txs</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">us</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">tx</span> <span class="skolem">txs</span> <span class="skolem">uus</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> tx<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tx</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> uus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">uus</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">#</span> <span class="skolem">us</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">uus</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="skolem">r</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="skolem">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="skolem">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="skolem">txs</span>"</span></span>
  <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> u_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="skolem">r</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="skolem">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="skolem">txs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> set <span class="skolem">us</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">bb</span> <span class="bound">xaa</span> <span class="bound">ab</span><span class="main">.</span> <span class="bound">bb</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">xaa</span><span class="main">)</span> <span class="main">⟹</span>
        <span class="main">(</span><span class="bound">ab</span><span class="main">,</span> <span class="bound">bb</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">txs</span> <span class="main">⟹</span> <span class="bound">xaa</span> <span class="main">∉</span> set <span class="skolem">us</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> us_facts<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?uxs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span><span class="free">substT</span> <span class="skolem">r</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="var">?uxs</span> <span class="main">=</span> rawpsubstT <span class="skolem">r</span> <span class="main">(</span><span class="var">?uxs</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Cons.prems u_facts <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> rawpsubstT_subst_fresh_switch<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?uuxs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">uus</span><span class="main">)</span> <span class="main">(</span>map snd <span class="main">(</span><span class="skolem">tx</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tus</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map fst <span class="skolem">txs</span><span class="main">)</span> <span class="skolem">us</span>"</span></span>  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ttxs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map fst <span class="main">(</span><span class="skolem">tx</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">uus</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> in_FvarsT_rawpsubstTD<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons.prems  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> us_facts<span class="main">(</span>1<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span> Cons.prems<span class="main">(</span>7<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> u_facts<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">tt</span><span class="main">,</span> <span class="skolem">xx</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">txs</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">∈</span> <span class="free">FvarsT</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">tt</span> <span class="skolem">xx</span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_conv_nth mem_Collect_eq
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">tt</span><span class="main">,</span> <span class="skolem">xx</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">txs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">txs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> that Cons.prems<span class="main">(</span>4<span class="main">)</span> Cons.prems<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span><span class="main">]</span> tx
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_Cons' <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sym<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> 00<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="var">?uuxs</span><span class="main">)</span> <span class="var">?ttxs</span> <span class="main">=</span> rawpsubstT <span class="main">(</span><span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="main">(</span><span class="var">?uxs</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span> <span class="var">?tus</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="skolem">r</span> <span class="main">(</span><span class="var">?uxs</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> rawpsubstT <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">[</span><span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubstT_compose<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">[</span><span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="main">(</span><span class="var">?uxs</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="main">=</span>
                <span class="free">substT</span> <span class="main">(</span><span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="var">?uxs</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> substT_substT<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT_atrm<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubstT <span class="skolem">r</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">#</span> <span class="var">?uxs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems 3
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> substT_rawpsubstT_fresh_switch<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D FvarsT_VarD<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>  rawpsubstT <span class="skolem">r</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="var">?uxs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubstT <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="var">?uxs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubstT_compose<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span><span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="main">(</span><span class="var">?uxs</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span> <span class="var">?tus</span> <span class="main">=</span>
                rawpsubstT <span class="main">(</span>rawpsubstT <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="var">?uuxs</span><span class="main">)</span> <span class="var">?ttxs</span> <span class="main">=</span> rawpsubstT <span class="main">(</span>rawpsubstT <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 00 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubstT <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="main">[</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="skolem">txs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> Cons.IH<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_leI le_imp_less_Suc length_Cons nth_Cons_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D in_FvarsT_substTD
             <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubstT_compose_freshVar2_aux<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> ts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ts</span> <span class="main">⊆</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>  <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>  <span class="quoted"><span class="quoted">"distinct <span class="free">us</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>set <span class="free">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">∩</span> set <span class="free">xs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> vs_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>  <span class="quoted"><span class="quoted">"distinct <span class="free">vs</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>set <span class="free">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">∩</span> set <span class="free">xs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">us</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">vs</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ts</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="comment1">(* Extra hypothesis, only to get induction through: *)</span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">∩</span> set <span class="free">vs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">r</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="free">us</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">ts</span> <span class="free">us</span><span class="main">)</span> <span class="main">=</span>
       rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">r</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="free">vs</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">ts</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">ts</span></span> <span class="quoted"><span class="free">us</span></span> <span class="quoted"><span class="free">vs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">r</span> <span class="skolem">tts</span> <span class="skolem">uus</span> <span class="skolem">vvs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">ts</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> tts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tts</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">#</span> <span class="skolem">ts</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ts</span> <span class="main">=</span> length <span class="skolem">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> uus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">uus</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">#</span> <span class="skolem">us</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="skolem">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> vvs<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vvs</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">vs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lvs<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">vs</span> <span class="main">=</span> length <span class="skolem">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">uus</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">vvs</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">tts</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tts</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">uus</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">vvs</span></span><span class="main">)</span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rux</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">substT</span> <span class="skolem">r</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>   <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rvx</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">substT</span> <span class="skolem">r</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span>rawpsubstT <span class="var">?rux</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="skolem">ts</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span>
           rawpsubstT <span class="main">(</span>rawpsubstT <span class="var">?rux</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="skolem">ts</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Cons.IH<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> FvarsT_substT<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="var">?rux</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span>
           <span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Cons.prems
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> substT_rawpsubstT_fresh_switch<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> 11<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="var">?rvx</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span>
           <span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Cons.prems
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> substT_rawpsubstT_fresh_switch<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">substT</span> <span class="main">(</span><span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="main">=</span>
        <span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Cons.prems
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> substT_substT<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT_atrm<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main"><span class="main">]</span></span>
           <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D in_FvarsT_rawpsubstT_imp FvarsT_VarD <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> FvarsT_rawpsubstT<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">substT</span> <span class="main">(</span><span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Cons.prems
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> substT_substT<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT_atrm<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D in_FvarsT_rawpsubstT_imp FvarsT_VarD
           <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> FvarsT_rawpsubstT<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span>
  2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">substT</span> <span class="main">(</span><span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="main">=</span>
      <span class="free">substT</span> <span class="main">(</span><span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">v</span>"</span></span>  <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span><span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="var">?rux</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>zip <span class="skolem">ts</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span>
        <span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="main">(</span>rawpsubstT <span class="var">?rux</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="skolem">ts</span> <span class="skolem">us</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Cons.prems
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> substT_rawpsubstT_fresh_switch<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT_atrm<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?rux</span></span></span><span class="main"><span class="main">]</span></span> substT_atrm <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="main">(</span>rawpsubstT <span class="var">?rux</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="skolem">ts</span> <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubstT <span class="main">(</span><span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="var">?rux</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>zip <span class="skolem">ts</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Cons.prems
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> substT_rawpsubstT_fresh_switch<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT_atrm<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?rux</span></span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubstT <span class="main">(</span><span class="free">substT</span> <span class="main">(</span><span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>zip <span class="skolem">ts</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> 1 <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubstT <span class="main">(</span><span class="free">substT</span> <span class="main">(</span><span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="skolem">r</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>zip <span class="skolem">ts</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> 2 <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> rawpsubstT <span class="main">(</span><span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="var">?rvx</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>zip <span class="skolem">ts</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> 11 <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span><span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="var">?rux</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>zip <span class="skolem">ts</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span>
        rawpsubstT <span class="main">(</span><span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="var">?rvx</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>zip <span class="skolem">ts</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="comment1">(* ... now getting rid of the disjointness hypothesis: *)</span>
<span class="keyword1"><span class="command">lemma</span></span> rawpsubstT_compose_freshVar2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> ts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ts</span> <span class="main">⊆</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>  <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>  <span class="quoted"><span class="quoted">"distinct <span class="free">us</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>set <span class="free">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="free">us</span> <span class="main">∩</span> set <span class="free">xs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> vs_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>  <span class="quoted"><span class="quoted">"distinct <span class="free">vs</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>set <span class="free">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="free">vs</span> <span class="main">∩</span> set <span class="free">xs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">us</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">vs</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ts</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">r</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="free">us</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">ts</span> <span class="free">us</span><span class="main">)</span> <span class="main">=</span>
       rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">r</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="free">vs</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">ts</span> <span class="free">vs</span><span class="main">)</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ts_trm<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ts</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ws</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">=</span> getFrN <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">us</span> <span class="main">@</span> <span class="free">vs</span><span class="main">)</span> <span class="main">(</span><span class="free">r</span> <span class="main">#</span> <span class="free">ts</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ws_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>  <span class="quoted"><span class="quoted">"distinct <span class="skolem">ws</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>set <span class="free">ts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">∩</span> set <span class="free">xs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">∩</span> set <span class="free">us</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ws</span> <span class="main">∩</span> set <span class="free">vs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"length <span class="skolem">ws</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> ts_trm assms<span class="main">(</span>3-17<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> ws_def
   <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">us</span> <span class="main">@</span> <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> <span class="free">ts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span>"</span></span><span class="main">]</span>
        getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">us</span> <span class="main">@</span> <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> <span class="free">ts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span>"</span></span><span class="main">]</span>
        getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">us</span> <span class="main">@</span> <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> <span class="free">ts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">@</span> <span class="free">us</span> <span class="main">@</span> <span class="free">vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> <span class="free">ts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">r</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">ws</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="free">ts</span> <span class="skolem">ws</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ws_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubstT_compose_freshVar2_aux<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?R</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ws_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubstT_compose_freshVar2_aux<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> in_fst_image<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="free">AB</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">AB</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="comment1">(* For many cases, the simpler rawpsubstT can replace psubst: *)</span>
<span class="keyword1"><span class="command">lemma</span></span> psubstT_eq_rawpsubstT<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="comment1">(* ... namely, when the substituted variables do not belong to trms substituted for previous variables: *)</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="free">txs</span> <span class="main">⟹</span> snd <span class="main">(</span><span class="free">txs</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">txs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubstT <span class="free">r</span> <span class="free">txs</span> <span class="main">=</span> rawpsubstT <span class="free">r</span> <span class="free">txs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> txs_trm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">note</span></span> frt <span class="main">=</span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> fr <span class="main">=</span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> var <span class="main">=</span>  getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> l <span class="main">=</span> getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">≡</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
  <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span> txs_trm <span class="keyword1"><span class="command">unfolding</span></span> us

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> frt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> frt <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_fst_image Int_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> prod.collapse<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> var <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_fst_image Int_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> rawpsubstT_compose_freshVar assms us_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> psubstT_def Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Some particular cases: *)</span>
<span class="keyword1"><span class="command">lemma</span></span> psubstT_eq_substT<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubstT <span class="free">r</span> <span class="main">[</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="free">substT</span> <span class="free">r</span> <span class="free">t</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"psubstT <span class="free">r</span> <span class="main">[</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> rawpsubstT <span class="free">r</span> <span class="main">[</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> psubstT_eq_rawpsubstT<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubstT_eq_rawpsubst2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">≠</span> <span class="free">x2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubstT <span class="free">r</span> <span class="main">[</span><span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="free">x1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t2</span><span class="main">,</span><span class="free">x2</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> rawpsubstT <span class="free">r</span> <span class="main">[</span><span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="free">x1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t2</span><span class="main">,</span><span class="free">x2</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">using</span></span> less_SucE <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> psubstT_eq_rawpsubstT<span class="main">)</span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubstT_eq_rawpsubst3<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x3</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t3</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">≠</span> <span class="free">x2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">≠</span> <span class="free">x3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">≠</span> <span class="free">x3</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x3</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x3</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubstT <span class="free">r</span> <span class="main">[</span><span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="free">x1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t2</span><span class="main">,</span><span class="free">x2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t3</span><span class="main">,</span><span class="free">x3</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> rawpsubstT <span class="free">r</span> <span class="main">[</span><span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="free">x1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t2</span><span class="main">,</span><span class="free">x2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t3</span><span class="main">,</span><span class="free">x3</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms less_SucE less_Suc_eq_0_disj
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> psubstT_eq_rawpsubstT<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> psubstT_eq_rawpsubst4<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x3</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x4</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t3</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t4</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">≠</span> <span class="free">x2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">≠</span> <span class="free">x3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">≠</span> <span class="free">x3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">≠</span> <span class="free">x4</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">≠</span> <span class="free">x4</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x3</span> <span class="main">≠</span> <span class="free">x4</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x3</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x3</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x4</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x4</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x4</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t3</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubstT <span class="free">r</span> <span class="main">[</span><span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="free">x1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t2</span><span class="main">,</span><span class="free">x2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t3</span><span class="main">,</span><span class="free">x3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t4</span><span class="main">,</span><span class="free">x4</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> rawpsubstT <span class="free">r</span> <span class="main">[</span><span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="free">x1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t2</span><span class="main">,</span><span class="free">x2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t3</span><span class="main">,</span><span class="free">x3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t4</span><span class="main">,</span><span class="free">x4</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms less_SucE less_Suc_eq_0_disj
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> psubstT_eq_rawpsubstT<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubstT_same_Var<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="free">r</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> psubstT_same_Var<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubstT <span class="free">r</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"psubstT <span class="free">r</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> rawpsubstT <span class="free">r</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">Var</span> <span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms FvarsT_Var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> <span class="main">_</span>"</span></span><span class="main">]</span> nth_mem<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">xs</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> psubstT_eq_rawpsubstT<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def distinct_conv_nth <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> FvarsT_VarD<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* The following holds for all trms, so no need to prove it for a trms: *)</span>
<span class="keyword1"><span class="command">thm</span></span> psubstT_notIn

<span class="comment1">(***)</span>

<span class="comment1">(* Behavior of psubst w.r.t. equality formulas: *)</span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubst_eql<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">eql</span> <span class="main">(</span>rawpsubstT <span class="free">t1</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>rawpsubstT <span class="free">t2</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t1</span></span> <span class="quoted"><span class="free">t2</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> tx txs t1 t2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tx</span></span><span class="main">)</span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_eql<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubst <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">eql</span> <span class="main">(</span>psubstT <span class="free">t1</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>psubstT <span class="free">t2</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> t12<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">≡</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">t1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">t2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
  <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> t12 <span class="keyword1"><span class="command">unfolding</span></span> us
  <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vs1</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs1</span> <span class="main">≡</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="free">t1</span> <span class="main">#</span> map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> vs1_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span>  <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">t1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"length <span class="skolem">vs1</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
  <span class="quoted"><span class="quoted">"distinct <span class="skolem">vs1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> t12 <span class="keyword1"><span class="command">unfolding</span></span> vs1
  <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs2</span> <span class="main">≡</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="free">t2</span> <span class="main">#</span> map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> vs2_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span>  <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">t2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"length <span class="skolem">vs2</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
  <span class="quoted"><span class="quoted">"distinct <span class="skolem">vs2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> t12 <span class="keyword1"><span class="command">unfolding</span></span> vs2
  <span class="keyword1"><span class="command">using</span></span> getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tus</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?uxs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="var">?uxs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">=</span> <span class="free">eql</span> <span class="main">(</span>rawpsubstT <span class="free">t1</span> <span class="var">?uxs</span><span class="main">)</span> <span class="main">(</span>rawpsubstT <span class="free">t2</span> <span class="var">?uxs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rawpsubst_eql<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> set_zip_rightD<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> set_zip_leftD<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubst <span class="var">?e</span> <span class="var">?tus</span> <span class="main">=</span>
     <span class="free">eql</span> <span class="main">(</span>rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">t1</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span><span class="main">)</span> <span class="main">(</span>rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">t2</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> e <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> rawpsubst_eql<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">t1</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span> <span class="main">=</span>
          rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">t1</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs1</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">vs1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms us_facts vs1_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubstT_compose_freshVar2<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">t2</span> <span class="var">?uxs</span><span class="main">)</span> <span class="var">?tus</span> <span class="main">=</span>
         rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">t2</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs2</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">vs2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms us_facts vs2_facts
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubstT_compose_freshVar2<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> psubstT_def psubst_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> vs1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> vs2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 0 1 2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* psubst versus the exists-unique quantifier: *)</span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_exu<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> atrm"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> snd <span class="main">`</span> set <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">t</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="free">txs</span><span class="main">.</span> <span class="free">FvarsT</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubst <span class="main">(</span>exu <span class="free">x</span> <span class="free">φ</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> exu <span class="free">x</span> <span class="main">(</span>psubst <span class="free">φ</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> atrm_trm subset_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> assms1 <span class="main">=</span> assms<span class="main">(</span>1-3<span class="main">)</span> assms<span class="main">(</span>5-7<span class="main">)</span> f
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≡</span> getFr <span class="main">(</span><span class="free">x</span> <span class="main">#</span> map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> u_facts<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="free">x</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> snd <span class="main">`</span> set <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">t</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="free">txs</span><span class="main">.</span> <span class="free">FvarsT</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> u <span class="keyword1"><span class="command">using</span></span> f getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">#</span> map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">φ</span><span class="main">]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"psubst <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">subst</span> <span class="main">(</span>psubst <span class="free">φ</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> psubst_subst_fresh_switch f<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f assms u_facts
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> exu_def_var<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="quoted">"psubst <span class="free">φ</span> <span class="free">txs</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> in_Fvars_psubstD <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> exu_def_var<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main"><span class="main">]</span></span> <span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* psubst versus the arithmetic trm constructors: *)</span>

<span class="comment1">(* We already have: *)</span>
<span class="keyword1"><span class="command">thm</span></span> psubstT_Var_not<span class="main">[</span><span class="operator">no_vars</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubstT_Var_in<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="free">txs</span> <span class="main">⟹</span> snd <span class="main">(</span><span class="free">txs</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">txs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">txs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">tx</span> <span class="skolem">txs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> tx<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tx</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tx</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> 00<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">FvarsT</span> <span class="skolem">t</span> <span class="main">∩</span> snd <span class="main">`</span> set <span class="skolem">txs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Cons.prems<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">_</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_conv_nth<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span><span class="free">substT</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">txs</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>True <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="main">(</span>map snd <span class="main">(</span><span class="skolem">tx</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">tx</span> <span class="main">#</span> <span class="skolem">txs</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> image_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons.prems 00 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">substT</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">Var</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> substT_notIn<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="skolem">txs</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> Cons.IH<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_Cons less_Suc_eq_0_disj nth_Cons_Suc<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> psubstT_Var_in<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubstT <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">≡</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span> <span class="main">#</span> map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> set <span class="skolem">us</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
  <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> us
  <span class="keyword1"><span class="command">using</span></span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">y</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">y</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">y</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">txs</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">txs</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 00<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="free">txs</span> <span class="main">⟹</span> <span class="free">txs</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">txs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>›</span></span> distinct_Ex1 nth_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> 000<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">j</span> <span class="bound">ia</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="free">txs</span> <span class="main">⟹</span> <span class="bound">ia</span> <span class="main">&lt;</span> length <span class="free">txs</span> <span class="main">⟹</span> snd <span class="main">(</span><span class="free">txs</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">us</span> <span class="main">!</span> <span class="bound">ia</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> assms us_facts
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntI empty_iff length_map list.set_map nth_map nth_mem<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ii</span> <span class="bound">jj</span><span class="main">.</span> <span class="bound">ii</span> <span class="main">&lt;</span> <span class="bound">jj</span> <span class="main">⟹</span> <span class="bound">jj</span> <span class="main">&lt;</span> length <span class="free">txs</span> <span class="main">⟹</span> <span class="skolem">us</span> <span class="main">!</span> <span class="bound">ii</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nth_mem us_facts<span class="main">(</span>1<span class="main">)</span> us_facts<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="free">txs</span> <span class="main">⟹</span> <span class="skolem">us</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">txs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> us_facts<span class="main">(</span>2<span class="main">,</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Int_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">Var</span> <span class="main">(</span><span class="skolem">us</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms us_facts
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubstT_Var_in<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_set_conv_nth <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span>rawpsubstT <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command">using</span></span> assms us_facts
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubstT_Var_in<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_set_conv_nth <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> psubstT_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubstT_Var_Cons_aux<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm"</span></span>
<span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> snd <span class="main">`</span> set <span class="free">txs</span>"</span></span>
<span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubstT <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">#</span> <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> psubstT <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">txs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> txs_trm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> assms1 <span class="main">=</span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> assms<span class="main">(</span>6-8<span class="main">)</span> txs_trm

  <span class="keyword1"><span class="command">note</span></span> fvt <span class="main">=</span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">#</span> map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">y</span> <span class="main">#</span> <span class="free">t</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> var <span class="main">=</span> getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">#</span> map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">y</span> <span class="main">#</span> <span class="free">t</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> l <span class="main">=</span> getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">#</span> map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">y</span> <span class="main">#</span> <span class="free">t</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">uus</span></span> <span class="keyword2"><span class="keyword">where</span></span> uus<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="skolem">uus</span> <span class="main">≡</span> getFrN <span class="main">(</span><span class="free">x</span> <span class="main">#</span> map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span> <span class="main">#</span> <span class="free">t</span> <span class="main">#</span> map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> uus_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">uus</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">uus</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">uus</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">uus</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> set <span class="skolem">uus</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> set <span class="skolem">uus</span>"</span></span>
  <span class="quoted"><span class="quoted">"length <span class="skolem">uus</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"distinct <span class="skolem">uus</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms1 <span class="keyword1"><span class="command">unfolding</span></span> uus
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> fvt <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_fst_image Int_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> prod.collapse<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> var <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_fst_image Int_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> fvt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> var <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_fst_image Int_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> fvt <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_fst_image Int_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> uus_us<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">uus</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">#</span> <span class="skolem">us</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> uus_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">uus</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> set <span class="skolem">us</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> set <span class="skolem">us</span>"</span></span>
  <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
  <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> u_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span><span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="free">x</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> set <span class="skolem">us</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> uus_facts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">note</span></span> fvt <span class="main">=</span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">y</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> var <span class="main">=</span> getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">y</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> l <span class="main">=</span> getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">y</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">≡</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span> <span class="main">#</span>  map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> vs_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> set <span class="skolem">vs</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"length <span class="skolem">vs</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
  <span class="quoted"><span class="quoted">"distinct <span class="skolem">vs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms1 <span class="keyword1"><span class="command">unfolding</span></span> vs
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> fvt <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_fst_image Int_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> prod.collapse<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> fvt l <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> var <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Int_def in_fst_image<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">substT</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">u</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">Var</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms u_facts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">substT</span> <span class="main">(</span>rawpsubstT <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="skolem">u</span> <span class="main">=</span>
           rawpsubstT <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms u_facts us_facts
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> substT_notIn<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D in_FvarsT_rawpsubstT_imp FvarsT_VarD<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span>rawpsubstT <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span>
    rawpsubstT <span class="main">(</span>rawpsubstT <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms vs_facts us_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubstT_compose_freshVar2<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> psubstT_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def uus<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> vs<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 0 1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Simplification rules for parallel substitution:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubstT_Var_Cons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> atrm <span class="main">⟹</span>
 snd <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">var</span> <span class="main">⟹</span> fst <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> atrm <span class="main">⟹</span> distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> snd <span class="main">`</span> set <span class="free">txs</span> <span class="main">⟹</span>
 psubstT <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">#</span> <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="keyword1">then</span> <span class="free">t</span> <span class="keyword1">else</span> psubstT <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> psubstT_Var_in<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> psubstT_Var_Cons_aux<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubstT_zer<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubstT <span class="free">zer</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">zer</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> psubstT_num<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubstT_suc<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span><span class="free">suc</span> <span class="free">r</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">suc</span> <span class="main">(</span>rawpsubstT <span class="free">r</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> tx txs r <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tx</span></span><span class="main">)</span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubstT_suc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubstT <span class="main">(</span><span class="free">suc</span> <span class="free">r</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">suc</span> <span class="main">(</span>psubstT <span class="free">r</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 000<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">≡</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
  <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> 000 <span class="keyword1"><span class="command">unfolding</span></span> us
  <span class="keyword1"><span class="command">using</span></span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">≡</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> vs_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">r</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"length <span class="skolem">vs</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
  <span class="quoted"><span class="quoted">"distinct <span class="skolem">vs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> 000 <span class="keyword1"><span class="command">unfolding</span></span> vs
  <span class="keyword1"><span class="command">using</span></span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span><span class="free">suc</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
           <span class="free">suc</span> <span class="main">(</span>rawpsubstT <span class="free">r</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms vs_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubstT_suc<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span>rawpsubstT <span class="main">(</span><span class="free">suc</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span>
        rawpsubstT <span class="main">(</span>rawpsubstT <span class="main">(</span><span class="free">suc</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms us_facts vs_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubstT_compose_freshVar2<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">suc</span> <span class="main">(</span>rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">r</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">vs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command">using</span></span> assms vs_facts <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> rawpsubstT_suc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Int_def<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> vs<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> psubstT_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubstT_pls<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span><span class="free">pls</span> <span class="free">r1</span> <span class="free">r2</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">pls</span> <span class="main">(</span>rawpsubstT <span class="free">r1</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>rawpsubstT <span class="free">r2</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">r1</span></span> <span class="quoted"><span class="free">r2</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> tx txs r <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tx</span></span><span class="main">)</span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubstT_pls<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubstT <span class="main">(</span><span class="free">pls</span> <span class="free">r1</span> <span class="free">r2</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">pls</span> <span class="main">(</span>psubstT <span class="free">r1</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>psubstT <span class="free">r2</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 000<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">≡</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="free">pls</span> <span class="free">r1</span> <span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">r1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">r2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
  <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> 000 <span class="keyword1"><span class="command">unfolding</span></span> us
  <span class="keyword1"><span class="command">using</span></span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="free">r1</span> <span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="free">r1</span> <span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="free">r1</span> <span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="free">r1</span> <span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="free">r1</span> <span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vs1</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs1</span> <span class="main">≡</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="free">r1</span> <span class="main">#</span> map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> vs1_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">r1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"length <span class="skolem">vs1</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
  <span class="quoted"><span class="quoted">"distinct <span class="skolem">vs1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> 000 <span class="keyword1"><span class="command">unfolding</span></span> vs1
  <span class="keyword1"><span class="command">using</span></span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs2</span> <span class="main">≡</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> vs2_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">r2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"length <span class="skolem">vs2</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
  <span class="quoted"><span class="quoted">"distinct <span class="skolem">vs2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> 000 <span class="keyword1"><span class="command">unfolding</span></span> vs2
  <span class="keyword1"><span class="command">using</span></span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span><span class="free">pls</span> <span class="free">r1</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
           <span class="free">pls</span> <span class="main">(</span>rawpsubstT <span class="free">r1</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="main">(</span>rawpsubstT <span class="free">r2</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubstT_pls<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">r1</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span>
           rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">r1</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs1</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">vs1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms us_facts vs1_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubstT_compose_freshVar2<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">r2</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span>
           rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">r2</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs2</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">vs2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms us_facts vs2_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubstT_compose_freshVar2<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span>rawpsubstT <span class="main">(</span><span class="free">pls</span> <span class="free">r1</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span>
    <span class="free">pls</span> <span class="main">(</span>rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">r1</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span><span class="main">)</span>
     <span class="main">(</span>rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">r2</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> rawpsubstT_pls<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Int_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Int_def<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> psubstT_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> vs1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> vs2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 1 2 3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rawpsubstT_tms<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span><span class="free">tms</span> <span class="free">r1</span> <span class="free">r2</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">tms</span> <span class="main">(</span>rawpsubstT <span class="free">r1</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>rawpsubstT <span class="free">r2</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">txs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">r1</span></span> <span class="quoted"><span class="free">r2</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> tx txs r <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tx</span></span><span class="main">)</span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubstT_tms<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubstT <span class="main">(</span><span class="free">tms</span> <span class="free">r1</span> <span class="free">r2</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> <span class="free">tms</span> <span class="main">(</span>psubstT <span class="free">r1</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>psubstT <span class="free">r2</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 000<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">us</span></span> <span class="keyword2"><span class="keyword">where</span></span> us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">≡</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="free">tms</span> <span class="free">r1</span> <span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">r1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">r2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">us</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"length <span class="skolem">us</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
  <span class="quoted"><span class="quoted">"distinct <span class="skolem">us</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> 000 <span class="keyword1"><span class="command">unfolding</span></span> us
  <span class="keyword1"><span class="command">using</span></span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="free">r1</span> <span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="free">r1</span> <span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="free">r1</span> <span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="free">r1</span> <span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="free">r1</span> <span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vs1</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs1</span> <span class="main">≡</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="free">r1</span> <span class="main">#</span> map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> vs1_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">r1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs1</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"length <span class="skolem">vs1</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
  <span class="quoted"><span class="quoted">"distinct <span class="skolem">vs1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> 000 <span class="keyword1"><span class="command">unfolding</span></span> vs1
  <span class="keyword1"><span class="command">using</span></span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs2</span> <span class="main">≡</span> getFrN <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>length <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> vs2_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">∩</span> <span class="free">FvarsT</span> <span class="free">r2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"set <span class="skolem">vs2</span> <span class="main">∩</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"length <span class="skolem">vs2</span> <span class="main">=</span> length <span class="free">txs</span>"</span></span>
  <span class="quoted"><span class="quoted">"distinct <span class="skolem">vs2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> 000 <span class="keyword1"><span class="command">unfolding</span></span> vs2
  <span class="keyword1"><span class="command">using</span></span> getFrN_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
        getFrN_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">#</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">txs</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span><span class="free">tms</span> <span class="free">r1</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
           <span class="free">tms</span> <span class="main">(</span>rawpsubstT <span class="free">r1</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="main">(</span>rawpsubstT <span class="free">r2</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubstT_tms<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">r1</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span>
           rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">r1</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs1</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">vs1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms us_facts vs1_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubstT_compose_freshVar2<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">r2</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span>
           rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">r2</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">vs2</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">vs2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms us_facts vs2_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rawpsubstT_compose_freshVar2<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"rawpsubstT <span class="main">(</span>rawpsubstT <span class="main">(</span><span class="free">tms</span> <span class="free">r1</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span>
    <span class="free">tms</span> <span class="main">(</span>rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">r1</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span><span class="main">)</span>
     <span class="main">(</span>rawpsubstT <span class="main">(</span>rawpsubstT <span class="free">r2</span> <span class="main">(</span>zip <span class="main">(</span>map <span class="free">Var</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">(</span>map fst <span class="free">txs</span><span class="main">)</span> <span class="skolem">us</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> 0 <span class="keyword1"><span class="command">using</span></span> assms us_facts <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> rawpsubstT_tms<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Int_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_zip_D <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rawpsubstT <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Int_def<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> psubstT_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def us<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> vs1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> vs2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 1 2 3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The (Nonstrict and Strict) Order Relations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lq (less than or equal to) is a formula with free vars xx and yy.
NB: Out of the two possible ways, adding zz to the left or to the right,
we choose the former, since this seems to enable Q (Robinson arithmetic)
to prove as many useful properties as possible.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Lq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Lq</span> <span class="main">≡</span> <span class="free">exi</span> zz <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> zz<span class="main">)</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Alternative, more flexible definition , for any non-capturing bound variable:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> Lq_def2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">≠</span> yy <span class="main">⟹</span> <span class="free">z</span> <span class="main">≠</span> xx <span class="main">⟹</span> Lq <span class="main">=</span> <span class="free">exi</span> <span class="free">z</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span> <span class="main">(</span><span class="free">pls</span>  <span class="main">(</span><span class="free">Var</span> <span class="free">z</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Lq_def <span class="keyword1"><span class="command">using</span></span> exi_rename<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> zz<span class="main">)</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted">zz</span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Lq<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Lq <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Lq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_Lq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> Lq <span class="main">=</span> <span class="main">{</span>xx<span class="main">,</span>yy<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Lq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹As usual, we also define a predicate version:›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">LLq</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">LLq</span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> psubst Lq <span class="main">[</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span>xx<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="bound">t2</span><span class="main">,</span>yy<span class="main">)</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> LLq<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"LLq <span class="free">t1</span> <span class="free">t2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> LLq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> LLq2<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">num</span> <span class="main">⟹</span> LLq <span class="free">n</span> <span class="main">(</span><span class="free">Var</span> yy'<span class="main">)</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_LLq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span>
<span class="free">Fvars</span> <span class="main">(</span>LLq <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">=</span> <span class="free">FvarsT</span> <span class="free">t1</span> <span class="main">∪</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> LLq_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> Fvars_psubst<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This lemma will be the working definition of LLq:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> LLq_pls<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"LLq <span class="free">t1</span> <span class="free">t2</span> <span class="main">=</span> <span class="free">exi</span> <span class="free">z</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t2</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> <span class="free">z</span><span class="main">)</span> <span class="free">t1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">≡</span> getFr <span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span><span class="free">z</span><span class="main">]</span> <span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">≠</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="skolem">z'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span><span class="free">z</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"LLq <span class="free">t1</span> <span class="free">t2</span> <span class="main">=</span> <span class="free">exi</span> <span class="skolem">z'</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t2</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z'</span><span class="main">)</span> <span class="free">t1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LLq_def Lq_def2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">z'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">exi</span> <span class="free">z</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t2</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> <span class="free">z</span><span class="main">)</span> <span class="free">t1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> exi_rename<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="free">t2</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z'</span><span class="main">)</span> <span class="free">t1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">z'</span></span> <span class="quoted"><span class="free">z</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> LLq_pls_zz<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"zz <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"zz <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"LLq <span class="free">t1</span> <span class="free">t2</span> <span class="main">=</span> <span class="free">exi</span> zz <span class="main">(</span><span class="free">eql</span> <span class="free">t2</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> zz<span class="main">)</span> <span class="free">t1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> LLq_pls<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If we restrict attention to arithmetic terms, we can prove a uniform
substitution property for LLq:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> subst_LLq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="main">(</span>LLq <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="free">s</span> <span class="free">x</span> <span class="main">=</span> LLq <span class="main">(</span><span class="free">substT</span> <span class="free">t1</span> <span class="free">s</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">substT</span> <span class="free">t2</span> <span class="free">s</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span><span class="free">x</span><span class="main">]</span> <span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span><span class="free">x</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">s</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FvarsT_substT LLq_pls<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span> subst2_fresh_switch Lq_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_LLq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubst <span class="main">(</span>LLq <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> LLq <span class="main">(</span>psubstT <span class="free">t1</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>psubstT <span class="free">t2</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">(</span><span class="main">[</span>xx<span class="main">,</span>yy<span class="main">]</span> <span class="main">@</span> map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span> <span class="main">@</span> map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> yy"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> 0 2 <span class="keyword1"><span class="command">unfolding</span></span> z
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">]</span> <span class="main">@</span>  map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span> <span class="main">@</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">]</span>
        getFr_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">]</span> <span class="main">@</span>  map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span> <span class="main">@</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">]</span>
        getFr_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">]</span> <span class="main">@</span>  map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span> <span class="main">@</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">note</span></span> in_FvarsT_psubstTD<span class="main">[</span><span class="operator">dest</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> if_splits<span class="main">[</span><span class="operator">split</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms 0 us_facts <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> LLq_pls<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> LLq_pls<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lq less than) is the strict version of the order relation.
We prove similar facts as for Lq›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Ls</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Ls</span> <span class="main">≡</span> <span class="free">cnj</span> Lq <span class="main">(</span>neg <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Ls<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ls <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Ls_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_Ls<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> Ls <span class="main">=</span> <span class="main">{</span>xx<span class="main">,</span>yy<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Ls_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">LLs</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">LLs</span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> psubst Ls <span class="main">[</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span>xx<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="bound">t2</span><span class="main">,</span>yy<span class="main">)</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> LLs<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"LLs <span class="free">t1</span> <span class="free">t2</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> LLs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> LLs2<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">num</span> <span class="main">⟹</span> LLs <span class="free">n</span> <span class="main">(</span><span class="free">Var</span> yy'<span class="main">)</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_LLs<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span>
<span class="free">Fvars</span> <span class="main">(</span>LLs <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">=</span> <span class="free">FvarsT</span> <span class="free">t1</span> <span class="main">∪</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> LLs_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> Fvars_psubst<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The working definition of LLs:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> LLs_LLq<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">t2</span> <span class="main">∈</span> atrm <span class="main">⟹</span>
 LLs <span class="free">t1</span> <span class="free">t2</span> <span class="main">=</span> <span class="free">cnj</span> <span class="main">(</span>LLq <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LLs_def Ls_def LLq_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_LLs<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="main">(</span>LLs <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="free">s</span> <span class="free">x</span> <span class="main">=</span> LLs <span class="main">(</span><span class="free">substT</span> <span class="free">t1</span> <span class="free">s</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">substT</span> <span class="free">t2</span> <span class="free">s</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LLs_LLq subst2_fresh_switch Ls_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_LLs<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">var</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"psubst <span class="main">(</span>LLs <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> LLs <span class="main">(</span>psubstT <span class="free">t1</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>psubstT <span class="free">t2</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">trm</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">(</span><span class="main">[</span>xx<span class="main">,</span>yy<span class="main">]</span> <span class="main">@</span> map snd <span class="free">txs</span><span class="main">)</span> <span class="main">(</span><span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span> <span class="main">@</span> map fst <span class="free">txs</span><span class="main">)</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> us_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> yy"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">FvarsT</span> <span class="main">`</span> <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> snd <span class="main">`</span> <span class="main">(</span>set <span class="free">txs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> 0 2 <span class="keyword1"><span class="command">unfolding</span></span> z
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">]</span> <span class="main">@</span>  map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span> <span class="main">@</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">]</span>
        getFr_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">]</span> <span class="main">@</span>  map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span> <span class="main">@</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="main">]</span>
        getFr_var<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">]</span> <span class="main">@</span>  map snd <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span> <span class="main">@</span> map fst <span class="free">txs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms 0 us_facts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LLs_LLq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Bounded Quantification›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Bounded forall›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ball</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> <span class="main">⇒</span> <span class="tfree">'trm</span> <span class="main">⇒</span> <span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="tfree">'fmla</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ball</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="free">all</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>LLq <span class="main">(</span><span class="free">Var</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ball<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> ball <span class="free">x</span> <span class="free">t</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ball_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_ball<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">Fvars</span> <span class="main">(</span>ball <span class="free">x</span> <span class="free">t</span> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Fvars</span> <span class="free">φ</span> <span class="main">∪</span> <span class="free">FvarsT</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ball_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_ball<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">t1</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span> <span class="main">⟹</span>
 <span class="free">subst</span> <span class="main">(</span>ball <span class="free">x</span> <span class="free">t</span> <span class="free">φ</span><span class="main">)</span> <span class="free">t1</span> <span class="free">y</span> <span class="main">=</span> ball <span class="free">x</span> <span class="main">(</span><span class="free">substT</span> <span class="free">t</span> <span class="free">t1</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t1</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ball_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_ball<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> snd <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> atrm <span class="main">⟹</span>
 fst <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">trm</span> <span class="main">⟹</span> fst <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> atrm <span class="main">⟹</span> <span class="free">y</span> <span class="main">∉</span> snd <span class="main">`</span> set <span class="free">txs</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">t</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="free">txs</span><span class="main">.</span> <span class="free">FvarsT</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟹</span>
 distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">⟹</span>
 psubst <span class="main">(</span>ball <span class="free">y</span> <span class="free">t</span> <span class="free">φ</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> ball <span class="free">y</span> <span class="main">(</span>psubstT <span class="free">t</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>psubst <span class="free">φ</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ball_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Bounded exists›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bexi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> <span class="main">⇒</span> <span class="tfree">'trm</span> <span class="main">⇒</span> <span class="tfree">'fmla</span> <span class="main">⇒</span> <span class="tfree">'fmla</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">bexi</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="free">exi</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free">cnj</span> <span class="main">(</span>LLq <span class="main">(</span><span class="free">Var</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bexi<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> bexi <span class="free">x</span> <span class="free">t</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> bexi_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Fvars_bexi<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">Fvars</span> <span class="main">(</span>bexi <span class="free">x</span> <span class="free">t</span> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Fvars</span> <span class="free">φ</span> <span class="main">∪</span> <span class="free">FvarsT</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> bexi_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> subst_bexi<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">t1</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span> <span class="main">⟹</span>
 <span class="free">subst</span> <span class="main">(</span>bexi <span class="free">x</span> <span class="free">t</span> <span class="free">φ</span><span class="main">)</span> <span class="free">t1</span> <span class="free">y</span> <span class="main">=</span> bexi <span class="free">x</span> <span class="main">(</span><span class="free">substT</span> <span class="free">t</span> <span class="free">t1</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t1</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> bexi_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> psubst_bexi<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> snd <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> atrm <span class="main">⟹</span>
 fst <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> <span class="free">trm</span> <span class="main">⟹</span> fst <span class="main">`</span> set <span class="free">txs</span> <span class="main">⊆</span> atrm <span class="main">⟹</span> <span class="free">y</span> <span class="main">∉</span> snd <span class="main">`</span> set <span class="free">txs</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">t</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="free">txs</span><span class="main">.</span> <span class="free">FvarsT</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟹</span>
 distinct <span class="main">(</span>map snd <span class="free">txs</span><span class="main">)</span> <span class="main">⟹</span>
 psubst <span class="main">(</span>bexi <span class="free">y</span> <span class="free">t</span> <span class="free">φ</span><span class="main">)</span> <span class="free">txs</span> <span class="main">=</span> bexi <span class="free">y</span> <span class="main">(</span>psubstT <span class="free">t</span> <span class="free">txs</span><span class="main">)</span> <span class="main">(</span>psubst <span class="free">φ</span> <span class="free">txs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> bexi_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span> Syntax_Arith<span class="antiquote">}</span></span>›</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
</pre>
</div><div id="Deduction_Q">
<div class="head">
<h1>Theory Deduction_Q</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Deduction in a System Embedding the Intuitionistic Robinson Arithmetic›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Deduction_Q <span class="keyword2"><span class="keyword">imports</span></span> <a href="Syntax_Arith.html">Syntax_Arith</a> <a href="Natural_Deduction.html">Natural_Deduction</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹NB: Robinson arithmetic, also know as system Q, is Peano arithmetic without the
induction axiom schema.›</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Natural Deduction with the Bounded Quantifiers›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We start by simply putting together deduction with the arithmetic syntax,
which allows us to reason about bounded quantifiers:›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Deduct_with_False_Disj_Arith <span class="main">=</span>
Syntax_Arith
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
  <span class="quoted"><span class="free">fls</span></span>
  <span class="quoted"><span class="free">dsj</span></span>
  <span class="quoted"><span class="free">num</span></span>
  <span class="quoted"><span class="free">zer</span></span> <span class="quoted"><span class="free">suc</span></span> <span class="quoted"><span class="free">pls</span></span> <span class="quoted"><span class="free">tms</span></span>
<span class="main">+</span>
Deduct_with_False_Disj
  <span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span> <span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
  <span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
  <span class="quoted"><span class="free">fls</span></span>
  <span class="quoted"><span class="free">dsj</span></span>
  <span class="quoted"><span class="free">num</span></span>
  <span class="quoted"><span class="free">prv</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
<span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">trm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">Var</span> <span class="free">FvarsT</span> <span class="free">substT</span> <span class="free">Fvars</span> <span class="free">subst</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">eql</span> <span class="free">cnj</span> <span class="free">imp</span> <span class="free">all</span> <span class="free">exi</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">fls</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">dsj</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">num</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">zer</span> <span class="free">suc</span> <span class="free">pls</span> <span class="free">tms</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">prv</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_ballI<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="main">(</span>LLq <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">φ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">trm</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
 <span class="free">x</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">φ</span> <span class="main">∈</span> <span class="free">F</span><span class="main">.</span> <span class="free">Fvars</span> <span class="bound">φ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="main">(</span>ball <span class="free">x</span> <span class="free">t</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ball_def
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">nprover2</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> nprv_allI <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_ballE_aux<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span>ball <span class="free">x</span> <span class="free">t</span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="main">(</span>LLq <span class="free">t1</span> <span class="free">t</span><span class="main">)</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">t1</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t1</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ball_def
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">nprover3</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> nprv_allE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="free">imp</span> <span class="main">(</span>LLq <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span> <span class="free">φ</span>"</span></span> <span class="quoted"><span class="free">t1</span></span><span class="main"><span class="main">]</span></span>
     <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> nprv_impE0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"LLq <span class="free">t1</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free">φ</span> <span class="free">t1</span> <span class="free">x</span>"</span></span><span class="main"><span class="main">]</span></span>
     <span class="quasi_keyword">r3</span><span class="main"><span class="main">:</span></span> nprv_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_ballE<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span>ball <span class="free">x</span> <span class="free">t</span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="main">(</span>LLq <span class="free">t1</span> <span class="free">t</span><span class="main">)</span> <span class="main">⟹</span> nprv <span class="main">(</span>insert <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t1</span> <span class="free">x</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">t1</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 <span class="free">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> atrm_trm local.subst nprv_ballE_aux nprv_cut rev_subsetD<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_ballE0 <span class="main">=</span> nprv_ballE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _ _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_ballE1 <span class="main">=</span> nprv_ballE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_ballE2 <span class="main">=</span> nprv_ballE<span class="main">[</span><span class="operator">OF</span> _ _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_ballE01 <span class="main">=</span> nprv_ballE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_ballE02 <span class="main">=</span> nprv_ballE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_ballE12 <span class="main">=</span> nprv_ballE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_ballE012 <span class="main">=</span> nprv_ballE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_bexiI<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="free">t1</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="main">(</span>LLq <span class="free">t1</span> <span class="free">t</span><span class="main">)</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">t1</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span>
 <span class="free">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="main">(</span>bexi <span class="free">x</span> <span class="free">t</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> bexi_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover2</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> nprv_exiI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">t1</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> nprv_cnjI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_bexiE<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span>bexi <span class="free">x</span> <span class="free">t</span> <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span> nprv <span class="main">(</span>insert <span class="main">(</span>LLq <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span> <span class="main">(</span>insert <span class="free">φ</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="free">ψ</span> <span class="main">⟹</span>
 <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> atrm <span class="main">⟹</span>
 <span class="free">x</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">φ</span> <span class="main">∈</span> <span class="free">F</span><span class="main">.</span> <span class="free">Fvars</span> <span class="bound">φ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">ψ</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> bexi_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover2</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> nprv_exiE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="free">cnj</span> <span class="main">(</span>LLq <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span> <span class="free">φ</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> nprv_cnjH<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_bexiE0 <span class="main">=</span> nprv_bexiE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_bexiE1 <span class="main">=</span> nprv_bexiE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_bexiE01 <span class="main">=</span> nprv_bexiE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span> Deduct_with_False_Disj<span class="antiquote">}</span></span>›</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Deduction with the Robinson Arithmetic Axioms›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Deduct_Q <span class="main">=</span>
Deduct_with_False_Disj_Arith
<span class="quoted"><span class="free">var</span></span> <span class="quoted"><span class="free">trm</span></span> <span class="quoted"><span class="free">fmla</span></span>
<span class="quoted"><span class="free">Var</span></span> <span class="quoted"><span class="free">FvarsT</span></span> <span class="quoted"><span class="free">substT</span></span> <span class="quoted"><span class="free">Fvars</span></span> <span class="quoted"><span class="free">subst</span></span>
<span class="quoted"><span class="free">eql</span></span> <span class="quoted"><span class="free">cnj</span></span> <span class="quoted"><span class="free">imp</span></span> <span class="quoted"><span class="free">all</span></span> <span class="quoted"><span class="free">exi</span></span>
<span class="quoted"><span class="free">fls</span></span>
<span class="quoted"><span class="free">dsj</span></span>
<span class="quoted"><span class="free">num</span></span>
<span class="quoted"><span class="free">zer</span></span> <span class="quoted"><span class="free">suc</span></span> <span class="quoted"><span class="free">pls</span></span> <span class="quoted"><span class="free">tms</span></span>
<span class="quoted"><span class="free">prv</span></span>
<span class="keyword2"><span class="keyword">for</span></span>
<span class="free">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'var</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">trm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'trm</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">fmla</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'fmla</span> set"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">Var</span> <span class="free">FvarsT</span> <span class="free">substT</span> <span class="free">Fvars</span> <span class="free">subst</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">eql</span> <span class="free">cnj</span> <span class="free">imp</span> <span class="free">all</span> <span class="free">exi</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">fls</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">dsj</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">num</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">zer</span> <span class="free">suc</span> <span class="free">pls</span> <span class="free">tms</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">prv</span>
<span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span>
<span class="comment1">― ‹The Q axioms are stated for some fixed variables;
we will prove more useful versions, for arbitrary terms substituting the variables.›</span>
prv_neg_zer_suc_var<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">eql</span> <span class="free">zer</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
prv_inj_suc_var<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
prv_zer_dsj_suc_var<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">dsj</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span> <span class="free">zer</span><span class="main">)</span>
          <span class="main">(</span><span class="free">exi</span> xx <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
prv_pls_zer_var<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span> <span class="free">zer</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
prv_pls_suc_var<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
prv_tms_zer_var<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">tms</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span> <span class="free">zer</span><span class="main">)</span> <span class="free">zer</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
prv_tms_suc_var<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">tms</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">tms</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Rules for quantifiers that allow changing, on the fly, the bound variable with
one that is fresh for the proof context:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_allI_var<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> n1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> i<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">φ</span> <span class="main">∈</span> <span class="free">F</span><span class="main">.</span> <span class="free">Fvars</span> <span class="bound">φ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yx<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">all</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> <span class="bound">φ</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="bound">φ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> u <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> all_rename2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> yx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_allI<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_exiE_var<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> nn<span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> yx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">Fvars</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">ψ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">exi</span> <span class="free">x</span> <span class="free">φ</span> <span class="main">=</span> <span class="free">exi</span> <span class="free">y</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> 0 yx n nn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> exi_rename2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 0<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> e
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> nprv_exiE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free">φ</span> <span class="main">(</span><span class="free">Var</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* The substitution closures of the variable-based axioms
(and the rulifications of the ones that are implications, negations or disjunctions).  *)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_neg_zer_suc<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">eql</span> <span class="free">zer</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> prv_psubst<span class="main">[</span><span class="operator">OF</span> _ _ _ prv_neg_zer_suc_var<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="free">t</span><span class="main">,</span>xx<span class="main">)</span><span class="main">]</span>"</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_neg_suc_zer<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t</span><span class="main">)</span> <span class="free">zer</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms atrm.simps atrm_imp_trm eql fls neg_def prv_eql_sym
  prv_neg_zer_suc prv_prv_imp_trans zer_atrm<span class="main">)</span>


<span class="comment1">(* Rulification: *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_zer_suc_contrE <span class="main">=</span>
 nprv_flsE<span class="main">[</span><span class="operator">OF</span> nprv_addImpLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_neg_zer_suc<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> neg_def<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">OF</span> _ _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_zer_suc_contrE0 <span class="main">=</span> nprv_zer_suc_contrE<span class="main">[</span><span class="operator">OF</span> nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>


<span class="comment1">(* A variation of the above, taking advantage of transitivity and symmetry: *)</span>
<span class="keyword1"><span class="command">lemma</span></span> nprv_zer_suc_2contrE<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t</span> <span class="free">zer</span><span class="main">)</span> <span class="main">⟹</span> nprv <span class="free">F</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
 finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">t1</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> nprv_eql_transI<span class="main">[</span><span class="operator">OF</span> nprv_eql_symI<span class="main">]</span> nprv_zer_suc_contrE
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> atrm_imp_trm suc zer_atrm<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_zer_suc_2contrE0 <span class="main">=</span> nprv_zer_suc_2contrE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_zer_suc_2contrE1 <span class="main">=</span> nprv_zer_suc_2contrE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_zer_suc_2contrE01 <span class="main">=</span> nprv_zer_suc_2contrE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="comment1">(* *)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_inj_suc<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">t'</span> <span class="main">∈</span> atrm <span class="main">⟹</span>
 <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t'</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span><span class="free">eql</span> <span class="free">t</span> <span class="free">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> prv_psubst<span class="main">[</span><span class="operator">OF</span> _ _ _ prv_inj_suc_var<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="free">t</span><span class="main">,</span>xx<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t'</span><span class="main">,</span>yy<span class="main">)</span><span class="main">]</span>"</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(* Rulification: *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_sucI <span class="main">=</span> nprv_addImpLemmaI<span class="main">[</span><span class="operator">OF</span> prv_inj_suc<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 4<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_sucE <span class="main">=</span> nprv_addImpLemmaE<span class="main">[</span><span class="operator">OF</span> prv_inj_suc<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 2<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_sucE0 <span class="main">=</span> nprv_eql_sucE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_sucE1 <span class="main">=</span> nprv_eql_sucE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_sucE01 <span class="main">=</span> nprv_eql_sucE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="comment1">(* NB: Provable substitution closures of sentences in the presence of quantifiers do not go
very smoothly -- the main reason being that bound variable renaming is not assumed
to hold up to equality, but it (only follows that it) holds up to provability: *)</span>
<span class="keyword1"><span class="command">lemma</span></span> prv_zer_dsj_suc<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> t<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">dsj</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t</span> <span class="free">zer</span><span class="main">)</span>
           <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> x'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">≡</span> getFr <span class="main">[</span><span class="free">x</span><span class="main">,</span>yy<span class="main">]</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> x'_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">≠</span> <span class="free">x</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x'
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">,</span>yy<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">exi</span> xx <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">exi</span> <span class="skolem">x'</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prv_exi_imp prv_all_gen
           <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prv_exi_inst<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">x'</span></span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> xx"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> prv_zer_dsj_suc_var
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">dsj</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span> <span class="free">zer</span><span class="main">)</span> <span class="main">(</span><span class="free">exi</span> <span class="skolem">x'</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> prv_dsj_cases<span class="main"><span class="main">[</span></span><span class="operator">rotated</span> 3<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prv_dsj_impL prv_dsj_impR <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prv_prv_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">rotated</span> 3<span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">note</span></span> 1 <span class="main">=</span> prv_psubst<span class="main">[</span><span class="operator">OF</span> _ _ _ 0<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="free">t</span><span class="main">,</span>yy<span class="main">)</span><span class="main">]</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">exi</span> <span class="skolem">x'</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">x'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">exi</span> <span class="free">x</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prv_exi_imp prv_all_gen <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prv_exi_inst<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="free">t</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">x'</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> prv_dsj_cases<span class="main"><span class="main">[</span></span><span class="operator">rotated</span> 3<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prv_dsj_impL prv_dsj_impR <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prv_prv_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">rotated</span> 3<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* The rulification of the above disjunction amounts to reasoning by zero-suc cases: *)</span>
<span class="keyword1"><span class="command">lemma</span></span> nprv_zer_suc_casesE<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="main">(</span><span class="free">eql</span> <span class="free">t</span> <span class="free">zer</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">φ</span> <span class="main">⟹</span> nprv <span class="main">(</span>insert <span class="main">(</span><span class="free">eql</span> <span class="free">t</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">φ</span> <span class="main">⟹</span>
 finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">var</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> atrm <span class="main">⟹</span>
 <span class="free">x</span> <span class="main">∉</span> <span class="free">Fvars</span> <span class="free">φ</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">Fvars</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover3</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> nprv_addDsjLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_zer_dsj_suc<span class="main"><span class="main">]</span></span>
             <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> nprv_exiE0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="free">t</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span>
             <span class="quasi_keyword">r3</span><span class="main"><span class="main">:</span></span> nprv_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span><span class="free">eql</span> <span class="main">_</span> <span class="main">(</span><span class="free">suc</span> <span class="main">_</span><span class="main">)</span><span class="main">)</span> <span class="main">_</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_zer_suc_casesE0 <span class="main">=</span> nprv_zer_suc_casesE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_zer_suc_casesE1 <span class="main">=</span> nprv_zer_suc_casesE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_zer_suc_casesE01 <span class="main">=</span> nprv_zer_suc_casesE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="comment1">(* *)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_pls_zer<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t</span> <span class="free">zer</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> prv_psubst<span class="main">[</span><span class="operator">OF</span> _ _ _ prv_pls_zer_var<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="free">t</span><span class="main">,</span>xx<span class="main">)</span><span class="main">]</span>"</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_pls_suc<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">t'</span> <span class="main">∈</span> atrm <span class="main">⟹</span>
 <span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t'</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t</span> <span class="free">t'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> prv_psubst<span class="main">[</span><span class="operator">OF</span> _ _ _ prv_pls_suc_var<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="free">t</span><span class="main">,</span>xx<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t'</span><span class="main">,</span>yy<span class="main">)</span><span class="main">]</span>"</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_tms_zer<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">tms</span> <span class="free">t</span> <span class="free">zer</span><span class="main">)</span> <span class="free">zer</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> prv_psubst<span class="main">[</span><span class="operator">OF</span> _ _ _ prv_tms_zer_var<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="free">t</span><span class="main">,</span>xx<span class="main">)</span><span class="main">]</span>"</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_tms_suc<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">t'</span> <span class="main">∈</span> atrm <span class="main">⟹</span>
 <span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">tms</span> <span class="free">t</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t'</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">tms</span> <span class="free">t</span> <span class="free">t'</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> prv_psubst<span class="main">[</span><span class="operator">OF</span> _ _ _ prv_tms_suc_var<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="free">t</span><span class="main">,</span>xx<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">t'</span><span class="main">,</span>yy<span class="main">)</span><span class="main">]</span>"</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="comment1">(* Congruence rules for the operators (follow from substitutivity of equality): *)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_suc_imp_cong<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> t1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>
                <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t1</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">]</span> <span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> zz"</span></span> <span class="quoted"><span class="quoted">"zz <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover4</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> nprv_prvI <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> nprv_impI
       <span class="quasi_keyword">r3</span><span class="main"><span class="main">:</span></span> nprv_eql_substE02<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t1</span></span> <span class="quoted"><span class="free">t2</span></span>  <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span>
       <span class="quasi_keyword">r4</span><span class="main"><span class="main">:</span></span> nprv_eq_eqlI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Rulification: *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_suc_congI <span class="main">=</span> nprv_addImpLemmaI<span class="main">[</span><span class="operator">OF</span> prv_suc_imp_cong<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 4<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_suc_congE <span class="main">=</span> nprv_addImpLemmaE<span class="main">[</span><span class="operator">OF</span> prv_suc_imp_cong<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 2<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_suc_congE0 <span class="main">=</span> nprv_suc_congE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_suc_congE1 <span class="main">=</span> nprv_suc_congE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_suc_congE01 <span class="main">=</span> nprv_suc_congE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_suc_cong<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> t1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t1</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms atrm_suc atrm_imp_trm eql prv_imp_mp prv_suc_imp_cong t1 t2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_pls_imp_cong<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> t1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t1'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1'</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> t2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t2'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t2'</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t1'</span><span class="main">)</span>
                <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t2</span> <span class="free">t2'</span><span class="main">)</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t1'</span> <span class="free">t2'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">]</span> <span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t1'</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">t2'</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> zz"</span></span> <span class="quoted"><span class="quoted">"zz <span class="main">≠</span> <span class="skolem">z</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t1'</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">t2'</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE02<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t1</span></span> <span class="quoted"><span class="free">t1'</span></span>  <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t1'</span> <span class="free">t2'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE02<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t2</span></span> <span class="quoted"><span class="free">t2'</span></span>  <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t1'</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t1'</span> <span class="free">t2'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eq_eqlI<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Rulification: *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_pls_congI <span class="main">=</span> nprv_addImp2LemmaI<span class="main">[</span><span class="operator">OF</span> prv_pls_imp_cong<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 6<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_pls_congE <span class="main">=</span> nprv_addImp2LemmaE<span class="main">[</span><span class="operator">OF</span> prv_pls_imp_cong<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 4<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_pls_congE0 <span class="main">=</span> nprv_pls_congE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _ _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_pls_congE1 <span class="main">=</span> nprv_pls_congE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_pls_congE2 <span class="main">=</span> nprv_pls_congE<span class="main">[</span><span class="operator">OF</span> _ _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_pls_congE01 <span class="main">=</span> nprv_pls_congE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_pls_congE02 <span class="main">=</span> nprv_pls_congE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_pls_congE12 <span class="main">=</span> nprv_pls_congE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_pls_congE012 <span class="main">=</span> nprv_pls_congE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_pls_cong<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1'</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2'</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t1'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t2</span> <span class="free">t2'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t1'</span> <span class="free">t2'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms atrm_imp_trm cnj eql pls prv_cnjI prv_cnj_imp_monoR2 prv_imp_mp prv_pls_imp_cong<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_pls_congL<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">t1'</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">t2</span> <span class="main">∈</span> atrm <span class="main">⟹</span>
 <span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t1'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t1'</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prv_pls_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ _ _ prv_eql_reflT<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_pls_congR<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">t2</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">t2'</span> <span class="main">∈</span> atrm <span class="main">⟹</span>
 <span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t2</span> <span class="free">t2'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t1</span> <span class="free">t2'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prv_pls_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ _ prv_eql_reflT<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_pls_cong<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1'</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2'</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">{</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t1'</span><span class="main">,</span> <span class="free">eql</span> <span class="free">t2</span> <span class="free">t2'</span><span class="main">}</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t1'</span> <span class="free">t2'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nprv_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prv_prv_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ prv_scnj2_imp_cnj<span class="main"><span class="main">]</span></span> prv_cnj_imp_monoR2 prv_pls_imp_cong<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_tms_imp_cong<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> t1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t1'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1'</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> t2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t2'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t2'</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t1'</span><span class="main">)</span>
                <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t2</span> <span class="free">t2'</span><span class="main">)</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">tms</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span><span class="free">tms</span> <span class="free">t1'</span> <span class="free">t2'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">]</span> <span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t1'</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">t2'</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> zz"</span></span> <span class="quoted"><span class="quoted">"zz <span class="main">≠</span> <span class="skolem">z</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t1'</span><span class="main">,</span><span class="free">t2</span><span class="main">,</span><span class="free">t2'</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE02<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t1</span></span> <span class="quoted"><span class="free">t1'</span></span>  <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="main">(</span><span class="free">tms</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span><span class="free">tms</span> <span class="free">t1'</span> <span class="free">t2'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE02<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t2</span></span> <span class="quoted"><span class="free">t2'</span></span>  <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="main">(</span><span class="free">tms</span> <span class="free">t1'</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">tms</span> <span class="free">t1'</span> <span class="free">t2'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eq_eqlI<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Rulification: *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_tms_congI <span class="main">=</span> nprv_addImp2LemmaI<span class="main">[</span><span class="operator">OF</span> prv_tms_imp_cong<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 6<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_tms_congE <span class="main">=</span> nprv_addImp2LemmaE<span class="main">[</span><span class="operator">OF</span> prv_tms_imp_cong<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 4<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_tms_congE0 <span class="main">=</span> nprv_tms_congE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _ _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_tms_congE1 <span class="main">=</span> nprv_tms_congE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_tms_congE2 <span class="main">=</span> nprv_tms_congE<span class="main">[</span><span class="operator">OF</span> _ _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_tms_congE01 <span class="main">=</span> nprv_tms_congE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_tms_congE02 <span class="main">=</span> nprv_tms_congE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_tms_congE12 <span class="main">=</span> nprv_tms_congE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_tms_congE012 <span class="main">=</span> nprv_tms_congE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_tms_cong<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1'</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2'</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t1'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t2</span> <span class="free">t2'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">tms</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span><span class="free">tms</span> <span class="free">t1'</span> <span class="free">t2'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms atrm_imp_trm cnj eql tms prv_cnjI prv_cnj_imp_monoR2 prv_imp_mp prv_tms_imp_cong<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_tms_cong<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1'</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2'</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nprv <span class="main">{</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t1'</span><span class="main">,</span> <span class="free">eql</span> <span class="free">t2</span> <span class="free">t2'</span><span class="main">}</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">tms</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span><span class="free">tms</span> <span class="free">t1'</span> <span class="free">t2'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nprv_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prv_prv_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ prv_scnj2_imp_cnj<span class="main"><span class="main">]</span></span> prv_cnj_imp_monoR2 prv_tms_imp_cong<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_tms_congL<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">t1'</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">t2</span> <span class="main">∈</span> atrm <span class="main">⟹</span>
 <span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t1'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">tms</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span><span class="free">tms</span> <span class="free">t1'</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prv_tms_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ _ _ prv_eql_reflT<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_tms_congR<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">t2</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">t2'</span> <span class="main">∈</span> atrm <span class="main">⟹</span>
 <span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t2</span> <span class="free">t2'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">tms</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span><span class="free">tms</span> <span class="free">t1</span> <span class="free">t2'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prv_tms_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ _ prv_eql_reflT<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Properties Provable in Q›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹General properties, unconstrained by numerals›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_pls_suc_zer<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t</span> <span class="main">(</span><span class="free">suc</span> <span class="free">zer</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> atrm.atrm_pls atrm_imp_trm
 pls prv_eql_trans prv_pls_suc prv_pls_zer prv_suc_cong suc zer_atrm<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_LLq_suc_imp<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>LLq <span class="main">(</span><span class="free">suc</span> <span class="free">t1</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>LLq <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">]</span> <span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> zz"</span></span> <span class="quoted"><span class="quoted">"zz <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> LLq_pls<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiE0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_pls_suc<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="free">t1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear3_3<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_transE01<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="free">t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t1</span><span class="main">)</span>"</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="free">t1</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_sucE0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t2</span></span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="free">t1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Rulification: *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_sucI <span class="main">=</span> nprv_addImpLemmaI<span class="main">[</span><span class="operator">OF</span> prv_LLq_suc_imp<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 4<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_sucE <span class="main">=</span> nprv_addImpLemmaE<span class="main">[</span><span class="operator">OF</span> prv_LLq_suc_imp<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 2<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_sucE0 <span class="main">=</span> nprv_LLq_sucE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_sucE1 <span class="main">=</span> nprv_LLq_sucE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_sucE01 <span class="main">=</span> nprv_LLq_sucE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>


<span class="keyword1"><span class="command">lemma</span></span> prv_LLs_imp_LLq<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>LLs <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span>LLq <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LLs_LLq prv_imp_cnjL<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_LLq_refl<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>LLq <span class="free">zer</span> <span class="free">zer</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> LLq_pls_zz prv_pls_zer prv_prv_eql_sym <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prv_exiI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">zz</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">zer</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹NB: Monotonicity of pls and tms w.r.t. LLq cannot be proved in Q.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_suc_mono_LLq<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>LLq <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span>LLq <span class="main">(</span><span class="free">suc</span> <span class="free">t1</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> assms1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> <span class="free">trm</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">]</span> <span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> zz"</span></span> <span class="quoted"><span class="quoted">"zz <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> assms1 <span class="keyword1"><span class="command">unfolding</span></span> z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≡</span> getFr <span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">,</span><span class="skolem">z</span><span class="main">]</span> <span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> x_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> zz"</span></span> <span class="quoted"><span class="quoted">"zz <span class="main">≠</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">,</span><span class="skolem">z</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> assms1 <span class="keyword1"><span class="command">unfolding</span></span> x_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> assms<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> LLq_pls<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiE0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="free">t2</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="free">t1</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear2_2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">z</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_pls_suc<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="free">t1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="free">t1</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear2_1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_suc_congI<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Rulification: *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_suc_mono_LLqI <span class="main">=</span> nprv_addImpLemmaI<span class="main">[</span><span class="operator">OF</span> prv_suc_mono_LLq<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 4<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_suc_mono_LLqE <span class="main">=</span> nprv_addImpLemmaE<span class="main">[</span><span class="operator">OF</span> prv_suc_mono_LLq<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 2<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_suc_mono_LLqE0 <span class="main">=</span> nprv_suc_mono_LLqE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_suc_mono_LLqE1 <span class="main">=</span> nprv_suc_mono_LLqE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_suc_mono_LLqE01 <span class="main">=</span> nprv_suc_mono_LLqE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Representability properties›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Representability of number inequality›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_neg_eql_suc_Num_zer<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">zer</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Num Num.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Num_atrm eql fls in_num neg_def prv_eql_sym prv_neg_zer_suc prv_prv_imp_trans suc<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Num_atrm atrm_imp_trm eql fls neg_def prv_eql_sym prv_neg_zer_suc prv_prv_imp_trans suc zer_atrm<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> diff_prv_eql_Num<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≠</span> <span class="free">n</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">eql</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Suc <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_neg_zer_suc<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> s <span class="main">=</span> Suc
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_neg_eql_suc_Num_zer<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> n <span class="main">=</span> Suc
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> s
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">meson</span> Num Num_atrm eql in_num neg prv_imp_mp prv_imp_neg_rev prv_inj_suc suc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> consistent_prv_eql_Num_equal<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted">consistent</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms consistent_def3 diff_prv_eql_Num in_num <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Representability of addition›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_pls_zer_zer<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="free">zer</span> <span class="free">zer</span><span class="main">)</span> <span class="free">zer</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_pls_zer<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eql_pls_plus<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span>Num <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> 0 <span class="main">=</span> prv_pls_suc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Num <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"Num <span class="skolem">n</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prv_eql_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ 0 prv_suc_cong<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> _ _ Suc<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_pls_zer<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> not_plus_prv_neg_eql_pls<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">≠</span> <span class="free">k</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">hence</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≠</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">note</span></span> diff_prv_eql_Num<span class="main">[</span><span class="operator">OF</span> m<span class="main">,</span> <span class="operator">simp</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_pls_zer<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Num <span class="free">m</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE
    <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="free">zer</span>"</span></span> <span class="quoted"><span class="quoted">"Num <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"neg <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span> <span class="main">(</span>Num <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted">xx</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> prv_nprvI<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k'</span><span class="main">.</span> <span class="skolem">k</span> <span class="main">=</span> Suc <span class="bound">k'</span> <span class="main">⟹</span>
    <span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Num <span class="bound">k'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">+</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="bound">k'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Suc.IH Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_pls_suc<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Num <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"Num <span class="skolem">n</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"neg <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span> <span class="main">(</span>Num <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted">xx</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover2</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> prv_nprvI <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> prv_neg_suc_zer<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> k' <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> 0<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover4</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> nprv_negI
        <span class="quasi_keyword">r3</span><span class="main"><span class="main">:</span></span> nprv_negE0 <span class="quasi_keyword">r4</span><span class="main"><span class="main">:</span></span> nprv_eql_sucI<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> consistent_prv_eql_pls_plus_rev<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"consistent"</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Num assms consistent_def eql not_plus_prv_neg_eql_pls num pls prv_neg_fls subsetCE<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Representability of multiplication›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_tms_Num_zer<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">tms</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span> <span class="free">zer</span><span class="main">)</span> <span class="free">zer</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prv_tms_zer<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_eql_tms_times<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">tms</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Num <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> 0 <span class="main">=</span> prv_pls_congL<span class="main">[</span><span class="operator">OF</span> _ _ _ Suc<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Num <span class="free">m</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
  <span class="keyword1"><span class="command">thm</span></span> prv_pls_cong<span class="main">[</span><span class="operator">no_vars</span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> add.commute<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 0<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_tms_suc<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Num <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"Num <span class="skolem">n</span>"</span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">simplified</span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_transE01<span class="main"><span class="main">[</span></span><span class="operator">of</span>
      <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="main">(</span><span class="free">tms</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span>"</span></span> <span class="main"><span class="main">_</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="main">(</span>Num <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear3_2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear2_2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_eql_pls_plus<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">*</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_transE01<span class="main"><span class="main">[</span></span><span class="operator">of</span>
      <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="main">(</span>Num <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span>"</span></span> <span class="main"><span class="main">_</span></span>
      <span class="quoted"><span class="quoted">"Num <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prv_tms_zer<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ge_prv_neg_eql_pls_Num_zer<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm"</span></span> <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="free">k</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">]</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> zz"</span></span> <span class="quoted"><span class="quoted">"zz <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> m <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>0 <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> n
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_neg_suc_zer<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="free">t</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_negI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_negE0<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear2_2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_symE0<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">zer</span></span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="free">t</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_symI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> prv_nprvI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> prv_pls_suc<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span> <span class="skolem">mm</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> mm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mm</span> <span class="main">=</span> Suc <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">mm</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> mm Num.simps
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc.IH<span class="main"><span class="main">[</span></span><span class="operator">OF</span> k<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_negI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_negE0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear2_2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI_rev<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_pls_suc<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"Num <span class="skolem">m</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="free">t</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t</span> <span class="main">(</span>Num <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t</span> <span class="main">(</span>Num <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Num <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_sucI<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nprv_pls_Num_injectR<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> atrm"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t1</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t2</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span>xx<span class="main">,</span>yy<span class="main">]</span> <span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t1</span><span class="main">,</span><span class="free">t2</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Num.simps
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_pls_zer<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="free">t1</span> <span class="free">zer</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t2</span> <span class="free">zer</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_pls_zer<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t2</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="free">t2</span> <span class="free">zer</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> Suc.IH<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_pls_suc<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t1</span></span> <span class="quoted"><span class="quoted">"Num <span class="skolem">m</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="free">t1</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t1</span> <span class="main">(</span>Num <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="quoted"><span class="quoted">"<span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t2</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="skolem">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_pls_suc<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t2</span></span> <span class="quoted"><span class="quoted">"Num <span class="skolem">m</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="free">t2</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t2</span> <span class="main">(</span>Num <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t1</span> <span class="main">(</span>Num <span class="skolem">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_sucE0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear2_2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> prv_nprv1I<span class="main">)</span>  <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Rulification: *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_pls_Num_injectI <span class="main">=</span> nprv_addImpLemmaI<span class="main">[</span><span class="operator">OF</span> nprv_pls_Num_injectR<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 4<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_pls_Num_injectE <span class="main">=</span> nprv_addImpLemmaE<span class="main">[</span><span class="operator">OF</span> nprv_pls_Num_injectR<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 2<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_pls_Num_injectE0 <span class="main">=</span> nprv_pls_Num_injectE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_pls_Num_injectE1 <span class="main">=</span> nprv_pls_Num_injectE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_pls_Num_injectE01 <span class="main">=</span> nprv_pls_Num_injectE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>


<span class="keyword1"><span class="command">lemma</span></span> not_times_prv_neg_eql_tms<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">*</span> <span class="free">n</span> <span class="main">≠</span> <span class="free">k</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">tms</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">hence</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≠</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">have</span></span> zer<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">zer</span> <span class="main">=</span> Num <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">eql</span> <span class="free">zer</span> <span class="main">(</span>Num <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> zer<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> diff_prv_eql_Num<span class="main"><span class="main">[</span></span><span class="operator">OF</span> m<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_tms_zer<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Num <span class="free">m</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="free">zer</span>"</span></span> <span class="quoted"><span class="free">zer</span></span> <span class="quoted"><span class="quoted">"neg <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span> <span class="main">(</span>Num <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted">xx</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> prv_nprvI<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nprv <span class="main">{}</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">tms</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Num <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="operator">-</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover2</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> prv_nprvI <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> ge_prv_neg_eql_pls_Num_zer<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">≡</span> <span class="skolem">k</span> <span class="main">-</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="skolem">k'</span> <span class="main">+</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> mm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="skolem">k'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> Suc.IH<span class="main">[</span><span class="operator">OF</span> mm<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> k
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_negI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_prv_eql_sym<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ prv_eql_pls_plus<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">k'</span></span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_transE01<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"Num <span class="main">(</span><span class="skolem">k'</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear3_2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear2_2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_pls_Num_injectE0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear2_2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> IH<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_negE0<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_tms_suc<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Num <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"Num <span class="skolem">n</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">tms</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="main">(</span><span class="free">tms</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span>"</span></span>
     <span class="quoted"><span class="quoted">"neg <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span> <span class="main">(</span>Num <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted">xx</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> consistent_prv_eql_tms_times_rev<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"consistent"</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">tms</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="free">m</span> <span class="main">*</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Num assms consistent_def eql not_times_prv_neg_eql_tms num tms prv_neg_fls subsetCE<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Representability of the order›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> leq_prv_LLq_Num<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>LLq <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms add.commute le_Suc_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">note</span></span> prv_eql_pls_plus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">exi</span> zz <span class="main">(</span><span class="free">eql</span> <span class="main">(</span>Num <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> zz<span class="main">)</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">nprover2</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> prv_exiI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"Num <span class="skolem">i</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> prv_prv_eql_sym<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LLq_pls_zz<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The "order-adequacy" properties›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹These are properties Q1--O9 from
Peter Smith, An Introduction to Gödel's theorems, Second Edition, Page 73.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_LLq_zer<span class="main">:</span> <span class="comment1">― ‹O1›</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>LLq <span class="free">zer</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span>xx<span class="main">,</span>yy<span class="main">]</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">exi</span> <span class="skolem">z</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="free">zer</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_symI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> prv_nprvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> prv_pls_zer<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LLq_pls<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Q1 <span class="main">=</span> prv_LLq_zer

<span class="keyword1"><span class="command">lemma</span></span> prv_LLq_zer_imp_eql<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>LLq <span class="free">t</span> <span class="free">zer</span><span class="main">)</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t</span> <span class="free">zer</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≡</span> getFr <span class="main">[]</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> y_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> y_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span><span class="skolem">y</span><span class="main">]</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">y</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≡</span> getFr <span class="main">[</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">]</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> x_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> LLq_pls<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_zer_suc_casesE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiE0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="free">zer</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear3_3<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_symE0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE01<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">t</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="free">zer</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_pls_suc<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">y</span>"</span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="operator">simplified</span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_transE01<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">zer</span></span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_zer_suc_contrE0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">y</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Rulification: *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_zer_eqlI <span class="main">=</span> nprv_addImpLemmaI<span class="main">[</span><span class="operator">OF</span> prv_LLq_zer_imp_eql<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 3<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_zer_eqlE <span class="main">=</span> nprv_addImpLemmaE<span class="main">[</span><span class="operator">OF</span> prv_LLq_zer_imp_eql<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 1<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_zer_eqlE0 <span class="main">=</span> nprv_LLq_zer_eqlE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_zer_eqlE1 <span class="main">=</span> nprv_LLq_zer_eqlE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_zer_eqlE01 <span class="main">=</span> nprv_LLq_zer_eqlE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>


<span class="keyword1"><span class="command">lemma</span></span> prv_sdsj_eql_imp_LLq<span class="main">:</span> <span class="comment1">― ‹O2›</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>ldsj <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">eql</span> <span class="free">t</span> <span class="main">(</span>Num <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>toN <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>LLq <span class="free">t</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span>xx<span class="main">,</span>yy<span class="main">]</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> imp<span class="main">[</span><span class="operator">rule</span> <span class="quasi_keyword">del</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">note</span></span> dsj<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_ldsjE0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> i
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"Num <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"LLq <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_hyp<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover3</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> leq_prv_LLq_Num<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_hyp<span class="main">)</span>   <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Rulification: *)</span>
<span class="keyword1"><span class="command">declare</span></span> subset_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_sdsj_eql_LLqI <span class="main">=</span> nprv_addImpLemmaI<span class="main">[</span><span class="operator">OF</span> prv_sdsj_eql_imp_LLq<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 3<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_sdsj_eql_LLqE <span class="main">=</span> nprv_addImpLemmaE<span class="main">[</span><span class="operator">OF</span> prv_sdsj_eql_imp_LLq<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 1<span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> subset_eq<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_sdsj_eql_LLqE0 <span class="main">=</span> nprv_sdsj_eql_LLqE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_sdsj_eql_LLqE1 <span class="main">=</span> nprv_sdsj_eql_LLqE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_sdsj_eql_LLqE01 <span class="main">=</span> nprv_sdsj_eql_LLqE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> O2I <span class="main">=</span> nprv_sdsj_eql_LLqI
<span class="keyword1"><span class="command">lemmas</span></span> O2E <span class="main">=</span> nprv_sdsj_eql_LLqE
<span class="keyword1"><span class="command">lemmas</span></span> O2E0 <span class="main">=</span> nprv_sdsj_eql_LLqE0
<span class="keyword1"><span class="command">lemmas</span></span> O2E1 <span class="main">=</span> nprv_sdsj_eql_LLqE1
<span class="keyword1"><span class="command">lemmas</span></span> O2E01 <span class="main">=</span> nprv_sdsj_eql_LLqE01
<span class="comment1">(* *)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_LLq_imp_sdsj_eql<span class="main">:</span> <span class="comment1">― ‹O3›</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>LLq <span class="free">t</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ldsj <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">eql</span> <span class="free">t</span> <span class="main">(</span>Num <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>toN <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>0 <span class="skolem">t</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> 0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> prv_LLq_zer_imp_eql<span class="main">[</span><span class="operator">OF</span> 0<span class="main">,</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover4</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> nprv_prvI <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> nprv_impI <span class="quasi_keyword">r3</span><span class="main"><span class="main">:</span></span> nprv_ldsjI <span class="quasi_keyword">r4</span><span class="main"><span class="main">:</span></span> prv_nprv1I<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span>  t<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> atrm›</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">]</span> <span class="main">[</span><span class="skolem">t</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> zz"</span></span> <span class="quoted"><span class="quoted">"zz <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> subset_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="skolem">t</span> <span class="free">zer</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">eql</span> <span class="skolem">t</span> <span class="main">(</span>Num <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>Suc <span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟹</span>
    <span class="free">eql</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">eql</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Num <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>Suc <span class="skolem">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">_</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule2</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_zer_suc_casesE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover3</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> nprv_impI <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> nprv_clear2_1 <span class="quasi_keyword">r3</span><span class="main"><span class="main">:</span></span> nprv_ldsjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
         <span class="quoted"><span class="quoted">"<span class="free">imp</span> <span class="main">(</span>LLq <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ldsj <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span> <span class="main">(</span>Num <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>toN <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted">xx</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_LLq_sucE0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addImpLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc.IH<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">z</span>"</span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">simplified</span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_ldsjE0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> i <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_ldsjI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_suc_congI<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Rulification: *)</span>
<span class="keyword1"><span class="command">declare</span></span> subset_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> prv_LLq_sdsj_eqlI <span class="main">=</span> nprv_addImpLemmaI<span class="main">[</span><span class="operator">OF</span> prv_LLq_imp_sdsj_eql<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 3<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> prv_LLq_sdsj_eqlE <span class="main">=</span> nprv_addImpLemmaE<span class="main">[</span><span class="operator">OF</span> prv_LLq_imp_sdsj_eql<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 1<span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> subset_eq<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> prv_LLq_sdsj_eqlE0 <span class="main">=</span> prv_LLq_sdsj_eqlE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> prv_LLq_sdsj_eqlE1 <span class="main">=</span> prv_LLq_sdsj_eqlE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> prv_LLq_sdsj_eqlE01 <span class="main">=</span> prv_LLq_sdsj_eqlE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> O3I <span class="main">=</span> prv_LLq_sdsj_eqlI
<span class="keyword1"><span class="command">lemmas</span></span> O3E <span class="main">=</span> prv_LLq_sdsj_eqlE
<span class="keyword1"><span class="command">lemmas</span></span> O3E0 <span class="main">=</span> prv_LLq_sdsj_eqlE0
<span class="keyword1"><span class="command">lemmas</span></span> O3E1 <span class="main">=</span> prv_LLq_sdsj_eqlE1
<span class="keyword1"><span class="command">lemmas</span></span> O3E01 <span class="main">=</span> prv_LLq_sdsj_eqlE01

<span class="comment1">(*  *)</span>
<span class="keyword1"><span class="command">lemma</span></span> not_leq_prv_neg_LLq_Num<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>  <span class="comment1">(* This is just m &lt; n, of course. *)</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>neg <span class="main">(</span>LLq <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Num <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">fls</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> neg_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> diff_prv_eql_Num<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_negI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> O3E0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_ldsjE0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear3_2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear2_2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> prv_nprv1I<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> consistent_prv_LLq_Num_leq<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted">consistent</span>  <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>LLq <span class="main">(</span>Num <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Num assms consistent_def LLq not_leq_prv_neg_LLq_Num num prv_neg_fls subsetCE<span class="main">)</span>
<span class="comment1">(* *)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_ball_NumI<span class="main">:</span> <span class="comment1">― ‹O4›</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="main">(</span>Num <span class="bound">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>ball <span class="free">x</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_ballI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> O3E0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear2_2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_ldsjE0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear2_2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"Num <span class="main">_</span>"</span></span> <span class="quoted"><span class="free">φ</span></span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> prv_nprvI<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> O4 <span class="main">=</span> prv_ball_NumI

<span class="keyword1"><span class="command">lemma</span></span> prv_bexi_NumI<span class="main">:</span> <span class="comment1">― ‹O5›</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="main">(</span>Num <span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>bexi <span class="free">x</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> leq_prv_LLq_Num<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover4</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> nprv_prvI <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> nprv_bexiI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"Num <span class="free">i</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">r3</span><span class="main"><span class="main">:</span></span> prv_nprvI <span class="quasi_keyword">r4</span><span class="main"><span class="main">:</span></span> prv_nprvI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> O5 <span class="main">=</span> prv_bexi_NumI

<span class="keyword1"><span class="command">lemma</span></span> prv_LLq_Num_imp_Suc<span class="main">:</span> <span class="comment1">― ‹O6›</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>LLq <span class="free">t</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>LLq <span class="free">t</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">prv</span> <span class="main">(</span>LLq <span class="main">(</span>Num <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> Num.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> leq_prv_LLq_Num<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> O3E0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear2_2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_ldsjE0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear2_2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"Num <span class="main">_</span>"</span></span> <span class="quoted"><span class="quoted">"LLq <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted">xx</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> prv_nprvI<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Rulification: *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_Num_SucI <span class="main">=</span> nprv_addImpLemmaI<span class="main">[</span><span class="operator">OF</span> prv_LLq_Num_imp_Suc<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 3<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_Num_SucE <span class="main">=</span> nprv_addImpLemmaE<span class="main">[</span><span class="operator">OF</span> prv_LLq_Num_imp_Suc<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 1<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_Num_SucE0 <span class="main">=</span> nprv_LLq_Num_SucE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_Num_SucE1 <span class="main">=</span> nprv_LLq_Num_SucE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_Num_SucE01 <span class="main">=</span> nprv_LLq_Num_SucE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> O6I <span class="main">=</span> nprv_LLq_Num_SucI
<span class="keyword1"><span class="command">lemmas</span></span> O6E <span class="main">=</span> nprv_LLq_Num_SucE
<span class="keyword1"><span class="command">lemmas</span></span> O6E0 <span class="main">=</span> nprv_LLq_Num_SucE0
<span class="keyword1"><span class="command">lemmas</span></span> O6E1 <span class="main">=</span> nprv_LLq_Num_SucE1
<span class="keyword1"><span class="command">lemmas</span></span> O6E01 <span class="main">=</span> nprv_LLq_Num_SucE01

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Crucial for proving O7:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> prv_LLq_suc_Num_pls_Num<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>LLq <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">]</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> zz"</span></span> <span class="quoted"><span class="quoted">"zz <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">exi</span> <span class="skolem">z</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t</span><span class="main">)</span> <span class="free">zer</span><span class="main">)</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="free">zer</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_pls_zer<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="free">t</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t</span><span class="main">)</span> <span class="free">zer</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="free">t</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="free">pls</span> <span class="free">t</span> <span class="main">(</span><span class="free">suc</span> <span class="free">zer</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_symI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> prv_nprvI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> prv_pls_suc_zer<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LLq_pls<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> nn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">suc</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">note</span></span> Suc.IH<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_pls_suc<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"Num <span class="skolem">n</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">suc</span> <span class="free">t</span><span class="main">)</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"LLq <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_suc_mono_LLqI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> prv_nprvI<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prv_Num_LLq_imp_eql_suc<span class="main">:</span> <span class="comment1">― ‹O7›</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>LLq <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span>
                <span class="main">(</span><span class="free">dsj</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span>
                     <span class="main">(</span>LLq <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">]</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> zz"</span></span> <span class="quoted"><span class="quoted">"zz <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≡</span> getFr <span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">,</span><span class="skolem">z</span><span class="main">]</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> x_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> zz"</span></span> <span class="quoted"><span class="quoted">"zz <span class="main">≠</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">,</span><span class="skolem">z</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> x_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≡</span> getFr <span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">]</span> <span class="main">[</span><span class="free">t</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> y_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> y_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">pls</span> <span class="free">zer</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Num.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> plus_nat.add_0 prv_eql_pls_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>LLq <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prv_LLq_suc_Num_pls_Num<span class="main">)</span>

  <span class="keyword1"><span class="command">note</span></span> LLq_pls<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Num <span class="free">n</span>"</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_exiE0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear2_2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_zer_suc_casesE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">z</span>"</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_dsjIL<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI_rev2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="free">zer</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="free">t</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE
       <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="free">zer</span></span> <span class="quoted"><span class="quoted">"<span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="free">zer</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> prv_nprvI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> prv_prv_eql_sym<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_dsjIR<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI_rev2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="free">t</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE
      <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span>  <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">imp</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t</span> <span class="main">(</span><span class="free">pls</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>  <span class="main">(</span>LLq <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="comment1">(* *)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE
       <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span>  <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"<span class="free">pls</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"LLq <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> prv_nprvI<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Rulification (this one is slightly more complex, as it puts together impE with dsjE): *)</span>
<span class="keyword1"><span class="command">lemma</span></span> prv_Num_LLq_eql_sucE<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="free">F</span> <span class="main">(</span>LLq <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span> <span class="main">⟹</span>
 nprv <span class="main">(</span>insert <span class="main">(</span><span class="free">eql</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span> <span class="main">⟹</span>
 nprv <span class="main">(</span>insert <span class="main">(</span>LLq <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span> <span class="main">⟹</span>
 <span class="free">t</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span>  <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addImpLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_Num_LLq_imp_eql_suc<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule2</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_dsjE0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"LLq <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span><span class="free">eql</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span> <span class="free">F</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span>LLq <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span> <span class="free">F</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> prv_Num_LLq_eql_sucE0 <span class="main">=</span> prv_Num_LLq_eql_sucE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _ _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> prv_Num_LLq_eql_sucE1 <span class="main">=</span> prv_Num_LLq_eql_sucE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> prv_Num_LLq_eql_sucE2 <span class="main">=</span> prv_Num_LLq_eql_sucE<span class="main">[</span><span class="operator">OF</span> _ _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> prv_Num_LLq_eql_sucE01 <span class="main">=</span> prv_Num_LLq_eql_sucE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> prv_Num_LLq_eql_sucE02 <span class="main">=</span> prv_Num_LLq_eql_sucE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> prv_Num_LLq_eql_sucE12 <span class="main">=</span> prv_Num_LLq_eql_sucE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> prv_Num_LLq_eql_sucE012 <span class="main">=</span> prv_Num_LLq_eql_sucE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="comment1">(* *)</span>

<span class="keyword1"><span class="command">lemmas</span></span> O7E <span class="main">=</span> prv_Num_LLq_eql_sucE
<span class="keyword1"><span class="command">lemmas</span></span> O7E0 <span class="main">=</span> prv_Num_LLq_eql_sucE0
<span class="comment1">(**)</span>

<span class="comment1">(* Although we work in intuitionistic logic,
Q decides equality of arbitrary entities with numerals: *)</span>
<span class="keyword1"><span class="command">lemma</span></span> prv_dsj_eql_Num_neg<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">dsj</span> <span class="main">(</span><span class="free">eql</span> <span class="free">t</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">eql</span> <span class="free">t</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="main">(</span>0 <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">]</span> <span class="main">[</span><span class="skolem">t</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> zz"</span></span> <span class="quoted"><span class="quoted">"zz <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_zer_suc_casesE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_dsjIL<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover3</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> nprv_dsjIR <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> nprv_negI <span class="quasi_keyword">r3</span><span class="main"><span class="main">:</span></span> nprv_zer_suc_2contrE01<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> atrm›</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≡</span> getFr <span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">]</span> <span class="main">[</span><span class="skolem">t</span><span class="main">]</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> z_facts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> xx"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> yy"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> zz"</span></span> <span class="quoted"><span class="quoted">"zz <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">FvarsT</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> getFr_FvarsT_Fvars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>xx<span class="main">,</span>yy<span class="main">,</span>zz<span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">t</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_zer_suc_casesE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover3</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> nprv_dsjIR <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> nprv_negI <span class="quasi_keyword">r3</span><span class="main"><span class="main">:</span></span> nprv_zer_suc_2contrE01<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="free">dsj</span> <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc.IH<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="skolem">z</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_dsjE0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover2</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> nprv_dsjIL <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> nprv_suc_congI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover4</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> nprv_dsjIR <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> nprv_negI <span class="quasi_keyword">r3</span><span class="main"><span class="main">:</span></span> nprv_negE0 <span class="quasi_keyword">r4</span><span class="main"><span class="main">:</span></span> nprv_eql_sucI<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Rulification: *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_Num_casesE <span class="main">=</span> nprv_addDsjLemmaE<span class="main">[</span><span class="operator">OF</span> prv_dsj_eql_Num_neg<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_Num_casesE0 <span class="main">=</span> nprv_eql_Num_casesE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_Num_casesE1 <span class="main">=</span> nprv_eql_Num_casesE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_eql_Num_casesE01 <span class="main">=</span> nprv_eql_Num_casesE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="comment1">(* *)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_LLq_Num_dsj<span class="main">:</span>  <span class="comment1">― ‹O8›</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">dsj</span> <span class="main">(</span>LLq <span class="free">t</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>LLq <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">note</span></span> prv_LLq_zer<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover3</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> nprv_prvI <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> nprv_dsjIR <span class="quasi_keyword">r3</span><span class="main"><span class="main">:</span></span> prv_nprvI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> nn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">suc</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> Num <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span>LLq <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> nn<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> leq_prv_LLq_Num<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_addLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Suc.IH<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_dsjE0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover2</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> nprv_dsjIL <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> O6I<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear2_2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule2</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_Num_casesE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover3</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> nprv_dsjIL
      <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> nprv_eql_substE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"Num <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"LLq <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted">xx</span><span class="main"><span class="main">]</span></span>
      <span class="quasi_keyword">r3</span><span class="main"><span class="main">:</span></span> prv_nprvI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> O7E0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover2</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> nprv_eql_symE0 <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> nprv_negE01 <span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_dsjIR<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Rulification: *)</span>
<span class="keyword1"><span class="command">lemma</span></span> prv_LLq_Num_casesE<span class="main">:</span>
<span class="quoted"><span class="quoted">"nprv <span class="main">(</span>insert <span class="main">(</span>LLq <span class="free">t</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span> <span class="main">⟹</span>
 nprv <span class="main">(</span>insert <span class="main">(</span>LLq <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">ψ</span> <span class="main">⟹</span>
 <span class="free">t</span> <span class="main">∈</span> atrm <span class="main">⟹</span> <span class="free">F</span> <span class="main">⊆</span> <span class="free">fmla</span> <span class="main">⟹</span> finite <span class="free">F</span> <span class="main">⟹</span> <span class="free">ψ</span> <span class="main">∈</span> <span class="free">fmla</span> <span class="main">⟹</span>
 nprv <span class="free">F</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nprv_addDsjLemmaE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prv_LLq_Num_dsj<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> prv_LLq_Num_casesE0 <span class="main">=</span> prv_LLq_Num_casesE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> prv_LLq_Num_casesE1 <span class="main">=</span> prv_LLq_Num_casesE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> prv_LLq_Num_casesE01 <span class="main">=</span> prv_LLq_Num_casesE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> O8E <span class="main">=</span> prv_LLq_Num_casesE
<span class="keyword1"><span class="command">lemmas</span></span> O8E0 <span class="main">=</span> prv_LLq_Num_casesE0
<span class="keyword1"><span class="command">lemmas</span></span> O8E1 <span class="main">=</span> prv_LLq_Num_casesE1
<span class="keyword1"><span class="command">lemmas</span></span> O8E01 <span class="main">=</span> prv_LLq_Num_casesE01
<span class="comment1">(* *)</span>

<span class="keyword1"><span class="command">lemma</span></span> prv_imp_LLq_neg_Num_suc<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> atrm"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>LLq <span class="free">t</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">(</span><span class="free">imp</span> <span class="main">(</span><span class="main">(</span>neg <span class="main">(</span><span class="free">eql</span> <span class="free">t</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">(</span>LLq <span class="free">t</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> O3E0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear3_3<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_ldsjE0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> i
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear3_2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI_rev2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">eql</span> <span class="free">t</span> <span class="main">(</span>Num <span class="skolem">i</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"neg <span class="main">(</span><span class="free">eql</span> <span class="free">t</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_eql_substE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="quoted">"Num <span class="skolem">i</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">imp</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>LLq <span class="main">(</span><span class="free">Var</span> xx<span class="main">)</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted">xx</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Suc <span class="free">n</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover2</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> nprv_negE0 <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> nprv_eql_reflI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nprover2</span> <span class="quasi_keyword">r1</span><span class="main"><span class="main">:</span></span> prv_nprvI <span class="quasi_keyword">r2</span><span class="main"><span class="main">:</span></span> leq_prv_LLq_Num<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="comment1">(* Rulification *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_neg_Num_sucI <span class="main">=</span> nprv_addImp2LemmaI<span class="main">[</span><span class="operator">OF</span> prv_imp_LLq_neg_Num_suc<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 3<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_neg_Num_sucE <span class="main">=</span> nprv_addImp2LemmaE<span class="main">[</span><span class="operator">OF</span> prv_imp_LLq_neg_Num_suc<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 1<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_neg_Num_sucE0 <span class="main">=</span> nprv_LLq_neg_Num_sucE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _ _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_neg_Num_sucE1 <span class="main">=</span> nprv_LLq_neg_Num_sucE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_neg_Num_sucE2 <span class="main">=</span> nprv_LLq_neg_Num_sucE<span class="main">[</span><span class="operator">OF</span> _ _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_neg_Num_sucE01 <span class="main">=</span> nprv_LLq_neg_Num_sucE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_neg_Num_sucE02 <span class="main">=</span> nprv_LLq_neg_Num_sucE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_neg_Num_sucE12 <span class="main">=</span> nprv_LLq_neg_Num_sucE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> nprv_LLq_neg_Num_sucE012 <span class="main">=</span> nprv_LLq_neg_Num_sucE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="comment1">(* *)</span>


<span class="keyword1"><span class="command">lemma</span></span> prv_ball_Num_imp_ball_suc<span class="main">:</span>  <span class="comment1">― ‹O9›</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>ball <span class="free">x</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span>
                <span class="main">(</span>ball <span class="free">x</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>neg <span class="main">(</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">suc</span> <span class="main">(</span>Num <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_ballI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_impI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_LLq_neg_Num_sucE01<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear4_2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_clear3_2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_ballE0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"Num <span class="free">n</span>"</span></span> <span class="quoted"><span class="free">φ</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free">x</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

<span class="comment1">(* Rulification: *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> prv_ball_Num_ball_sucI <span class="main">=</span> nprv_addImpLemmaI<span class="main">[</span><span class="operator">OF</span> prv_ball_Num_imp_ball_suc<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 4<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> prv_ball_Num_ball_sucE <span class="main">=</span> nprv_addImpLemmaE<span class="main">[</span><span class="operator">OF</span> prv_ball_Num_imp_ball_suc<span class="main">,</span> <span class="operator">simped</span><span class="main">,</span> <span class="operator">rotated</span> 2<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> prv_ball_Num_ball_sucE0 <span class="main">=</span> prv_ball_Num_ball_sucE<span class="main">[</span><span class="operator">OF</span> nprv_hyp _<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> prv_ball_Num_ball_sucE1 <span class="main">=</span> prv_ball_Num_ball_sucE<span class="main">[</span><span class="operator">OF</span> _ nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> prv_ball_Num_ball_sucE01 <span class="main">=</span> prv_ball_Num_ball_sucE<span class="main">[</span><span class="operator">OF</span> nprv_hyp nprv_hyp<span class="main">,</span> <span class="operator">simped</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> O9I <span class="main">=</span> prv_ball_Num_ball_sucI
<span class="keyword1"><span class="command">lemmas</span></span> O9E <span class="main">=</span> prv_ball_Num_ball_sucE
<span class="keyword1"><span class="command">lemmas</span></span> O9E0 <span class="main">=</span> prv_ball_Num_ball_sucE0
<span class="keyword1"><span class="command">lemmas</span></span> O9E1 <span class="main">=</span> prv_ball_Num_ball_sucE1
<span class="keyword1"><span class="command">lemmas</span></span> O9E01 <span class="main">=</span> prv_ball_Num_ball_sucE01


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Verifying the abstract ordering assumptions›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> LLq_num<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">∈</span> <span class="free">fmla</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">Fvars</span> <span class="free">φ</span> <span class="main">=</span> <span class="main">{</span>zz<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="free">num</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">num</span><span class="main">.</span> <span class="free">prv</span> <span class="main">(</span><span class="free">subst</span> <span class="free">φ</span> <span class="bound">p</span> zz<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">prv</span> <span class="main">(</span><span class="free">all</span> zz <span class="main">(</span><span class="free">imp</span> <span class="main">(</span>LLq <span class="main">(</span><span class="free">Var</span> zz<span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> Num <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q num_Num <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="comment1">― ‹NB: We did not need the whole strength of the assumption p -- we only needed that to hold for
numerals smaller than n. However, the abstract framework allowed us to make this strong assumption,
and did not need to even assume an order on the numerals.›</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> q ball_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> p p num_Num <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> O4<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> LLq_num2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="free">num</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">P</span></span><span class="main">⊆</span><span class="free">num</span><span class="main">.</span> finite <span class="bound">P</span> <span class="main">∧</span> <span class="free">prv</span> <span class="main">(</span><span class="free">dsj</span> <span class="main">(</span>sdsj <span class="main">{</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span> <span class="bound">r</span> <span class="main">|</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="bound">P</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>LLq <span class="free">p</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Num <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms num_Num <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span> <span class="bound">r</span> <span class="main">|</span><span class="bound">r</span><span class="main">.</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">r</span> <span class="main">=</span> Num <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">fmla</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>Num <span class="bound">i</span> <span class="main">|</span> <span class="bound">i</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_prvI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> O8E<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">Var</span> yy"</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_dsjIL<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> O3E0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_ldsjE0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_sdsjI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">eql</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span> <span class="main">(</span>Num <span class="main">_</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_hyp<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">nrule</span> <span class="quasi_keyword">r</span><span class="main"><span class="main">:</span></span> nprv_dsjIR<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹context <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">locale</span> Deduct_Q<span class="antiquote">}</span></span>›</span>

<span class="keyword1"><span class="command">sublocale</span></span> Deduct_Q <span class="main">&lt;</span> lab<span class="main">:</span> Deduct_with_PseudoOrder <span class="keyword2"><span class="keyword">where</span></span> Lq <span class="main">=</span> <span class="quoted"><span class="quoted">"LLq <span class="main">(</span><span class="free">Var</span> zz<span class="main">)</span> <span class="main">(</span><span class="free">Var</span> yy<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span><span class="main"><span class="keyword3">]</span></span> <span class="keyword1"><span class="command">using</span></span> Fvars_Lq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span><span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command">using</span></span> LLq_num LLq_num2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
</pre>
</div>